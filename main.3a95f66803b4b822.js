"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[179],{913:(Wv,qv,In)=>{function kt(e){return"function"==typeof e}function Of(e){const i=e(n=>{Error.call(n),n.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const ru=Of(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((n,r)=>`${r+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function $l(e,t){if(e){const i=e.indexOf(t);0<=i&&e.splice(i,1)}}class en{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const s of i)s.remove(this);else i.remove(this);const{initialTeardown:n}=this;if(kt(n))try{n()}catch(s){t=s instanceof ru?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{au(s)}catch(o){t=t??[],o instanceof ru?t=[...t,...o.errors]:t.push(o)}}if(t)throw new ru(t)}}add(t){var i;if(t&&t!==this)if(this.closed)au(t);else{if(t instanceof en){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(t)}}_hasParent(t){const{_parentage:i}=this;return i===t||Array.isArray(i)&&i.includes(t)}_addParent(t){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(t),i):i?[i,t]:t}_removeParent(t){const{_parentage:i}=this;i===t?this._parentage=null:Array.isArray(i)&&$l(i,t)}remove(t){const{_finalizers:i}=this;i&&$l(i,t),t instanceof en&&t._removeParent(this)}}en.EMPTY=(()=>{const e=new en;return e.closed=!0,e})();const su=en.EMPTY;function ou(e){return e instanceof en||e&&"closed"in e&&kt(e.remove)&&kt(e.add)&&kt(e.unsubscribe)}function au(e){kt(e)?e():e.unsubscribe()}const Es={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ra={setTimeout(e,t,...i){const{delegate:n}=ra;return n?.setTimeout?n.setTimeout(e,t,...i):setTimeout(e,t,...i)},clearTimeout(e){const{delegate:t}=ra;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function $a(e){ra.setTimeout(()=>{const{onUnhandledError:t}=Es;if(!t)throw e;t(e)})}function Lf(){}const yq=yx("C",void 0,void 0);function yx(e,t,i){return{kind:e,value:t,error:i}}let lu=null;function Yv(e){if(Es.useDeprecatedSynchronousErrorHandling){const t=!lu;if(t&&(lu={errorThrown:!1,error:null}),e(),t){const{errorThrown:i,error:n}=lu;if(lu=null,i)throw n}}else e()}class _x extends en{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ou(t)&&t.add(this)):this.destination=Eq}static create(t,i,n){return new Nf(t,i,n)}next(t){this.isStopped?wx(function bq(e){return yx("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?wx(function _q(e){return yx("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?wx(yq,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const xq=Function.prototype.bind;function bx(e,t){return xq.call(e,t)}class Sq{constructor(t){this.partialObserver=t}next(t){const{partialObserver:i}=this;if(i.next)try{i.next(t)}catch(n){Xv(n)}}error(t){const{partialObserver:i}=this;if(i.error)try{i.error(t)}catch(n){Xv(n)}else Xv(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(i){Xv(i)}}}class Nf extends _x{constructor(t,i,n){let r;if(super(),kt(t)||!t)r={next:t??void 0,error:i??void 0,complete:n??void 0};else{let s;this&&Es.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&bx(t.next,s),error:t.error&&bx(t.error,s),complete:t.complete&&bx(t.complete,s)}):r=t}this.destination=new Sq(r)}}function Xv(e){Es.useDeprecatedSynchronousErrorHandling?function wq(e){Es.useDeprecatedSynchronousErrorHandling&&lu&&(lu.errorThrown=!0,lu.error=e)}(e):$a(e)}function wx(e,t){const{onStoppedNotification:i}=Es;i&&ra.setTimeout(()=>i(e,t))}const Eq={closed:!0,next:Lf,error:function Cq(e){throw e},complete:Lf},xx="function"==typeof Symbol&&Symbol.observable||"@@observable";function Jl(e){return e}function V2(e){return 0===e.length?Jl:1===e.length?e[0]:function(i){return e.reduce((n,r)=>r(n),i)}}let Bi=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){const n=new e;return n.source=this,n.operator=i,n}subscribe(i,n,r){const s=function Dq(e){return e&&e instanceof _x||function Aq(e){return e&&kt(e.next)&&kt(e.error)&&kt(e.complete)}(e)&&ou(e)}(i)?i:new Nf(i,n,r);return Yv(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(i){try{return this._subscribe(i)}catch(n){i.error(n)}}forEach(i,n){return new(n=z2(n))((r,s)=>{const o=new Nf({next:a=>{try{i(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(i){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(i)}[xx](){return this}pipe(...i){return V2(i)(this)}toPromise(i){return new(i=z2(i))((n,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>n(s))})}}return e.create=t=>new e(t),e})();function z2(e){var t;return null!==(t=e??Es.Promise)&&void 0!==t?t:Promise}const Tq=Of(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let yi=(()=>{class e extends Bi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const n=new U2(this,this);return n.operator=i,n}_throwIfClosed(){if(this.closed)throw new Tq}next(i){Yv(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(i)}})}error(i){Yv(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:n}=this;for(;n.length;)n.shift().error(i)}})}complete(){Yv(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:n,isStopped:r,observers:s}=this;return n||r?su:(this.currentObservers=null,s.push(i),new en(()=>{this.currentObservers=null,$l(s,i)}))}_checkFinalizedStatuses(i){const{hasError:n,thrownError:r,isStopped:s}=this;n?i.error(r):s&&i.complete()}asObservable(){const i=new Bi;return i.source=this,i}}return e.create=(t,i)=>new U2(t,i),e})();class U2 extends yi{constructor(t,i){super(),this.destination=t,this.source=i}next(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===n||n.call(i,t)}error(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===n||n.call(i,t)}complete(){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===i||i.call(t)}_subscribe(t){var i,n;return null!==(n=null===(i=this.source)||void 0===i?void 0:i.subscribe(t))&&void 0!==n?n:su}}function j2(e){return kt(e?.lift)}function mn(e){return t=>{if(j2(t))return t.lift(function(i){try{return e(i,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Wi(e,t,i,n,r){return new Iq(e,t,i,n,r)}class Iq extends _x{constructor(t,i,n,r,s,o){super(t),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=i?function(a){try{i(a)}catch(l){t.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){t.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Si(e,t){return mn((i,n)=>{let r=0;i.subscribe(Wi(n,s=>{n.next(e.call(t,s,r++))}))})}function ec(e){return this instanceof ec?(this.v=e,this):new ec(e)}function q2(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Mx(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i);function n(s){i[s]=e[s]&&function(o){return new Promise(function(a,l){!function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=e[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Ax=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Y2(e){return kt(e?.then)}function X2(e){return kt(e[xx])}function Z2(e){return Symbol.asyncIterator&&kt(e?.[Symbol.asyncIterator])}function Q2(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const K2=function $q(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function $2(e){return kt(e?.[K2])}function J2(e){return function W2(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=i.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(d){n[d]&&(r[d]=function(p){return new Promise(function(f,m){s.push([d,p,f,m])>1||a(d,p)})})}function a(d,p){try{!function l(d){d.value instanceof ec?Promise.resolve(d.value.v).then(c,h):u(s[0][2],d)}(n[d](p))}catch(f){u(s[0][3],f)}}function c(d){a("next",d)}function h(d){a("throw",d)}function u(d,p){d(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const i=e.getReader();try{for(;;){const{value:n,done:r}=yield ec(i.read());if(r)return yield ec(void 0);yield yield ec(n)}}finally{i.releaseLock()}})}function eP(e){return kt(e?.getReader)}function Mr(e){if(e instanceof Bi)return e;if(null!=e){if(X2(e))return function Jq(e){return new Bi(t=>{const i=e[xx]();if(kt(i.subscribe))return i.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ax(e))return function e7(e){return new Bi(t=>{for(let i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()})}(e);if(Y2(e))return function t7(e){return new Bi(t=>{e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,$a)})}(e);if(Z2(e))return tP(e);if($2(e))return function i7(e){return new Bi(t=>{for(const i of e)if(t.next(i),t.closed)return;t.complete()})}(e);if(eP(e))return function n7(e){return tP(J2(e))}(e)}throw Q2(e)}function tP(e){return new Bi(t=>{(function r7(e,t){var i,n,r,s;return function H2(e,t,i,n){return new(i||(i=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):function r(s){return s instanceof i?s:new i(function(o){o(s)})}(h.value).then(a,l)}c((n=n.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(i=q2(e);!(n=yield i.next()).done;)if(t.next(n.value),t.closed)return}catch(o){r={error:o}}finally{try{n&&!n.done&&(s=i.return)&&(yield s.call(i))}finally{if(r)throw r.error}}t.complete()})})(e,t).catch(i=>t.error(i))})}function Ja(e,t,i,n=0,r=!1){const s=t.schedule(function(){i(),r?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!r)return s}function Gn(e,t,i=1/0){return kt(t)?Gn((n,r)=>Si((s,o)=>t(n,s,r,o))(Mr(e(n,r))),i):("number"==typeof t&&(i=t),mn((n,r)=>function s7(e,t,i,n,r,s,o,a){const l=[];let c=0,h=0,u=!1;const d=()=>{u&&!l.length&&!c&&t.complete()},p=m=>c<n?f(m):l.push(m),f=m=>{s&&t.next(m),c++;let g=!1;Mr(i(m,h++)).subscribe(Wi(t,v=>{r?.(v),s?p(v):t.next(v)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<n;){const v=l.shift();o?Ja(t,o,()=>f(v)):f(v)}d()}catch(v){t.error(v)}}))};return e.subscribe(Wi(t,p,()=>{u=!0,d()})),()=>{a?.()}}(n,r,e,i)))}function Ih(e=1/0){return Gn(Jl,e)}const xo=new Bi(e=>e.complete());function iP(e){return e&&kt(e.schedule)}function Dx(e){return e[e.length-1]}function nP(e){return kt(Dx(e))?e.pop():void 0}function kf(e){return iP(Dx(e))?e.pop():void 0}function rP(e,t=0){return mn((i,n)=>{i.subscribe(Wi(n,r=>Ja(n,e,()=>n.next(r),t),()=>Ja(n,e,()=>n.complete(),t),r=>Ja(n,e,()=>n.error(r),t)))})}function sP(e,t=0){return mn((i,n)=>{n.add(e.schedule(()=>i.subscribe(n),t))})}function oP(e,t){if(!e)throw new Error("Iterable cannot be null");return new Bi(i=>{Ja(i,t,()=>{const n=e[Symbol.asyncIterator]();Ja(i,t,()=>{n.next().then(r=>{r.done?i.complete():i.next(r.value)})},0,!0)})})}function Pn(e,t){return t?function p7(e,t){if(null!=e){if(X2(e))return function l7(e,t){return Mr(e).pipe(sP(t),rP(t))}(e,t);if(Ax(e))return function u7(e,t){return new Bi(i=>{let n=0;return t.schedule(function(){n===e.length?i.complete():(i.next(e[n++]),i.closed||this.schedule())})})}(e,t);if(Y2(e))return function c7(e,t){return Mr(e).pipe(sP(t),rP(t))}(e,t);if(Z2(e))return oP(e,t);if($2(e))return function h7(e,t){return new Bi(i=>{let n;return Ja(i,t,()=>{n=e[K2](),Ja(i,t,()=>{let r,s;try{({value:r,done:s}=n.next())}catch(o){return void i.error(o)}s?i.complete():i.next(r)},0,!0)}),()=>kt(n?.return)&&n.return()})}(e,t);if(eP(e))return function d7(e,t){return oP(J2(e),t)}(e,t)}throw Q2(e)}(e,t):Mr(e)}function aP(...e){const t=kf(e),i=function a7(e,t){return"number"==typeof Dx(e)?e.pop():t}(e,1/0),n=e;return n.length?1===n.length?Mr(n[0]):Ih(i)(Pn(n,t)):xo}class Gs extends yi{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const i=super._subscribe(t);return!i.closed&&t.next(this._value),i}getValue(){const{hasError:t,thrownError:i,_value:n}=this;if(t)throw i;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}}function gt(...e){return Pn(e,kf(e))}function lP(e={}){const{connector:t=(()=>new yi),resetOnError:i=!0,resetOnComplete:n=!0,resetOnRefCountZero:r=!0}=e;return s=>{let o,a,l,c=0,h=!1,u=!1;const d=()=>{a?.unsubscribe(),a=void 0},p=()=>{d(),o=l=void 0,h=u=!1},f=()=>{const m=o;p(),m?.unsubscribe()};return mn((m,g)=>{c++,!u&&!h&&d();const v=l=l??t();g.add(()=>{c--,0===c&&!u&&!h&&(a=Tx(f,r))}),v.subscribe(g),!o&&c>0&&(o=new Nf({next:y=>v.next(y),error:y=>{u=!0,d(),a=Tx(p,i,y),v.error(y)},complete:()=>{h=!0,d(),a=Tx(p,n),v.complete()}}),Mr(m).subscribe(o))})(s)}}function Tx(e,t,...i){if(!0===t)return void e();if(!1===t)return;const n=new Nf({next:()=>{n.unsubscribe(),e()}});return Mr(t(...i)).subscribe(n)}function So(e,t){return mn((i,n)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&n.complete();i.subscribe(Wi(n,l=>{r?.unsubscribe();let c=0;const h=s++;Mr(e(l,h)).subscribe(r=Wi(n,u=>n.next(t?t(l,u,h,c++):u),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function m7(e,t){return e===t}function ci(e){for(let t in e)if(e[t]===ci)return t;throw Error("Could not find renamed property on target object.")}function Zv(e,t){for(const i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function Rn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Rn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const i=t.indexOf("\n");return-1===i?t:t.substring(0,i)}function Ix(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const g7=ci({__forward_ref__:ci});function ui(e){return e.__forward_ref__=ui,e.toString=function(){return Rn(this())},e}function vt(e){return Px(e)?e():e}function Px(e){return"function"==typeof e&&e.hasOwnProperty(g7)&&e.__forward_ref__===ui}function Rx(e){return e&&!!e.\u0275providers}class be extends Error{constructor(t,i){super(function Qv(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,i)),this.code=t}}function _t(e){return"string"==typeof e?e:null==e?"":String(e)}function Ox(e,t){throw new be(-201,!1)}function Ws(e,t){null==e&&function dt(e,t,i,n){throw new Error(`ASSERTION ERROR: ${e}`+(null==n?"":` [Expected=> ${i} ${n} ${t} <=Actual]`))}(t,e,null,"!=")}function je(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ti(e){return{providers:e.providers||[],imports:e.imports||[]}}function Kv(e){return uP(e,Jv)||uP(e,hP)}function uP(e,t){return e.hasOwnProperty(t)?e[t]:null}function $v(e){return e&&(e.hasOwnProperty(Lx)||e.hasOwnProperty(C7))?e[Lx]:null}const Jv=ci({\u0275prov:ci}),Lx=ci({\u0275inj:ci}),hP=ci({ngInjectableDef:ci}),C7=ci({ngInjectorDef:ci});var Ft=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Ft||{});let Nx;function rs(e){const t=Nx;return Nx=e,t}function pP(e,t,i){const n=Kv(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:i&Ft.Optional?null:void 0!==t?t:void Ox(Rn(e))}const Di=globalThis;class Le{constructor(t,i){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=je({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Ff={},zx="__NG_DI_FLAG__",ey="ngTempTokenPath",A7=/\n/gm,mP="__source";let Ph;function tc(e){const t=Ph;return Ph=e,t}function I7(e,t=Ft.Default){if(void 0===Ph)throw new be(-203,!1);return null===Ph?pP(e,void 0,t):Ph.get(e,t&Ft.Optional?null:void 0,t)}function we(e,t=Ft.Default){return(function dP(){return Nx}()||I7)(vt(e),t)}function We(e,t=Ft.Default){return we(e,ty(t))}function ty(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Ux(e){const t=[];for(let i=0;i<e.length;i++){const n=vt(e[i]);if(Array.isArray(n)){if(0===n.length)throw new be(900,!1);let r,s=Ft.Default;for(let o=0;o<n.length;o++){const a=n[o],l=P7(a);"number"==typeof l?-1===l?r=a.token:s|=l:r=a}t.push(we(r,s))}else t.push(we(n))}return t}function Bf(e,t){return e[zx]=t,e.prototype[zx]=t,e}function P7(e){return e[zx]}function el(e){return{toString:e}.toString()}var iy=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(iy||{}),Co=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Co||{});const sa={},Kt=[],ny=ci({\u0275cmp:ci}),jx=ci({\u0275dir:ci}),Hx=ci({\u0275pipe:ci}),vP=ci({\u0275mod:ci}),tl=ci({\u0275fac:ci}),Vf=ci({__NG_ELEMENT_ID__:ci}),yP=ci({__NG_ENV_ID__:ci});function _P(e,t,i){let n=e.length;for(;;){const r=e.indexOf(t,i);if(-1===r)return r;if(0===r||e.charCodeAt(r-1)<=32){const s=t.length;if(r+s===n||e.charCodeAt(r+s)<=32)return r}i=r+1}}function Gx(e,t,i){let n=0;for(;n<i.length;){const r=i[n];if("number"==typeof r){if(0!==r)break;n++;const s=i[n++],o=i[n++],a=i[n++];e.setAttribute(t,o,a,s)}else{const s=r,o=i[++n];wP(s)?e.setProperty(t,s,o):e.setAttribute(t,s,o),n++}}return n}function bP(e){return 3===e||4===e||6===e}function wP(e){return 64===e.charCodeAt(0)}function zf(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let i=-1;for(let n=0;n<t.length;n++){const r=t[n];"number"==typeof r?i=r:0===i||xP(e,i,r,null,-1===i||2===i?t[++n]:null)}}return e}function xP(e,t,i,n,r){let s=0,o=e.length;if(-1===t)o=-1;else for(;s<e.length;){const a=e[s++];if("number"==typeof a){if(a===t){o=-1;break}if(a>t){o=s-1;break}}}for(;s<e.length;){const a=e[s];if("number"==typeof a)break;if(a===i){if(null===n)return void(null!==r&&(e[s+1]=r));if(n===e[s+1])return void(e[s+2]=r)}s++,null!==n&&s++,null!==r&&s++}-1!==o&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,i),null!==n&&e.splice(s++,0,n),null!==r&&e.splice(s++,0,r)}const SP="ng-template";function L7(e,t,i){let n=0,r=!0;for(;n<e.length;){let s=e[n++];if("string"==typeof s&&r){const o=e[n++];if(i&&"class"===s&&-1!==_P(o.toLowerCase(),t,0))return!0}else{if(1===s){for(;n<e.length&&"string"==typeof(s=e[n++]);)if(s.toLowerCase()===t)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function CP(e){return 4===e.type&&e.value!==SP}function N7(e,t,i){return t===(4!==e.type||i?e.value:SP)}function k7(e,t,i){let n=4;const r=e.attrs||[],s=function V7(e){for(let t=0;t<e.length;t++)if(bP(e[t]))return t;return e.length}(r);let o=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!o)if(4&n){if(n=2|1&n,""!==l&&!N7(e,l,i)||""===l&&1===t.length){if(Eo(n))return!1;o=!0}}else{const c=8&n?l:t[++a];if(8&n&&null!==e.attrs){if(!L7(e.attrs,c,i)){if(Eo(n))return!1;o=!0}continue}const u=F7(8&n?"class":l,r,CP(e),i);if(-1===u){if(Eo(n))return!1;o=!0;continue}if(""!==c){let d;d=u>s?"":r[u+1].toLowerCase();const p=8&n?d:null;if(p&&-1!==_P(p,c,0)||2&n&&c!==d){if(Eo(n))return!1;o=!0}}}}else{if(!o&&!Eo(n)&&!Eo(l))return!1;if(o&&Eo(l))continue;o=!1,n=l|1&n}}return Eo(n)||o}function Eo(e){return 0==(1&e)}function F7(e,t,i,n){if(null===t)return-1;let r=0;if(n||!i){let s=!1;for(;r<t.length;){const o=t[r];if(o===e)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=t[++r];for(;"string"==typeof a;)a=t[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function z7(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const n=e[i];if("number"==typeof n)return-1;if(n===t)return i;i++}return-1}(t,e)}function EP(e,t,i=!1){for(let n=0;n<t.length;n++)if(k7(e,t[n],i))return!0;return!1}function U7(e,t){e:for(let i=0;i<t.length;i++){const n=t[i];if(e.length===n.length){for(let r=0;r<e.length;r++)if(e[r]!==n[r])continue e;return!0}}return!1}function MP(e,t){return e?":not("+t.trim()+")":t}function j7(e){let t=e[0],i=1,n=2,r="",s=!1;for(;i<e.length;){let o=e[i];if("string"==typeof o)if(2&n){const a=e[++i];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&n?r+="."+o:4&n&&(r+=" "+o);else""!==r&&!Eo(o)&&(t+=MP(s,r),r=""),n=o,s=s||!Eo(n);i++}return""!==r&&(t+=MP(s,r)),t}function Ar(e){return el(()=>{const t=DP(e),i={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===iy.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Co.Emulated,styles:e.styles||Kt,_:null,schemas:e.schemas||null,tView:null,id:""};TP(i);const n=e.dependencies;return i.directiveDefs=ry(n,!1),i.pipeDefs=ry(n,!0),i.id=function Q7(e){let t=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const r of i)t=Math.imul(31,t)+r.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(i),i})}function q7(e){return Wt(e)||Jn(e)}function Y7(e){return null!==e}function oi(e){return el(()=>({type:e.type,bootstrap:e.bootstrap||Kt,declarations:e.declarations||Kt,imports:e.imports||Kt,exports:e.exports||Kt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function AP(e,t){if(null==e)return sa;const i={};for(const n in e)if(e.hasOwnProperty(n)){let r=e[n],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),i[r]=n,t&&(t[r]=s)}return i}function et(e){return el(()=>{const t=DP(e);return TP(t),t})}function Wt(e){return e[ny]||null}function Jn(e){return e[jx]||null}function Dr(e){return e[Hx]||null}function As(e,t){const i=e[vP]||null;if(!i&&!0===t)throw new Error(`Type ${Rn(e)} does not have '\u0275mod' property.`);return i}function DP(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||sa,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Kt,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:AP(e.inputs,t),outputs:AP(e.outputs)}}function TP(e){e.features?.forEach(t=>t(e))}function ry(e,t){if(!e)return null;const i=t?Dr:q7;return()=>("function"==typeof e?e():e).map(n=>i(n)).filter(Y7)}const qi=0,ke=1,At=2,Vi=3,Mo=4,Uf=5,cr=6,Oh=7,tn=8,ic=9,Lh=10,bt=11,jf=12,IP=13,Nh=14,nn=15,Hf=16,kh=17,oa=18,Gf=19,PP=20,nc=21,il=22,Wf=23,qf=24,Bt=25,Wx=1,RP=2,aa=7,Fh=9,er=11;function os(e){return Array.isArray(e)&&"object"==typeof e[Wx]}function Tr(e){return Array.isArray(e)&&!0===e[Wx]}function qx(e){return 0!=(4&e.flags)}function uu(e){return e.componentOffset>-1}function oy(e){return 1==(1&e.flags)}function Ao(e){return!!e.template}function Yx(e){return 0!=(512&e[At])}function hu(e,t){return e.hasOwnProperty(tl)?e[tl]:null}let tr=null,ay=!1;function qs(e){const t=tr;return tr=e,t}const NP={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function FP(e){if(!Xf(e)||e.dirty){if(!e.producerMustRecompute(e)&&!zP(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function VP(e){e.dirty=!0,function BP(e){if(void 0===e.liveConsumerNode)return;const t=ay;ay=!0;try{for(const i of e.liveConsumerNode)i.dirty||VP(i)}finally{ay=t}}(e),e.consumerMarkedDirty?.(e)}function Zx(e){return e&&(e.nextProducerIndex=0),qs(e)}function Qx(e,t){if(qs(t),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Xf(e))for(let i=e.nextProducerIndex;i<e.producerNode.length;i++)ly(e.producerNode[i],e.producerIndexOfThis[i]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function zP(e){Bh(e);for(let t=0;t<e.producerNode.length;t++){const i=e.producerNode[t],n=e.producerLastReadVersion[t];if(n!==i.version||(FP(i),n!==i.version))return!0}return!1}function UP(e){if(Bh(e),Xf(e))for(let t=0;t<e.producerNode.length;t++)ly(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function ly(e,t){if(function HP(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),Bh(e),1===e.liveConsumerNode.length)for(let n=0;n<e.producerNode.length;n++)ly(e.producerNode[n],e.producerIndexOfThis[n]);const i=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[i],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[i],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){const n=e.liveConsumerIndexOfThis[t],r=e.liveConsumerNode[t];Bh(r),r.producerIndexOfThis[n]=t}}function Xf(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Bh(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let GP=null;const XP=()=>{},cY=(()=>({...NP,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:XP}))();class uY{constructor(t,i,n){this.previousValue=t,this.currentValue=i,this.firstChange=n}isFirstChange(){return this.firstChange}}function Ys(){return ZP}function ZP(e){return e.type.prototype.ngOnChanges&&(e.setInput=dY),hY}function hY(){const e=KP(this),t=e?.current;if(t){const i=e.previous;if(i===sa)e.previous=t;else for(let n in t)i[n]=t[n];e.current=null,this.ngOnChanges(t)}}function dY(e,t,i,n){const r=this.declaredInputs[i],s=KP(e)||function pY(e,t){return e[QP]=t}(e,{previous:sa,current:null}),o=s.current||(s.current={}),a=s.previous,l=a[r];o[r]=new uY(l&&l.currentValue,t,a===sa),e[n]=t}Ys.ngInherit=!0;const QP="__ngSimpleChanges__";function KP(e){return e[QP]||null}const la=function(e,t,i){};function Ti(e){for(;Array.isArray(e);)e=e[qi];return e}function cy(e,t){return Ti(t[e])}function as(e,t){return Ti(t[e.index])}function eR(e,t){return e.data[t]}function Ds(e,t){const i=t[e];return os(i)?i:i[qi]}function sc(e,t){return null==t?null:e[t]}function tR(e){e[kh]=0}function _Y(e){1024&e[At]||(e[At]|=1024,nR(e,1))}function iR(e){1024&e[At]&&(e[At]&=-1025,nR(e,-1))}function nR(e,t){let i=e[Vi];if(null===i)return;i[Uf]+=t;let n=i;for(i=i[Vi];null!==i&&(1===t&&1===n[Uf]||-1===t&&0===n[Uf]);)i[Uf]+=t,n=i,i=i[Vi]}const pt={lFrame:fR(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function oR(){return pt.bindingsEnabled}function zh(){return null!==pt.skipHydrationRootTNode}function ve(){return pt.lFrame.lView}function qt(){return pt.lFrame.tView}function ir(){let e=aR();for(;null!==e&&64===e.type;)e=e.parent;return e}function aR(){return pt.lFrame.currentTNode}function ca(e,t){const i=pt.lFrame;i.currentTNode=e,i.isParent=t}function t1(){return pt.lFrame.isParent}function n1(){pt.lFrame.isParent=!1}function Uh(){return pt.lFrame.bindingIndex++}function rl(e){const t=pt.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}function OY(e,t){const i=pt.lFrame;i.bindingIndex=i.bindingRootIndex=e,r1(t)}function r1(e){pt.lFrame.currentDirectiveIndex=e}function hR(){return pt.lFrame.currentQueryIndex}function o1(e){pt.lFrame.currentQueryIndex=e}function NY(e){const t=e[ke];return 2===t.type?t.declTNode:1===t.type?e[cr]:null}function dR(e,t,i){if(i&Ft.SkipSelf){let r=t,s=e;for(;!(r=r.parent,null!==r||i&Ft.Host||(r=NY(s),null===r||(s=s[Nh],10&r.type))););if(null===r)return!1;t=r,e=s}const n=pt.lFrame=pR();return n.currentTNode=t,n.lView=e,!0}function a1(e){const t=pR(),i=e[ke];pt.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function pR(){const e=pt.lFrame,t=null===e?null:e.child;return null===t?fR(e):t}function fR(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function mR(){const e=pt.lFrame;return pt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gR=mR;function l1(){const e=mR();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Pr(){return pt.lFrame.selectedIndex}function du(e){pt.lFrame.selectedIndex=e}function Ui(){const e=pt.lFrame;return eR(e.tView,e.selectedIndex)}function c1(){pt.lFrame.currentNamespace="svg"}function u1(){!function VY(){pt.lFrame.currentNamespace=null}()}let yR=!0;function uy(){return yR}function oc(e){yR=e}function hy(e,t){for(let i=t.directiveStart,n=t.directiveEnd;i<n;i++){const s=e.data[i].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:h}=s;o&&(e.contentHooks??=[]).push(-i,o),a&&((e.contentHooks??=[]).push(i,a),(e.contentCheckHooks??=[]).push(i,a)),l&&(e.viewHooks??=[]).push(-i,l),c&&((e.viewHooks??=[]).push(i,c),(e.viewCheckHooks??=[]).push(i,c)),null!=h&&(e.destroyHooks??=[]).push(i,h)}}function dy(e,t,i){_R(e,t,3,i)}function py(e,t,i,n){(3&e[At])===i&&_R(e,t,i,n)}function h1(e,t){let i=e[At];(3&i)===t&&(i&=8191,i+=1,e[At]=i)}function _R(e,t,i,n){const s=n??-1,o=t.length-1;let a=0;for(let l=void 0!==n?65535&e[kh]:0;l<o;l++)if("number"==typeof t[l+1]){if(a=t[l],null!=n&&a>=n)break}else t[l]<0&&(e[kh]+=65536),(a<s||-1==s)&&(UY(e,i,t,l),e[kh]=(4294901760&e[kh])+l+2),l++}function bR(e,t){la(4,e,t);const i=qs(null);try{t.call(e)}finally{qs(i),la(5,e,t)}}function UY(e,t,i,n){const r=i[n]<0,s=i[n+1],a=e[r?-i[n]:i[n]];r?e[At]>>13<e[kh]>>16&&(3&e[At])===t&&(e[At]+=8192,bR(a,s)):bR(a,s)}const jh=-1;class Qf{constructor(t,i,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=n}}function p1(e){return e!==jh}function Kf(e){return 32767&e}function $f(e,t){let i=function WY(e){return e>>16}(e),n=t;for(;i>0;)n=n[Nh],i--;return n}let f1=!0;function fy(e){const t=f1;return f1=e,t}const wR=255,xR=5;let qY=0;const ua={};function my(e,t){const i=SR(e,t);if(-1!==i)return i;const n=t[ke];n.firstCreatePass&&(e.injectorIndex=t.length,m1(n.data,e),m1(t,null),m1(n.blueprint,null));const r=gy(e,t),s=e.injectorIndex;if(p1(r)){const o=Kf(r),a=$f(r,t),l=a[ke].data;for(let c=0;c<8;c++)t[s+c]=a[o+c]|l[o+c]}return t[s+8]=r,s}function m1(e,t){e.push(0,0,0,0,0,0,0,0,t)}function SR(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function gy(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,n=null,r=t;for(;null!==r;){if(n=IR(r),null===n)return jh;if(i++,r=r[Nh],-1!==n.injectorIndex)return n.injectorIndex|i<<16}return jh}function g1(e,t,i){!function YY(e,t,i){let n;"string"==typeof i?n=i.charCodeAt(0)||0:i.hasOwnProperty(Vf)&&(n=i[Vf]),null==n&&(n=i[Vf]=qY++);const r=n&wR;t.data[e+(r>>xR)]|=1<<r}(e,t,i)}function CR(e,t,i){if(i&Ft.Optional||void 0!==e)return e;Ox()}function ER(e,t,i,n){if(i&Ft.Optional&&void 0===n&&(n=null),!(i&(Ft.Self|Ft.Host))){const r=e[ic],s=rs(void 0);try{return r?r.get(t,n,i&Ft.Optional):pP(t,n,i&Ft.Optional)}finally{rs(s)}}return CR(n,0,i)}function MR(e,t,i,n=Ft.Default,r){if(null!==e){if(2048&t[At]&&!(n&Ft.Self)){const o=function JY(e,t,i,n,r){let s=e,o=t;for(;null!==s&&null!==o&&2048&o[At]&&!(512&o[At]);){const a=AR(s,o,i,n|Ft.Self,ua);if(a!==ua)return a;let l=s.parent;if(!l){const c=o[PP];if(c){const h=c.get(i,ua,n);if(h!==ua)return h}l=IR(o),o=o[Nh]}s=l}return r}(e,t,i,n,ua);if(o!==ua)return o}const s=AR(e,t,i,n,ua);if(s!==ua)return s}return ER(t,i,n,r)}function AR(e,t,i,n,r){const s=function QY(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Vf)?e[Vf]:void 0;return"number"==typeof t?t>=0?t&wR:$Y:t}(i);if("function"==typeof s){if(!dR(t,e,n))return n&Ft.Host?CR(r,0,n):ER(t,i,n,r);try{let o;if(o=s(n),null!=o||n&Ft.Optional)return o;Ox()}finally{gR()}}else if("number"==typeof s){let o=null,a=SR(e,t),l=jh,c=n&Ft.Host?t[nn][cr]:null;for((-1===a||n&Ft.SkipSelf)&&(l=-1===a?gy(e,t):t[a+8],l!==jh&&TR(n,!1)?(o=t[ke],a=Kf(l),t=$f(l,t)):a=-1);-1!==a;){const h=t[ke];if(DR(s,a,h.data)){const u=ZY(a,t,i,o,n,c);if(u!==ua)return u}l=t[a+8],l!==jh&&TR(n,t[ke].data[a+8]===c)&&DR(s,a,t)?(o=h,a=Kf(l),t=$f(l,t)):a=-1}}return r}function ZY(e,t,i,n,r,s){const o=t[ke],a=o.data[e+8],h=vy(a,o,i,null==n?uu(a)&&f1:n!=o&&0!=(3&a.type),r&Ft.Host&&s===a);return null!==h?pu(t,o,h,a):ua}function vy(e,t,i,n,r){const s=e.providerIndexes,o=t.data,a=1048575&s,l=e.directiveStart,h=s>>20,d=r?a+h:e.directiveEnd;for(let p=n?a:a+h;p<d;p++){const f=o[p];if(p<l&&i===f||p>=l&&f.type===i)return p}if(r){const p=o[l];if(p&&Ao(p)&&p.type===i)return l}return null}function pu(e,t,i,n){let r=e[i];const s=t.data;if(function jY(e){return e instanceof Qf}(r)){const o=r;o.resolving&&function v7(e,t){const i=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new be(-200,`Circular dependency in DI detected for ${e}${i}`)}(function si(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_t(e)}(s[i]));const a=fy(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?rs(o.injectImpl):null;dR(e,n,Ft.Default);try{r=e[i]=o.factory(void 0,s,e,n),t.firstCreatePass&&i>=n.directiveStart&&function zY(e,t,i){const{ngOnChanges:n,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(n){const o=ZP(t);(i.preOrderHooks??=[]).push(e,o),(i.preOrderCheckHooks??=[]).push(e,o)}r&&(i.preOrderHooks??=[]).push(0-e,r),s&&((i.preOrderHooks??=[]).push(e,s),(i.preOrderCheckHooks??=[]).push(e,s))}(i,s[i],t)}finally{null!==c&&rs(c),fy(a),o.resolving=!1,gR()}}return r}function DR(e,t,i){return!!(i[t+(e>>xR)]&1<<e)}function TR(e,t){return!(e&Ft.Self||e&Ft.Host&&t)}class Rr{constructor(t,i){this._tNode=t,this._lView=i}get(t,i,n){return MR(this._tNode,this._lView,t,ty(n),i)}}function $Y(){return new Rr(ir(),ve())}function v1(e){return Px(e)?()=>{const t=v1(vt(e));return t&&t()}:hu(e)}function IR(e){const t=e[ke],i=t.type;return 2===i?t.declTNode:1===i?e[cr]:null}const Gh="__parameters__";function qh(e,t,i){return el(()=>{const n=function y1(e){return function(...i){if(e){const n=e(...i);for(const r in n)this[r]=n[r]}}}(t);function r(...s){if(this instanceof r)return n.apply(this,s),this;const o=new r(...s);return a.annotation=o,a;function a(l,c,h){const u=l.hasOwnProperty(Gh)?l[Gh]:Object.defineProperty(l,Gh,{value:[]})[Gh];for(;u.length<=h;)u.push(null);return(u[h]=u[h]||[]).push(o),l}}return i&&(r.prototype=Object.create(i.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r})}function Xh(e,t){e.forEach(i=>Array.isArray(i)?Xh(i,t):t(i))}function RR(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function _y(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function tm(e,t){const i=[];for(let n=0;n<e;n++)i.push(t);return i}function Ts(e,t,i){let n=Zh(e,t);return n>=0?e[1|n]=i:(n=~n,function oX(e,t,i,n){let r=e.length;if(r==t)e.push(i,n);else if(1===r)e.push(n,e[0]),e[0]=i;else{for(r--,e.push(e[r-1],e[r]);r>t;)e[r]=e[r-2],r--;e[t]=i,e[t+1]=n}}(e,n,t,i)),n}function _1(e,t){const i=Zh(e,t);if(i>=0)return e[1|i]}function Zh(e,t){return function OR(e,t,i){let n=0,r=e.length>>i;for(;r!==n;){const s=n+(r-n>>1),o=e[s<<i];if(t===o)return s<<i;o>t?r=s:n=s+1}return~(r<<i)}(e,t,1)}const wy=Bf(qh("Optional"),8),xy=Bf(qh("SkipSelf"),4);function Ay(e){return 128==(128&e.flags)}var ac=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(ac||{});const C1=new Map;let IX=0;const M1="__ngContext__";function ur(e,t){os(t)?(e[M1]=t[Gf],function RX(e){C1.set(e[Gf],e)}(t)):e[M1]=t}let A1;function D1(e,t){return A1(e,t)}function rm(e){const t=e[Vi];return Tr(t)?t[Vi]:t}function JR(e){return tO(e[jf])}function eO(e){return tO(e[Mo])}function tO(e){for(;null!==e&&!Tr(e);)e=e[Mo];return e}function $h(e,t,i,n,r){if(null!=n){let s,o=!1;Tr(n)?s=n:os(n)&&(o=!0,n=n[qi]);const a=Ti(n);0===e&&null!==i?null==r?sO(t,i,a):fu(t,i,a,r||null,!0):1===e&&null!==i?fu(t,i,a,r||null,!0):2===e?function Ly(e,t,i){const n=Ry(e,t);n&&function KX(e,t,i,n){e.removeChild(t,i,n)}(e,n,t,i)}(t,a,o):3===e&&t.destroyNode(a),null!=s&&function eZ(e,t,i,n,r){const s=i[aa];s!==Ti(i)&&$h(t,e,n,s,r);for(let a=er;a<i.length;a++){const l=i[a];om(l[ke],l,e,t,n,s)}}(t,e,s,i,r)}}function Iy(e,t,i){return e.createElement(t,i)}function nO(e,t){const i=e[Fh],n=i.indexOf(t);iR(t),i.splice(n,1)}function Py(e,t){if(e.length<=er)return;const i=er+t,n=e[i];if(n){const r=n[Hf];null!==r&&r!==e&&nO(r,n),t>0&&(e[i-1][Mo]=n[Mo]);const s=_y(e,er+t);!function HX(e,t){om(e,t,t[bt],2,null,null),t[qi]=null,t[cr]=null}(n[ke],n);const o=s[oa];null!==o&&o.detachView(s[ke]),n[Vi]=null,n[Mo]=null,n[At]&=-129}return n}function I1(e,t){if(!(256&t[At])){const i=t[bt];t[Wf]&&UP(t[Wf]),t[qf]&&UP(t[qf]),i.destroyNode&&om(e,t,i,3,null,null),function qX(e){let t=e[jf];if(!t)return P1(e[ke],e);for(;t;){let i=null;if(os(t))i=t[jf];else{const n=t[er];n&&(i=n)}if(!i){for(;t&&!t[Mo]&&t!==e;)os(t)&&P1(t[ke],t),t=t[Vi];null===t&&(t=e),os(t)&&P1(t[ke],t),i=t&&t[Mo]}t=i}}(t)}}function P1(e,t){if(!(256&t[At])){t[At]&=-129,t[At]|=256,function QX(e,t){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let n=0;n<i.length;n+=2){const r=t[i[n]];if(!(r instanceof Qf)){const s=i[n+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],l=s[o+1];la(4,a,l);try{l.call(a)}finally{la(5,a,l)}}else{la(4,r,s);try{s.call(r)}finally{la(5,r,s)}}}}}(e,t),function ZX(e,t){const i=e.cleanup,n=t[Oh];if(null!==i)for(let s=0;s<i.length-1;s+=2)if("string"==typeof i[s]){const o=i[s+3];o>=0?n[o]():n[-o].unsubscribe(),s+=2}else i[s].call(n[i[s+1]]);null!==n&&(t[Oh]=null);const r=t[nc];if(null!==r){t[nc]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(e,t),1===t[ke].type&&t[bt].destroy();const i=t[Hf];if(null!==i&&Tr(t[Vi])){i!==t[Vi]&&nO(i,t);const n=t[oa];null!==n&&n.detachView(e)}!function OX(e){C1.delete(e[Gf])}(t)}}function R1(e,t,i){return function rO(e,t,i){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return i[qi];{const{componentOffset:r}=n;if(r>-1){const{encapsulation:s}=e.data[n.directiveStart+r];if(s===Co.None||s===Co.Emulated)return null}return as(n,i)}}(e,t.parent,i)}function fu(e,t,i,n,r){e.insertBefore(t,i,n,r)}function sO(e,t,i){e.appendChild(t,i)}function oO(e,t,i,n,r){null!==n?fu(e,t,i,n,r):sO(e,t,i)}function Ry(e,t){return e.parentNode(t)}function aO(e,t,i){return cO(e,t,i)}let O1,F1,cO=function lO(e,t,i){return 40&e.type?as(e,i):null};function Oy(e,t,i,n){const r=R1(e,n,t),s=t[bt],a=aO(n.parent||t[cr],n,t);if(null!=r)if(Array.isArray(i))for(let l=0;l<i.length;l++)oO(s,r,i[l],a,!1);else oO(s,r,i,a,!1);void 0!==O1&&O1(s,n,t,i,r)}function sm(e,t){if(null!==t){const i=t.type;if(3&i)return as(t,e);if(4&i)return L1(-1,e[t.index]);if(8&i){const n=t.child;if(null!==n)return sm(e,n);{const r=e[t.index];return Tr(r)?L1(-1,r):Ti(r)}}if(32&i)return D1(t,e)()||Ti(e[t.index]);{const n=hO(e,t);return null!==n?Array.isArray(n)?n[0]:sm(rm(e[nn]),n):sm(e,t.next)}}return null}function hO(e,t){return null!==t?e[nn][cr].projection[t.projection]:null}function L1(e,t){const i=er+e+1;if(i<t.length){const n=t[i],r=n[ke].firstChild;if(null!==r)return sm(n,r)}return t[aa]}function N1(e,t,i,n,r,s,o){for(;null!=i;){const a=n[i.index],l=i.type;if(o&&0===t&&(a&&ur(Ti(a),n),i.flags|=2),32!=(32&i.flags))if(8&l)N1(e,t,i.child,n,r,s,!1),$h(t,e,r,a,s);else if(32&l){const c=D1(i,n);let h;for(;h=c();)$h(t,e,r,h,s);$h(t,e,r,a,s)}else 16&l?pO(e,t,n,i,r,s):$h(t,e,r,a,s);i=o?i.projectionNext:i.next}}function om(e,t,i,n,r,s){N1(i,n,e.firstChild,t,r,s,!1)}function pO(e,t,i,n,r,s){const o=i[nn],l=o[cr].projection[n.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)$h(t,e,r,l[c],s);else{let c=l;const h=o[Vi];Ay(n)&&(c.flags|=128),N1(e,t,c,h,r,s,!0)}}function fO(e,t,i){""===i?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function mO(e,t,i){const{mergedAttrs:n,classes:r,styles:s}=i;null!==n&&Gx(e,t,n),null!==r&&fO(e,t,r),null!==s&&function iZ(e,t,i){e.setAttribute(t,"style",i)}(e,t,s)}class _O{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function lc(e){return e instanceof _O?e.changingThisBreaksApplicationSecurity:e}const um=new Le("ENVIRONMENT_INITIALIZER"),TO=new Le("INJECTOR",-1),IO=new Le("INJECTOR_DEF_TYPES");class H1{get(t,i=Ff){if(i===Ff){const n=new Error(`NullInjectorError: No provider for ${Rn(t)}!`);throw n.name="NullInjectorError",n}return i}}function TZ(...e){return{\u0275providers:RO(0,e),\u0275fromNgModule:!0}}function RO(e,...t){const i=[],n=new Set;let r;const s=o=>{i.push(o)};return Xh(t,o=>{const a=o;By(a,s,[],n)&&(r||=[],r.push(a))}),void 0!==r&&OO(r,s),i}function OO(e,t){for(let i=0;i<e.length;i++){const{ngModule:n,providers:r}=e[i];G1(r,s=>{t(s,n)})}}function By(e,t,i,n){if(!(e=vt(e)))return!1;let r=null,s=$v(e);const o=!s&&Wt(e);if(s||o){if(o&&!o.standalone)return!1;r=e}else{const l=e.ngModule;if(s=$v(l),!s)return!1;r=l}const a=n.has(r);if(o){if(a)return!1;if(n.add(r),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)By(c,t,i,n)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let c;n.add(r);try{Xh(s.imports,h=>{By(h,t,i,n)&&(c||=[],c.push(h))})}finally{}void 0!==c&&OO(c,t)}if(!a){const c=hu(r)||(()=>new r);t({provide:r,useFactory:c,deps:Kt},r),t({provide:IO,useValue:r,multi:!0},r),t({provide:um,useValue:()=>we(r),multi:!0},r)}const l=s.providers;if(null!=l&&!a){const c=e;G1(l,h=>{t(h,c)})}}}return r!==e&&void 0!==e.providers}function G1(e,t){for(let i of e)Rx(i)&&(i=i.\u0275providers),Array.isArray(i)?G1(i,t):t(i)}const IZ=ci({provide:String,useValue:ci});function W1(e){return null!==e&&"object"==typeof e&&IZ in e}function mu(e){return"function"==typeof e}const q1=new Le("Set Injector scope."),Vy={},RZ={};let Y1;function zy(){return void 0===Y1&&(Y1=new H1),Y1}class Zs{}class id extends Zs{get destroyed(){return this._destroyed}constructor(t,i,n,r){super(),this.parent=i,this.source=n,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Z1(t,o=>this.processProvider(o)),this.records.set(TO,nd(void 0,this)),r.has("environment")&&this.records.set(Zs,nd(void 0,this));const s=this.records.get(q1);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(IO.multi,Kt,Ft.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const i=tc(this),n=rs(void 0);try{return t()}finally{tc(i),rs(n)}}get(t,i=Ff,n=Ft.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(yP))return t[yP](this);n=ty(n);const s=tc(this),o=rs(void 0);try{if(!(n&Ft.SkipSelf)){let l=this.records.get(t);if(void 0===l){const c=function FZ(e){return"function"==typeof e||"object"==typeof e&&e instanceof Le}(t)&&Kv(t);l=c&&this.injectableDefInScope(c)?nd(X1(t),Vy):null,this.records.set(t,l)}if(null!=l)return this.hydrate(t,l)}return(n&Ft.Self?zy():this.parent).get(t,i=n&Ft.Optional&&i===Ff?null:i)}catch(a){if("NullInjectorError"===a.name){if((a[ey]=a[ey]||[]).unshift(Rn(t)),s)throw a;return function R7(e,t,i,n){const r=e[ey];throw t[mP]&&r.unshift(t[mP]),e.message=function O7(e,t,i,n=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let r=Rn(t);if(Array.isArray(t))r=t.map(Rn).join(" -> ");else if("object"==typeof t){let s=[];for(let o in t)if(t.hasOwnProperty(o)){let a=t[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):Rn(a)))}r=`{${s.join(", ")}}`}return`${i}${n?"("+n+")":""}[${r}]: ${e.replace(A7,"\n  ")}`}("\n"+e.message,r,i,n),e.ngTokenPath=r,e[ey]=null,e}(a,t,"R3InjectorError",this.source)}throw a}finally{rs(o),tc(s)}}resolveInjectorInitializers(){const t=tc(this),i=rs(void 0);try{const r=this.get(um.multi,Kt,Ft.Self);for(const s of r)s()}finally{tc(t),rs(i)}}toString(){const t=[],i=this.records;for(const n of i.keys())t.push(Rn(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new be(205,!1)}processProvider(t){let i=mu(t=vt(t))?t:vt(t&&t.provide);const n=function LZ(e){return W1(e)?nd(void 0,e.useValue):nd(kO(e),Vy)}(t);if(mu(t)||!0!==t.multi)this.records.get(i);else{let r=this.records.get(i);r||(r=nd(void 0,Vy,!0),r.factory=()=>Ux(r.multi),this.records.set(i,r)),i=t,r.multi.push(t)}this.records.set(i,n)}hydrate(t,i){return i.value===Vy&&(i.value=RZ,i.value=i.factory()),"object"==typeof i.value&&i.value&&function kZ(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(t){if(!t.providedIn)return!1;const i=vt(t.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(t){const i=this._onDestroyHooks.indexOf(t);-1!==i&&this._onDestroyHooks.splice(i,1)}}function X1(e){const t=Kv(e),i=null!==t?t.factory:hu(e);if(null!==i)return i;if(e instanceof Le)throw new be(204,!1);if(e instanceof Function)return function OZ(e){const t=e.length;if(t>0)throw tm(t,"?"),new be(204,!1);const i=function S7(e){return e&&(e[Jv]||e[hP])||null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new be(204,!1)}function kO(e,t,i){let n;if(mu(e)){const r=vt(e);return hu(r)||X1(r)}if(W1(e))n=()=>vt(e.useValue);else if(function NO(e){return!(!e||!e.useFactory)}(e))n=()=>e.useFactory(...Ux(e.deps||[]));else if(function LO(e){return!(!e||!e.useExisting)}(e))n=()=>we(vt(e.useExisting));else{const r=vt(e&&(e.useClass||e.provide));if(!function NZ(e){return!!e.deps}(e))return hu(r)||X1(r);n=()=>new r(...Ux(e.deps))}return n}function nd(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function Z1(e,t){for(const i of e)Array.isArray(i)?Z1(i,t):i&&Rx(i)?Z1(i.\u0275providers,t):t(i)}const Uy=new Le("AppId",{providedIn:"root",factory:()=>BZ}),BZ="ng",FO=new Le("Platform Initializer"),gu=new Le("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),VZ=new Le("AnimationModuleType"),BO=new Le("CSP nonce",{providedIn:"root",factory:()=>function ed(){if(void 0!==F1)return F1;if(typeof document<"u")return document;throw new be(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let VO=(e,t,i)=>null;function nS(e,t,i=!1){return VO(e,t,i)}class ZZ{}class jO{}class KZ{resolveComponentFactory(t){throw function QZ(e){const t=Error(`No component factory found for ${Rn(e)}.`);return t.ngComponent=e,t}(t)}}let vu=(()=>{class e{static#e=this.NULL=new KZ}return e})();function $Z(){return od(ir(),ve())}function od(e,t){return new gn(as(e,t))}let gn=(()=>{class e{constructor(i){this.nativeElement=i}static#e=this.__NG_ELEMENT_ID__=$Z}return e})();function JZ(e){return e instanceof gn?e.nativeElement:e}class GO{}let Qs=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function eQ(){const e=ve(),i=Ds(ir().index,e);return(os(i)?i:e)[bt]}()}return e})(),tQ=(()=>{class e{static#e=this.\u0275prov=je({token:e,providedIn:"root",factory:()=>null})}return e})();class pm{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const iQ=new pm("16.2.12"),oS={};function XO(e,t=null,i=null,n){const r=ZO(e,t,i,n);return r.resolveInjectorInitializers(),r}function ZO(e,t=null,i=null,n,r=new Set){const s=[i||Kt,TZ(e)];return n=n||("object"==typeof e?void 0:Rn(e)),new id(s,t||zy(),n||null,r)}let rr=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=Ff;static#t=this.NULL=new H1;static create(i,n){if(Array.isArray(i))return XO({name:""},n,i,"");{const r=i.name??"";return XO({name:r},i.parent,i.providers,r)}}static#i=this.\u0275prov=je({token:e,providedIn:"any",factory:()=>we(TO)});static#n=this.__NG_ELEMENT_ID__=-1}return e})();function lS(e){return e.ngOriginalError}class ol{constructor(){this._console=console}handleError(t){const i=this._findOriginalError(t);this._console.error("ERROR",t),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(t){let i=t&&lS(t);for(;i&&lS(i);)i=lS(i);return i||null}}function uS(e){return t=>{setTimeout(e,void 0,t)}}const Ii=class cQ extends yi{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,i,n){let r=t,s=i||(()=>null),o=n;if(t&&"object"==typeof t){const l=t;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=uS(s),r&&(r=uS(r)),o&&(o=uS(o)));const a=super.subscribe({next:r,error:s,complete:o});return t instanceof en&&t.add(a),a}};function KO(...e){}class Vt{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ii(!1),this.onMicrotaskEmpty=new Ii(!1),this.onStable=new Ii(!1),this.onError=new Ii(!1),typeof Zone>"u")throw new be(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&i,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function uQ(){const e="function"==typeof Di.requestAnimationFrame;let t=Di[e?"requestAnimationFrame":"setTimeout"],i=Di[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&i){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const r=i[Zone.__symbol__("OriginalDelegate")];r&&(i=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function pQ(e){const t=()=>{!function dQ(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Di,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,dS(e),e.isCheckStableRunning=!0,hS(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),dS(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,n,r,s,o,a)=>{if(function mQ(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(a))return i.invokeTask(r,s,o,a);try{return $O(e),i.invokeTask(r,s,o,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),JO(e)}},onInvoke:(i,n,r,s,o,a,l)=>{try{return $O(e),i.invoke(r,s,o,a,l)}finally{e.shouldCoalesceRunChangeDetection&&t(),JO(e)}},onHasTask:(i,n,r,s)=>{i.hasTask(r,s),n===r&&("microTask"==s.change?(e._hasPendingMicrotasks=s.microTask,dS(e),hS(e)):"macroTask"==s.change&&(e.hasPendingMacrotasks=s.macroTask))},onHandleError:(i,n,r,s)=>(i.handleError(r,s),e.runOutsideAngular(()=>e.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Vt.isInAngularZone())throw new be(909,!1)}static assertNotInAngularZone(){if(Vt.isInAngularZone())throw new be(909,!1)}run(t,i,n){return this._inner.run(t,i,n)}runTask(t,i,n,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,t,hQ,KO,KO);try{return s.runTask(o,i,n)}finally{s.cancelTask(o)}}runGuarded(t,i,n){return this._inner.runGuarded(t,i,n)}runOutsideAngular(t){return this._outer.run(t)}}const hQ={};function hS(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function dS(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function $O(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function JO(e){e._nesting--,hS(e)}class fQ{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ii,this.onMicrotaskEmpty=new Ii,this.onStable=new Ii,this.onError=new Ii}run(t,i,n){return t.apply(i,n)}runGuarded(t,i,n){return t.apply(i,n)}runOutsideAngular(t){return t()}runTask(t,i,n,r){return t.apply(i,n)}}const e3=new Le("",{providedIn:"root",factory:t3});function t3(){const e=We(Vt);let t=!0;return aP(new Bi(r=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{r.next(t),r.complete()})}),new Bi(r=>{let s;e.runOutsideAngular(()=>{s=e.onStable.subscribe(()=>{Vt.assertNotInAngularZone(),queueMicrotask(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,r.next(!0))})})});const o=e.onUnstable.subscribe(()=>{Vt.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),o.unsubscribe()}}).pipe(lP()))}function i3(e){return e.ownerDocument.defaultView}function al(e){return e instanceof Function?e():e}let pS=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=je({token:e,providedIn:"root",factory:()=>new e})}return e})();function fm(e){for(;e;){e[At]|=64;const t=rm(e);if(Yx(e)&&!t)return e;e=t}return null}const a3=new Le("",{providedIn:"root",factory:()=>!1});let Xy=null;function h3(e,t){return e[t]??f3()}function d3(e,t){const i=f3();i.producerNode?.length&&(e[t]=Xy,i.lView=e,Xy=p3())}const CQ={...NP,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{fm(e.lView)},lView:null};function p3(){return Object.create(CQ)}function f3(){return Xy??=p3(),Xy}const Et={};function cd(e){m3(qt(),ve(),Pr()+e,!1)}function m3(e,t,i,n){if(!n)if(3==(3&t[At])){const s=e.preOrderCheckHooks;null!==s&&dy(t,s,i)}else{const s=e.preOrderHooks;null!==s&&py(t,s,0,i)}du(i)}function pe(e,t=Ft.Default){const i=ve();return null===i?we(e,t):MR(ir(),i,vt(e),t)}function Zy(e,t,i,n,r,s,o,a,l,c,h){const u=t.blueprint.slice();return u[qi]=r,u[At]=140|n,(null!==c||e&&2048&e[At])&&(u[At]|=2048),tR(u),u[Vi]=u[Nh]=e,u[tn]=i,u[Lh]=o||e&&e[Lh],u[bt]=a||e&&e[bt],u[ic]=l||e&&e[ic]||null,u[cr]=s,u[Gf]=function PX(){return IX++}(),u[il]=h,u[PP]=c,u[nn]=2==t.type?e[nn]:u,u}function ud(e,t,i,n,r){let s=e.data[t];if(null===s)s=function fS(e,t,i,n,r){const s=aR(),o=t1(),l=e.data[t]=function RQ(e,t,i,n,r,s){let o=t?t.injectorIndex:-1,a=0;return zh()&&(a|=128),{type:i,index:n,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,i,t,n,r);return null===e.firstChild&&(e.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l,l.prev=s)),l}(e,t,i,n,r),function RY(){return pt.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=i,s.value=n,s.attrs=r;const o=function Zf(){const e=pt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return ca(s,!0),s}function mm(e,t,i,n){if(0===i)return-1;const r=t.length;for(let s=0;s<i;s++)t.push(n),e.blueprint.push(n),e.data.push(null);return r}function v3(e,t,i,n,r){const s=h3(t,Wf),o=Pr(),a=2&n;try{du(-1),a&&t.length>Bt&&m3(e,t,Bt,!1),la(a?2:0,r);const c=a?s:null,h=Zx(c);try{null!==c&&(c.dirty=!1),i(n,r)}finally{Qx(c,h)}}finally{a&&null===t[Wf]&&d3(t,Wf),du(o),la(a?3:1,r)}}function mS(e,t,i){if(qx(t)){const n=qs(null);try{const s=t.directiveEnd;for(let o=t.directiveStart;o<s;o++){const a=e.data[o];a.contentQueries&&a.contentQueries(1,i[o],o)}}finally{qs(n)}}}function gS(e,t,i){oR()&&(function VQ(e,t,i,n){const r=i.directiveStart,s=i.directiveEnd;uu(i)&&function qQ(e,t,i){const n=as(t,e),r=y3(i);let o=16;i.signals?o=4096:i.onPush&&(o=64);const a=Qy(e,Zy(e,r,null,o,n,t,null,e[Lh].rendererFactory.createRenderer(n,i),null,null,null));e[t.index]=a}(t,i,e.data[r+i.componentOffset]),e.firstCreatePass||my(i,t),ur(n,t);const o=i.initialInputs;for(let a=r;a<s;a++){const l=e.data[a],c=pu(t,e,a,i);ur(c,t),null!==o&&YQ(0,a-r,c,l,0,o),Ao(l)&&(Ds(i.index,t)[tn]=pu(t,e,a,i))}}(e,t,i,as(i,t)),64==(64&i.flags)&&S3(e,t,i))}function vS(e,t,i=as){const n=t.localNames;if(null!==n){let r=t.index+1;for(let s=0;s<n.length;s+=2){const o=n[s+1],a=-1===o?i(t,e):e[o];e[r++]=a}}}function y3(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=yS(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function yS(e,t,i,n,r,s,o,a,l,c,h){const u=Bt+n,d=u+r,p=function MQ(e,t){const i=[];for(let n=0;n<t;n++)i.push(n<e?null:Et);return i}(u,d),f="function"==typeof c?c():c;return p[ke]={type:e,blueprint:p,template:i,queries:null,viewQuery:a,declTNode:t,data:p.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:f,incompleteFirstPass:!1,ssrId:h}}let _3=e=>null;function b3(e,t,i,n){for(let r in e)if(e.hasOwnProperty(r)){i=null===i?{}:i;const s=e[r];null===n?w3(i,t,r,s):n.hasOwnProperty(r)&&w3(i,t,n[r],s)}return i}function w3(e,t,i,n){e.hasOwnProperty(i)?e[i].push(t,n):e[i]=[t,n]}function Is(e,t,i,n,r,s,o,a){const l=as(t,i);let h,c=t.inputs;!a&&null!=c&&(h=c[n])?(SS(e,i,h,n,r),uu(t)&&function NQ(e,t){const i=Ds(t,e);16&i[At]||(i[At]|=64)}(i,t.index)):3&t.type&&(n=function LQ(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n),r=null!=o?o(r,t.value||"",n):r,s.setProperty(l,n,r))}function _S(e,t,i,n){if(oR()){const r=null===n?null:{"":-1},s=function UQ(e,t){const i=e.directiveRegistry;let n=null,r=null;if(i)for(let s=0;s<i.length;s++){const o=i[s];if(EP(t,o.selectors,!1))if(n||(n=[]),Ao(o))if(null!==o.findHostDirectiveDefs){const a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),n.unshift(...a,o),bS(e,t,a.length)}else n.unshift(o),bS(e,t,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,n,r),n.push(o)}return null===n?null:[n,r]}(e,i);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&x3(e,t,i,o,r,a),r&&function jQ(e,t,i){if(t){const n=e.localNames=[];for(let r=0;r<t.length;r+=2){const s=i[t[r+1]];if(null==s)throw new be(-301,!1);n.push(t[r],s)}}}(i,n,r)}i.mergedAttrs=zf(i.mergedAttrs,i.attrs)}function x3(e,t,i,n,r,s){for(let c=0;c<n.length;c++)g1(my(i,t),e,n[c].type);!function GQ(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}(i,e.data.length,n.length);for(let c=0;c<n.length;c++){const h=n[c];h.providersResolver&&h.providersResolver(h)}let o=!1,a=!1,l=mm(e,t,n.length,null);for(let c=0;c<n.length;c++){const h=n[c];i.mergedAttrs=zf(i.mergedAttrs,h.hostAttrs),WQ(e,i,t,l,h),HQ(l,h,r),null!==h.contentQueries&&(i.flags|=4),(null!==h.hostBindings||null!==h.hostAttrs||0!==h.hostVars)&&(i.flags|=64);const u=h.type.prototype;!o&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),o=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),a=!0),l++}!function OQ(e,t,i){const r=t.directiveEnd,s=e.data,o=t.attrs,a=[];let l=null,c=null;for(let h=t.directiveStart;h<r;h++){const u=s[h],d=i?i.get(u):null,f=d?d.outputs:null;l=b3(u.inputs,h,l,d?d.inputs:null),c=b3(u.outputs,h,c,f);const m=null===l||null===o||CP(t)?null:XQ(l,h,o);a.push(m)}null!==l&&(l.hasOwnProperty("class")&&(t.flags|=8),l.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=a,t.inputs=l,t.outputs=c}(e,i,s)}function S3(e,t,i){const n=i.directiveStart,r=i.directiveEnd,s=i.index,o=function LY(){return pt.lFrame.currentDirectiveIndex}();try{du(s);for(let a=n;a<r;a++){const l=e.data[a],c=t[a];r1(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&zQ(l,c)}}finally{du(-1),r1(o)}}function zQ(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function bS(e,t,i){t.componentOffset=i,(e.components??=[]).push(t.index)}function HQ(e,t,i){if(i){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)i[t.exportAs[n]]=e;Ao(t)&&(i[""]=e)}}function WQ(e,t,i,n,r){e.data[n]=r;const s=r.factory||(r.factory=hu(r.type)),o=new Qf(s,Ao(r),pe);e.blueprint[n]=o,i[n]=o,function FQ(e,t,i,n,r){const s=r.hostBindings;if(s){let o=e.hostBindingOpCodes;null===o&&(o=e.hostBindingOpCodes=[]);const a=~t.index;(function BQ(e){let t=e.length;for(;t>0;){const i=e[--t];if("number"==typeof i&&i<0)return i}return 0})(o)!=a&&o.push(a),o.push(i,n,s)}}(e,t,n,mm(e,i,r.hostVars,Et),r)}function ha(e,t,i,n,r,s){const o=as(e,t);!function wS(e,t,i,n,r,s,o){if(null==s)e.removeAttribute(t,r,i);else{const a=null==o?_t(s):o(s,n||"",r);e.setAttribute(t,r,a,i)}}(t[bt],o,s,e.value,i,n,r)}function YQ(e,t,i,n,r,s){const o=s[t];if(null!==o)for(let a=0;a<o.length;)C3(n,i,o[a++],o[a++],o[a++])}function C3(e,t,i,n,r){const s=qs(null);try{const o=e.inputTransforms;null!==o&&o.hasOwnProperty(n)&&(r=o[n].call(t,r)),null!==e.setInput?e.setInput(t,r,i,n):t[n]=r}finally{qs(s)}}function XQ(e,t,i){let n=null,r=0;for(;r<i.length;){const s=i[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(e.hasOwnProperty(s)){null===n&&(n=[]);const o=e[s];for(let a=0;a<o.length;a+=2)if(o[a]===t){n.push(s,o[a+1],i[r+1]);break}}r+=2}else r+=2;else r+=4}return n}function E3(e,t,i,n){return[e,!0,!1,t,null,0,n,i,null,null,null]}function M3(e,t){const i=e.contentQueries;if(null!==i)for(let n=0;n<i.length;n+=2){const s=i[n+1];if(-1!==s){const o=e.data[s];o1(i[n]),o.contentQueries(2,t[s],s)}}}function Qy(e,t){return e[jf]?e[IP][Mo]=t:e[jf]=t,e[IP]=t,t}function xS(e,t,i){o1(0);const n=qs(null);try{t(e,i)}finally{qs(n)}}function A3(e){return e[Oh]||(e[Oh]=[])}function D3(e){return e.cleanup||(e.cleanup=[])}function I3(e,t){const i=e[ic],n=i?i.get(ol,null):null;n&&n.handleError(t)}function SS(e,t,i,n,r){for(let s=0;s<i.length;){const o=i[s++],a=i[s++];C3(e.data[o],t[o],n,a,r)}}function ZQ(e,t){const i=Ds(t,e),n=i[ke];!function QQ(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])}(n,i);const r=i[qi];null!==r&&null===i[il]&&(i[il]=nS(r,i[ic])),CS(n,i,i[tn])}function CS(e,t,i){a1(t);try{const n=e.viewQuery;null!==n&&xS(1,n,i);const r=e.template;null!==r&&v3(e,t,r,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&M3(e,t),e.staticViewQueries&&xS(2,e.viewQuery,i);const s=e.components;null!==s&&function KQ(e,t){for(let i=0;i<t.length;i++)ZQ(e,t[i])}(t,s)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[At]&=-5,l1()}}let P3=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(i,n,r){const s=typeof Zone>"u"?null:Zone.current,o=function lY(e,t,i){const n=Object.create(cY);i&&(n.consumerAllowSignalWrites=!0),n.fn=e,n.schedule=t;const r=o=>{n.cleanupFn=o};return n.ref={notify:()=>VP(n),run:()=>{if(n.dirty=!1,n.hasRun&&!zP(n))return;n.hasRun=!0;const o=Zx(n);try{n.cleanupFn(),n.cleanupFn=XP,n.fn(r)}finally{Qx(n,o)}},cleanup:()=>n.cleanupFn()},n.ref}(i,c=>{this.all.has(c)&&this.queue.set(c,s)},r);let a;this.all.add(o),o.notify();const l=()=>{o.cleanup(),a?.(),this.all.delete(o),this.queue.delete(o)};return a=n?.onDestroy(l),{destroy:l}}flush(){if(0!==this.queue.size)for(const[i,n]of this.queue)this.queue.delete(i),n?n.run(()=>i.run()):i.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=je({token:e,providedIn:"root",factory:()=>new e})}return e})();function Ky(e,t,i){let n=i?e.styles:null,r=i?e.classes:null,s=0;if(null!==t)for(let o=0;o<t.length;o++){const a=t[o];"number"==typeof a?s=a:1==s?r=Ix(r,a):2==s&&(n=Ix(n,a+": "+t[++o]+";"))}i?e.styles=n:e.stylesWithoutHost=n,i?e.classes=r:e.classesWithoutHost=r}function gm(e,t,i,n,r=!1){for(;null!==i;){const s=t[i.index];null!==s&&n.push(Ti(s)),Tr(s)&&R3(s,n);const o=i.type;if(8&o)gm(e,t,i.child,n);else if(32&o){const a=D1(i,t);let l;for(;l=a();)n.push(l)}else if(16&o){const a=hO(t,i);if(Array.isArray(a))n.push(...a);else{const l=rm(t[nn]);gm(l[ke],l,a,n,!0)}}i=r?i.projectionNext:i.next}return n}function R3(e,t){for(let i=er;i<e.length;i++){const n=e[i],r=n[ke].firstChild;null!==r&&gm(n[ke],n,r,t)}e[aa]!==e[qi]&&t.push(e[aa])}function $y(e,t,i,n=!0){const r=t[Lh],s=r.rendererFactory,o=r.afterRenderEventManager;s.begin?.(),o?.begin();try{O3(e,t,e.template,i)}catch(l){throw n&&I3(t,l),l}finally{s.end?.(),r.effectManager?.flush(),o?.end()}}function O3(e,t,i,n){const r=t[At];if(256!=(256&r)){t[Lh].effectManager?.flush(),a1(t);try{tR(t),function cR(e){return pt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&v3(e,t,i,2,n);const o=3==(3&r);if(o){const c=e.preOrderCheckHooks;null!==c&&dy(t,c,null)}else{const c=e.preOrderHooks;null!==c&&py(t,c,0,null),h1(t,0)}if(function eK(e){for(let t=JR(e);null!==t;t=eO(t)){if(!t[RP])continue;const i=t[Fh];for(let n=0;n<i.length;n++){_Y(i[n])}}}(t),L3(t,2),null!==e.contentQueries&&M3(e,t),o){const c=e.contentCheckHooks;null!==c&&dy(t,c)}else{const c=e.contentHooks;null!==c&&py(t,c,1),h1(t,1)}!function EQ(e,t){const i=e.hostBindingOpCodes;if(null===i)return;const n=h3(t,qf);try{for(let r=0;r<i.length;r++){const s=i[r];if(s<0)du(~s);else{const o=s,a=i[++r],l=i[++r];OY(a,o),n.dirty=!1;const c=Zx(n);try{l(2,t[o])}finally{Qx(n,c)}}}}finally{null===t[qf]&&d3(t,qf),du(-1)}}(e,t);const a=e.components;null!==a&&k3(t,a,0);const l=e.viewQuery;if(null!==l&&xS(2,l,n),o){const c=e.viewCheckHooks;null!==c&&dy(t,c)}else{const c=e.viewHooks;null!==c&&py(t,c,2),h1(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[At]&=-73,iR(t)}finally{l1()}}}function L3(e,t){for(let i=JR(e);null!==i;i=eO(i))for(let n=er;n<i.length;n++)N3(i[n],t)}function tK(e,t,i){N3(Ds(t,e),i)}function N3(e,t){if(!function vY(e){return 128==(128&e[At])}(e))return;const i=e[ke],n=e[At];if(80&n&&0===t||1024&n||2===t)O3(i,e,i.template,e[tn]);else if(e[Uf]>0){L3(e,1);const r=i.components;null!==r&&k3(e,r,1)}}function k3(e,t,i){for(let n=0;n<t.length;n++)tK(e,t[n],i)}class vm{get rootNodes(){const t=this._lView,i=t[ke];return gm(i,t,i.firstChild,[])}constructor(t,i){this._lView=t,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[tn]}set context(t){this._lView[tn]=t}get destroyed(){return 256==(256&this._lView[At])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[Vi];if(Tr(t)){const i=t[8],n=i?i.indexOf(this):-1;n>-1&&(Py(t,n),_y(i,n))}this._attachedToViewContainer=!1}I1(this._lView[ke],this._lView)}onDestroy(t){!function rR(e,t){if(256==(256&e[At]))throw new be(911,!1);null===e[nc]&&(e[nc]=[]),e[nc].push(t)}(this._lView,t)}markForCheck(){fm(this._cdRefInjectingView||this._lView)}detach(){this._lView[At]&=-129}reattach(){this._lView[At]|=128}detectChanges(){$y(this._lView[ke],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new be(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function WX(e,t){om(e,t,t[bt],2,null,null)}(this._lView[ke],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new be(902,!1);this._appRef=t}}class iK extends vm{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;$y(t[ke],t,t[tn],!1)}checkNoChanges(){}get context(){return null}}class F3 extends vu{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const i=Wt(t);return new ym(i,this.ngModule)}}function B3(e){const t=[];for(let i in e)e.hasOwnProperty(i)&&t.push({propName:e[i],templateName:i});return t}class rK{constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,n){n=ty(n);const r=this.injector.get(t,oS,n);return r!==oS||i===oS?r:this.parentInjector.get(t,i,n)}}class ym extends jO{get inputs(){const t=this.componentDef,i=t.inputTransforms,n=B3(t.inputs);if(null!==i)for(const r of n)i.hasOwnProperty(r.propName)&&(r.transform=i[r.propName]);return n}get outputs(){return B3(this.componentDef.outputs)}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=function H7(e){return e.map(j7).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!i}create(t,i,n,r){let s=(r=r||this.ngModule)instanceof Zs?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new rK(t,s):t,a=o.get(GO,null);if(null===a)throw new be(407,!1);const u={rendererFactory:a,sanitizer:o.get(tQ,null),effectManager:o.get(P3,null),afterRenderEventManager:o.get(pS,null)},d=a.createRenderer(null,this.componentDef),p=this.componentDef.selectors[0][0]||"div",f=n?function AQ(e,t,i,n){const s=n.get(a3,!1)||i===Co.ShadowDom,o=e.selectRootElement(t,s);return function DQ(e){_3(e)}(o),o}(d,n,this.componentDef.encapsulation,o):Iy(d,p,function nK(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(p)),v=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let y=null;null!==f&&(y=nS(f,o,!0));const _=yS(0,null,null,1,0,null,null,null,null,null,null),b=Zy(null,_,null,v,null,null,u,d,o,null,y);let w,C;a1(b);try{const x=this.componentDef;let S,E=null;x.findHostDirectiveDefs?(S=[],E=new Map,x.findHostDirectiveDefs(x,S,E),S.push(x)):S=[x];const D=function oK(e,t){const i=e[ke],n=Bt;return e[n]=t,ud(i,n,2,"#host",null)}(b,f),T=function aK(e,t,i,n,r,s,o){const a=r[ke];!function lK(e,t,i,n){for(const r of e)t.mergedAttrs=zf(t.mergedAttrs,r.hostAttrs);null!==t.mergedAttrs&&(Ky(t,t.mergedAttrs,!0),null!==i&&mO(n,i,t))}(n,e,t,o);let l=null;null!==t&&(l=nS(t,r[ic]));const c=s.rendererFactory.createRenderer(t,i);let h=16;i.signals?h=4096:i.onPush&&(h=64);const u=Zy(r,y3(i),null,h,r[e.index],e,s,c,null,null,l);return a.firstCreatePass&&bS(a,e,n.length-1),Qy(r,u),r[e.index]=u}(D,f,x,S,b,u,d);C=eR(_,Bt),f&&function uK(e,t,i,n){if(n)Gx(e,i,["ng-version",iQ.full]);else{const{attrs:r,classes:s}=function G7(e){const t=[],i=[];let n=1,r=2;for(;n<e.length;){let s=e[n];if("string"==typeof s)2===r?""!==s&&t.push(s,e[++n]):8===r&&i.push(s);else{if(!Eo(r))break;r=s}n++}return{attrs:t,classes:i}}(t.selectors[0]);r&&Gx(e,i,r),s&&s.length>0&&fO(e,i,s.join(" "))}}(d,x,f,n),void 0!==i&&function hK(e,t,i){const n=e.projection=[];for(let r=0;r<t.length;r++){const s=i[r];n.push(null!=s?Array.from(s):null)}}(C,this.ngContentSelectors,i),w=function cK(e,t,i,n,r,s){const o=ir(),a=r[ke],l=as(o,r);x3(a,r,o,i,null,n);for(let h=0;h<i.length;h++)ur(pu(r,a,o.directiveStart+h,o),r);S3(a,r,o),l&&ur(l,r);const c=pu(r,a,o.directiveStart+o.componentOffset,o);if(e[tn]=r[tn]=c,null!==s)for(const h of s)h(c,t);return mS(a,o,e),c}(T,x,S,E,b,[dK]),CS(_,b,null)}finally{l1()}return new sK(this.componentType,w,od(C,b),b,C)}}class sK extends ZZ{constructor(t,i,n,r,s){super(),this.location=n,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new iK(r),this.componentType=t}setInput(t,i){const n=this._tNode.inputs;let r;if(null!==n&&(r=n[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),i))return;const s=this._rootLView;SS(s[ke],s,r,t,i),this.previousInputValues.set(t,i),fm(Ds(this._tNode.index,s))}}get injector(){return new Rr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function dK(){const e=ir();hy(ve()[ke],e)}function ai(e){let t=function V3(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const n=[e];for(;t;){let r;if(Ao(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new be(903,!1);r=t.\u0275dir}if(r){if(i){n.push(r);const o=e;o.inputs=Jy(e.inputs),o.inputTransforms=Jy(e.inputTransforms),o.declaredInputs=Jy(e.declaredInputs),o.outputs=Jy(e.outputs);const a=r.hostBindings;a&&gK(e,a);const l=r.viewQuery,c=r.contentQueries;if(l&&fK(e,l),c&&mK(e,c),Zv(e.inputs,r.inputs),Zv(e.declaredInputs,r.declaredInputs),Zv(e.outputs,r.outputs),null!==r.inputTransforms&&(null===o.inputTransforms&&(o.inputTransforms={}),Zv(o.inputTransforms,r.inputTransforms)),Ao(r)&&r.data.animation){const h=e.data;h.animation=(h.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(e),a===ai&&(i=!1)}}t=Object.getPrototypeOf(t)}!function pK(e){let t=0,i=null;for(let n=e.length-1;n>=0;n--){const r=e[n];r.hostVars=t+=r.hostVars,r.hostAttrs=zf(r.hostAttrs,i=zf(i,r.hostAttrs))}}(n)}function Jy(e){return e===sa?{}:e===Kt?[]:e}function fK(e,t){const i=e.viewQuery;e.viewQuery=i?(n,r)=>{t(n,r),i(n,r)}:t}function mK(e,t){const i=e.contentQueries;e.contentQueries=i?(n,r,s)=>{t(n,r,s),i(n,r,s)}:t}function gK(e,t){const i=e.hostBindings;e.hostBindings=i?(n,r)=>{t(n,r),i(n,r)}:t}function e0(e){return!!ES(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function ES(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function hr(e,t,i){return!Object.is(e[t],i)&&(e[t]=i,!0)}function Do(e,t,i,n){const r=ve();return hr(r,Uh(),t)&&(qt(),ha(Ui(),r,e,t,i,n)),Do}let nL=function rL(e,t,i,n){return oc(!0),t[bt].createComment("")};function Sm(e,t,i){const n=ve();return hr(n,Uh(),t)&&Is(qt(),Ui(),n,e,t,n[bt],i,!1),Sm}function PS(e,t,i,n,r){const o=r?"class":"style";SS(e,i,t.inputs[o],o,n)}function Me(e,t,i,n){const r=ve(),s=qt(),o=Bt+e,a=r[bt],l=s.firstCreatePass?function qK(e,t,i,n,r,s){const o=t.consts,l=ud(t,e,2,n,sc(o,r));return _S(t,i,l,sc(o,s)),null!==l.attrs&&Ky(l,l.attrs,!1),null!==l.mergedAttrs&&Ky(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(o,s,r,t,i,n):s.data[o],c=sL(s,r,l,a,t,e);r[o]=c;const h=oy(l);return ca(l,!0),mO(a,c,l),32!=(32&l.flags)&&uy()&&Oy(s,r,c,l),0===function wY(){return pt.lFrame.elementDepthCount}()&&ur(c,r),function xY(){pt.lFrame.elementDepthCount++}(),h&&(gS(s,r,l),mS(s,l,r)),null!==n&&vS(r,l),Me}function Pe(){let e=ir();t1()?n1():(e=e.parent,ca(e,!1));const t=e;(function CY(e){return pt.skipHydrationRootTNode===e})(t)&&function DY(){pt.skipHydrationRootTNode=null}(),function SY(){pt.lFrame.elementDepthCount--}();const i=qt();return i.firstCreatePass&&(hy(i,e),qx(e)&&i.queries.elementEnd(e)),null!=t.classesWithoutHost&&function HY(e){return 0!=(8&e.flags)}(t)&&PS(i,t,ve(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function GY(e){return 0!=(16&e.flags)}(t)&&PS(i,t,ve(),t.stylesWithoutHost,!1),Pe}function wt(e,t,i,n){return Me(e,t,i,n),Pe(),wt}let sL=(e,t,i,n,r,s)=>(oc(!0),Iy(n,r,function vR(){return pt.lFrame.currentNamespace}()));function Cm(e){return!!e&&"function"==typeof e.then}function lL(e){return!!e&&"function"==typeof e.subscribe}function vn(e,t,i,n){const r=ve(),s=qt(),o=ir();return function uL(e,t,i,n,r,s,o){const a=oy(n),c=e.firstCreatePass&&D3(e),h=t[tn],u=A3(t);let d=!0;if(3&n.type||o){const m=as(n,t),g=o?o(m):m,v=u.length,y=o?b=>o(Ti(b[n.index])):n.index;let _=null;if(!o&&a&&(_=function JK(e,t,i,n){const r=e.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===i&&r[s+1]===n){const a=t[Oh],l=r[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(e,t,r,n.index)),null!==_)(_.__ngLastListenerFn__||_).__ngNextListenerFn__=s,_.__ngLastListenerFn__=s,d=!1;else{s=dL(n,t,h,s,!1);const b=i.listen(g,r,s);u.push(s,b),c&&c.push(r,y,v,v+1)}}else s=dL(n,t,h,s,!1);const p=n.outputs;let f;if(d&&null!==p&&(f=p[r])){const m=f.length;if(m)for(let g=0;g<m;g+=2){const w=t[f[g]][f[g+1]].subscribe(s),C=u.length;u.push(s,w),c&&c.push(r,n.index,C,-(C+1))}}}(s,r,r[bt],o,e,t,n),vn}function hL(e,t,i,n){try{return la(6,t,i),!1!==i(n)}catch(r){return I3(e,r),!1}finally{la(7,t,i)}}function dL(e,t,i,n,r){return function s(o){if(o===Function)return n;fm(e.componentOffset>-1?Ds(e.index,t):t);let l=hL(t,i,n,o),c=s.__ngNextListenerFn__;for(;c;)l=hL(t,i,c,o)&&l,c=c.__ngNextListenerFn__;return r&&!1===l&&o.preventDefault(),l}}function t$(e,t){let i=null;const n=function B7(e){const t=e.attrs;if(null!=t){const i=t.indexOf(5);if(!(1&i))return t[i+1]}return null}(e);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===n?EP(e,s,!0):U7(n,s))return r}else i=r}return i}function o0(e,t){return e<<17|t<<2}function cc(e){return e>>17&32767}function NS(e){return 2|e}function _u(e){return(131068&e)>>2}function kS(e,t){return-131069&e|t<<2}function FS(e){return 1|e}function CL(e,t,i,n,r){const s=e[i+1],o=null===t;let a=n?cc(s):_u(s),l=!1;for(;0!==a&&(!1===l||o);){const h=e[a+1];a$(e[a],t)&&(l=!0,e[a+1]=n?FS(h):NS(h)),a=n?cc(h):_u(h)}l&&(e[i+1]=n?NS(s):FS(s))}function a$(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Zh(e,t)>=0}const Ln={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function EL(e){return e.substring(Ln.key,Ln.keyEnd)}function ML(e,t){const i=Ln.textEnd;return i===t?-1:(t=Ln.keyEnd=function h$(e,t,i){for(;t<i&&e.charCodeAt(t)>32;)t++;return t}(e,Ln.key=t,i),bd(e,t,i))}function bd(e,t,i){for(;t<i&&e.charCodeAt(t)<=32;)t++;return t}function wd(e,t){return function To(e,t,i,n){const r=ve(),s=qt(),o=rl(2);s.firstUpdatePass&&LL(s,e,o,n),t!==Et&&hr(r,o,t)&&kL(s,s.data[Pr()],r,r[bt],e,r[o+1]=function x$(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=Rn(lc(e)))),e}(t,i),n,o)}(e,t,null,!0),wd}function RL(e){!function Io(e,t,i,n){const r=qt(),s=rl(2);r.firstUpdatePass&&LL(r,null,s,n);const o=ve();if(i!==Et&&hr(o,s,i)){const a=r.data[Pr()];if(BL(a,n)&&!OL(r,s)){let l=n?a.classesWithoutHost:a.stylesWithoutHost;null!==l&&(i=Ix(l,i||"")),PS(r,a,o,i,n)}else!function w$(e,t,i,n,r,s,o,a){r===Et&&(r=Kt);let l=0,c=0,h=0<r.length?r[0]:null,u=0<s.length?s[0]:null;for(;null!==h||null!==u;){const d=l<r.length?r[l+1]:void 0,p=c<s.length?s[c+1]:void 0;let m,f=null;h===u?(l+=2,c+=2,d!==p&&(f=u,m=p)):null===u||null!==h&&h<u?(l+=2,f=h):(c+=2,f=u,m=p),null!==f&&kL(e,t,i,n,f,m,o,a),h=l<r.length?r[l]:null,u=c<s.length?s[c]:null}}(r,a,o,o[bt],o[s+1],o[s+1]=function _$(e,t,i){if(null==i||""===i)return Kt;const n=[],r=lc(i);if(Array.isArray(r))for(let s=0;s<r.length;s++)e(n,r[s],!0);else if("object"==typeof r)for(const s in r)r.hasOwnProperty(s)&&e(n,s,r[s]);else"string"==typeof r&&t(n,r);return n}(e,t,i),n,s)}}(b$,fa,e,!0)}function fa(e,t){for(let i=function c$(e){return function DL(e){Ln.key=0,Ln.keyEnd=0,Ln.value=0,Ln.valueEnd=0,Ln.textEnd=e.length}(e),ML(e,bd(e,0,Ln.textEnd))}(t);i>=0;i=ML(t,i))Ts(e,EL(t),!0)}function OL(e,t){return t>=e.expandoStartIndex}function LL(e,t,i,n){const r=e.data;if(null===r[i+1]){const s=r[Pr()],o=OL(e,i);BL(s,n)&&null===t&&!o&&(t=!1),t=function m$(e,t,i,n){const r=function s1(e){const t=pt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=n?t.residualClasses:t.residualStyles;if(null===r)0===(n?t.classBindings:t.styleBindings)&&(i=Em(i=BS(null,e,t,i,n),t.attrs,n),s=null);else{const o=t.directiveStylingLast;if(-1===o||e[o]!==r)if(i=BS(r,e,t,i,n),null===s){let l=function g$(e,t,i){const n=i?t.classBindings:t.styleBindings;if(0!==_u(n))return e[cc(n)]}(e,t,n);void 0!==l&&Array.isArray(l)&&(l=BS(null,e,t,l[1],n),l=Em(l,t.attrs,n),function v$(e,t,i,n){e[cc(i?t.classBindings:t.styleBindings)]=n}(e,t,n,l))}else s=function y$(e,t,i){let n;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)n=Em(n,e[s].hostAttrs,i);return Em(n,t.attrs,i)}(e,t,n)}return void 0!==s&&(n?t.residualClasses=s:t.residualStyles=s),i}(r,s,t,n),function s$(e,t,i,n,r,s){let o=s?t.classBindings:t.styleBindings,a=cc(o),l=_u(o);e[n]=i;let h,c=!1;if(Array.isArray(i)?(h=i[1],(null===h||Zh(i,h)>0)&&(c=!0)):h=i,r)if(0!==l){const d=cc(e[a+1]);e[n+1]=o0(d,a),0!==d&&(e[d+1]=kS(e[d+1],n)),e[a+1]=function n$(e,t){return 131071&e|t<<17}(e[a+1],n)}else e[n+1]=o0(a,0),0!==a&&(e[a+1]=kS(e[a+1],n)),a=n;else e[n+1]=o0(l,0),0===a?a=n:e[l+1]=kS(e[l+1],n),l=n;c&&(e[n+1]=NS(e[n+1])),CL(e,h,n,!0),CL(e,h,n,!1),function o$(e,t,i,n,r){const s=r?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&Zh(s,t)>=0&&(i[n+1]=FS(i[n+1]))}(t,h,e,n,s),o=o0(a,l),s?t.classBindings=o:t.styleBindings=o}(r,s,t,i,o,n)}}function BS(e,t,i,n,r){let s=null;const o=i.directiveEnd;let a=i.directiveStylingLast;for(-1===a?a=i.directiveStart:a++;a<o&&(s=t[a],n=Em(n,s.hostAttrs,r),s!==e);)a++;return null!==e&&(i.directiveStylingLast=a),n}function Em(e,t,i){const n=i?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const o=t[s];"number"==typeof o?r=o:r===n&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Ts(e,o,!!i||t[++s]))}return void 0===e?null:e}function b$(e,t,i){const n=String(t);""!==n&&!n.includes(" ")&&Ts(e,n,i)}function kL(e,t,i,n,r,s,o,a){if(!(3&t.type))return;const l=e.data,c=l[a+1],h=function r$(e){return 1==(1&e)}(c)?FL(l,t,i,r,_u(c),o):void 0;a0(h)||(a0(s)||function i$(e){return 2==(2&e)}(c)&&(s=FL(l,null,i,r,a,o)),function tZ(e,t,i,n,r){if(t)r?e.addClass(i,n):e.removeClass(i,n);else{let s=-1===n.indexOf("-")?void 0:ac.DashCase;null==r?e.removeStyle(i,n,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=ac.Important),e.setStyle(i,n,r,s))}}(n,o,cy(Pr(),i),r,s))}function FL(e,t,i,n,r,s){const o=null===t;let a;for(;r>0;){const l=e[r],c=Array.isArray(l),h=c?l[1]:l,u=null===h;let d=i[r+1];d===Et&&(d=u?Kt:void 0);let p=u?_1(d,n):h===n?d:void 0;if(c&&!a0(p)&&(p=_1(l,n)),a0(p)&&(a=p,o))return a;const f=e[r+1];r=o?cc(f):_u(f)}if(null!==t){let l=s?t.residualClasses:t.residualStyles;null!=l&&(a=_1(l,n))}return a}function a0(e){return void 0!==e}function BL(e,t){return 0!=(e.flags&(t?8:16))}function ht(e,t=""){const i=ve(),n=qt(),r=e+Bt,s=n.firstCreatePass?ud(n,r,1,t,null):n.data[r],o=VL(n,i,s,t,e);i[r]=o,uy()&&Oy(n,i,o,s),ca(s,!1)}let VL=(e,t,i,n,r)=>(oc(!0),function Ty(e,t){return e.createText(t)}(t[bt],n));function l0(e){return VS("",e,""),l0}function VS(e,t,i){const n=ve(),r=function dd(e,t,i,n){return hr(e,Uh(),i)?t+_t(i)+n:Et}(n,e,t,i);return r!==Et&&function ll(e,t,i){const n=cy(t,e);!function iO(e,t,i){e.setValue(t,i)}(e[bt],n,i)}(n,Pr(),r),VS}function Mm(e,t,i){const n=ve();return hr(n,Uh(),t)&&Is(qt(),Ui(),n,e,t,n[bt],i,!0),Mm}const Sd="en-US";let oN=Sd;function jS(e,t,i,n,r){if(e=vt(e),Array.isArray(e))for(let s=0;s<e.length;s++)jS(e[s],t,i,n,r);else{const s=qt(),o=ve(),a=ir();let l=mu(e)?e:vt(e.provide);const c=kO(e),h=1048575&a.providerIndexes,u=a.directiveStart,d=a.providerIndexes>>20;if(mu(e)||!e.multi){const p=new Qf(c,r,pe),f=GS(l,t,r?h:h+d,u);-1===f?(g1(my(a,o),s,l),HS(s,e,t.length),t.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),i.push(p),o.push(p)):(i[f]=p,o[f]=p)}else{const p=GS(l,t,h+d,u),f=GS(l,t,h,h+d),g=f>=0&&i[f];if(r&&!g||!r&&!(p>=0&&i[p])){g1(my(a,o),s,l);const v=function HJ(e,t,i,n,r){const s=new Qf(e,i,pe);return s.multi=[],s.index=t,s.componentProviders=0,PN(s,r,n&&!i),s}(r?jJ:UJ,i.length,r,n,c);!r&&g&&(i[f].providerFactory=v),HS(s,e,t.length,0),t.push(l),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),i.push(v),o.push(v)}else HS(s,e,p>-1?p:f,PN(i[r?f:p],c,!r&&n));!r&&n&&g&&i[f].componentProviders++}}}function HS(e,t,i,n){const r=mu(t),s=function PZ(e){return!!e.useClass}(t);if(r||s){const l=(s?vt(t.useClass):t).prototype.ngOnDestroy;if(l){const c=e.destroyHooks||(e.destroyHooks=[]);if(!r&&t.multi){const h=c.indexOf(i);-1===h?c.push(i,[n,l]):c[h+1].push(n,l)}else c.push(i,l)}}}function PN(e,t,i){return i&&e.componentProviders++,e.multi.push(t)-1}function GS(e,t,i,n){for(let r=i;r<n;r++)if(t[r]===e)return r;return-1}function UJ(e,t,i,n){return WS(this.multi,[])}function jJ(e,t,i,n){const r=this.multi;let s;if(this.providerFactory){const o=this.providerFactory.componentProviders,a=pu(i,i[ke],this.providerFactory.index,n);s=a.slice(0,o),WS(r,s);for(let l=o;l<a.length;l++)s.push(a[l])}else s=[],WS(r,s);return s}function WS(e,t){for(let i=0;i<e.length;i++)t.push((0,e[i])());return t}function _i(e,t=[]){return i=>{i.providersResolver=(n,r)=>function zJ(e,t,i){const n=qt();if(n.firstCreatePass){const r=Ao(e);jS(i,n.data,n.blueprint,r,!0),jS(t,n.data,n.blueprint,r,!1)}}(n,r?r(e):e,t)}}class wu{}class RN{}class qS extends wu{constructor(t,i,n){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new F3(this);const r=As(t);this._bootstrapComponents=al(r.bootstrap),this._r3Injector=ZO(t,i,[{provide:wu,useValue:this},{provide:vu,useValue:this.componentFactoryResolver},...n],Rn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class YS extends RN{constructor(t){super(),this.moduleType=t}create(t){return new qS(this.moduleType,t,[])}}class ON extends wu{constructor(t){super(),this.componentFactoryResolver=new F3(this),this.instance=null;const i=new id([...t.providers,{provide:wu,useValue:this},{provide:vu,useValue:this.componentFactoryResolver}],t.parent||zy(),t.debugName,new Set(["environment"]));this.injector=i,t.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function XS(e,t,i=null){return new ON({providers:e,parent:t,debugName:i,runEnvironmentInitializers:!0}).injector}let qJ=(()=>{class e{constructor(i){this._injector=i,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){const n=RO(0,i.type),r=n.length>0?XS([n],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,r)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(const i of this.cachedInjectors.values())null!==i&&i.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=je({token:e,providedIn:"environment",factory:()=>new e(we(Zs))})}return e})();function LN(e){e.getStandaloneInjector=t=>t.get(qJ).getOrCreateStandaloneInjector(e)}function QS(e,t,i,n){return function UN(e,t,i,n,r,s){const o=t+i;return hr(e,o,r)?function da(e,t,i){return e[t]=i}(e,o+1,s?n.call(s,r):n(r)):function Rm(e,t){const i=e[t];return i===Et?void 0:i}(e,o+1)}(ve(),function Ir(){const e=pt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}(),e,t,i,n)}function vee(){return this._results[Symbol.iterator]()}class KS{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new Ii)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=KS.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=vee)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){const n=this;n.dirty=!1;const r=function Xs(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function rX(e,t,i){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let r=e[n],s=t[n];if(i&&(r=i(r),s=i(s)),s!==r)return!1}return!0}(n._results,r,i))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function _ee(e,t,i,n=!0){const r=t[ke];if(function YX(e,t,i,n){const r=er+n,s=i.length;n>0&&(i[r-1][Mo]=t),n<s-er?(t[Mo]=i[r],RR(i,er+n,t)):(i.push(t),t[Mo]=null),t[Vi]=i;const o=t[Hf];null!==o&&i!==o&&function XX(e,t){const i=e[Fh];t[nn]!==t[Vi][Vi][nn]&&(e[RP]=!0),null===i?e[Fh]=[t]:i.push(t)}(o,t);const a=t[oa];null!==a&&a.insertView(e),t[At]|=128}(r,t,e,i),n){const s=L1(i,e),o=t[bt],a=Ry(o,e[aa]);null!==a&&function GX(e,t,i,n,r,s){n[qi]=r,n[cr]=t,om(e,n,i,1,r,s)}(r,e[cr],o,t,a,s)}}let ma=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=xee}return e})();const bee=ma,wee=class extends bee{constructor(t,i,n){super(),this._declarationLView=t,this._declarationTContainer=i,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,n){const r=function yee(e,t,i,n){const r=t.tView,a=Zy(e,r,i,4096&e[At]?4096:16,null,t,null,null,null,n?.injector??null,n?.hydrationInfo??null);a[Hf]=e[t.index];const c=e[oa];return null!==c&&(a[oa]=c.createEmbeddedView(r)),CS(r,a,i),a}(this._declarationLView,this._declarationTContainer,t,{injector:i,hydrationInfo:n});return new vm(r)}};function xee(){return p0(ir(),ve())}function p0(e,t){return 4&e.type?new wee(t,e,od(e,t)):null}let $s=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Dee}return e})();function Dee(){return $N(ir(),ve())}const Tee=$s,QN=class extends Tee{constructor(t,i,n){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=n}get element(){return od(this._hostTNode,this._hostLView)}get injector(){return new Rr(this._hostTNode,this._hostLView)}get parentInjector(){const t=gy(this._hostTNode,this._hostLView);if(p1(t)){const i=$f(t,this._hostLView),n=Kf(t);return new Rr(i[ke].data[n+8],i)}return new Rr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const i=KN(this._lContainer);return null!==i&&i[t]||null}get length(){return this._lContainer.length-er}createEmbeddedView(t,i,n){let r,s;"number"==typeof n?r=n:null!=n&&(r=n.index,s=n.injector);const a=t.createEmbeddedViewImpl(i||{},s,null);return this.insertImpl(a,r,false),a}createComponent(t,i,n,r,s){const o=t&&!function em(e){return"function"==typeof e}(t);let a;if(o)a=i;else{const m=i||{};a=m.index,n=m.injector,r=m.projectableNodes,s=m.environmentInjector||m.ngModuleRef}const l=o?t:new ym(Wt(t)),c=n||this.parentInjector;if(!s&&null==l.ngModule){const g=(o?c:this.parentInjector).get(Zs,null);g&&(s=g)}Wt(l.componentType??{});const p=l.create(c,r,null,s);return this.insertImpl(p.hostView,a,false),p}insert(t,i){return this.insertImpl(t,i,!1)}insertImpl(t,i,n){const r=t._lView;if(function yY(e){return Tr(e[Vi])}(r)){const l=this.indexOf(t);if(-1!==l)this.detach(l);else{const c=r[Vi],h=new QN(c,c[cr],c[Vi]);h.detach(h.indexOf(t))}}const o=this._adjustIndex(i),a=this._lContainer;return _ee(a,r,o,!n),t.attachToViewContainerRef(),RR($S(a),o,t),t}move(t,i){return this.insert(t,i)}indexOf(t){const i=KN(this._lContainer);return null!==i?i.indexOf(t):-1}remove(t){const i=this._adjustIndex(t,-1),n=Py(this._lContainer,i);n&&(_y($S(this._lContainer),i),I1(n[ke],n))}detach(t){const i=this._adjustIndex(t,-1),n=Py(this._lContainer,i);return n&&null!=_y($S(this._lContainer),i)?new vm(n):null}_adjustIndex(t,i=0){return t??this.length+i}};function KN(e){return e[8]}function $S(e){return e[8]||(e[8]=[])}function $N(e,t){let i;const n=t[e.index];return Tr(n)?i=n:(i=E3(n,t,null,e),t[e.index]=i,Qy(t,i)),JN(i,t,e,n),new QN(i,e,t)}let JN=function ek(e,t,i,n){if(e[aa])return;let r;r=8&i.type?Ti(n):function Iee(e,t){const i=e[bt],n=i.createComment(""),r=as(t,e);return fu(i,Ry(i,r),n,function $X(e,t){return e.nextSibling(t)}(i,r),!1),n}(t,i),e[aa]=r};class JS{constructor(t){this.queryList=t,this.matches=null}clone(){return new JS(this.queryList)}setDirty(){this.queryList.setDirty()}}class eC{constructor(t=[]){this.queries=t}createEmbeddedView(t){const i=t.queries;if(null!==i){const n=null!==t.contentQueries?t.contentQueries[0]:i.length,r=[];for(let s=0;s<n;s++){const o=i.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new eC(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)null!==sk(t,i).matches&&this.queries[i].setDirty()}}class tk{constructor(t,i,n=null){this.predicate=t,this.flags=i,this.read=n}}class tC{constructor(t=[]){this.queries=t}elementStart(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let n=0;n<this.length;n++){const r=null!==i?i.length:0,s=this.getByIndex(n).embeddedTView(t,r);s&&(s.indexInDeclarationView=n,null!==i?i.push(s):i=[s])}return null!==i?new tC(i):null}template(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class iC{constructor(t,i=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new iC(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==i;)n=n.parent;return i===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,i){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const s=n[r];this.matchTNodeWithReadOption(t,i,Oee(i,s)),this.matchTNodeWithReadOption(t,i,vy(i,t,s,!1,!1))}else n===ma?4&i.type&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,vy(i,t,n,!1,!1))}matchTNodeWithReadOption(t,i,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===gn||r===$s||r===ma&&4&i.type)this.addMatch(i.index,-2);else{const s=vy(i,t,r,!1,!1);null!==s&&this.addMatch(i.index,s)}else this.addMatch(i.index,n)}}addMatch(t,i){null===this.matches?this.matches=[t,i]:this.matches.push(t,i)}}function Oee(e,t){const i=e.localNames;if(null!==i)for(let n=0;n<i.length;n+=2)if(i[n]===t)return i[n+1];return null}function Nee(e,t,i,n){return-1===i?function Lee(e,t){return 11&e.type?od(e,t):4&e.type?p0(e,t):null}(t,e):-2===i?function kee(e,t,i){return i===gn?od(t,e):i===ma?p0(t,e):i===$s?$N(t,e):void 0}(e,t,n):pu(e,e[ke],i,t)}function ik(e,t,i,n){const r=t[oa].queries[n];if(null===r.matches){const s=e.data,o=i.matches,a=[];for(let l=0;l<o.length;l+=2){const c=o[l];a.push(c<0?null:Nee(t,s[c],o[l+1],i.metadata.read))}r.matches=a}return r.matches}function nC(e,t,i,n){const r=e.queries.getByIndex(i),s=r.matches;if(null!==s){const o=ik(e,t,r,i);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)n.push(o[a/2]);else{const c=s[a+1],h=t[-l];for(let u=er;u<h.length;u++){const d=h[u];d[Hf]===d[Vi]&&nC(d[ke],d,c,n)}if(null!==h[Fh]){const u=h[Fh];for(let d=0;d<u.length;d++){const p=u[d];nC(p[ke],p,c,n)}}}}}return n}function Lr(e){const t=ve(),i=qt(),n=hR();o1(n+1);const r=sk(i,n);if(e.dirty&&function gY(e){return 4==(4&e[At])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)e.reset([]);else{const s=r.crossesNgTemplate?nC(i,t,n,[]):ik(i,t,r,n);e.reset(s,JZ),e.notifyOnChanges()}return!0}return!1}function Po(e,t,i){const n=qt();n.firstCreatePass&&(rk(n,new tk(e,t,i),-1),2==(2&t)&&(n.staticViewQueries=!0)),nk(n,ve(),t)}function Lm(e,t,i,n){const r=qt();if(r.firstCreatePass){const s=ir();rk(r,new tk(t,i,n),s.index),function Bee(e,t){const i=e.contentQueries||(e.contentQueries=[]);t!==(i.length?i[i.length-1]:-1)&&i.push(e.queries.length-1,t)}(r,e),2==(2&i)&&(r.staticContentQueries=!0)}nk(r,ve(),i)}function Nr(){return function Fee(e,t){return e[oa].queries[t].queryList}(ve(),hR())}function nk(e,t,i){const n=new KS(4==(4&i));(function PQ(e,t,i,n){const r=A3(t);r.push(i),e.firstCreatePass&&D3(e).push(n,r.length-1)})(e,t,n,n.destroy),null===t[oa]&&(t[oa]=new eC),t[oa].queries.push(new JS(n))}function rk(e,t,i){null===e.queries&&(e.queries=new tC),e.queries.track(new iC(t,i))}function sk(e,t){return e.queries.getByIndex(t)}const cC=new Le("Application Initializer");let uC=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,n)=>{this.resolve=i,this.reject=n}),this.appInits=We(cC,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const i=[];for(const r of this.appInits){const s=r();if(Cm(s))i.push(s);else if(lL(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});i.push(o)}}const n=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{n()}).catch(r=>{this.reject(r)}),0===i.length&&n(),this.initialized=!0}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),xk=(()=>{class e{log(i){console.log(i)}warn(i){console.warn(i)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const cl=new Le("LocaleId",{providedIn:"root",factory:()=>We(cl,Ft.Optional|Ft.SkipSelf)||function ote(){return typeof $localize<"u"&&$localize.locale||Sd}()});let Sk=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Gs(!1)}add(){this.hasPendingTasks.next(!0);const i=this.taskId++;return this.pendingTasks.add(i),i}remove(i){this.pendingTasks.delete(i),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class cte{constructor(t,i){this.ngModuleFactory=t,this.componentFactories=i}}let Ck=(()=>{class e{compileModuleSync(i){return new YS(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){const n=this.compileModuleSync(i),s=al(As(i).declarations).reduce((o,a)=>{const l=Wt(a);return l&&o.push(new ym(l)),o},[]);return new cte(n,s)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Dk=new Le(""),v0=new Le("");let mC,pC=(()=>{class e{constructor(i,n,r){this._ngZone=i,this.registry=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,mC||(function Pte(e){mC=e}(r),r.addToWindow(n)),this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Vt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(n=>!n.updateCb||!n.updateCb(i)||(clearTimeout(n.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,n,r){let s=-1;n&&n>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),i(this._didWork,this.getPendingTasks())},n)),this._callbacks.push({doneCb:i,timeoutId:s,updateCb:r})}whenStable(i,n,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,n,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,n,r){return[]}static#e=this.\u0275fac=function(n){return new(n||e)(we(Vt),we(fC),we(v0))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})(),fC=(()=>{class e{constructor(){this._applications=new Map}registerApplication(i,n){this._applications.set(i,n)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,n=!0){return mC?.findTestabilityInTree(this,i,n)??null}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),uc=null;const Tk=new Le("AllowMultipleToken"),gC=new Le("PlatformDestroyListeners"),vC=new Le("appBootstrapListener");class Pk{constructor(t,i){this.name=t,this.token=i}}function Ok(e,t,i=[]){const n=`Platform: ${t}`,r=new Le(n);return(s=[])=>{let o=yC();if(!o||o.injector.get(Tk,!1)){const a=[...i,...s,{provide:r,useValue:!0}];e?e(a):function Lte(e){if(uc&&!uc.get(Tk,!1))throw new be(400,!1);(function Ik(){!function nY(e){GP=e}(()=>{throw new be(600,!1)})})(),uc=e;const t=e.get(Nk);(function Rk(e){e.get(FO,null)?.forEach(i=>i())})(e)}(function Lk(e=[],t){return rr.create({name:t,providers:[{provide:q1,useValue:"platform"},{provide:gC,useValue:new Set([()=>uc=null])},...e]})}(a,n))}return function kte(e){const t=yC();if(!t)throw new be(401,!1);return t}()}}function yC(){return uc?.get(Nk)??null}let Nk=(()=>{class e{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,n){const r=function Fte(e="zone.js",t){return"noop"===e?new fQ:"zone.js"===e?new Vt(t):e}(n?.ngZone,function kk(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:n?.ngZoneEventCoalescing,runCoalescing:n?.ngZoneRunCoalescing}));return r.run(()=>{const s=function WJ(e,t,i){return new qS(e,t,i)}(i.moduleType,this.injector,function Uk(e){return[{provide:Vt,useFactory:e},{provide:um,multi:!0,useFactory:()=>{const t=We(Vte,{optional:!0});return()=>t.initialize()}},{provide:zk,useFactory:Bte},{provide:e3,useFactory:t3}]}(()=>r)),o=s.injector.get(ol,null);return r.runOutsideAngular(()=>{const a=r.onError.subscribe({next:l=>{o.handleError(l)}});s.onDestroy(()=>{y0(this._modules,s),a.unsubscribe()})}),function Fk(e,t,i){try{const n=i();return Cm(n)?n.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}(o,r,()=>{const a=s.injector.get(uC);return a.runInitializers(),a.donePromise.then(()=>(function aN(e){Ws(e,"Expected localeId to be defined"),"string"==typeof e&&(oN=e.toLowerCase().replace(/_/g,"-"))}(s.injector.get(cl,Sd)||Sd),this._moduleDoBootstrap(s),s))})})}bootstrapModule(i,n=[]){const r=Bk({},n);return function Rte(e,t,i){const n=new YS(i);return Promise.resolve(n)}(0,0,i).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(i){const n=i.injector.get(xu);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(r=>n.bootstrap(r));else{if(!i.instance.ngDoBootstrap)throw new be(-403,!1);i.instance.ngDoBootstrap(n)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new be(404,!1);this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n());const i=this._injector.get(gC,null);i&&(i.forEach(n=>n()),i.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(n){return new(n||e)(we(rr))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function Bk(e,t){return Array.isArray(t)?t.reduce(Bk,e):{...e,...t}}let xu=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=We(zk),this.zoneIsStable=We(e3),this.componentTypes=[],this.components=[],this.isStable=We(Sk).hasPendingTasks.pipe(So(i=>i?gt(!1):this.zoneIsStable),function f7(e,t=Jl){return e=e??m7,mn((i,n)=>{let r,s=!0;i.subscribe(Wi(n,o=>{const a=t(o);(s||!e(r,a))&&(s=!1,r=a,n.next(o))}))})}(),lP()),this._injector=We(Zs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(i,n){const r=i instanceof jO;if(!this._injector.get(uC).done)throw!r&&function Rh(e){const t=Wt(e)||Jn(e)||Dr(e);return null!==t&&t.standalone}(i),new be(405,!1);let o;o=r?i:this._injector.get(vu).resolveComponentFactory(i),this.componentTypes.push(o.componentType);const a=function Ote(e){return e.isBoundToModule}(o)?void 0:this._injector.get(wu),c=o.create(rr.NULL,[],n||o.selector,a),h=c.location.nativeElement,u=c.injector.get(Dk,null);return u?.registerApplication(h),c.onDestroy(()=>{this.detachView(c.hostView),y0(this.components,c),u?.unregisterApplication(h)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new be(101,!1);try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1}}attachView(i){const n=i;this._views.push(n),n.attachToAppRef(this)}detachView(i){const n=i;y0(this._views,n),n.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);const n=this._injector.get(vC,[]);n.push(...this._bootstrapListeners),n.forEach(r=>r(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>y0(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new be(406,!1);const i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function y0(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}const zk=new Le("",{providedIn:"root",factory:()=>We(ol).handleError.bind(void 0)});function Bte(){const e=We(Vt),t=We(ol);return i=>e.runOutsideAngular(()=>t.handleError(i))}let Vte=(()=>{class e{constructor(){this.zone=We(Vt),this.applicationRef=We(xu)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let Fm=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Ute}return e})();function Ute(e){return function jte(e,t,i){if(uu(e)&&!i){const n=Ds(e.index,t);return new vm(n,n)}return 47&e.type?new vm(t[nn],t):null}(ir(),ve(),16==(16&e))}class Wk{constructor(){}supports(t){return e0(t)}create(t){return new Xte(t)}}const Yte=(e,t)=>t;class Xte{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Yte}forEachItem(t){let i;for(i=this._itHead;null!==i;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,n=this._removalsHead,r=0,s=null;for(;i||n;){const o=!n||i&&i.currentIndex<Yk(n,r,s)?i:n,a=Yk(o,r,s),l=o.currentIndex;if(o===n)r--,n=n._nextRemoved;else if(i=i._next,null==o.previousIndex)r++;else{s||(s=[]);const c=a-r,h=l-r;if(c!=h){for(let d=0;d<c;d++){const p=d<s.length?s[d]:s[d]=0,f=p+d;h<=f&&f<c&&(s[d]=p+1)}s[o.previousIndex]=h-c}}a!==l&&t(o,a,l)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)t(i)}diff(t){if(null==t&&(t=[]),!e0(t))throw new be(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,o,i=this._itHead,n=!1;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)s=t[a],o=this._trackByFn(a,s),null!==i&&Object.is(i.trackById,o)?(n&&(i=this._verifyReinsertion(i,s,o,a)),Object.is(i.item,s)||this._addIdentityChange(i,s)):(i=this._mismatch(i,s,o,a),n=!0),i=i._next}else r=0,function SK(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{const i=e[Symbol.iterator]();let n;for(;!(n=i.next()).done;)t(n.value)}}(t,a=>{o=this._trackByFn(r,a),null!==i&&Object.is(i.trackById,o)?(n&&(i=this._verifyReinsertion(i,a,o,r)),Object.is(i.item,a)||this._addIdentityChange(i,a)):(i=this._mismatch(i,a,o,r),n=!0),i=i._next,r++}),this.length=r;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,n,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,s,r)):t=this._addAfter(new Zte(i,n),s,r),t}_verifyReinsertion(t,i,n,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const i=t._next;this._addToRemovals(this._unlink(t)),t=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,i,n),this._addToMoves(t,n),t}_moveAfter(t,i,n){return this._unlink(t),this._insertAfter(t,i,n),this._addToMoves(t,n),t}_addAfter(t,i,n){return this._insertAfter(t,i,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,i,n){const r=null===i?this._itHead:i._next;return t._next=r,t._prev=i,null===r?this._itTail=t:r._prev=t,null===i?this._itHead=t:i._next=t,null===this._linkedRecords&&(this._linkedRecords=new qk),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const i=t._prev,n=t._next;return null===i?this._itHead=n:i._next=n,null===n?this._itTail=i:n._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new qk),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Zte{constructor(t,i){this.item=t,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Qte{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===i||i<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const i=t._prevDup,n=t._nextDup;return null===i?this._head=n:i._nextDup=n,null===n?this._tail=i:n._prevDup=i,null===this._head}}class qk{constructor(){this.map=new Map}put(t){const i=t.trackById;let n=this.map.get(i);n||(n=new Qte,this.map.set(i,n)),n.add(t)}get(t,i){const r=this.map.get(t);return r?r.get(t,i):null}remove(t){const i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Yk(e,t,i){const n=e.previousIndex;if(null===n)return n;let r=0;return i&&n<i.length&&(r=i[n]),n+t+r}class Xk{constructor(){}supports(t){return t instanceof Map||ES(t)}create(){return new Kte}}class Kte{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let i;for(i=this._mapHead;null!==i;i=i._next)t(i)}forEachPreviousItem(t){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)t(i)}forEachChangedItem(t){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}diff(t){if(t){if(!(t instanceof Map||ES(t)))throw new be(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(t,(n,r)=>{if(i&&i.key===r)this._maybeAddToChanges(i,n),this._appendAfter=i,i=i._next;else{const s=this._getOrCreateRecordForKey(r,n);i=this._insertBeforeOrAppend(i,s)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let n=i;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,i){if(t){const n=t._prev;return i._next=t,i._prev=n,t._prev=i,n&&(n._next=i),t===this._mapHead&&(this._mapHead=i),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(t,i){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,i);const s=r._prev,o=r._next;return s&&(s._next=o),o&&(o._prev=s),r._next=null,r._prev=null,r}const n=new $te(t);return this._records.set(t,n),n.currentValue=i,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,i){Object.is(i,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=i,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,i){t instanceof Map?t.forEach(i):Object.keys(t).forEach(n=>i(t[n],n))}}class $te{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Zk(){return new w0([new Wk])}let w0=(()=>{class e{static#e=this.\u0275prov=je({token:e,providedIn:"root",factory:Zk});constructor(i){this.factories=i}static create(i,n){if(null!=n){const r=n.factories.slice();i=i.concat(r)}return new e(i)}static extend(i){return{provide:e,useFactory:n=>e.create(i,n||Zk()),deps:[[e,new xy,new wy]]}}find(i){const n=this.factories.find(r=>r.supports(i));if(null!=n)return n;throw new be(901,!1)}}return e})();function Qk(){return new Bm([new Xk])}let Bm=(()=>{class e{static#e=this.\u0275prov=je({token:e,providedIn:"root",factory:Qk});constructor(i){this.factories=i}static create(i,n){if(n){const r=n.factories.slice();i=i.concat(r)}return new e(i)}static extend(i){return{provide:e,useFactory:n=>e.create(i,n||Qk()),deps:[[e,new xy,new wy]]}}find(i){const n=this.factories.find(r=>r.supports(i));if(n)return n;throw new be(901,!1)}}return e})();const tie=Ok(null,"core",[]);let iie=(()=>{class e{constructor(i){}static#e=this.\u0275fac=function(n){return new(n||e)(we(xu))};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({})}return e})(),CC=null;function hc(){return CC}class gie{}const Ri=new Le("DocumentToken");let EC=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:function(){return We(yie)},providedIn:"platform"})}return e})();const vie=new Le("Location Initialized");let yie=(()=>{class e extends EC{constructor(){super(),this._doc=We(Ri),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return hc().getBaseHref(this._doc)}onPopState(i){const n=hc().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",i,!1),()=>n.removeEventListener("popstate",i)}onHashChange(i){const n=hc().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",i,!1),()=>n.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,n,r){this._history.pushState(i,n,r)}replaceState(i,n,r){this._history.replaceState(i,n,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function MC(e,t){if(0==e.length)return t;if(0==t.length)return e;let i=0;return e.endsWith("/")&&i++,t.startsWith("/")&&i++,2==i?e+t.substring(1):1==i?e+t:e+"/"+t}function sF(e){const t=e.match(/#|\?|$/),i=t&&t.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function ul(e){return e&&"?"!==e[0]?"?"+e:e}let Cu=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:function(){return We(aF)},providedIn:"root"})}return e})();const oF=new Le("appBaseHref");let aF=(()=>{class e extends Cu{constructor(i,n){super(),this._platformLocation=i,this._removeListenerFns=[],this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??We(Ri).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return MC(this._baseHref,i)}path(i=!1){const n=this._platformLocation.pathname+ul(this._platformLocation.search),r=this._platformLocation.hash;return r&&i?`${n}${r}`:n}pushState(i,n,r,s){const o=this.prepareExternalUrl(r+ul(s));this._platformLocation.pushState(i,n,o)}replaceState(i,n,r,s){const o=this.prepareExternalUrl(r+ul(s));this._platformLocation.replaceState(i,n,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#e=this.\u0275fac=function(n){return new(n||e)(we(EC),we(oF,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_ie=(()=>{class e extends Cu{constructor(i,n){super(),this._platformLocation=i,this._baseHref="",this._removeListenerFns=[],null!=n&&(this._baseHref=n)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let n=this._platformLocation.hash;return null==n&&(n="#"),n.length>0?n.substring(1):n}prepareExternalUrl(i){const n=MC(this._baseHref,i);return n.length>0?"#"+n:n}pushState(i,n,r,s){let o=this.prepareExternalUrl(r+ul(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(i,n,o)}replaceState(i,n,r,s){let o=this.prepareExternalUrl(r+ul(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(i,n,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#e=this.\u0275fac=function(n){return new(n||e)(we(EC),we(oF,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})(),S0=(()=>{class e{constructor(i){this._subject=new Ii,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=i;const n=this._locationStrategy.getBaseHref();this._basePath=function xie(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(sF(lF(n))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,n=""){return this.path()==this.normalize(i+ul(n))}normalize(i){return e.stripTrailingSlash(function wie(e,t){if(!e||!t.startsWith(e))return t;const i=t.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:t}(this._basePath,lF(i)))}prepareExternalUrl(i){return i&&"/"!==i[0]&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,n="",r=null){this._locationStrategy.pushState(r,"",i,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+ul(n)),r)}replaceState(i,n="",r=null){this._locationStrategy.replaceState(r,"",i,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+ul(n)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)})),()=>{const n=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(n,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",n){this._urlChangeListeners.forEach(r=>r(i,n))}subscribe(i,n,r){return this._subject.subscribe({next:i,error:n,complete:r})}static#e=this.normalizeQueryParams=ul;static#t=this.joinWithSlash=MC;static#i=this.stripTrailingSlash=sF;static#n=this.\u0275fac=function(n){return new(n||e)(we(Cu))};static#r=this.\u0275prov=je({token:e,factory:function(){return function bie(){return new S0(we(Cu))}()},providedIn:"root"})}return e})();function lF(e){return e.replace(/\/index.html$/,"")}const kC=/\s+/,vF=[];let FC=(()=>{class e{constructor(i,n,r,s){this._iterableDiffers=i,this._keyValueDiffers=n,this._ngEl=r,this._renderer=s,this.initialClasses=vF,this.stateMap=new Map}set klass(i){this.initialClasses=null!=i?i.trim().split(kC):vF}set ngClass(i){this.rawClass="string"==typeof i?i.trim().split(kC):i}ngDoCheck(){for(const n of this.initialClasses)this._updateState(n,!0);const i=this.rawClass;if(Array.isArray(i)||i instanceof Set)for(const n of i)this._updateState(n,!0);else if(null!=i)for(const n of Object.keys(i))this._updateState(n,!!i[n]);this._applyStateDiff()}_updateState(i,n){const r=this.stateMap.get(i);void 0!==r?(r.enabled!==n&&(r.changed=!0,r.enabled=n),r.touched=!0):this.stateMap.set(i,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(const i of this.stateMap){const n=i[0],r=i[1];r.changed?(this._toggleClass(n,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),r.touched=!1}}_toggleClass(i,n){(i=i.trim()).length>0&&i.split(kC).forEach(r=>{n?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static#e=this.\u0275fac=function(n){return new(n||e)(pe(w0),pe(Bm),pe(gn),pe(Qs))};static#t=this.\u0275dir=et({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})(),xF=(()=>{class e{constructor(i,n,r){this._ngEl=i,this._differs=n,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(i){this._ngStyle=i,!this._differ&&i&&(this._differ=this._differs.find(i).create())}ngDoCheck(){if(this._differ){const i=this._differ.diff(this._ngStyle);i&&this._applyChanges(i)}}_setStyle(i,n){const[r,s]=i.split("."),o=-1===r.indexOf("-")?void 0:ac.DashCase;null!=n?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${n}${s}`:n,o):this._renderer.removeStyle(this._ngEl.nativeElement,r,o)}_applyChanges(i){i.forEachRemovedItem(n=>this._setStyle(n.key,null)),i.forEachAddedItem(n=>this._setStyle(n.key,n.currentValue)),i.forEachChangedItem(n=>this._setStyle(n.key,n.currentValue))}static#e=this.\u0275fac=function(n){return new(n||e)(pe(gn),pe(Bm),pe(Qs))};static#t=this.\u0275dir=et({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0})}return e})(),Rs=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({})}return e})();const CF="browser";function EF(e){return"server"===e}let Une=(()=>{class e{static#e=this.\u0275prov=je({token:e,providedIn:"root",factory:()=>new jne(we(Ri),window)})}return e})();class jne{constructor(t,i){this.document=t,this.window=i,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const i=function Hne(e,t){const i=e.getElementById(t)||e.getElementsByName(t)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const s=r.shadowRoot;if(s){const o=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(o)return o}r=n.nextNode()}}return null}(this.document,t);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(t){this.supportsScrolling()&&(this.window.history.scrollRestoration=t)}scrollToElement(t){const i=t.getBoundingClientRect(),n=i.left+this.window.pageXOffset,r=i.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(n-s[0],r-s[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class pre extends gie{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class GC extends pre{static makeCurrent(){!function mie(e){CC||(CC=e)}(new GC)}onAndCancel(t,i,n){return t.addEventListener(i,n),()=>{t.removeEventListener(i,n)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,i){return(i=i||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return"window"===i?window:"document"===i?t:"body"===i?t.body:null}getBaseHref(t){const i=function fre(){return jm=jm||document.querySelector("base"),jm?jm.getAttribute("href"):null}();return null==i?null:function mre(e){k0=k0||document.createElement("a"),k0.setAttribute("href",e);const t=k0.pathname;return"/"===t.charAt(0)?t:`/${t}`}(i)}resetBaseElement(){jm=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function one(e,t){t=encodeURIComponent(t);for(const i of e.split(";")){const n=i.indexOf("="),[r,s]=-1==n?[i,""]:[i.slice(0,n),i.slice(n+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}(document.cookie,t)}}let k0,jm=null,vre=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();const WC=new Le("EventManagerPlugins");let IF=(()=>{class e{constructor(i,n){this._zone=n,this._eventNameToPlugin=new Map,i.forEach(r=>{r.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,n,r){return this._findPluginFor(n).addEventListener(i,n,r)}getZone(){return this._zone}_findPluginFor(i){let n=this._eventNameToPlugin.get(i);if(n)return n;if(n=this._plugins.find(s=>s.supports(i)),!n)throw new be(5101,!1);return this._eventNameToPlugin.set(i,n),n}static#e=this.\u0275fac=function(n){return new(n||e)(we(WC),we(Vt))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();class PF{constructor(t){this._doc=t}}const qC="ng-app-id";let RF=(()=>{class e{constructor(i,n,r,s={}){this.doc=i,this.appId=n,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=EF(s),this.resetHostNodes()}addStyles(i){for(const n of i)1===this.changeUsageCount(n,1)&&this.onStyleAdded(n)}removeStyles(i){for(const n of i)this.changeUsageCount(n,-1)<=0&&this.onStyleRemoved(n)}ngOnDestroy(){const i=this.styleNodesInDOM;i&&(i.forEach(n=>n.remove()),i.clear());for(const n of this.getAllStyles())this.onStyleRemoved(n);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const n of this.getAllStyles())this.addStyleToHost(i,n)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(const n of this.hostNodes)this.addStyleToHost(n,i)}onStyleRemoved(i){const n=this.styleRef;n.get(i)?.elements?.forEach(r=>r.remove()),n.delete(i)}collectServerRenderedStyles(){const i=this.doc.head?.querySelectorAll(`style[${qC}="${this.appId}"]`);if(i?.length){const n=new Map;return i.forEach(r=>{null!=r.textContent&&n.set(r.textContent,r)}),n}return null}changeUsageCount(i,n){const r=this.styleRef;if(r.has(i)){const s=r.get(i);return s.usage+=n,s.usage}return r.set(i,{usage:n,elements:[]}),n}getStyleElement(i,n){const r=this.styleNodesInDOM,s=r?.get(n);if(s?.parentNode===i)return r.delete(n),s.removeAttribute(qC),s;{const o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=n,this.platformIsServer&&o.setAttribute(qC,this.appId),o}}addStyleToHost(i,n){const r=this.getStyleElement(i,n);i.appendChild(r);const s=this.styleRef,o=s.get(n)?.elements;o?o.push(r):s.set(n,{elements:[r],usage:1})}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri),we(Uy),we(BO,8),we(gu))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();const YC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},XC=/%COMP%/g,wre=new Le("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function LF(e,t){return t.map(i=>i.replace(XC,e))}let NF=(()=>{class e{constructor(i,n,r,s,o,a,l,c=null){this.eventManager=i,this.sharedStylesHost=n,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=EF(a),this.defaultRenderer=new ZC(i,o,l,this.platformIsServer)}createRenderer(i,n){if(!i||!n)return this.defaultRenderer;this.platformIsServer&&n.encapsulation===Co.ShadowDom&&(n={...n,encapsulation:Co.Emulated});const r=this.getOrCreateRenderer(i,n);return r instanceof FF?r.applyToHost(i):r instanceof QC&&r.applyStyles(),r}getOrCreateRenderer(i,n){const r=this.rendererByCompId;let s=r.get(n.id);if(!s){const o=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,u=this.platformIsServer;switch(n.encapsulation){case Co.Emulated:s=new FF(l,c,n,this.appId,h,o,a,u);break;case Co.ShadowDom:return new Ere(l,c,i,n,o,a,this.nonce,u);default:s=new QC(l,c,n,h,o,a,u)}r.set(n.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(n){return new(n||e)(we(IF),we(RF),we(Uy),we(wre),we(Ri),we(gu),we(Vt),we(BO))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();class ZC{constructor(t,i,n,r){this.eventManager=t,this.doc=i,this.ngZone=n,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,i){return i?this.doc.createElementNS(YC[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(kF(t)?t.content:t).appendChild(i)}insertBefore(t,i,n){t&&(kF(t)?t.content:t).insertBefore(i,n)}removeChild(t,i){t&&t.removeChild(i)}selectRootElement(t,i){let n="string"==typeof t?this.doc.querySelector(t):t;if(!n)throw new be(-5104,!1);return i||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,n,r){if(r){i=r+":"+i;const s=YC[r];s?t.setAttributeNS(s,i,n):t.setAttribute(i,n)}else t.setAttribute(i,n)}removeAttribute(t,i,n){if(n){const r=YC[n];r?t.removeAttributeNS(r,i):t.removeAttribute(`${n}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,n,r){r&(ac.DashCase|ac.Important)?t.style.setProperty(i,n,r&ac.Important?"important":""):t.style[i]=n}removeStyle(t,i,n){n&ac.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,n){t[i]=n}setValue(t,i){t.nodeValue=i}listen(t,i,n){if("string"==typeof t&&!(t=hc().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${i}`);return this.eventManager.addEventListener(t,i,this.decoratePreventDefault(n))}decoratePreventDefault(t){return i=>{if("__ngUnwrap__"===i)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(i)):t(i))&&i.preventDefault()}}}function kF(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Ere extends ZC{constructor(t,i,n,r,s,o,a,l){super(t,s,o,l),this.sharedStylesHost=i,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=LF(r.id,r.styles);for(const h of c){const u=document.createElement("style");a&&u.setAttribute("nonce",a),u.textContent=h,this.shadowRoot.appendChild(u)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,n){return super.insertBefore(this.nodeOrShadowRoot(t),i,n)}removeChild(t,i){return super.removeChild(this.nodeOrShadowRoot(t),i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class QC extends ZC{constructor(t,i,n,r,s,o,a,l){super(t,s,o,a),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=r,this.styles=l?LF(l,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class FF extends QC{constructor(t,i,n,r,s,o,a,l){const c=r+"-"+n.id;super(t,i,n,s,o,a,l,c),this.contentAttr=function xre(e){return"_ngcontent-%COMP%".replace(XC,e)}(c),this.hostAttr=function Sre(e){return"_nghost-%COMP%".replace(XC,e)}(c)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){const n=super.createElement(t,i);return super.setAttribute(n,this.contentAttr,""),n}}let Mre=(()=>{class e extends PF{constructor(i){super(i)}supports(i){return!0}addEventListener(i,n,r){return i.addEventListener(n,r,!1),()=>this.removeEventListener(i,n,r)}removeEventListener(i,n,r){return i.removeEventListener(n,r)}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();const BF=["alt","control","meta","shift"],Are={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Dre={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Tre=(()=>{class e extends PF{constructor(i){super(i)}supports(i){return null!=e.parseEventName(i)}addEventListener(i,n,r){const s=e.parseEventName(n),o=e.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>hc().onAndCancel(i,s.domEventName,o))}static parseEventName(i){const n=i.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const s=e._normalizeKey(n.pop());let o="",a=n.indexOf("code");if(a>-1&&(n.splice(a,1),o="code."),BF.forEach(c=>{const h=n.indexOf(c);h>-1&&(n.splice(h,1),o+=c+".")}),o+=s,0!=n.length||0===s.length)return null;const l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(i,n){let r=Are[i.key]||i.key,s="";return n.indexOf("code.")>-1&&(r=i.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),BF.forEach(o=>{o!==r&&(0,Dre[o])(i)&&(s+=o+".")}),s+=r,s===n)}static eventCallback(i,n,r){return s=>{e.matchEventFullKeyCode(s,i)&&r.runGuarded(()=>n(s))}}static _normalizeKey(i){return"esc"===i?"escape":i}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();const zF=[{provide:gu,useValue:CF},{provide:FO,useValue:function Ire(){GC.makeCurrent()},multi:!0},{provide:Ri,useFactory:function Rre(){return function oZ(e){F1=e}(document),document},deps:[]}],Ore=Ok(tie,"browser",zF),Lre=new Le(""),UF=[{provide:v0,useClass:class gre{addToWindow(t){Di.getAngularTestability=(n,r=!0)=>{const s=t.findTestabilityInTree(n,r);if(null==s)throw new be(5103,!1);return s},Di.getAllAngularTestabilities=()=>t.getAllTestabilities(),Di.getAllAngularRootElements=()=>t.getAllRootElements(),Di.frameworkStabilizers||(Di.frameworkStabilizers=[]),Di.frameworkStabilizers.push(n=>{const r=Di.getAllAngularTestabilities();let s=r.length,o=!1;const a=function(l){o=o||l,s--,0==s&&n(o)};r.forEach(l=>{l.whenStable(a)})})}findTestabilityInTree(t,i,n){return null==i?null:t.getTestability(i)??(n?hc().isShadowRoot(i)?this.findTestabilityInTree(t,i.host,!0):this.findTestabilityInTree(t,i.parentElement,!0):null)}},deps:[]},{provide:Dk,useClass:pC,deps:[Vt,fC,v0]},{provide:pC,useClass:pC,deps:[Vt,fC,v0]}],jF=[{provide:q1,useValue:"root"},{provide:ol,useFactory:function Pre(){return new ol},deps:[]},{provide:WC,useClass:Mre,multi:!0,deps:[Ri,Vt,gu]},{provide:WC,useClass:Tre,multi:!0,deps:[Ri]},NF,RF,IF,{provide:GO,useExisting:NF},{provide:class Gne{},useClass:vre,deps:[]},[]];let Nre=(()=>{class e{constructor(i){}static withServerTransition(i){return{ngModule:e,providers:[{provide:Uy,useValue:i.appId}]}}static#e=this.\u0275fac=function(n){return new(n||e)(we(Lre,12))};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({providers:[...jF,...UF],imports:[Rs,iie]})}return e})(),HF=(()=>{class e{constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri))};static#t=this.\u0275prov=je({token:e,factory:function(n){let r=null;return r=n?new n:function Fre(){return new HF(we(Ri))}(),r},providedIn:"root"})}return e})();typeof window<"u"&&window;const{isArray:Hre}=Array,{getPrototypeOf:Gre,prototype:Wre,keys:qre}=Object;function YF(e){if(1===e.length){const t=e[0];if(Hre(t))return{args:t,keys:null};if(function Yre(e){return e&&"object"==typeof e&&Gre(e)===Wre}(t)){const i=qre(t);return{args:i.map(n=>t[n]),keys:i}}}return{args:e,keys:null}}const{isArray:Xre}=Array;function $C(e){return Si(t=>function Zre(e,t){return Xre(t)?e(...t):e(t)}(e,t))}function XF(e,t){return e.reduce((i,n,r)=>(i[n]=t[r],i),{})}function JC(...e){const t=kf(e),i=nP(e),{args:n,keys:r}=YF(e);if(0===n.length)return Pn([],t);const s=new Bi(function Qre(e,t,i=Jl){return n=>{ZF(t,()=>{const{length:r}=e,s=new Array(r);let o=r,a=r;for(let l=0;l<r;l++)ZF(t,()=>{const c=Pn(e[l],t);let h=!1;c.subscribe(Wi(n,u=>{s[l]=u,h||(h=!0,a--),a||n.next(i(s.slice()))},()=>{--o||n.complete()}))},n)},n)}}(n,t,r?o=>XF(r,o):Jl));return i?s.pipe($C(i)):s}function ZF(e,t,i){e?Ja(i,e,t):t()}const F0=Of(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function eE(...e){return function Kre(){return Ih(1)}()(Pn(e,kf(e)))}function QF(e){return new Bi(t=>{Mr(e()).subscribe(t)})}function Hm(e,t){const i=kt(e)?e:()=>e,n=r=>r.error(i());return new Bi(t?r=>t.schedule(n,0,r):n)}function tE(){return mn((e,t)=>{let i=null;e._refCount++;const n=Wi(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(i=null);const r=e._connection,s=i;i=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(n),n.closed||(i=e.connect())})}class KF extends Bi{constructor(t,i){super(),this.source=t,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,j2(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new en;const i=this.getSubject();t.add(this.source.subscribe(Wi(i,void 0,()=>{this._teardown(),i.complete()},n=>{this._teardown(),i.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=en.EMPTY)}return t}refCount(){return tE()(this)}}function ga(e){return e<=0?()=>xo:mn((t,i)=>{let n=0;t.subscribe(Wi(i,r=>{++n<=e&&(i.next(r),e<=n&&i.complete())}))})}function $F(...e){const t=kf(e);return mn((i,n)=>{(t?eE(e,i,t):eE(e,i)).subscribe(n)})}function to(e,t){return mn((i,n)=>{let r=0;i.subscribe(Wi(n,s=>e.call(t,s,r++)&&n.next(s)))})}function B0(e){return mn((t,i)=>{let n=!1;t.subscribe(Wi(i,r=>{n=!0,i.next(r)},()=>{n||i.next(e),i.complete()}))})}function JF(e=$re){return mn((t,i)=>{let n=!1;t.subscribe(Wi(i,r=>{n=!0,i.next(r)},()=>n?i.complete():i.error(e())))})}function $re(){return new F0}function Eu(e,t){const i=arguments.length>=2;return n=>n.pipe(e?to((r,s)=>e(r,s,n)):Jl,ga(1),i?B0(t):JF(()=>new F0))}function Gm(e,t){return kt(t)?Gn(e,t,1):Gn(e,1)}function dr(e,t,i){const n=kt(e)||t||i?{next:e,error:t,complete:i}:e;return n?mn((r,s)=>{var o;null===(o=n.subscribe)||void 0===o||o.call(n);let a=!0;r.subscribe(Wi(s,l=>{var c;null===(c=n.next)||void 0===c||c.call(n,l),s.next(l)},()=>{var l;a=!1,null===(l=n.complete)||void 0===l||l.call(n),s.complete()},l=>{var c;a=!1,null===(c=n.error)||void 0===c||c.call(n,l),s.error(l)},()=>{var l,c;a&&(null===(l=n.unsubscribe)||void 0===l||l.call(n)),null===(c=n.finalize)||void 0===c||c.call(n)}))}):Jl}function Mu(e){return mn((t,i)=>{let s,n=null,r=!1;n=t.subscribe(Wi(i,void 0,void 0,o=>{s=Mr(e(o,Mu(e)(t))),n?(n.unsubscribe(),n=null,s.subscribe(i)):r=!0})),r&&(n.unsubscribe(),n=null,s.subscribe(i))})}function iE(e){return e<=0?()=>xo:mn((t,i)=>{let n=[];t.subscribe(Wi(i,r=>{n.push(r),e<n.length&&n.shift()},()=>{for(const r of n)i.next(r);i.complete()},void 0,()=>{n=null}))})}function nE(e){return mn((t,i)=>{try{t.subscribe(i)}finally{i.add(e)}})}function Au(e){return mn((t,i)=>{Mr(e).subscribe(Wi(i,()=>i.complete(),Lf)),!i.closed&&t.subscribe(i)})}const Tt="primary",Wm=Symbol("RouteTitle");class nse{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function Dd(e){return new nse(e)}function rse(e,t,i){const n=i.path.split("/");if(n.length>e.length||"full"===i.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const r={};for(let s=0;s<n.length;s++){const o=n[s],a=e[s];if(o.startsWith(":"))r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:e.slice(0,n.length),posParams:r}}function va(e,t){const i=e?Object.keys(e):void 0,n=t?Object.keys(t):void 0;if(!i||!n||i.length!=n.length)return!1;let r;for(let s=0;s<i.length;s++)if(r=i[s],!eB(e[r],t[r]))return!1;return!0}function eB(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const i=[...e].sort(),n=[...t].sort();return i.every((r,s)=>n[s]===r)}return e===t}function tB(e){return e.length>0?e[e.length-1]:null}function pc(e){return function jre(e){return!!e&&(e instanceof Bi||kt(e.lift)&&kt(e.subscribe))}(e)?e:Cm(e)?Pn(Promise.resolve(e)):gt(e)}const ose={exact:function rB(e,t,i){if(!Du(e.segments,t.segments)||!V0(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!e.children[n]||!rB(e.children[n],t.children[n],i))return!1;return!0},subset:sB},iB={exact:function ase(e,t){return va(e,t)},subset:function lse(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>eB(e[i],t[i]))},ignored:()=>!0};function nB(e,t,i){return ose[i.paths](e.root,t.root,i.matrixParams)&&iB[i.queryParams](e.queryParams,t.queryParams)&&!("exact"===i.fragment&&e.fragment!==t.fragment)}function sB(e,t,i){return oB(e,t,t.segments,i)}function oB(e,t,i,n){if(e.segments.length>i.length){const r=e.segments.slice(0,i.length);return!(!Du(r,i)||t.hasChildren()||!V0(r,i,n))}if(e.segments.length===i.length){if(!Du(e.segments,i)||!V0(e.segments,i,n))return!1;for(const r in t.children)if(!e.children[r]||!sB(e.children[r],t.children[r],n))return!1;return!0}{const r=i.slice(0,e.segments.length),s=i.slice(e.segments.length);return!!(Du(e.segments,r)&&V0(e.segments,r,n)&&e.children[Tt])&&oB(e.children[Tt],t,s,n)}}function V0(e,t,i){return t.every((n,r)=>iB[i](e[r].parameters,n.parameters))}class Td{constructor(t=new hi([],{}),i={},n=null){this.root=t,this.queryParams=i,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Dd(this.queryParams)),this._queryParamMap}toString(){return hse.serialize(this)}}class hi{constructor(t,i){this.segments=t,this.children=i,this.parent=null,Object.values(i).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return z0(this)}}class qm{constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=Dd(this.parameters)),this._parameterMap}toString(){return cB(this)}}function Du(e,t){return e.length===t.length&&e.every((i,n)=>i.path===t[n].path)}let Ym=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:function(){return new rE},providedIn:"root"})}return e})();class rE{parse(t){const i=new xse(t);return new Td(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){const i=`/${Xm(t.root,!0)}`,n=function fse(e){const t=Object.keys(e).map(i=>{const n=e[i];return Array.isArray(n)?n.map(r=>`${U0(i)}=${U0(r)}`).join("&"):`${U0(i)}=${U0(n)}`}).filter(i=>!!i);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${i}${n}${"string"==typeof t.fragment?`#${function dse(e){return encodeURI(e)}(t.fragment)}`:""}`}}const hse=new rE;function z0(e){return e.segments.map(t=>cB(t)).join("/")}function Xm(e,t){if(!e.hasChildren())return z0(e);if(t){const i=e.children[Tt]?Xm(e.children[Tt],!1):"",n=[];return Object.entries(e.children).forEach(([r,s])=>{r!==Tt&&n.push(`${r}:${Xm(s,!1)}`)}),n.length>0?`${i}(${n.join("//")})`:i}{const i=function use(e,t){let i=[];return Object.entries(e.children).forEach(([n,r])=>{n===Tt&&(i=i.concat(t(r,n)))}),Object.entries(e.children).forEach(([n,r])=>{n!==Tt&&(i=i.concat(t(r,n)))}),i}(e,(n,r)=>r===Tt?[Xm(e.children[Tt],!1)]:[`${r}:${Xm(n,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Tt]?`${z0(e)}/${i[0]}`:`${z0(e)}/(${i.join("//")})`}}function aB(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function U0(e){return aB(e).replace(/%3B/gi,";")}function sE(e){return aB(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function j0(e){return decodeURIComponent(e)}function lB(e){return j0(e.replace(/\+/g,"%20"))}function cB(e){return`${sE(e.path)}${function pse(e){return Object.keys(e).map(t=>`;${sE(t)}=${sE(e[t])}`).join("")}(e.parameters)}`}const mse=/^[^\/()?;#]+/;function oE(e){const t=e.match(mse);return t?t[0]:""}const gse=/^[^\/()?;=#]+/,yse=/^[^=?&#]+/,bse=/^[^&#]+/;class xse{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new hi([],{}):new hi([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(n[Tt]=new hi(t,i)),n}parseSegment(){const t=oE(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new be(4009,!1);return this.capture(t),new qm(j0(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const i=function vse(e){const t=e.match(gse);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const r=oE(this.remaining);r&&(n=r,this.capture(n))}t[j0(i)]=j0(n)}parseQueryParam(t){const i=function _se(e){const t=e.match(yse);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const o=function wse(e){const t=e.match(bse);return t?t[0]:""}(this.remaining);o&&(n=o,this.capture(n))}const r=lB(i),s=lB(n);if(t.hasOwnProperty(r)){let o=t[r];Array.isArray(o)||(o=[o],t[r]=o),o.push(s)}else t[r]=s}parseParens(t){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=oE(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new be(4010,!1);let s;n.indexOf(":")>-1?(s=n.slice(0,n.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Tt);const o=this.parseChildren();i[s]=1===Object.keys(o).length?o[Tt]:new hi([],o),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new be(4011,!1)}}function uB(e){return e.segments.length>0?new hi([],{[Tt]:e}):e}function hB(e){const t={};for(const n of Object.keys(e.children)){const s=hB(e.children[n]);if(n===Tt&&0===s.segments.length&&s.hasChildren())for(const[o,a]of Object.entries(s.children))t[o]=a;else(s.segments.length>0||s.hasChildren())&&(t[n]=s)}return function Sse(e){if(1===e.numberOfChildren&&e.children[Tt]){const t=e.children[Tt];return new hi(e.segments.concat(t.segments),t.children)}return e}(new hi(e.segments,t))}function Tu(e){return e instanceof Td}function dB(e){let t;const r=uB(function i(s){const o={};for(const l of s.children){const c=i(l);o[l.outlet]=c}const a=new hi(s.url,o);return s===e&&(t=a),a}(e.root));return t??r}function pB(e,t,i,n){let r=e;for(;r.parent;)r=r.parent;if(0===t.length)return aE(r,r,r,i,n);const s=function Ese(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new mB(!0,0,e);let t=0,i=!1;const n=e.reduce((r,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return Object.entries(s.outlets).forEach(([l,c])=>{a[l]="string"==typeof c?c.split("/"):c}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===o?(s.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?i=!0:".."===a?t++:""!=a&&r.push(a))}),r):[...r,s]},[]);return new mB(i,t,n)}(t);if(s.toRoot())return aE(r,r,new hi([],{}),i,n);const o=function Mse(e,t,i){if(e.isAbsolute)return new G0(t,!0,0);if(!i)return new G0(t,!1,NaN);if(null===i.parent)return new G0(i,!0,0);const n=H0(e.commands[0])?0:1;return function Ase(e,t,i){let n=e,r=t,s=i;for(;s>r;){if(s-=r,n=n.parent,!n)throw new be(4005,!1);r=n.segments.length}return new G0(n,!1,r-s)}(i,i.segments.length-1+n,e.numberOfDoubleDots)}(s,r,e),a=o.processChildren?Qm(o.segmentGroup,o.index,s.commands):gB(o.segmentGroup,o.index,s.commands);return aE(r,o.segmentGroup,a,i,n)}function H0(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Zm(e){return"object"==typeof e&&null!=e&&e.outlets}function aE(e,t,i,n,r){let o,s={};n&&Object.entries(n).forEach(([l,c])=>{s[l]=Array.isArray(c)?c.map(h=>`${h}`):`${c}`}),o=e===t?i:fB(e,t,i);const a=uB(hB(o));return new Td(a,s,r)}function fB(e,t,i){const n={};return Object.entries(e.children).forEach(([r,s])=>{n[r]=s===t?i:fB(s,t,i)}),new hi(e.segments,n)}class mB{constructor(t,i,n){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=n,t&&n.length>0&&H0(n[0]))throw new be(4003,!1);const r=n.find(Zm);if(r&&r!==tB(n))throw new be(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class G0{constructor(t,i,n){this.segmentGroup=t,this.processChildren=i,this.index=n}}function gB(e,t,i){if(e||(e=new hi([],{})),0===e.segments.length&&e.hasChildren())return Qm(e,t,i);const n=function Tse(e,t,i){let n=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(n>=i.length)return s;const o=e.segments[r],a=i[n];if(Zm(a))break;const l=`${a}`,c=n<i.length-1?i[n+1]:null;if(r>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!yB(l,c,o))return s;n+=2}else{if(!yB(l,{},o))return s;n++}r++}return{match:!0,pathIndex:r,commandIndex:n}}(e,t,i),r=i.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const s=new hi(e.segments.slice(0,n.pathIndex),{});return s.children[Tt]=new hi(e.segments.slice(n.pathIndex),e.children),Qm(s,0,r)}return n.match&&0===r.length?new hi(e.segments,{}):n.match&&!e.hasChildren()?lE(e,t,i):n.match?Qm(e,0,r):lE(e,t,i)}function Qm(e,t,i){if(0===i.length)return new hi(e.segments,{});{const n=function Dse(e){return Zm(e[0])?e[0].outlets:{[Tt]:e}}(i),r={};if(Object.keys(n).some(s=>s!==Tt)&&e.children[Tt]&&1===e.numberOfChildren&&0===e.children[Tt].segments.length){const s=Qm(e.children[Tt],t,i);return new hi(e.segments,s.children)}return Object.entries(n).forEach(([s,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(r[s]=gB(e.children[s],t,o))}),Object.entries(e.children).forEach(([s,o])=>{void 0===n[s]&&(r[s]=o)}),new hi(e.segments,r)}}function lE(e,t,i){const n=e.segments.slice(0,t);let r=0;for(;r<i.length;){const s=i[r];if(Zm(s)){const l=Ise(s.outlets);return new hi(n,l)}if(0===r&&H0(i[0])){n.push(new qm(e.segments[t].path,vB(i[0]))),r++;continue}const o=Zm(s)?s.outlets[Tt]:`${s}`,a=r<i.length-1?i[r+1]:null;o&&a&&H0(a)?(n.push(new qm(o,vB(a))),r+=2):(n.push(new qm(o,{})),r++)}return new hi(n,{})}function Ise(e){const t={};return Object.entries(e).forEach(([i,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=lE(new hi([],{}),0,n))}),t}function vB(e){const t={};return Object.entries(e).forEach(([i,n])=>t[i]=`${n}`),t}function yB(e,t,i){return e==i.path&&va(t,i.parameters)}const Km="imperative";class ya{constructor(t,i){this.id=t,this.url=i}}class W0 extends ya{constructor(t,i,n="imperative",r=null){super(t,i),this.type=0,this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class fc extends ya{constructor(t,i,n){super(t,i),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class $m extends ya{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Id extends ya{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=16}}class q0 extends ya{constructor(t,i,n,r){super(t,i),this.error=n,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class _B extends ya{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Pse extends ya{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Rse extends ya{constructor(t,i,n,r,s){super(t,i),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Ose extends ya{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Lse extends ya{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Nse{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class kse{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Fse{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bse{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Vse{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class zse{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bB{constructor(t,i,n){this.routerEvent=t,this.position=i,this.anchor=n,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class cE{}class uE{constructor(t){this.url=t}}class Use{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Jm,this.attachRef=null}}let Jm=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(i,n){const r=this.getOrCreateContext(i);r.outlet=n,this.contexts.set(i,r)}onChildOutletDestroyed(i){const n=this.getContext(i);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let n=this.getContext(i);return n||(n=new Use,this.contexts.set(i,n)),n}getContext(i){return this.contexts.get(i)||null}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class wB{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){const i=hE(t,this._root);return i?i.children.map(n=>n.value):[]}firstChild(t){const i=hE(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){const i=dE(t,this._root);return i.length<2?[]:i[i.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return dE(t,this._root).map(i=>i.value)}}function hE(e,t){if(e===t.value)return t;for(const i of t.children){const n=hE(e,i);if(n)return n}return null}function dE(e,t){if(e===t.value)return[t];for(const i of t.children){const n=dE(e,i);if(n.length)return n.unshift(t),n}return[]}class pl{constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}}function Pd(e){const t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}class xB extends wB{constructor(t,i){super(t),this.snapshot=i,pE(this,t)}toString(){return this.snapshot.toString()}}function SB(e,t){const i=function jse(e,t){const o=new Y0([],{},{},"",{},Tt,t,null,{});return new EB("",new pl(o,[]))}(0,t),n=new Gs([new qm("",{})]),r=new Gs({}),s=new Gs({}),o=new Gs({}),a=new Gs(""),l=new Rd(n,r,o,a,s,Tt,t,i.root);return l.snapshot=i.root,new xB(new pl(l,[]),i)}class Rd{constructor(t,i,n,r,s,o,a,l){this.urlSubject=t,this.paramsSubject=i,this.queryParamsSubject=n,this.fragmentSubject=r,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(Si(c=>c[Wm]))??gt(void 0),this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Si(t=>Dd(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Si(t=>Dd(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function CB(e,t="emptyOnly"){const i=e.pathFromRoot;let n=0;if("always"!==t)for(n=i.length-1;n>=1;){const r=i[n],s=i[n-1];if(r.routeConfig&&""===r.routeConfig.path)n--;else{if(s.component)break;n--}}return function Hse(e){return e.reduce((t,i)=>({params:{...t.params,...i.params},data:{...t.data,...i.data},resolve:{...i.data,...t.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(n))}class Y0{get title(){return this.data?.[Wm]}constructor(t,i,n,r,s,o,a,l,c){this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Dd(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Dd(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class EB extends wB{constructor(t,i){super(i),this.url=t,pE(this,i)}toString(){return MB(this._root)}}function pE(e,t){t.value._routerState=e,t.children.forEach(i=>pE(e,i))}function MB(e){const t=e.children.length>0?` { ${e.children.map(MB).join(", ")} } `:"";return`${e.value}${t}`}function fE(e){if(e.snapshot){const t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,va(t.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),t.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),va(t.params,i.params)||e.paramsSubject.next(i.params),function sse(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!va(e[i],t[i]))return!1;return!0}(t.url,i.url)||e.urlSubject.next(i.url),va(t.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function mE(e,t){const i=va(e.params,t.params)&&function cse(e,t){return Du(e,t)&&e.every((i,n)=>va(i.parameters,t[n].parameters))}(e.url,t.url);return i&&!(!e.parent!=!t.parent)&&(!e.parent||mE(e.parent,t.parent))}let AB=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Tt,this.activateEvents=new Ii,this.deactivateEvents=new Ii,this.attachEvents=new Ii,this.detachEvents=new Ii,this.parentContexts=We(Jm),this.location=We($s),this.changeDetector=We(Fm),this.environmentInjector=We(Zs),this.inputBinder=We(X0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(i){if(i.name){const{firstChange:n,previousValue:r}=i.name;if(n)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new be(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new be(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new be(4012,!1);this.location.detach();const i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,n){this.activated=i,this._activatedRoute=n,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){const i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,n){if(this.isActivated)throw new be(4013,!1);this._activatedRoute=i;const r=this.location,o=i.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new Gse(i,a,r.injector);this.activated=r.createComponent(o,{index:r.length,injector:l,environmentInjector:n??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275dir=et({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ys]})}return e})();class Gse{constructor(t,i,n){this.route=t,this.childContexts=i,this.parent=n}get(t,i){return t===Rd?this.route:t===Jm?this.childContexts:this.parent.get(t,i)}}const X0=new Le("");let DB=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){const{activatedRoute:n}=i,r=JC([n.queryParams,n.params,n.data]).pipe(So(([s,o,a],l)=>(a={...s,...o,...a},0===l?gt(a):Promise.resolve(a)))).subscribe(s=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==n||null===n.component)return void this.unsubscribeFromRouteData(i);const o=function fie(e){const t=Wt(e);if(!t)return null;const i=new ym(t);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(n.component);if(o)for(const{templateName:a}of o.inputs)i.activatedComponentRef.setInput(a,s[a]);else this.unsubscribeFromRouteData(i)});this.outletDataSubscriptions.set(i,r)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();function eg(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){const n=i.value;n._futureSnapshot=t.value;const r=function qse(e,t,i){return t.children.map(n=>{for(const r of i.children)if(e.shouldReuseRoute(n.value,r.value.snapshot))return eg(e,n,r);return eg(e,n)})}(e,t,i);return new pl(n,r)}{if(e.shouldAttach(t.value)){const s=e.retrieve(t.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=t.value,o.children=t.children.map(a=>eg(e,a)),o}}const n=function Yse(e){return new Rd(new Gs(e.url),new Gs(e.params),new Gs(e.queryParams),new Gs(e.fragment),new Gs(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(s=>eg(e,s));return new pl(n,r)}}const gE="ngNavigationCancelingError";function TB(e,t){const{redirectTo:i,navigationBehaviorOptions:n}=Tu(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=IB(!1,0,t);return r.url=i,r.navigationBehaviorOptions=n,r}function IB(e,t,i){const n=new Error("NavigationCancelingError: "+(e||""));return n[gE]=!0,n.cancellationCode=t,i&&(n.url=i),n}function PB(e){return e&&e[gE]}let RB=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["ng-component"]],standalone:!0,features:[LN],decls:1,vars:0,template:function(n,r){1&n&&wt(0,"router-outlet")},dependencies:[AB],encapsulation:2})}return e})();function vE(e){const t=e.children&&e.children.map(vE),i=t?{...e,children:t}:{...e};return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==Tt&&(i.component=RB),i}function Lo(e){return e.outlet||Tt}function tg(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class toe{constructor(t,i,n,r,s){this.routeReuseStrategy=t,this.futureState=i,this.currState=n,this.forwardEvent=r,this.inputBindingEnabled=s}activate(t){const i=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,n,t),fE(this.futureState.root),this.activateChildRoutes(i,n,t)}deactivateChildRoutes(t,i,n){const r=Pd(i);t.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,r[o],n),delete r[o]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,n)})}deactivateRoutes(t,i,n){const r=t.value,s=i?i.value:null;if(r===s)if(r.component){const o=n.getContext(r.outlet);o&&this.deactivateChildRoutes(t,i,o.children)}else this.deactivateChildRoutes(t,i,n);else s&&this.deactivateRouteAndItsChildren(i,n)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,s=Pd(t);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);if(n&&n.outlet){const o=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:o,route:t,contexts:a})}}deactivateRouteAndOutlet(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,s=Pd(t);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,i,n){const r=Pd(i);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],n),this.forwardEvent(new zse(s.value.snapshot))}),t.children.length&&this.forwardEvent(new Bse(t.value.snapshot))}activateRoutes(t,i,n){const r=t.value,s=i?i.value:null;if(fE(r),r===s)if(r.component){const o=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,i,o.children)}else this.activateChildRoutes(t,i,n);else if(r.component){const o=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),fE(a.route.value),this.activateChildRoutes(t,null,o.children)}else{const a=tg(r.snapshot);o.attachRef=null,o.route=r,o.injector=a,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(t,null,o.children)}}else this.activateChildRoutes(t,null,n)}}class OB{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Z0{constructor(t,i){this.component=t,this.route=i}}function ioe(e,t,i){const n=e._root;return ig(n,t?t._root:null,i,[n.value])}function Od(e,t){const i=Symbol(),n=t.get(e,i);return n===i?"function"!=typeof e||function x7(e){return null!==Kv(e)}(e)?t.get(e):e:n}function ig(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Pd(t);return e.children.forEach(o=>{(function roe(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,o=t?t.value:null,a=i?i.getContext(e.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function soe(e,t,i){if("function"==typeof i)return i(e,t);switch(i){case"pathParamsChange":return!Du(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Du(e.url,t.url)||!va(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!mE(e,t)||!va(e.queryParams,t.queryParams);default:return!mE(e,t)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new OB(n)):(s.data=o.data,s._resolvedData=o._resolvedData),ig(e,t,s.component?a?a.children:null:i,n,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new Z0(a.outlet.component,o))}else o&&ng(t,a,r),r.canActivateChecks.push(new OB(n)),ig(e,null,s.component?a?a.children:null:i,n,r)})(o,s[o.value.outlet],i,n.concat([o.value]),r),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>ng(a,i.getContext(o),r)),r}function ng(e,t,i){const n=Pd(e),r=e.value;Object.entries(n).forEach(([s,o])=>{ng(o,r.component?t?t.children.getContext(s):null:t,i)}),i.canDeactivateChecks.push(new Z0(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function rg(e){return"function"==typeof e}function LB(e){return e instanceof F0||"EmptyError"===e?.name}const Q0=Symbol("INITIAL_VALUE");function Ld(){return So(e=>JC(e.map(t=>t.pipe(ga(1),$F(Q0)))).pipe(Si(t=>{for(const i of t)if(!0!==i){if(i===Q0)return Q0;if(!1===i||i instanceof Td)return i}return!0}),to(t=>t!==Q0),ga(1)))}function NB(e){return function Mq(...e){return V2(e)}(dr(t=>{if(Tu(t))throw TB(0,t)}),Si(t=>!0===t))}class K0{constructor(t){this.segmentGroup=t||null}}class kB{constructor(t){this.urlTree=t}}function Nd(e){return Hm(new K0(e))}function FB(e){return Hm(new kB(e))}class Eoe{constructor(t,i){this.urlSerializer=t,this.urlTree=i}noMatchError(t){return new be(4002,!1)}lineralizeSegments(t,i){let n=[],r=i.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return gt(n);if(r.numberOfChildren>1||!r.children[Tt])return Hm(new be(4e3,!1));r=r.children[Tt]}}applyRedirectCommands(t,i,n){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,n)}applyRedirectCreateUrlTree(t,i,n,r){const s=this.createSegmentGroup(t,i.root,n,r);return new Td(s,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){const n={};return Object.entries(t).forEach(([r,s])=>{if("string"==typeof s&&s.startsWith(":")){const a=s.substring(1);n[r]=i[a]}else n[r]=s}),n}createSegmentGroup(t,i,n,r){const s=this.createSegments(t,i.segments,n,r);let o={};return Object.entries(i.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(t,l,n,r)}),new hi(s,o)}createSegments(t,i,n,r){return i.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,n))}findPosParam(t,i,n){const r=n[i.path.substring(1)];if(!r)throw new be(4001,!1);return r}findOrReturn(t,i){let n=0;for(const r of i){if(r.path===t.path)return i.splice(n),r;n++}return t}}const yE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Moe(e,t,i,n,r){const s=_E(e,t,i);return s.matched?(n=function Zse(e,t){return e.providers&&!e._injector&&(e._injector=XS(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,n),function xoe(e,t,i,n){const r=t.canMatch;return r&&0!==r.length?gt(r.map(o=>{const a=Od(o,e);return pc(function hoe(e){return e&&rg(e.canMatch)}(a)?a.canMatch(t,i):e.runInContext(()=>a(t,i)))})).pipe(Ld(),NB()):gt(!0)}(n,t,i).pipe(Si(o=>!0===o?s:{...yE}))):gt(s)}function _E(e,t,i){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||i.length>0)?{...yE}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const r=(t.matcher||rse)(i,e,t);if(!r)return{...yE};const s={};Object.entries(r.posParams??{}).forEach(([a,l])=>{s[a]=l.path});const o=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:i.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function BB(e,t,i,n){return i.length>0&&function Toe(e,t,i){return i.some(n=>$0(e,t,n)&&Lo(n)!==Tt)}(e,i,n)?{segmentGroup:new hi(t,Doe(n,new hi(i,e.children))),slicedSegments:[]}:0===i.length&&function Ioe(e,t,i){return i.some(n=>$0(e,t,n))}(e,i,n)?{segmentGroup:new hi(e.segments,Aoe(e,0,i,n,e.children)),slicedSegments:i}:{segmentGroup:new hi(e.segments,e.children),slicedSegments:i}}function Aoe(e,t,i,n,r){const s={};for(const o of n)if($0(e,i,o)&&!r[Lo(o)]){const a=new hi([],{});s[Lo(o)]=a}return{...r,...s}}function Doe(e,t){const i={};i[Tt]=t;for(const n of e)if(""===n.path&&Lo(n)!==Tt){const r=new hi([],{});i[Lo(n)]=r}return i}function $0(e,t,i){return(!(e.hasChildren()||t.length>0)||"full"!==i.pathMatch)&&""===i.path}class Loe{constructor(t,i,n,r,s,o,a){this.injector=t,this.configLoader=i,this.rootComponentType=n,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.allowRedirects=!0,this.applyRedirects=new Eoe(this.urlSerializer,this.urlTree)}noMatchError(t){return new be(4002,!1)}recognize(){const t=BB(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Tt).pipe(Mu(i=>{if(i instanceof kB)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof K0?this.noMatchError(i):i}),Si(i=>{const n=new Y0([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Tt,this.rootComponentType,null,{}),r=new pl(n,i),s=new EB("",r),o=function Cse(e,t,i=null,n=null){return pB(dB(e),t,i,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root),{state:s,tree:o}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,Tt).pipe(Mu(n=>{throw n instanceof K0?this.noMatchError(n):n}))}inheritParamsAndData(t){const i=t.value,n=CB(i,this.paramsInheritanceStrategy);i.params=Object.freeze(n.params),i.data=Object.freeze(n.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,i,n,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,i,n):this.processSegment(t,i,n,n.segments,r,!0)}processChildren(t,i,n){const r=[];for(const s of Object.keys(n.children))"primary"===s?r.unshift(s):r.push(s);return Pn(r).pipe(Gm(s=>{const o=n.children[s],a=function Jse(e,t){const i=e.filter(n=>Lo(n)===t);return i.push(...e.filter(n=>Lo(n)!==t)),i}(i,s);return this.processSegmentGroup(t,a,o,s)}),function ese(e,t){return mn(function Jre(e,t,i,n,r){return(s,o)=>{let a=i,l=t,c=0;s.subscribe(Wi(o,h=>{const u=c++;l=a?e(l,h,u):(a=!0,h),n&&o.next(l)},r&&(()=>{a&&o.next(l),o.complete()})))}}(e,t,arguments.length>=2,!0))}((s,o)=>(s.push(...o),s)),B0(null),function tse(e,t){const i=arguments.length>=2;return n=>n.pipe(e?to((r,s)=>e(r,s,n)):Jl,iE(1),i?B0(t):JF(()=>new F0))}(),Gn(s=>{if(null===s)return Nd(n);const o=VB(s);return function Noe(e){e.sort((t,i)=>t.value.outlet===Tt?-1:i.value.outlet===Tt?1:t.value.outlet.localeCompare(i.value.outlet))}(o),gt(o)}))}processSegment(t,i,n,r,s,o){return Pn(i).pipe(Gm(a=>this.processSegmentAgainstRoute(a._injector??t,i,a,n,r,s,o).pipe(Mu(l=>{if(l instanceof K0)return gt(null);throw l}))),Eu(a=>!!a),Mu(a=>{if(LB(a))return function Roe(e,t,i){return 0===t.length&&!e.children[i]}(n,r,s)?gt([]):Nd(n);throw a}))}processSegmentAgainstRoute(t,i,n,r,s,o,a){return function Poe(e,t,i,n){return!!(Lo(e)===n||n!==Tt&&$0(t,i,e))&&("**"===e.path||_E(t,e,i).matched)}(n,r,s,o)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,r,n,s,o,a):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,r,i,n,s,o):Nd(r):Nd(r)}expandSegmentAgainstRouteUsingRedirect(t,i,n,r,s,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,n,r){const s=this.applyRedirects.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?FB(s):this.applyRedirects.lineralizeSegments(n,s).pipe(Gn(o=>{const a=new hi(o,{});return this.processSegment(t,i,a,o,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,s,o){const{matched:a,consumedSegments:l,remainingSegments:c,positionalParamSegments:h}=_E(i,r,s);if(!a)return Nd(i);const u=this.applyRedirects.applyRedirectCommands(l,r.redirectTo,h);return r.redirectTo.startsWith("/")?FB(u):this.applyRedirects.lineralizeSegments(r,u).pipe(Gn(d=>this.processSegment(t,n,i,d.concat(c),o,!1)))}matchSegmentAgainstRoute(t,i,n,r,s,o){let a;if("**"===n.path){const l=r.length>0?tB(r).parameters:{};a=gt({snapshot:new Y0(r,l,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,zB(n),Lo(n),n.component??n._loadedComponent??null,n,UB(n)),consumedSegments:[],remainingSegments:[]}),i.children={}}else a=Moe(i,n,r,t).pipe(Si(({matched:l,consumedSegments:c,remainingSegments:h,parameters:u})=>l?{snapshot:new Y0(c,u,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,zB(n),Lo(n),n.component??n._loadedComponent??null,n,UB(n)),consumedSegments:c,remainingSegments:h}:null));return a.pipe(So(l=>null===l?Nd(i):this.getChildConfig(t=n._injector??t,n,r).pipe(So(({routes:c})=>{const h=n._loadedInjector??t,{snapshot:u,consumedSegments:d,remainingSegments:p}=l,{segmentGroup:f,slicedSegments:m}=BB(i,d,p,c);if(0===m.length&&f.hasChildren())return this.processChildren(h,c,f).pipe(Si(v=>null===v?null:[new pl(u,v)]));if(0===c.length&&0===m.length)return gt([new pl(u,[])]);const g=Lo(n)===s;return this.processSegment(h,c,f,m,g?Tt:s,!0).pipe(Si(v=>[new pl(u,v)]))}))))}getChildConfig(t,i,n){return i.children?gt({routes:i.children,injector:t}):i.loadChildren?void 0!==i._loadedRoutes?gt({routes:i._loadedRoutes,injector:i._loadedInjector}):function woe(e,t,i,n){const r=t.canLoad;return void 0===r||0===r.length?gt(!0):gt(r.map(o=>{const a=Od(o,e);return pc(function aoe(e){return e&&rg(e.canLoad)}(a)?a.canLoad(t,i):e.runInContext(()=>a(t,i)))})).pipe(Ld(),NB())}(t,i,n).pipe(Gn(r=>r?this.configLoader.loadChildren(t,i).pipe(dr(s=>{i._loadedRoutes=s.routes,i._loadedInjector=s.injector})):function Coe(e){return Hm(IB(!1,3))}())):gt({routes:[],injector:t})}}function koe(e){const t=e.value.routeConfig;return t&&""===t.path}function VB(e){const t=[],i=new Set;for(const n of e){if(!koe(n)){t.push(n);continue}const r=t.find(s=>n.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...n.children),i.add(r)):t.push(n)}for(const n of i){const r=VB(n.children);t.push(new pl(n.value,r))}return t.filter(n=>!i.has(n))}function zB(e){return e.data||{}}function UB(e){return e.resolve||{}}function jB(e){return"string"==typeof e.title||null===e.title}function bE(e){return So(t=>{const i=e(t);return i?Pn(i).pipe(Si(()=>t)):gt(t)})}const kd=new Le("ROUTES");let wE=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=We(Ck)}loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return gt(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const n=pc(i.loadComponent()).pipe(Si(HB),dr(s=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=s}),nE(()=>{this.componentLoaders.delete(i)})),r=new KF(n,()=>new yi).pipe(tE());return this.componentLoaders.set(i,r),r}loadChildren(i,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return gt({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);const s=function Hoe(e,t,i,n){return pc(e.loadChildren()).pipe(Si(HB),Gn(r=>r instanceof RN||Array.isArray(r)?gt(r):Pn(t.compileModuleAsync(r))),Si(r=>{n&&n(e);let s,o,a=!1;return Array.isArray(r)?(o=r,!0):(s=r.create(i).injector,o=s.get(kd,[],{optional:!0,self:!0}).flat()),{routes:o.map(vE),injector:s}}))}(n,this.compiler,i,this.onLoadEndListener).pipe(nE(()=>{this.childrenLoaders.delete(n)})),o=new KF(s,()=>new yi).pipe(tE());return this.childrenLoaders.set(n,o),o}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function HB(e){return function Goe(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let J0=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new yi,this.transitionAbortSubject=new yi,this.configLoader=We(wE),this.environmentInjector=We(Zs),this.urlSerializer=We(Ym),this.rootContexts=We(Jm),this.inputBindingEnabled=null!==We(X0,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>gt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new kse(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new Nse(r))}complete(){this.transitions?.complete()}handleNavigationRequest(i){const n=++this.navigationId;this.transitions?.next({...this.transitions.value,...i,id:n})}setupNavigations(i,n,r){return this.transitions=new Gs({id:0,currentUrlTree:n,currentRawUrl:n,currentBrowserUrl:n,extractedUrl:i.urlHandlingStrategy.extract(n),urlAfterRedirects:i.urlHandlingStrategy.extract(n),rawUrl:n,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Km,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(to(s=>0!==s.id),Si(s=>({...s,extractedUrl:i.urlHandlingStrategy.extract(s.rawUrl)})),So(s=>{this.currentTransition=s;let o=!1,a=!1;return gt(s).pipe(dr(l=>{this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),So(l=>{const c=l.currentBrowserUrl.toString(),h=!i.navigated||l.extractedUrl.toString()!==c||c!==l.currentUrlTree.toString();if(!h&&"reload"!==(l.extras.onSameUrlNavigation??i.onSameUrlNavigation)){const d="";return this.events.next(new Id(l.id,this.urlSerializer.serialize(l.rawUrl),d,0)),l.resolve(null),xo}if(i.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return gt(l).pipe(So(d=>{const p=this.transitions?.getValue();return this.events.next(new W0(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),p!==this.transitions?.getValue()?xo:Promise.resolve(d)}),function Foe(e,t,i,n,r,s){return Gn(o=>function Ooe(e,t,i,n,r,s,o="emptyOnly"){return new Loe(e,t,i,n,r,o,s).recognize()}(e,t,i,n,o.extractedUrl,r,s).pipe(Si(({state:a,tree:l})=>({...o,targetSnapshot:a,urlAfterRedirects:l}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,i.paramsInheritanceStrategy),dr(d=>{s.targetSnapshot=d.targetSnapshot,s.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:d.urlAfterRedirects};const p=new _B(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}));if(h&&i.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){const{id:d,extractedUrl:p,source:f,restoredState:m,extras:g}=l,v=new W0(d,this.urlSerializer.serialize(p),f,m);this.events.next(v);const y=SB(0,this.rootComponentType).snapshot;return this.currentTransition=s={...l,targetSnapshot:y,urlAfterRedirects:p,extras:{...g,skipLocationChange:!1,replaceUrl:!1}},gt(s)}{const d="";return this.events.next(new Id(l.id,this.urlSerializer.serialize(l.extractedUrl),d,1)),l.resolve(null),xo}}),dr(l=>{const c=new Pse(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),Si(l=>(this.currentTransition=s={...l,guards:ioe(l.targetSnapshot,l.currentSnapshot,this.rootContexts)},s)),function poe(e,t){return Gn(i=>{const{targetSnapshot:n,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=i;return 0===o.length&&0===s.length?gt({...i,guardsResult:!0}):function foe(e,t,i,n){return Pn(e).pipe(Gn(r=>function boe(e,t,i,n,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?gt(s.map(a=>{const l=tg(t)??r,c=Od(a,l);return pc(function uoe(e){return e&&rg(e.canDeactivate)}(c)?c.canDeactivate(e,t,i,n):l.runInContext(()=>c(e,t,i,n))).pipe(Eu())})).pipe(Ld()):gt(!0)}(r.component,r.route,i,t,n)),Eu(r=>!0!==r,!0))}(o,n,r,e).pipe(Gn(a=>a&&function ooe(e){return"boolean"==typeof e}(a)?function moe(e,t,i,n){return Pn(t).pipe(Gm(r=>eE(function voe(e,t){return null!==e&&t&&t(new Fse(e)),gt(!0)}(r.route.parent,n),function goe(e,t){return null!==e&&t&&t(new Vse(e)),gt(!0)}(r.route,n),function _oe(e,t,i){const n=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(o=>function noe(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(o)).filter(o=>null!==o).map(o=>QF(()=>gt(o.guards.map(l=>{const c=tg(o.node)??i,h=Od(l,c);return pc(function coe(e){return e&&rg(e.canActivateChild)}(h)?h.canActivateChild(n,e):c.runInContext(()=>h(n,e))).pipe(Eu())})).pipe(Ld())));return gt(s).pipe(Ld())}(e,r.path,i),function yoe(e,t,i){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return gt(!0);const r=n.map(s=>QF(()=>{const o=tg(t)??i,a=Od(s,o);return pc(function loe(e){return e&&rg(e.canActivate)}(a)?a.canActivate(t,e):o.runInContext(()=>a(t,e))).pipe(Eu())}));return gt(r).pipe(Ld())}(e,r.route,i))),Eu(r=>!0!==r,!0))}(n,s,e,t):gt(a)),Si(a=>({...i,guardsResult:a})))})}(this.environmentInjector,l=>this.events.next(l)),dr(l=>{if(s.guardsResult=l.guardsResult,Tu(l.guardsResult))throw TB(0,l.guardsResult);const c=new Rse(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),to(l=>!!l.guardsResult||(this.cancelNavigationTransition(l,"",3),!1)),bE(l=>{if(l.guards.canActivateChecks.length)return gt(l).pipe(dr(c=>{const h=new Ose(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(h)}),So(c=>{let h=!1;return gt(c).pipe(function Boe(e,t){return Gn(i=>{const{targetSnapshot:n,guards:{canActivateChecks:r}}=i;if(!r.length)return gt(i);let s=0;return Pn(r).pipe(Gm(o=>function Voe(e,t,i,n){const r=e.routeConfig,s=e._resolve;return void 0!==r?.title&&!jB(r)&&(s[Wm]=r.title),function zoe(e,t,i,n){const r=function Uoe(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===r.length)return gt({});const s={};return Pn(r).pipe(Gn(o=>function joe(e,t,i,n){const r=tg(t)??n,s=Od(e,r);return pc(s.resolve?s.resolve(t,i):r.runInContext(()=>s(t,i)))}(e[o],t,i,n).pipe(Eu(),dr(a=>{s[o]=a}))),iE(1),function ise(e){return Si(()=>e)}(s),Mu(o=>LB(o)?xo:Hm(o)))}(s,e,t,n).pipe(Si(o=>(e._resolvedData=o,e.data=CB(e,i).resolve,r&&jB(r)&&(e.data[Wm]=r.title),null)))}(o.route,n,e,t)),dr(()=>s++),iE(1),Gn(o=>s===r.length?gt(i):xo))})}(i.paramsInheritanceStrategy,this.environmentInjector),dr({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(c,"",2)}}))}),dr(c=>{const h=new Lse(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(h)}))}),bE(l=>{const c=h=>{const u=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&u.push(this.configLoader.loadComponent(h.routeConfig).pipe(dr(d=>{h.component=d}),Si(()=>{})));for(const d of h.children)u.push(...c(d));return u};return JC(c(l.targetSnapshot.root)).pipe(B0(),ga(1))}),bE(()=>this.afterPreactivation()),Si(l=>{const c=function Wse(e,t,i){const n=eg(e,t._root,i?i._root:void 0);return new xB(n,t)}(i.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=s={...l,targetRouterState:c},s}),dr(()=>{this.events.next(new cE)}),((e,t,i,n)=>Si(r=>(new toe(t,r.targetRouterState,r.currentRouterState,i,n).activate(e),r)))(this.rootContexts,i.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),ga(1),dr({next:l=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new fc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),i.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{o=!0}}),Au(this.transitionAbortSubject.pipe(dr(l=>{throw l}))),nE(()=>{o||a||this.cancelNavigationTransition(s,"",1),this.currentNavigation?.id===s.id&&(this.currentNavigation=null)}),Mu(l=>{if(a=!0,PB(l))this.events.next(new $m(s.id,this.urlSerializer.serialize(s.extractedUrl),l.message,l.cancellationCode)),function Xse(e){return PB(e)&&Tu(e.url)}(l)?this.events.next(new uE(l.url)):s.resolve(!1);else{this.events.next(new q0(s.id,this.urlSerializer.serialize(s.extractedUrl),l,s.targetSnapshot??void 0));try{s.resolve(i.errorHandler(l))}catch(c){s.reject(c)}}return xo}))}))}cancelNavigationTransition(i,n,r){const s=new $m(i.id,this.urlSerializer.serialize(i.extractedUrl),n,r);this.events.next(s),i.resolve(!1)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function GB(e){return e!==Km}let WB=(()=>{class e{buildTitle(i){let n,r=i.root;for(;void 0!==r;)n=this.getResolvedTitleForRoute(r)??n,r=r.children.find(s=>s.outlet===Tt);return n}getResolvedTitleForRoute(i){return i.data[Wm]}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:function(){return We(Woe)},providedIn:"root"})}return e})(),Woe=(()=>{class e extends WB{constructor(i){super(),this.title=i}updateTitle(i){const n=this.buildTitle(i);void 0!==n&&this.title.setTitle(n)}static#e=this.\u0275fac=function(n){return new(n||e)(we(HF))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),qoe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:function(){return We(Xoe)},providedIn:"root"})}return e})();class Yoe{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}}let Xoe=(()=>{class e extends Yoe{static#e=this.\u0275fac=function(){let i;return function(r){return(i||(i=function nr(e){return el(()=>{const t=e.prototype.constructor,i=t[tl]||v1(t),n=Object.prototype;let r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==n;){const s=r[tl]||v1(r);if(s&&s!==i)return s;r=Object.getPrototypeOf(r)}return s=>new s})}(e)))(r||e)}}();static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const e_=new Le("",{providedIn:"root",factory:()=>({})});let Zoe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:function(){return We(Qoe)},providedIn:"root"})}return e})(),Qoe=(()=>{class e{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,n){return i}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var sg=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(sg||{});function qB(e,t){e.events.pipe(to(i=>i instanceof fc||i instanceof $m||i instanceof q0||i instanceof Id),Si(i=>i instanceof fc||i instanceof Id?sg.COMPLETE:i instanceof $m&&(0===i.code||1===i.code)?sg.REDIRECTING:sg.FAILED),to(i=>i!==sg.REDIRECTING),ga(1)).subscribe(()=>{t()})}function Koe(e){throw e}function $oe(e,t,i){return t.parse("/")}const Joe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},eae={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let io=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=We(xk),this.isNgZoneEnabled=!1,this._events=new yi,this.options=We(e_,{optional:!0})||{},this.pendingTasks=We(Sk),this.errorHandler=this.options.errorHandler||Koe,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||$oe,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=We(Zoe),this.routeReuseStrategy=We(qoe),this.titleStrategy=We(WB),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=We(kd,{optional:!0})?.flat()??[],this.navigationTransitions=We(J0),this.urlSerializer=We(Ym),this.location=We(S0),this.componentInputBindingEnabled=!!We(X0,{optional:!0}),this.eventsSubscription=new en,this.isNgZoneEnabled=We(Vt)instanceof Vt&&Vt.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Td,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=SB(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(i=>{this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId},i=>{this.console.warn(`Unhandled Navigation Error: ${i}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const i=this.navigationTransitions.events.subscribe(n=>{try{const{currentTransition:r}=this.navigationTransitions;if(null===r)return void(YB(n)&&this._events.next(n));if(n instanceof W0)GB(r.source)&&(this.browserUrlTree=r.extractedUrl);else if(n instanceof Id)this.rawUrlTree=r.rawUrl;else if(n instanceof _B){if("eager"===this.urlUpdateStrategy){if(!r.extras.skipLocationChange){const s=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl);this.setBrowserUrl(s,r)}this.browserUrlTree=r.urlAfterRedirects}}else if(n instanceof cE)this.currentUrlTree=r.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r),this.browserUrlTree=r.urlAfterRedirects);else if(n instanceof $m)0!==n.code&&1!==n.code&&(this.navigated=!0),(3===n.code||2===n.code)&&this.restoreHistory(r);else if(n instanceof uE){const s=this.urlHandlingStrategy.merge(n.url,r.currentRawUrl),o={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||GB(r.source)};this.scheduleNavigation(s,Km,null,o,{resolve:r.resolve,reject:r.reject,promise:r.promise})}n instanceof q0&&this.restoreHistory(r,!0),n instanceof fc&&(this.navigated=!0),YB(n)&&this._events.next(n)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const i=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Km,i)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(i=>{const n="popstate"===i.type?"popstate":"hashchange";"popstate"===n&&setTimeout(()=>{this.navigateToSyncWithBrowser(i.url,n,i.state)},0)}))}navigateToSyncWithBrowser(i,n,r){const s={replaceUrl:!0},o=r?.navigationId?r:null;if(r){const l={...r};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(s.state=l)}const a=this.parseUrl(i);this.scheduleNavigation(a,n,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(vE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,n={}){const{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=n,c=l?this.currentUrlTree.fragment:o;let u,h=null;switch(a){case"merge":h={...this.currentUrlTree.queryParams,...s};break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=s||null}null!==h&&(h=this.removeEmptyProps(h));try{u=dB(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof i[0]||!i[0].startsWith("/"))&&(i=[]),u=this.currentUrlTree.root}return pB(u,i,h,c??null)}navigateByUrl(i,n={skipLocationChange:!1}){const r=Tu(i)?i:this.parseUrl(i),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,Km,null,n)}navigate(i,n={skipLocationChange:!1}){return function tae(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new be(4008,!1)}(i),this.navigateByUrl(this.createUrlTree(i,n),n)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){let n;try{n=this.urlSerializer.parse(i)}catch(r){n=this.malformedUriErrorHandler(r,this.urlSerializer,i)}return n}isActive(i,n){let r;if(r=!0===n?{...Joe}:!1===n?{...eae}:n,Tu(i))return nB(this.currentUrlTree,i,r);const s=this.parseUrl(i);return nB(this.currentUrlTree,s,r)}removeEmptyProps(i){return Object.keys(i).reduce((n,r)=>{const s=i[r];return null!=s&&(n[r]=s),n},{})}scheduleNavigation(i,n,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,c;o?(a=o.resolve,l=o.reject,c=o.promise):c=new Promise((u,d)=>{a=u,l=d});const h=this.pendingTasks.add();return qB(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:i,extras:s,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(u=>Promise.reject(u))}setBrowserUrl(i,n){const r=this.urlSerializer.serialize(i);if(this.location.isCurrentPathEqualTo(r)||n.extras.replaceUrl){const o={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId)};this.location.replaceState(r,"",o)}else{const s={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId+1)};this.location.go(r,"",s)}}restoreHistory(i,n=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-this.browserPageId;0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(i),this.browserUrlTree=i.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(n&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=i.currentRouterState,this.currentUrlTree=i.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,n){return"computed"===this.canceledNavigationResolution?{navigationId:i,\u0275routerPageId:n}:{navigationId:i}}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function YB(e){return!(e instanceof cE||e instanceof uE)}class XB{}let rae=(()=>{class e{constructor(i,n,r,s,o){this.router=i,this.injector=r,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(to(i=>i instanceof fc),Gm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,n){const r=[];for(const s of n){s.providers&&!s._injector&&(s._injector=XS(s.providers,i,`Route: ${s.path}`));const o=s._injector??i,a=s._loadedInjector??o;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&r.push(this.preloadConfig(o,s)),(s.children||s._loadedRoutes)&&r.push(this.processRoutes(a,s.children??s._loadedRoutes))}return Pn(r).pipe(Ih())}preloadConfig(i,n){return this.preloadingStrategy.preload(n,()=>{let r;r=n.loadChildren&&void 0===n.canLoad?this.loader.loadChildren(i,n):gt(null);const s=r.pipe(Gn(o=>null===o?gt(void 0):(n._loadedRoutes=o.routes,n._loadedInjector=o.injector,this.processRoutes(o.injector??i,o.routes))));return n.loadComponent&&!n._loadedComponent?Pn([s,this.loader.loadComponent(n)]).pipe(Ih()):s})}static#e=this.\u0275fac=function(n){return new(n||e)(we(io),we(Ck),we(Zs),we(XB),we(wE))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const SE=new Le("");let ZB=(()=>{class e{constructor(i,n,r,s,o={}){this.urlSerializer=i,this.transitions=n,this.viewportScroller=r,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof W0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof fc?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof Id&&0===i.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof bB&&(i.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(i.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,n){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new bB(i,"popstate"===this.lastSource?this.store[this.restoredId]:null,n))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(n){!function g3(){throw new Error("invalid")}()};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac})}return e})();function fl(e,t){return{\u0275kind:e,\u0275providers:t}}function KB(){const e=We(rr);return t=>{const i=e.get(xu);if(t!==i.components[0])return;const n=e.get(io),r=e.get($B);1===e.get(CE)&&n.initialNavigation(),e.get(JB,null,Ft.Optional)?.setUpPreloading(),e.get(SE,null,Ft.Optional)?.init(),n.resetRootComponentType(i.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const $B=new Le("",{factory:()=>new yi}),CE=new Le("",{providedIn:"root",factory:()=>1}),JB=new Le("");function lae(e){return fl(0,[{provide:JB,useExisting:rae},{provide:XB,useExisting:e}])}const eV=new Le("ROUTER_FORROOT_GUARD"),uae=[S0,{provide:Ym,useClass:rE},io,Jm,{provide:Rd,useFactory:function QB(e){return e.routerState.root},deps:[io]},wE,[]];function hae(){return new Pk("Router",io)}let tV=(()=>{class e{constructor(i){}static forRoot(i,n){return{ngModule:e,providers:[uae,[],{provide:kd,multi:!0,useValue:i},{provide:eV,useFactory:mae,deps:[[io,new wy,new xy]]},{provide:e_,useValue:n||{}},n?.useHash?{provide:Cu,useClass:_ie}:{provide:Cu,useClass:aF},{provide:SE,useFactory:()=>{const e=We(Une),t=We(Vt),i=We(e_),n=We(J0),r=We(Ym);return i.scrollOffset&&e.setOffset(i.scrollOffset),new ZB(r,n,e,t,i)}},n?.preloadingStrategy?lae(n.preloadingStrategy).\u0275providers:[],{provide:Pk,multi:!0,useFactory:hae},n?.initialNavigation?gae(n):[],n?.bindToComponentInputs?fl(8,[DB,{provide:X0,useExisting:DB}]).\u0275providers:[],[{provide:iV,useFactory:KB},{provide:vC,multi:!0,useExisting:iV}]]}}static forChild(i){return{ngModule:e,providers:[{provide:kd,multi:!0,useValue:i}]}}static#e=this.\u0275fac=function(n){return new(n||e)(we(eV,8))};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({})}return e})();function mae(e){return"guarded"}function gae(e){return["disabled"===e.initialNavigation?fl(3,[{provide:cC,multi:!0,useFactory:()=>{const t=We(io);return()=>{t.setUpLocationChangeListener()}}},{provide:CE,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?fl(2,[{provide:CE,useValue:0},{provide:cC,multi:!0,deps:[rr],useFactory:t=>{const i=t.get(vie,Promise.resolve());return()=>i.then(()=>new Promise(n=>{const r=t.get(io),s=t.get($B);qB(r,()=>{n(!0)}),t.get(J0).afterPreactivation=()=>(n(!0),s.closed?gt(void 0):s),r.initialNavigation()}))}}]).\u0275providers:[]]}const iV=new Le("");let nV=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-about"]],decls:7,vars:0,consts:[[1,"text-center","bg-gradient-primary-to-secondary"],[1,"container","mt-1","mb-1"],[1,"row","justify-content-center"],[1,"col-xl-8"],[1,"h2","fs-1","text-white"],["src","../../../assets/img/logo.svg",2,"height","10rem"]],template:function(n,r){1&n&&(Me(0,"aside",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),ht(5,"An intuitive solution to a common problem WE ALL FACE \u2014 finding the RIGHT RESTAURANT."),Pe(),wt(6,"img",5),Pe()()()())},styles:[".masthead[_ngcontent-%COMP%]{background-color:transparent!important}.gradient-start-color[_ngcontent-%COMP%], .gradient-end-color[_ngcontent-%COMP%]{color:#fff!important;background-color:#fff!important}"]})}return e})(),yae=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-survey"]],decls:2,vars:0,template:function(n,r){1&n&&(Me(0,"p"),ht(1,"survey works!"),Pe())}})}return e})();const _ae=["addListener","removeListener"],bae=["addEventListener","removeEventListener"],wae=["on","off"];function og(e,t,i,n){if(kt(i)&&(n=i,i=void 0),n)return og(e,t,i).pipe($C(n));const[r,s]=function Cae(e){return kt(e.addEventListener)&&kt(e.removeEventListener)}(e)?bae.map(o=>a=>e[o](t,a,i)):function xae(e){return kt(e.addListener)&&kt(e.removeListener)}(e)?_ae.map(rV(e,t)):function Sae(e){return kt(e.on)&&kt(e.off)}(e)?wae.map(rV(e,t)):[];if(!r&&Ax(e))return Gn(o=>og(o,t,i))(Mr(e));if(!r)throw new TypeError("Invalid event target");return new Bi(o=>{const a=(...l)=>o.next(1<l.length?l:l[0]);return r(a),()=>s(a)})}function rV(e,t){return i=>n=>e[i](t,n)}class EE{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class ME extends EE{constructor(t,i,n,r,s){super(),this.component=t,this.viewContainerRef=i,this.injector=n,this.componentFactoryResolver=r,this.projectableNodes=s}}class sV extends EE{constructor(t,i,n,r){super(),this.templateRef=t,this.viewContainerRef=i,this.context=n,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,i=this.context){return this.context=i,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class Eae extends EE{constructor(t){super(),this.element=t instanceof gn?t.nativeElement:t}}class oV{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof ME?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof sV?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof Eae?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Mae extends oV{constructor(t,i,n,r,s){super(),this.outletElement=t,this._componentFactoryResolver=i,this._appRef=n,this._defaultInjector=r,this.attachDomPortal=o=>{const a=o.element,l=this._document.createComment("dom-portal");a.parentNode.insertBefore(l,a),this.outletElement.appendChild(a),this._attachedPortal=o,super.setDisposeFn(()=>{l.parentNode&&l.parentNode.replaceChild(a,l)})},this._document=s}attachComponentPortal(t){const n=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(n,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=n.create(t.injector||this._defaultInjector||rr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let i=t.viewContainerRef,n=i.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return n.rootNodes.forEach(r=>this.outletElement.appendChild(r)),n.detectChanges(),this.setDisposeFn(()=>{let r=i.indexOf(n);-1!==r&&i.remove(r)}),this._attachedPortal=t,n}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let DE,aV=(()=>{class e extends oV{constructor(i,n,r){super(),this._componentFactoryResolver=i,this._viewContainerRef=n,this._isInitialized=!1,this.attached=new Ii,this.attachDomPortal=s=>{const o=s.element,a=this._document.createComment("dom-portal");s.setAttachedHost(this),o.parentNode.insertBefore(a,o),this._getRootNode().appendChild(o),this._attachedPortal=s,super.setDisposeFn(()=>{a.parentNode&&a.parentNode.replaceChild(o,a)})},this._document=r}get portal(){return this._attachedPortal}set portal(i){this.hasAttached()&&!i&&!this._isInitialized||(this.hasAttached()&&super.detach(),i&&super.attach(i),this._attachedPortal=i||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(i){i.setAttachedHost(this);const n=null!=i.viewContainerRef?i.viewContainerRef:this._viewContainerRef,s=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component),o=n.createComponent(s,n.length,i.injector||n.injector,i.projectableNodes||void 0);return n!==this._viewContainerRef&&this._getRootNode().appendChild(o.hostView.rootNodes[0]),super.setDisposeFn(()=>o.destroy()),this._attachedPortal=i,this._attachedRef=o,this.attached.emit(o),o}attachTemplatePortal(i){i.setAttachedHost(this);const n=this._viewContainerRef.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=i,this._attachedRef=n,this.attached.emit(n),n}_getRootNode(){const i=this._viewContainerRef.element.nativeElement;return i.nodeType===i.ELEMENT_NODE?i:i.parentNode}static#e=this.\u0275fac=function(n){return new(n||e)(pe(vu),pe($s),pe(Ri))};static#t=this.\u0275dir=et({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[ai]})}return e})(),AE=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({})}return e})();try{DE=typeof Intl<"u"&&Intl.v8BreakIterator}catch{DE=!1}let ag,Pu,Iu=(()=>{class e{constructor(i){this._platformId=i,this.isBrowser=this._platformId?function zne(e){return e===CF}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!DE)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#e=this.\u0275fac=function(n){return new(n||e)(we(gu))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function TE(e){return function Aae(){if(null==ag&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>ag=!0}))}finally{ag=ag||!1}return ag}()?e:!!e.capture}function Dae(){if(null==Pu){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Pu=!1,Pu;if("scrollBehavior"in document.documentElement.style)Pu=!0;else{const e=Element.prototype.scrollTo;Pu=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return Pu}function cV(e){return e.composedPath?e.composedPath()[0]:e.target}function uV(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}let Fae=(()=>{class e{constructor(i){this._platform=i}isDisabled(i){return i.hasAttribute("disabled")}isVisible(i){return function Vae(e){return!!(e.offsetWidth||e.offsetHeight||"function"==typeof e.getClientRects&&e.getClientRects().length)}(i)&&"visible"===getComputedStyle(i).visibility}isTabbable(i){if(!this._platform.isBrowser)return!1;const n=function Bae(e){try{return e.frameElement}catch{return null}}(function Yae(e){return e.ownerDocument&&e.ownerDocument.defaultView||window}(i));if(n&&(-1===fV(n)||!this.isVisible(n)))return!1;let r=i.nodeName.toLowerCase(),s=fV(i);return i.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function Wae(e){let t=e.nodeName.toLowerCase(),i="input"===t&&e.type;return"text"===i||"password"===i||"select"===t||"textarea"===t}(i))&&("audio"===r?!!i.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||i.hasAttribute("controls")):i.tabIndex>=0)}isFocusable(i,n){return function qae(e){return!function Uae(e){return function Hae(e){return"input"==e.nodeName.toLowerCase()}(e)&&"hidden"==e.type}(e)&&(function zae(e){let t=e.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(e)||function jae(e){return function Gae(e){return"a"==e.nodeName.toLowerCase()}(e)&&e.hasAttribute("href")}(e)||e.hasAttribute("contenteditable")||pV(e))}(i)&&!this.isDisabled(i)&&(n?.ignoreVisibility||this.isVisible(i))}static#e=this.\u0275fac=function(n){return new(n||e)(we(Iu))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function pV(e){if(!e.hasAttribute("tabindex")||void 0===e.tabIndex)return!1;let t=e.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function fV(e){if(!pV(e))return null;const t=parseInt(e.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class Xae{get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}constructor(t,i,n,r,s=!1){this._element=t,this._checker=i,this._ngZone=n,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}destroy(){const t=this._startAnchor,i=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),i&&(i.removeEventListener("focus",this.endAnchorListener),i.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(i=>{this._executeOnStable(()=>i(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(i=>{this._executeOnStable(()=>i(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(i=>{this._executeOnStable(()=>i(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const i=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?i.length?i[0]:this._getFirstTabbableElement(this._element):i.length?i[i.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const i=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(i){if(!this._checker.isFocusable(i)){const n=this._getFirstTabbableElement(i);return n?.focus(t),!!n}return i.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const i=this._getRegionBoundary("start");return i&&i.focus(t),!!i}focusLastTabbableElement(t){const i=this._getRegionBoundary("end");return i&&i.focus(t),!!i}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const i=t.children;for(let n=0;n<i.length;n++){const r=i[n].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(i[n]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const i=t.children;for(let n=i.length-1;n>=0;n--){const r=i[n].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(i[n]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,i){t?i.setAttribute("tabindex","0"):i.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(ga(1)).subscribe(t)}}class Zae extends Xae{get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}constructor(t,i,n,r,s,o,a){super(t,i,n,r,a.defer),this._focusTrapManager=s,this._inertStrategy=o,this._focusTrapManager.register(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const Qae=new Le("FOCUS_TRAP_INERT_STRATEGY");class Kae{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=i=>this._trapFocus(t,i),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){this._listener&&(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,i){const n=i.target,r=t._element;n&&!r.contains(n)&&!n.closest?.("div.cdk-overlay-pane")&&setTimeout(()=>{t.enabled&&!r.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let $ae=(()=>{class e{constructor(){this._focusTrapStack=[]}register(i){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==i);let n=this._focusTrapStack;n.length&&n[n.length-1]._disable(),n.push(i),i._enable()}deregister(i){i._disable();const n=this._focusTrapStack,r=n.indexOf(i);-1!==r&&(n.splice(r,1),n.length&&n[n.length-1]._enable())}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Jae=(()=>{class e{constructor(i,n,r,s,o){this._checker=i,this._ngZone=n,this._focusTrapManager=r,this._document=s,this._inertStrategy=o||new Kae}create(i,n={defer:!1}){let r;return r="boolean"==typeof n?{defer:n}:n,new Zae(i,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}static#e=this.\u0275fac=function(n){return new(n||e)(we(Fae),we(Vt),we($ae),we(Ri),we(Qae,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Ru(e){return null!=e&&"false"!=`${e}`}function mV(e){return Array.isArray(e)?e:[e]}function _n(e){return null==e?"":"string"==typeof e?e:`${e}px`}function i_(e){return e instanceof gn?e.nativeElement:e}class ile extends en{constructor(t,i){super()}schedule(t,i=0){return this}}const n_={setInterval(e,t,...i){const{delegate:n}=n_;return n?.setInterval?n.setInterval(e,t,...i):setInterval(e,t,...i)},clearInterval(e){const{delegate:t}=n_;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class PE extends ile{constructor(t,i){super(t,i),this.scheduler=t,this.work=i,this.pending=!1}schedule(t,i=0){var n;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,i)),this.pending=!0,this.delay=i,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(s,this.id,i),this}requestAsyncId(t,i,n=0){return n_.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,i,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return i;null!=i&&n_.clearInterval(i)}execute(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,i);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,i){let r,n=!1;try{this.work(t)}catch(s){n=!0,r=s||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:i}=this,{actions:n}=i;this.work=this.state=this.scheduler=null,this.pending=!1,$l(n,this),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,super.unsubscribe()}}}const lg={schedule(e){let t=requestAnimationFrame,i=cancelAnimationFrame;const{delegate:n}=lg;n&&(t=n.requestAnimationFrame,i=n.cancelAnimationFrame);const r=t(s=>{i=void 0,e(s)});return new en(()=>i?.(r))},requestAnimationFrame(...e){const{delegate:t}=lg;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:t}=lg;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0},gV={now:()=>(gV.delegate||Date).now(),delegate:void 0};class cg{constructor(t,i=cg.now){this.schedulerActionCtor=t,this.now=i}schedule(t,i=0,n){return new this.schedulerActionCtor(this,t).schedule(n,i)}}cg.now=gV.now;class RE extends cg{constructor(t,i=cg.now){super(t,i),this.actions=[],this._active=!1}flush(t){const{actions:i}=this;if(this._active)return void i.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=i.shift());if(this._active=!1,n){for(;t=i.shift();)t.unsubscribe();throw n}}}new class rle extends RE{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let r;t=t||n.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,r){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw r}}}(class nle extends PE{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=lg.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,i,n=0){var r;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:s}=t;null!=i&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==i&&(lg.cancelAnimationFrame(i),t._scheduled=void 0)}});let OE,ole=1;const r_={};function vV(e){return e in r_&&(delete r_[e],!0)}const ale={setImmediate(e){const t=ole++;return r_[t]=!0,OE||(OE=Promise.resolve()),OE.then(()=>vV(t)&&e()),t},clearImmediate(e){vV(e)}},{setImmediate:lle,clearImmediate:cle}=ale,s_={setImmediate(...e){const{delegate:t}=s_;return(t?.setImmediate||lle)(...e)},clearImmediate(e){const{delegate:t}=s_;return(t?.clearImmediate||cle)(e)},delegate:void 0},yV=(new class hle extends RE{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let r;t=t||n.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,r){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw r}}}(class ule extends PE{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=s_.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,i,n=0){var r;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:s}=t;null!=i&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==i&&(s_.clearImmediate(i),t._scheduled===i&&(t._scheduled=void 0))}}),new RE(PE)),ple=yV;function _V(e,t=yV){return function fle(e){return mn((t,i)=>{let n=!1,r=null,s=null,o=!1;const a=()=>{if(s?.unsubscribe(),s=null,n){n=!1;const c=r;r=null,i.next(c)}o&&i.complete()},l=()=>{s=null,o&&i.complete()};t.subscribe(Wi(i,c=>{n=!0,r=c,s||Mr(e(c)).subscribe(s=Wi(i,a,l))},()=>{o=!0,(!n||!s||s.closed)&&i.complete()}))})}(()=>function gle(e=0,t,i=ple){let n=-1;return null!=t&&(iP(t)?i=t:n=t),new Bi(r=>{let s=function mle(e){return e instanceof Date&&!isNaN(e)}(e)?+e-i.now():e;s<0&&(s=0);let o=0;return i.schedule(function(){r.closed||(r.next(o++),0<=n?this.schedule(void 0,n):r.complete())},s)})}(e,t))}const vle=new Le("cdk-dir-doc",{providedIn:"root",factory:function yle(){return We(Ri)}}),_le=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let wle=(()=>{class e{constructor(i){this.value="ltr",this.change=new Ii,i&&(this.value=function ble(e){const t=e?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?_le.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((i.body?i.body.dir:null)||(i.documentElement?i.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#e=this.\u0275fac=function(n){return new(n||e)(we(vle,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),LE=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({})}return e})(),Sle=(()=>{class e{constructor(i,n,r){this._ngZone=i,this._platform=n,this._scrolled=new yi,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){const n=this.scrollContainers.get(i);n&&(n.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=20){return this._platform.isBrowser?new Bi(n=>{this._globalSubscription||this._addGlobalListener();const r=i>0?this._scrolled.pipe(_V(i)).subscribe(n):this._scrolled.subscribe(n);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):gt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,n)=>this.deregister(n)),this._scrolled.complete()}ancestorScrolled(i,n){const r=this.getAncestorScrollContainers(i);return this.scrolled(n).pipe(to(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(i){const n=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,i)&&n.push(s)}),n}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,n){let r=i_(n),s=i.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>og(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#e=this.\u0275fac=function(n){return new(n||e)(we(Vt),we(Iu),we(Ri,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),bV=(()=>{class e{constructor(i,n,r){this._platform=i,this._change=new yi,this._changeListener=s=>{this._change.next(s)},this._document=r,n.runOutsideAngular(()=>{if(i.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){const i=this.getViewportScrollPosition(),{width:n,height:r}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+r,right:i.left+n,height:r,width:n}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const i=this._document,n=this._getWindow(),r=i.documentElement,s=r.getBoundingClientRect();return{top:-s.top||i.body.scrollTop||n.scrollY||r.scrollTop||0,left:-s.left||i.body.scrollLeft||n.scrollX||r.scrollLeft||0}}change(i=20){return i>0?this._change.pipe(_V(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}static#e=this.\u0275fac=function(n){return new(n||e)(we(Iu),we(Vt),we(Ri,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wV=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({})}return e})(),xV=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({imports:[LE,wV,LE,wV]})}return e})();const SV=Dae();class Ele{constructor(t,i){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=i}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=_n(-this._previousScrollPosition.left),t.style.top=_n(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,n=t.style,r=this._document.body.style,s=n.scrollBehavior||"",o=r.scrollBehavior||"";this._isEnabled=!1,n.left=this._previousHTMLStyles.left,n.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),SV&&(n.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),SV&&(n.scrollBehavior=s,r.scrollBehavior=o)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const i=this._document.body,n=this._viewportRuler.getViewportSize();return i.scrollHeight>n.height||i.scrollWidth>n.width}}class Mle{constructor(t,i,n,r){this._scrollDispatcher=t,this._ngZone=i,this._viewportRuler=n,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe(to(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class CV{enable(){}disable(){}attach(){}}function NE(e,t){return t.some(i=>e.bottom<i.top||e.top>i.bottom||e.right<i.left||e.left>i.right)}function EV(e,t){return t.some(i=>e.top<i.top||e.bottom>i.bottom||e.left<i.left||e.right>i.right)}class Ale{constructor(t,i,n,r){this._scrollDispatcher=t,this._viewportRuler=i,this._ngZone=n,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:n,height:r}=this._viewportRuler.getViewportSize();NE(i,[{width:n,height:r,bottom:r,right:n,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Dle=(()=>{class e{constructor(i,n,r,s){this._scrollDispatcher=i,this._viewportRuler=n,this._ngZone=r,this.noop=()=>new CV,this.close=o=>new Mle(this._scrollDispatcher,this._ngZone,this._viewportRuler,o),this.block=()=>new Ele(this._viewportRuler,this._document),this.reposition=o=>new Ale(this._scrollDispatcher,this._viewportRuler,this._ngZone,o),this._document=s}static#e=this.\u0275fac=function(n){return new(n||e)(we(Sle),we(bV),we(Vt),we(Ri))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class MV{constructor(t){if(this.scrollStrategy=new CV,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const i=Object.keys(t);for(const n of i)void 0!==t[n]&&(this[n]=t[n])}}}class Tle{constructor(t,i){this.connectionPair=t,this.scrollableViewProperties=i}}let AV=(()=>{class e{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){const n=this._attachedOverlays.indexOf(i);n>-1&&this._attachedOverlays.splice(n,1),0===this._attachedOverlays.length&&this.detach()}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Ile=(()=>{class e extends AV{constructor(i,n){super(i),this._ngZone=n,this._keydownListener=r=>{const s=this._attachedOverlays;for(let o=s.length-1;o>-1;o--)if(s[o]._keydownEvents.observers.length>0){const a=s[o]._keydownEvents;this._ngZone?this._ngZone.run(()=>a.next(r)):a.next(r);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri),we(Vt,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Ple=(()=>{class e extends AV{constructor(i,n,r){super(i),this._platform=n,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=cV(s)},this._clickListener=s=>{const o=cV(s),a="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:o;this._pointerDownEventTarget=null;const l=this._attachedOverlays.slice();for(let c=l.length-1;c>-1;c--){const h=l[c];if(h._outsidePointerEvents.observers.length<1||!h.hasAttached())continue;if(h.overlayElement.contains(o)||h.overlayElement.contains(a))break;const u=h._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>u.next(s)):u.next(s)}}}add(i){if(super.add(i),!this._isAttached){const n=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(n)):this._addEventListeners(n),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=n.style.cursor,n.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri),we(Iu),we(Vt,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),DV=(()=>{class e{constructor(i,n){this._platform=n,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const i="cdk-overlay-container";if(this._platform.isBrowser||uV()){const r=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const n=this._document.createElement("div");n.classList.add(i),uV()?n.setAttribute("platform","test"):this._platform.isBrowser||n.setAttribute("platform","server"),this._document.body.appendChild(n),this._containerElement=n}static#e=this.\u0275fac=function(n){return new(n||e)(we(Ri),we(Iu))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class Rle{constructor(t,i,n,r,s,o,a,l,c,h=!1){this._portalOutlet=t,this._host=i,this._pane=n,this._config=r,this._ngZone=s,this._keyboardDispatcher=o,this._document=a,this._location=l,this._outsideClickDispatcher=c,this._animationsDisabled=h,this._backdropElement=null,this._backdropClick=new yi,this._attachments=new yi,this._detachments=new yi,this._locationChanges=en.EMPTY,this._backdropClickHandler=u=>this._backdropClick.next(u),this._backdropTransitionendHandler=u=>{this._disposeBackdrop(u.target)},this._keydownEvents=new yi,this._outsidePointerEvents=new yi,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const i=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(ga(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof i?.onDestroy&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=_n(this._config.width),t.height=_n(this._config.height),t.minWidth=_n(this._config.minWidth),t.minHeight=_n(this._config.minHeight),t.maxWidth=_n(this._config.maxWidth),t.maxHeight=_n(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,i,n){const r=mV(i||[]).filter(s=>!!s);r.length&&(n?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Au(aP(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const TV="cdk-overlay-connected-position-bounding-box",Ole=/([A-Za-z%]+)$/;class Lle{get positions(){return this._preferredPositions}constructor(t,i,n,r,s){this._viewportRuler=i,this._document=n,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new yi,this._resizeSubscription=en.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(TV),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,i=this._overlayRect,n=this._viewportRect,r=this._containerRect,s=[];let o;for(let a of this._preferredPositions){let l=this._getOriginPoint(t,r,a),c=this._getOverlayPoint(l,i,a),h=this._getOverlayFit(c,i,n,a);if(h.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(a,l);this._canFitWithFlexibleDimensions(h,c,n)?s.push({position:a,origin:l,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(l,a)}):(!o||o.overlayFit.visibleArea<h.visibleArea)&&(o={overlayFit:h,overlayPoint:c,originPoint:l,position:a,overlayRect:i})}if(s.length){let a=null,l=-1;for(const c of s){const h=c.boundingBoxRect.width*c.boundingBoxRect.height*(c.position.weight||1);h>l&&(l=h,a=c)}return this._isPushed=!1,void this._applyPosition(a.position,a.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(o.position,o.originPoint);this._applyPosition(o.position,o.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Ou(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(TV),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,i)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,i,n){let r,s;if("center"==n.originX)r=t.left+t.width/2;else{const o=this._isRtl()?t.right:t.left,a=this._isRtl()?t.left:t.right;r="start"==n.originX?o:a}return i.left<0&&(r-=i.left),s="center"==n.originY?t.top+t.height/2:"top"==n.originY?t.top:t.bottom,i.top<0&&(s-=i.top),{x:r,y:s}}_getOverlayPoint(t,i,n){let r,s;return r="center"==n.overlayX?-i.width/2:"start"===n.overlayX?this._isRtl()?-i.width:0:this._isRtl()?0:-i.width,s="center"==n.overlayY?-i.height/2:"top"==n.overlayY?0:-i.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,i,n,r){const s=PV(i);let{x:o,y:a}=t,l=this._getOffset(r,"x"),c=this._getOffset(r,"y");l&&(o+=l),c&&(a+=c);let d=0-a,p=a+s.height-n.height,f=this._subtractOverflows(s.width,0-o,o+s.width-n.width),m=this._subtractOverflows(s.height,d,p),g=f*m;return{visibleArea:g,isCompletelyWithinViewport:s.width*s.height===g,fitsInViewportVertically:m===s.height,fitsInViewportHorizontally:f==s.width}}_canFitWithFlexibleDimensions(t,i,n){if(this._hasFlexibleDimensions){const r=n.bottom-i.y,s=n.right-i.x,o=IV(this._overlayRef.getConfig().minHeight),a=IV(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=o&&o<=r)&&(t.fitsInViewportHorizontally||null!=a&&a<=s)}return!1}_pushOverlayOnScreen(t,i,n){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=PV(i),s=this._viewportRect,o=Math.max(t.x+r.width-s.width,0),a=Math.max(t.y+r.height-s.height,0),l=Math.max(s.top-n.top-t.y,0),c=Math.max(s.left-n.left-t.x,0);let h=0,u=0;return h=r.width<=s.width?c||-o:t.x<this._viewportMargin?s.left-n.left-t.x:0,u=r.height<=s.height?l||-a:t.y<this._viewportMargin?s.top-n.top-t.y:0,this._previousPushAmount={x:h,y:u},{x:t.x+h,y:t.y+u}}_applyPosition(t,i){if(this._setTransformOrigin(t),this._setOverlayElementStyles(i,t),this._setBoundingBoxStyles(i,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const n=this._getScrollVisibility(),r=new Tle(t,n);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const i=this._boundingBox.querySelectorAll(this._transformOriginSelector);let n,r=t.overlayY;n="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<i.length;s++)i[s].style.transformOrigin=`${n} ${r}`}_calculateBoundingBoxRect(t,i){const n=this._viewportRect,r=this._isRtl();let s,o,a,h,u,d;if("top"===i.overlayY)o=t.y,s=n.height-o+this._viewportMargin;else if("bottom"===i.overlayY)a=n.height-t.y+2*this._viewportMargin,s=n.height-a+this._viewportMargin;else{const p=Math.min(n.bottom-t.y+n.top,t.y),f=this._lastBoundingBoxSize.height;s=2*p,o=t.y-p,s>f&&!this._isInitialRender&&!this._growAfterOpen&&(o=t.y-f/2)}if("end"===i.overlayX&&!r||"start"===i.overlayX&&r)d=n.width-t.x+this._viewportMargin,h=t.x-this._viewportMargin;else if("start"===i.overlayX&&!r||"end"===i.overlayX&&r)u=t.x,h=n.right-t.x;else{const p=Math.min(n.right-t.x+n.left,t.x),f=this._lastBoundingBoxSize.width;h=2*p,u=t.x-p,h>f&&!this._isInitialRender&&!this._growAfterOpen&&(u=t.x-f/2)}return{top:o,left:u,bottom:a,right:d,width:h,height:s}}_setBoundingBoxStyles(t,i){const n=this._calculateBoundingBoxRect(t,i);!this._isInitialRender&&!this._growAfterOpen&&(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,o=this._overlayRef.getConfig().maxWidth;r.height=_n(n.height),r.top=_n(n.top),r.bottom=_n(n.bottom),r.width=_n(n.width),r.left=_n(n.left),r.right=_n(n.right),r.alignItems="center"===i.overlayX?"center":"end"===i.overlayX?"flex-end":"flex-start",r.justifyContent="center"===i.overlayY?"center":"bottom"===i.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=_n(s)),o&&(r.maxWidth=_n(o))}this._lastBoundingBoxSize=n,Ou(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Ou(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Ou(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,i){const n={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,o=this._overlayRef.getConfig();if(r){const h=this._viewportRuler.getViewportScrollPosition();Ou(n,this._getExactOverlayY(i,t,h)),Ou(n,this._getExactOverlayX(i,t,h))}else n.position="static";let a="",l=this._getOffset(i,"x"),c=this._getOffset(i,"y");l&&(a+=`translateX(${l}px) `),c&&(a+=`translateY(${c}px)`),n.transform=a.trim(),o.maxHeight&&(r?n.maxHeight=_n(o.maxHeight):s&&(n.maxHeight="")),o.maxWidth&&(r?n.maxWidth=_n(o.maxWidth):s&&(n.maxWidth="")),Ou(this._pane.style,n)}_getExactOverlayY(t,i,n){let r={top:"",bottom:""},s=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,n)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=_n(s.y),r}_getExactOverlayX(t,i,n){let o,r={left:"",right:""},s=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,n)),o=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===o?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=_n(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),i=this._pane.getBoundingClientRect(),n=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:EV(t,n),isOriginOutsideView:NE(t,n),isOverlayClipped:EV(i,n),isOverlayOutsideView:NE(i,n)}}_subtractOverflows(t,...i){return i.reduce((n,r)=>n-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+t-this._viewportMargin,bottom:n.top+i-this._viewportMargin,width:t-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,i){return"x"===i?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&mV(t).forEach(i=>{""!==i&&-1===this._appliedPanelClasses.indexOf(i)&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof gn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const i=t.width||0,n=t.height||0;return{top:t.y,bottom:t.y+n,left:t.x,right:t.x+i,height:n,width:i}}}function Ou(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function IV(e){if("number"!=typeof e&&null!=e){const[t,i]=e.split(Ole);return i&&"px"!==i?null:parseFloat(t)}return e||null}function PV(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const RV="cdk-global-overlay-wrapper";class Nle{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const i=t.getConfig();this._overlayRef=t,this._width&&!i.width&&t.updateSize({width:this._width}),this._height&&!i.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(RV),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:o,maxHeight:a}=n,l=!("100%"!==r&&"100vw"!==r||o&&"100%"!==o&&"100vw"!==o),c=!("100%"!==s&&"100vh"!==s||a&&"100%"!==a&&"100vh"!==a),h=this._xPosition,u=this._xOffset,d="rtl"===this._overlayRef.getConfig().direction;let p="",f="",m="";l?m="flex-start":"center"===h?(m="center",d?f=u:p=u):d?"left"===h||"end"===h?(m="flex-end",p=u):("right"===h||"start"===h)&&(m="flex-start",f=u):"left"===h||"start"===h?(m="flex-start",p=u):("right"===h||"end"===h)&&(m="flex-end",f=u),t.position=this._cssPosition,t.marginLeft=l?"0":p,t.marginTop=c?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=l?"0":f,i.justifyContent=m,i.alignItems=c?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,n=i.style;i.classList.remove(RV),n.justifyContent=n.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let kle=(()=>{class e{constructor(i,n,r,s){this._viewportRuler=i,this._document=n,this._platform=r,this._overlayContainer=s}global(){return new Nle}flexibleConnectedTo(i){return new Lle(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#e=this.\u0275fac=function(n){return new(n||e)(we(bV),we(Ri),we(Iu),we(DV))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Fle=0,kE=(()=>{class e{constructor(i,n,r,s,o,a,l,c,h,u,d,p){this.scrollStrategies=i,this._overlayContainer=n,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=o,this._injector=a,this._ngZone=l,this._document=c,this._directionality=h,this._location=u,this._outsideClickDispatcher=d,this._animationsModuleType=p}create(i){const n=this._createHostElement(),r=this._createPaneElement(n),s=this._createPortalOutlet(r),o=new MV(i);return o.direction=o.direction||this._directionality.value,new Rle(s,n,r,o,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(i){const n=this._document.createElement("div");return n.id="cdk-overlay-"+Fle++,n.classList.add("cdk-overlay-pane"),i.appendChild(n),n}_createHostElement(){const i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(xu)),new Mae(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#e=this.\u0275fac=function(n){return new(n||e)(we(Dle),we(DV),we(vu),we(kle),we(Ile),we(rr),we(Vt),we(Ri),we(wle),we(S0),we(Ple),we(VZ,8))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const zle={provide:new Le("cdk-connected-overlay-scroll-strategy"),deps:[kE],useFactory:function Vle(e){return()=>e.scrollStrategies.reposition()}};let o_=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({providers:[kE,zle],imports:[LE,AE,xV,xV]})}return e})();const Ule=["dialog"],jle=["content"];function Hle(e,t){}const Gle=function(e){return{"rounded-0":e}};class Wle{animation=!0;backdrop=!0;ignoreBackdropClick=!1;keyboard=!0;modalClass="";containerClass="";viewContainerRef;data=null;nonInvasive=!1}class FE{_overlayRef;_container;constructor(t,i){this._overlayRef=t,this._container=i}component;onClose$=new yi;onClose=this.onClose$.asObservable();close(t){this._container._close(),setTimeout(()=>{this._container._config.nonInvasive&&this._container._onNonInvasiveModalHidden(),this._container._restoreScrollbar(),this.onClose$.next(t),this.onClose$.complete(),this._overlayRef.detach(),this._overlayRef.dispose()},this._container.MODAL_TRANSITION)}}const BE="modal-open",OV="modal-non-invasive-open",LV="modal-non-invasive-show";let NV=(()=>{class e{_document;_elementRef;_renderer;_focusTrapFactory;_ngZone;_portalOutlet;modalDialog;modalContent;_destroy$=new yi;backdropClick$=new yi;_config;BACKDROP_TRANSITION=150;MODAL_TRANSITION=200;NON_INVASIVE_TRANSITION=450;_previouslyFocusedElement;_focusTrap;modal=!0;get hasAnimation(){return this._config.animation}onWindowResize(){this._ngZone.runOutsideAngular(()=>{this._config.nonInvasive&&this._handleWindowResize()})}get host(){return this._elementRef.nativeElement}_isScrollable=!1;_isBottomRight=!1;_isBottomLeft=!1;_isTopRight=!1;_isTopLeft=!1;_isSideTopModal=!1;_isSideBottomModal=!1;_isSideModal=!1;_isModalBottom=!1;_modalContentRect;_modalContentComputedStyles;_modalDialogComputedStyles;_topOffset=0;_leftOffset=0;_rightOffset=0;_bottomOffset=0;constructor(i,n,r,s,o){this._document=i,this._elementRef=n,this._renderer=r,this._focusTrapFactory=s,this._ngZone=o}ngOnInit(){this._updateContainerClass(),this._renderer.setStyle(this.host,"display","block"),this._config.nonInvasive||(this._focusTrap=this._focusTrapFactory.create(this.host),this._previouslyFocusedElement=this._document.activeElement),this._config.animation?setTimeout(()=>{this._renderer.addClass(this.host,"show"),setTimeout(()=>{this._focusTrap?.focusInitialElementWhenReady()},this.MODAL_TRANSITION)},this.BACKDROP_TRANSITION):this._focusTrap?.focusInitialElementWhenReady()}ngAfterViewInit(){const i=this._document.body.offsetWidth;this._renderer.addClass(this._document.body,BE),this._config.nonInvasive&&(this._renderer.addClass(this._document.body,OV),setTimeout(()=>{this._onNonInvasiveModalShown()},this.NON_INVASIVE_TRANSITION)),this._config.nonInvasive||this._renderer.setStyle(this._document.body,"overflow","hidden"),this._config.nonInvasive||this._renderer.setStyle(this._document.body,"padding-right",this._document.body.offsetWidth-i+"px"),!this._config.ignoreBackdropClick&&!this._config.nonInvasive&&og(this.host,"mousedown").pipe(to(r=>{const s=r.target,o=this.modalDialog.nativeElement,a=s!==o,l=!o.contains(s);return a&&l}),Au(this._destroy$)).subscribe(r=>{this.backdropClick$.next(r)})}ngOnDestroy(){this._previouslyFocusedElement?.focus(),this._focusTrap?.destroy(),this._destroy$.next(),this._destroy$.complete()}_updateContainerClass(){""===this._config.containerClass||this._config.containerClass.length&&0===this._config.containerClass.length||this._config.containerClass.split(" ").forEach(n=>{this._renderer.addClass(this.host,n)})}_onNonInvasiveModalShown(){this._isScrollable=this._config.modalClass.includes("modal-dialog-scrollable"),this._isBottomRight=this._config.modalClass.includes("modal-bottom-right"),this._isBottomLeft=this._config.modalClass.includes("modal-bottom-left"),this._isTopRight=this._config.modalClass.includes("modal-top-right"),this._isTopLeft=this._config.modalClass.includes("modal-top-left"),this._isModalBottom=this._config.modalClass.includes("modal-bottom"),this._isSideTopModal=this._isTopLeft||this._isTopRight,this._isSideBottomModal=this._isBottomLeft||this._isBottomRight,this._isSideModal=this._isSideTopModal||this._isSideBottomModal,this._modalContentRect=this.modalContent.nativeElement.getBoundingClientRect(),this._modalContentComputedStyles=window.getComputedStyle(this.modalContent.nativeElement),this._modalDialogComputedStyles=window.getComputedStyle(this.modalDialog.nativeElement),this._topOffset=parseInt(this._modalDialogComputedStyles.top,0),this._leftOffset=parseInt(this._modalDialogComputedStyles.left,0),this._rightOffset=parseInt(this._modalDialogComputedStyles.right,0),this._bottomOffset=parseInt(this._modalDialogComputedStyles.bottom,0),this._renderer.addClass(this.host,LV),this._setNonInvasiveStyles()}_setNonInvasiveStyles(i=0,n=0){const r=window.innerWidth>=992;this._renderer.setStyle(this.host,"left",`${this._modalContentRect.left+i}px`),this._renderer.setStyle(this.host,"width",this._modalContentComputedStyles.width),this._isScrollable||(this._renderer.setStyle(this.host,"height",this._modalContentComputedStyles.height),this._renderer.setStyle(this.host,"display","")),r&&((this._isSideBottomModal||this._isModalBottom)&&this._renderer.setStyle(this.host,"top",`${this._modalContentRect.top+n}px`),this._isSideModal&&this._renderer.setStyle(this.host,"overflowX","auto")),r||(this.host.style.height="")}_onNonInvasiveModalHidden(){this._renderer.removeClass(this.host,LV),this._resetNonInvasiveStyles(),this._removeNonInvasiveClass()}_resetNonInvasiveStyles(){this._renderer.setStyle(this.host,"left",""),this._renderer.setStyle(this.host,"top",""),this._renderer.setStyle(this.host,"height",""),this._renderer.setStyle(this.host,"width",""),this._isScrollable||this._renderer.setStyle(this.host,"display",""),this._isSideModal&&this._renderer.setStyle(this.host,"overflowX","")}_removeNonInvasiveClass(){this._document.body.querySelector(".modal.show.modal-non-invasive-show")?this._renderer.addClass(this._document.body,BE):this._renderer.removeClass(this._document.body,OV)}_handleWindowResize(){const i=this.host.querySelector(".modal-content");if(this._resetNonInvasiveStyles(),this._modalContentRect=i.getBoundingClientRect(),this._modalContentComputedStyles=window.getComputedStyle(i),this._isSideTopModal||this._isSideBottomModal){let n=0,r=0;(this._isBottomRight||this._isBottomLeft)&&(r=-this._bottomOffset),(this._isBottomRight||this._isTopRight)&&(n=-this._rightOffset),(this._isBottomLeft||this._isTopLeft)&&(n=this._leftOffset),this._setNonInvasiveStyles(n,r)}else this._setNonInvasiveStyles()}_close(){this._config.animation&&this._renderer.removeClass(this.host,"show");const i=Array.from(this.host.querySelectorAll("iframe")),n=Array.from(this.host.querySelectorAll("video"));i.forEach(r=>{const s=r.getAttribute("src");this._renderer.setAttribute(r,"src",s)}),n.forEach(r=>{r.pause()})}_restoreScrollbar(){this._renderer.removeClass(this._document.body,BE),this._renderer.removeStyle(this._document.body,"overflow"),this._renderer.removeStyle(this._document.body,"padding-right")}attachComponentPortal(i){return this._portalOutlet.attachComponentPortal(i)}attachTemplatePortal(i){return this._portalOutlet.attachTemplatePortal(i)}static \u0275fac=function(n){return new(n||e)(pe(Ri),pe(gn),pe(Qs),pe(Jae),pe(Vt))};static \u0275cmp=Ar({type:e,selectors:[["mdb-modal-container"]],viewQuery:function(n,r){if(1&n&&(Po(aV,7),Po(Ule,7),Po(jle,7)),2&n){let s;Lr(s=Nr())&&(r._portalOutlet=s.first),Lr(s=Nr())&&(r.modalDialog=s.first),Lr(s=Nr())&&(r.modalContent=s.first)}},hostVars:4,hostBindings:function(n,r){1&n&&vn("resize",function(o){return r.onWindowResize(o)},0,i3),2&n&&wd("modal",r.modal)("fade",r.hasAnimation)},decls:5,vars:5,consts:[["dialog",""],[1,"modal-content",3,"ngClass"],["content",""],["cdkPortalOutlet",""]],template:function(n,r){1&n&&(Me(0,"div",null,0)(2,"div",1,2),function iL(e,t,i,n,r,s,o,a){const l=ve(),c=qt(),h=e+Bt,u=c.firstCreatePass?function UK(e,t,i,n,r,s,o,a,l){const c=t.consts,h=ud(t,e,4,o||null,sc(c,a));_S(t,i,h,sc(c,l)),hy(t,h);const u=h.tView=yS(2,h,n,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return null!==t.queries&&(t.queries.template(t,h),u.queries=t.queries.embeddedTView(h)),h}(h,c,l,t,i,n,r,s,o):c.data[h];ca(u,!1);const d=nL(c,l,u,e);uy()&&Oy(c,l,d,u),ur(d,l),Qy(l,l[h]=E3(d,l,d,u)),oy(u)&&gS(c,l,u),null!=o&&vS(l,u,a)}(4,Hle,0,0,"ng-template",3),Pe()()),2&n&&(RL("modal-dialog"+(r._config.modalClass?" "+r._config.modalClass:"")),cd(2),Sm("ngClass",QS(3,Gle,r._config.modalClass.includes("modal-frame"))))},dependencies:[FC,aV],encapsulation:2})}return e})(),kV=(()=>{class e{_document;_overlay;_injector;_cfr;constructor(i,n,r,s){this._document=i,this._overlay=n,this._injector=r,this._cfr=s}open(i,n){const r=new Wle;n=n?Object.assign(r,n):r;const s=this._createOverlay(n),o=this._createContainer(s,n),a=this._createContent(i,o,s,n);return this._registerListeners(a,n,o),a}_createOverlay(i){const n=this._getOverlayConfig(i);return this._overlay.create(n)}_getOverlayConfig(i){return new MV({positionStrategy:this._overlay.position().global(),scrollStrategy:this._overlay.scrollStrategies.noop(),hasBackdrop:!i.nonInvasive&&i.backdrop,backdropClass:"mdb-backdrop"})}_createContainer(i,n){const r=new ME(NV,null,this._injector,this._cfr),s=i.attach(r);return s.instance._config=n,s.instance}_createContent(i,n,r,s){const o=new FE(r,n);if(i instanceof ma)n.attachTemplatePortal(new sV(i,null,{$implicit:s.data,modalRef:o}));else{const a=this._createInjector(s,o,n),l=n.attachComponentPortal(new ME(i,s.viewContainerRef,a));s.data&&Object.assign(l.instance,{...s.data}),o.component=l.instance}return o}_createInjector(i,n,r){return rr.create({parent:i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,providers:[{provide:NV,useValue:r},{provide:FE,useValue:n}]})}_registerListeners(i,n,r){r.backdropClick$.pipe(ga(1)).subscribe(()=>{i.close()}),n.keyboard&&og(r._elementRef.nativeElement,"keydown").pipe(to(s=>"Escape"===s.key),ga(1)).subscribe(()=>{i.close()})}static \u0275fac=function(n){return new(n||e)(we(Ri),we(kE),we(rr),we(vu))};static \u0275prov=je({token:e,factory:e.\u0275fac})}return e})(),Yle=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({providers:[kV],imports:[Rs,o_,AE]})}return e})(),Xle=(()=>{class e{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Zle=(()=>{class e{constructor(i){this._mutationObserverFactory=i,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((i,n)=>this._cleanupObserver(n))}observe(i){const n=i_(i);return new Bi(r=>{const o=this._observeElement(n).subscribe(r);return()=>{o.unsubscribe(),this._unobserveElement(n)}})}_observeElement(i){if(this._observedElements.has(i))this._observedElements.get(i).count++;else{const n=new yi,r=this._mutationObserverFactory.create(s=>n.next(s));r&&r.observe(i,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(i,{observer:r,stream:n,count:1})}return this._observedElements.get(i).stream}_unobserveElement(i){this._observedElements.has(i)&&(this._observedElements.get(i).count--,this._observedElements.get(i).count||this._cleanupObserver(i))}_cleanupObserver(i){if(this._observedElements.has(i)){const{observer:n,stream:r}=this._observedElements.get(i);n&&n.disconnect(),r.complete(),this._observedElements.delete(i)}}static#e=this.\u0275fac=function(n){return new(n||e)(we(Xle))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Os=new Le("NgValueAccessor");function XV(e){return null!=e}function ZV(e){return Cm(e)?Pn(e):e}function QV(e){let t={};return e.forEach(i=>{t=null!=i?{...t,...i}:t}),0===Object.keys(t).length?null:t}function KV(e,t){return t.map(i=>i(e))}function $V(e){return e.map(t=>function ice(e){return!e.validate}(t)?t:i=>t.validate(i))}function zE(e){return null!=e?function JV(e){if(!e)return null;const t=e.filter(XV);return 0==t.length?null:function(i){return QV(KV(i,t))}}($V(e)):null}function UE(e){return null!=e?function ez(e){if(!e)return null;const t=e.filter(XV);return 0==t.length?null:function(i){return function Qle(...e){const t=nP(e),{args:i,keys:n}=YF(e),r=new Bi(s=>{const{length:o}=i;if(!o)return void s.complete();const a=new Array(o);let l=o,c=o;for(let h=0;h<o;h++){let u=!1;Mr(i[h]).subscribe(Wi(s,d=>{u||(u=!0,c--),a[h]=d},()=>l--,void 0,()=>{(!l||!u)&&(c||s.next(n?XF(n,a):a),s.complete())}))}});return t?r.pipe($C(t)):r}(KV(i,t).map(ZV)).pipe(Si(QV))}}($V(e)):null}class oz{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=zE(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=UE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,i){return!!this.control&&this.control.hasError(t,i)}getError(t,i){return this.control?this.control.getError(t,i):null}}class ml extends oz{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}const Vd=new Le("CallSetDisabledState",{providedIn:"root",factory:()=>d_}),d_="always";let Sz=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({})}return e})(),Yce=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({imports:[Sz]})}return e})(),v_=(()=>{class e{static withConfig(i){return{ngModule:e,providers:[{provide:Vd,useValue:i.callSetDisabledState??d_}]}}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({imports:[Yce]})}return e})();const Uz=TE({passive:!0});let Zce=(()=>{class e{constructor(i,n){this._platform=i,this._ngZone=n,this._monitoredElements=new Map}monitor(i){if(!this._platform.isBrowser)return xo;const n=i_(i),r=this._monitoredElements.get(n);if(r)return r.subject;const s=new yi,o="cdk-text-field-autofilled",a=l=>{"cdk-text-field-autofill-start"!==l.animationName||n.classList.contains(o)?"cdk-text-field-autofill-end"===l.animationName&&n.classList.contains(o)&&(n.classList.remove(o),this._ngZone.run(()=>s.next({target:l.target,isAutofilled:!1}))):(n.classList.add(o),this._ngZone.run(()=>s.next({target:l.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{n.addEventListener("animationstart",a,Uz),n.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(n,{subject:s,unlisten:()=>{n.removeEventListener("animationstart",a,Uz)}}),s}stopMonitoring(i){const n=i_(i),r=this._monitoredElements.get(n);r&&(r.unlisten(),r.subject.complete(),n.classList.remove("cdk-text-field-autofill-monitored"),n.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(n))}ngOnDestroy(){this._monitoredElements.forEach((i,n)=>this.stopMonitoring(n))}static#e=this.\u0275fac=function(n){return new(n||e)(we(Iu),we(Vt))};static#t=this.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Qce=["notchLeading"],Kce=["notchMiddle"],$ce=["*"];let jz=(()=>{class e{stateChanges;input;labelActive;static \u0275fac=function(n){return new(n||e)};static \u0275dir=et({type:e})}return e})(),Hz=(()=>{class e{constructor(){}static \u0275fac=function(n){return new(n||e)};static \u0275dir=et({type:e,selectors:[["","mdbLabel",""]],exportAs:["mdbLabel"]})}return e})(),Jce=(()=>{class e{_renderer;_contentObserver;_elementRef;_ngZone;_notchLeading;_notchMiddle;_formControl;_label;outline=!0;display=!0;get input(){return this._formControl.input}constructor(i,n,r,s){this._renderer=i,this._contentObserver=n,this._elementRef=r,this._ngZone=s}_destroy$=new yi;_notchLeadingLength=9;_labelMarginLeft=0;_labelGapPadding=8;_labelScale=.8;_recalculateGapWhenVisible=!1;ngAfterContentInit(){this._label?setTimeout(()=>{this._updateBorderGap()},0):this._renderer.addClass(this.input,"placeholder-active"),this._updateLabelActiveState(),this._label&&this._contentObserver.observe(this._label.nativeElement).pipe(Au(this._destroy$)).subscribe(()=>{this._updateBorderGap()}),this._formControl.stateChanges.pipe(Au(this._destroy$)).subscribe(()=>{this._updateLabelActiveState(),this._label&&this._updateBorderGap()}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Au(this._destroy$)).subscribe(()=>{this._label&&this._recalculateGapWhenVisible&&this._updateBorderGap()})})}ngOnDestroy(){this._destroy$.next(),this._destroy$.unsubscribe()}_getLabelWidth(){return this._label.nativeElement.clientWidth*this._labelScale+this._labelGapPadding}_updateBorderGap(){if(this._isHidden())return void(this._recalculateGapWhenVisible=!0);const i=`${this._labelMarginLeft+this._notchLeadingLength}px`,n=`${this._getLabelWidth()}px`;this._notchLeading.nativeElement.style.width=i,this._notchMiddle.nativeElement.style.width=n,this._label.nativeElement.style.marginLeft=`${this._labelMarginLeft}px`,this._recalculateGapWhenVisible=!1}_updateLabelActiveState(){this._isLabelActive()?this._renderer.addClass(this.input,"active"):this._renderer.removeClass(this.input,"active")}_isLabelActive(){return this._formControl&&this._formControl.labelActive}_isHidden(){const i=this._elementRef.nativeElement;return!i.offsetHeight&&!i.offsetWidth}static \u0275fac=function(n){return new(n||e)(pe(Qs),pe(Zle),pe(gn),pe(Vt))};static \u0275cmp=Ar({type:e,selectors:[["mdb-form-control"]],contentQueries:function(n,r,s){if(1&n&&(Lm(s,jz,7),Lm(s,Hz,7,gn)),2&n){let o;Lr(o=Nr())&&(r._formControl=o.first),Lr(o=Nr())&&(r._label=o.first)}},viewQuery:function(n,r){if(1&n&&(Po(Qce,7),Po(Kce,7)),2&n){let s;Lr(s=Nr())&&(r._notchLeading=s.first),Lr(s=Nr())&&(r._notchMiddle=s.first)}},hostVars:4,hostBindings:function(n,r){2&n&&wd("form-outline",r.outline)("d-block",r.display)},ngContentSelectors:$ce,decls:7,vars:0,consts:[[1,"form-notch"],[1,"form-notch-leading"],["notchLeading",""],[1,"form-notch-middle"],["notchMiddle",""],[1,"form-notch-trailing"]],template:function(n,r){1&n&&(function pL(e){const t=ve()[nn][cr];if(!t.projection){const n=t.projection=tm(e?e.length:1,null),r=n.slice();let s=t.child;for(;null!==s;){const o=e?t$(s,e):0;null!==o&&(r[o]?r[o].projectionNext=s:n[o]=s,r[o]=s),s=s.next}}}(),function fL(e,t=0,i){const n=ve(),r=qt(),s=ud(r,Bt+e,16,null,i||null);null===s.projection&&(s.projection=t),n1(),(!n[il]||zh())&&32!=(32&s.flags)&&function JX(e,t,i){pO(t[bt],0,t,i,R1(e,i,t),aO(i.parent||t[cr],i,t))}(r,n,s)}(0),Me(1,"div",0),wt(2,"div",1,2)(4,"div",3,4)(6,"div",5),Pe())},encapsulation:2,changeDetection:0})}return e})(),eue=(()=>{class e{_elementRef;_renderer;_ngControl;_autofill;constructor(i,n,r,s){this._elementRef=i,this._renderer=n,this._ngControl=r,this._autofill=s}stateChanges=new yi;_focused=!1;_autofilled=!1;_color="";ngAfterViewInit(){this._color=getComputedStyle(this._elementRef.nativeElement).color,"date"===this._elementRef.nativeElement.type&&this._updateTextColorForDateType(),this._autofill.monitor(this.input).subscribe(i=>{this._autofilled=i.isAutofilled,this.stateChanges.next()})}_currentNativeValue;get disabled(){return this._ngControl&&null!==this._ngControl.disabled?this._ngControl.disabled:this._disabled}set disabled(i){this._disabled=Ru(i)}_disabled=!1;get readonly(){return this._readonly}set readonly(i){i?this._renderer.setAttribute(this._elementRef.nativeElement,"readonly",""):this._renderer.removeAttribute(this._elementRef.nativeElement,"readonly"),this._readonly=Ru(i)}_readonly=!1;get value(){return this._elementRef.nativeElement.value}set value(i){i!==this.value&&(this._elementRef.nativeElement.value=i,this._value=i,this.stateChanges.next())}_value;_updateTextColorForDateType(){const i=getComputedStyle(this._elementRef.nativeElement).color;this._color="rgba(0, 0, 0, 0)"!==i?i:this._color,this._renderer.setStyle(this._elementRef.nativeElement,"color",this.labelActive?this._color:"transparent")}_onFocus(){this._focused=!0,"date"===this._elementRef.nativeElement.type&&this._updateTextColorForDateType(),this.stateChanges.next()}_onBlur(){this._focused=!1,"date"===this._elementRef.nativeElement.type&&this._updateTextColorForDateType(),this.stateChanges.next()}ngDoCheck(){const i=this._elementRef.nativeElement.value;this._currentNativeValue!==i&&(this._currentNativeValue=i,this.stateChanges.next())}get hasValue(){return""!==this._elementRef.nativeElement.value}get focused(){return this._focused}get autofilled(){return this._autofilled}get input(){return this._elementRef.nativeElement}get labelActive(){return this.focused||this.hasValue||this.autofilled}static ngAcceptInputType_disabled;static ngAcceptInputType_readonly;ngOnDestroy(){this._autofill.stopMonitoring(this.input)}static \u0275fac=function(n){return new(n||e)(pe(gn),pe(Qs),pe(ml,10),pe(Zce))};static \u0275dir=et({type:e,selectors:[["","mdbInput",""]],hostVars:1,hostBindings:function(n,r){1&n&&vn("focus",function(){return r._onFocus()})("blur",function(){return r._onBlur()}),2&n&&Mm("disabled",r.disabled)},inputs:{disabled:"disabled",readonly:"readonly",value:"value"},exportAs:["mdbInput"],features:[_i([{provide:jz,useExisting:e}])]})}return e})(),tue=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,v_]})}return e})(),Gz=(()=>{class e{constructor(i){this.modalRef=i}close(){this.modalRef&&this.modalRef.close("Modal closed")}static#e=this.\u0275fac=function(n){return new(n||e)(pe(FE,8))};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-contact"]],decls:24,vars:0,consts:[[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-4"],["mdbInput","","type","text","id","form4Example1",1,"form-control"],["mdbLabel","","for","form4Example1",1,"form-label"],["mdbInput","","type","email","id","form4Example2",1,"form-control"],["mdbLabel","","for","form4Example2",1,"form-label"],["mdbInput","","id","form4Example3","rows","4",1,"form-control"],["mdbLabel","","for","form4Example3",1,"form-label"],[1,"modal-footer"],["type","button",1,"btn","btn-danger",3,"click"],["type","button",1,"btn","btn-primary"]],template:function(n,r){1&n&&(Me(0,"div",0)(1,"div",1)(2,"h5",2),ht(3,"Give us your feedback!"),Pe(),Me(4,"button",3),vn("click",function(){return r.close()}),Pe()(),Me(5,"div",4)(6,"form")(7,"mdb-form-control",5),wt(8,"input",6),Me(9,"label",7),ht(10,"Name"),Pe()(),Me(11,"mdb-form-control",5),wt(12,"input",8),Me(13,"label",9),ht(14,"Email address"),Pe()(),Me(15,"mdb-form-control",5),wt(16,"textarea",10),Me(17,"label",11),ht(18,"Message"),Pe()()()(),Me(19,"div",12)(20,"button",13),vn("click",function(){return r.close()}),ht(21," Close "),Pe(),Me(22,"button",14),ht(23,"Send"),Pe()()())},dependencies:[Jce,eue,Hz]})}return e})();const iue=[{path:"about",component:nV},{path:"survey",component:yae},{path:"contact",component:Gz}];let nue=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e});static#i=this.\u0275inj=ti({imports:[tV.forRoot(iue),tV]})}return e})();var sn=In(861),rue=Object.create,y_=Object.defineProperty,sue=Object.getOwnPropertyDescriptor,oue=Object.getOwnPropertyNames,aue=Object.getPrototypeOf,lue=Object.prototype.hasOwnProperty,fr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Wn=(e,t,i)=>(i=null!=e?rue(aue(e)):{},((e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of oue(t))!lue.call(e,r)&&undefined!==r&&y_(e,r,{get:()=>t[r],enumerable:!(n=sue(t,r))||n.enumerable});return e})(!t&&e&&e.__esModule?i:y_(i,"default",{value:e,enumerable:!0}),e)),Vr=(e,t,i)=>(((e,t,i)=>{t in e?y_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),due=fr((e,t)=>{var i,n;i=e,n=function(){return i.importState=function(r){var s=new i;return s.importState(r),s},i;function i(){return function(r){var s=0,o=0,a=0,l=1;0==r.length&&(r=[+new Date]);var c=function n(){var r=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){var l=.02519603282416938*(r+=o.charCodeAt(a));l-=r=l>>>0,r=(l*=r)>>>0,r+=4294967296*(l-=r)}return 2.3283064365386963e-10*(r>>>0)};return s.version="Mash 0.9",s}();s=c(" "),o=c(" "),a=c(" ");for(var h=0;h<r.length;h++)(s-=c(r[h]))<0&&(s+=1),(o-=c(r[h]))<0&&(o+=1),(a-=c(r[h]))<0&&(a+=1);c=null;var u=function(){var d=2091639*s+2.3283064365386963e-10*l;return s=o,o=a,a=d-(l=0|d)};return u.next=u,u.uint32=function(){return 4294967296*u()},u.fract53=function(){return u()+11102230246251565e-32*(2097152*u()|0)},u.version="Alea 0.9",u.args=r,u.exportState=function(){return[s,o,a,l]},u.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,l=+d[3]||0},u}(Array.prototype.slice.call(arguments))}},"object"==typeof e?t.exports=n():"function"==typeof define&&define.amd?define(n):i.Alea=n()}),Wz=fr((e,t)=>{var i,n;i=e,n=function(i){i.SVD=function(n,r,s,o,a){if(r=void 0===r||r,s=void 0===s||s,a=1e-64/(o=o||Math.pow(2,-52)),!n)throw new TypeError("Matrix a is not defined");var l,c,h,u,d,p,f,m,g,v,y,_,b=n[0].length,w=n.length;if(w<b)throw new TypeError("Invalid matrix: m < n");for(var C=[],x=[],S=[],E="f"===r?w:b,D=v=f=0;D<w;D++)x[D]=new Array(E).fill(0);for(D=0;D<b;D++)S[D]=new Array(b).fill(0);var T,I=new Array(b).fill(0);for(D=0;D<w;D++)for(l=0;l<b;l++)x[D][l]=n[D][l];for(D=0;D<b;D++){for(C[D]=f,g=0,h=D+1,l=D;l<w;l++)g+=Math.pow(x[l][D],2);if(g<a)f=0;else for(m=(p=x[D][D])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,x[D][D]=p-f,l=h;l<b;l++){for(g=0,c=D;c<w;c++)g+=x[c][D]*x[c][l];for(p=g/m,c=D;c<w;c++)x[c][l]=x[c][l]+p*x[c][D]}for(I[D]=f,g=0,l=h;l<b;l++)g+=Math.pow(x[D][l],2);if(g<a)f=0;else{for(m=(p=x[D][D+1])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,x[D][D+1]=p-f,l=h;l<b;l++)C[l]=x[D][l]/m;for(l=h;l<w;l++){for(g=0,c=h;c<b;c++)g+=x[l][c]*x[D][c];for(c=h;c<b;c++)x[l][c]=x[l][c]+g*C[c]}}v<(y=Math.abs(I[D])+Math.abs(C[D]))&&(v=y)}if(s)for(D=b-1;0<=D;D--){if(0!==f){for(m=x[D][D+1]*f,l=h;l<b;l++)S[l][D]=x[D][l]/m;for(l=h;l<b;l++){for(g=0,c=h;c<b;c++)g+=x[D][c]*S[c][l];for(c=h;c<b;c++)S[c][l]=S[c][l]+g*S[c][D]}}for(l=h;l<b;l++)S[D][l]=0,S[l][D]=0;S[D][D]=1,f=C[D],h=D}if(r){if("f"===r)for(D=b;D<w;D++){for(l=b;l<w;l++)x[D][l]=0;x[D][D]=1}for(D=b-1;0<=D;D--){for(f=I[D],l=h=D+1;l<E;l++)x[D][l]=0;if(0!==f){for(m=x[D][D]*f,l=h;l<E;l++){for(g=0,c=h;c<w;c++)g+=x[c][D]*x[c][l];for(p=g/m,c=D;c<w;c++)x[c][l]=x[c][l]+p*x[c][D]}for(l=D;l<w;l++)x[l][D]=x[l][D]/f}else for(l=D;l<w;l++)x[l][D]=0;x[D][D]=x[D][D]+1}}for(o*=v,c=b-1;0<=c;c--)for(var P=0;P<50;P++){for(T=!1,h=c;0<=h;h--){if(Math.abs(C[h])<=o){T=!0;break}if(Math.abs(I[h-1])<=o)break}if(!T)for(d=0,u=h-(g=1),D=h;D<c+1&&(p=g*C[D],C[D]=d*C[D],!(Math.abs(p)<=o));D++)if(f=I[D],I[D]=Math.sqrt(p*p+f*f),d=f/(m=I[D]),g=-p/m,r)for(l=0;l<w;l++)x[l][u]=(y=x[l][u])*d+(_=x[l][D])*g,x[l][D]=-y*g+_*d;if(_=I[c],h===c){if(_<0&&(I[c]=-_,s))for(l=0;l<b;l++)S[l][c]=-S[l][c];break}for(v=I[h],p=(((y=I[c-1])-_)*(y+_)+((f=C[c-1])-(m=C[c]))*(f+m))/(2*m*y),f=Math.sqrt(p*p+1),p=((v-_)*(v+_)+m*(y/(p<0?p-f:p+f)-m))/v,D=h+(g=d=1);D<c+1;D++){if(y=I[D],m=g*(f=C[D]),f*=d,_=Math.sqrt(p*p+m*m),p=v*(d=p/(C[D-1]=_))+f*(g=m/_),f=-v*g+f*d,m=y*g,y*=d,s)for(l=0;l<b;l++)S[l][D-1]=(v=S[l][D-1])*d+(_=S[l][D])*g,S[l][D]=-v*g+_*d;if(_=Math.sqrt(p*p+m*m),p=(d=p/(I[D-1]=_))*f+(g=m/_)*y,v=-g*f+d*y,r)for(l=0;l<w;l++)x[l][D-1]=(y=x[l][D-1])*d+(_=x[l][D])*g,x[l][D]=-y*g+_*d}C[h]=0,C[c]=p,I[c]=v}for(D=0;D<b;D++)I[D]<o&&(I[D]=0);return{u:x,q:I,v:S}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})},"object"==typeof e&&typeof t<"u"?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})}),pue=fr((e,t)=>{var i,n;i=e,n=function(){var i=function(r,s){if(void 0===r&&(r=[]),void 0===s&&(s=n),this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};function n(r,s){return r<s?-1:r>s?1:0}return i.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(0!==this.length){var r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(r){for(var o=this.data,a=this.compare,l=o[r];r>0;){var c=r-1>>1,h=o[c];if(a(l,h)>=0)break;o[r]=h,r=c}o[r]=l},i.prototype._down=function(r){for(var o=this.data,a=this.compare,l=this.length>>1,c=o[r];r<l;){var h=1+(r<<1),u=o[h],d=h+1;if(d<this.length&&a(o[d],u)<0&&(h=d,u=o[d]),a(u,c)>=0)break;o[r]=u,r=h}o[r]=c},i},"object"==typeof e&&typeof t<"u"?t.exports=n():"function"==typeof define&&define.amd?define(n):(i=i||self).TinyQueue=n()}),fue=fr((e,t)=>{var i=pue();function n(c,h,u){h=h||1;for(var d,p,f,m,g=0;g<c[0].length;g++){var v=c[0][g];(!g||v[0]<d)&&(d=v[0]),(!g||v[1]<p)&&(p=v[1]),(!g||v[0]>f)&&(f=v[0]),(!g||v[1]>m)&&(m=v[1])}var y=f-d,_=m-p,b=Math.min(y,_),w=b/2;if(0===b){var C=[d,p];return C.distance=0,C}for(var x=new i(void 0,r),S=d;S<f;S+=b)for(var E=p;E<m;E+=b)x.push(new s(S+w,E+w,w,c));var D=function a(c){for(var h=0,u=0,d=0,p=c[0],f=0,m=p.length,g=m-1;f<m;g=f++){var v=p[f],y=p[g],_=v[0]*y[1]-y[0]*v[1];u+=(v[0]+y[0])*_,d+=(v[1]+y[1])*_,h+=3*_}return 0===h?new s(p[0][0],p[0][1],0,c):new s(u/h,d/h,0,c)}(c),T=new s(d+y/2,p+_/2,0,c);T.d>D.d&&(D=T);for(var I=x.length;x.length;){var P=x.pop();P.d>D.d&&(D=P,u&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,I)),!(P.max-D.d<=h)&&(x.push(new s(P.x-(w=P.h/2),P.y-w,w,c)),x.push(new s(P.x+w,P.y-w,w,c)),x.push(new s(P.x-w,P.y+w,w,c)),x.push(new s(P.x+w,P.y+w,w,c)),I+=4)}u&&(console.log("num probes: "+I),console.log("best distance: "+D.d));var R=[D.x,D.y];return R.distance=D.d,R}function r(c,h){return h.max-c.max}function s(c,h,u,d){this.x=c,this.y=h,this.h=u,this.d=function o(c,h,u){for(var d=!1,p=1/0,f=0;f<u.length;f++)for(var m=u[f],g=0,v=m.length,y=v-1;g<v;y=g++){var _=m[g],b=m[y];_[1]>h!=b[1]>h&&c<(b[0]-_[0])*(h-_[1])/(b[1]-_[1])+_[0]&&(d=!d),p=Math.min(p,l(c,h,_,b))}return 0===p?0:(d?1:-1)*Math.sqrt(p)}(c,h,d),this.max=this.d+this.h*Math.SQRT2}function l(c,h,u,d){var p=u[0],f=u[1],m=d[0]-p,g=d[1]-f;if(0!==m||0!==g){var v=((c-p)*m+(h-f)*g)/(m*m+g*g);v>1?(p=d[0],f=d[1]):v>0&&(p+=m*v,f+=g*v)}return(m=c-p)*m+(g=h-f)*g}i.default&&(i=i.default),t.exports=n,t.exports.default=n}),mue=fr((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function i(n){if(null===n||!0===n||!1===n)return NaN;var r=Number(n);return isNaN(r)?r:r<0?Math.ceil(r):Math.floor(r)},t.exports=e.default}),gue=fr((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function i(n){var r=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return r.setUTCFullYear(n.getFullYear()),n.getTime()-r.getTime()},t.exports=e.default}),vue=fr(e=>{(function(){var t=function(){this.init()};t.prototype={init:function(){var u=this||i;return u._counter=1e3,u._html5AudioPool=[],u.html5PoolSize=10,u._codecs={},u._howls=[],u._muted=!1,u._volume=1,u._canPlayEvent="canplaythrough",u._navigator=typeof window<"u"&&window.navigator?window.navigator:null,u.masterGain=null,u.noAudio=!1,u.usingWebAudio=!0,u.autoSuspend=!0,u.ctx=null,u.autoUnlock=!0,u._setup(),u},volume:function(u){var d=this||i;if(u=parseFloat(u),d.ctx||h(),typeof u<"u"&&u>=0&&u<=1){if(d._volume=u,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=d._howls[p]._soundById(f[m]);g&&g._node&&(g._node.volume=g._volume*u)}return d}return d._volume},mute:function(u){var d=this||i;d.ctx||h(),d._muted=u,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u?0:d._volume,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=d._howls[p]._soundById(f[m]);g&&g._node&&(g._node.muted=!!u||g._muted)}return d},stop:function(){for(var u=this||i,d=0;d<u._howls.length;d++)u._howls[d].stop();return u},unload:function(){for(var u=this||i,d=u._howls.length-1;d>=0;d--)u._howls[d].unload();return u.usingWebAudio&&u.ctx&&typeof u.ctx.close<"u"&&(u.ctx.close(),u.ctx=null,h()),u},codecs:function(u){return(this||i)._codecs[u.replace(/^x-/,"")]},_setup:function(){var u=this||i;if(u.state=u.ctx&&u.ctx.state||"suspended",u._autoSuspend(),!u.usingWebAudio)if(typeof Audio<"u")try{typeof(new Audio).oncanplaythrough>"u"&&(u._canPlayEvent="canplay")}catch{u.noAudio=!0}else u.noAudio=!0;try{(new Audio).muted&&(u.noAudio=!0)}catch{}return u.noAudio||u._setupCodecs(),u},_setupCodecs:function(){var u=this||i,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return u}if(!d||"function"!=typeof d.canPlayType)return u;var p=d.canPlayType("audio/mpeg;").replace(/^no$/,""),f=u._navigator?u._navigator.userAgent:"",m=f.match(/OPR\/([0-6].)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,v=-1!==f.indexOf("Safari")&&-1===f.indexOf("Chrome"),y=f.match(/Version\/(.*?) /),_=v&&y&&parseInt(y[1],10)<15;return u._codecs={mp3:!(g||!p&&!d.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!p,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(_||!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(_||!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},u},_unlockAudio:function(){var u=this||i;if(!u._audioUnlocked&&u.ctx){u._audioUnlocked=!1,u.autoUnlock=!1,!u._mobileUnloaded&&44100!==u.ctx.sampleRate&&(u._mobileUnloaded=!0,u.unload()),u._scratchBuffer=u.ctx.createBuffer(1,1,22050);var d=function(p){for(;u._html5AudioPool.length<u.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,u._releaseHtml5Audio(f)}catch{u.noAudio=!0;break}for(var m=0;m<u._howls.length;m++)if(!u._howls[m]._webAudio)for(var g=u._howls[m]._getSoundIds(),v=0;v<g.length;v++){var y=u._howls[m]._soundById(g[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}u._autoResume();var _=u.ctx.createBufferSource();_.buffer=u._scratchBuffer,_.connect(u.ctx.destination),typeof _.start>"u"?_.noteOn(0):_.start(0),"function"==typeof u.ctx.resume&&u.ctx.resume(),_.onended=function(){_.disconnect(0),u._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var b=0;b<u._howls.length;b++)u._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),u}},_obtainHtml5Audio:function(){var u=this||i;if(u._html5AudioPool.length)return u._html5AudioPool.pop();var d=(new Audio).play();return d&&typeof Promise<"u"&&(d instanceof Promise||"function"==typeof d.then)&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(u){var d=this||i;return u._unlocked&&d._html5AudioPool.push(u),d},_autoSuspend:function(){var u=this;if(u.autoSuspend&&u.ctx&&!(typeof u.ctx.suspend>"u")&&i.usingWebAudio){for(var d=0;d<u._howls.length;d++)if(u._howls[d]._webAudio)for(var p=0;p<u._howls[d]._sounds.length;p++)if(!u._howls[d]._sounds[p]._paused)return u;return u._suspendTimer&&clearTimeout(u._suspendTimer),u._suspendTimer=setTimeout(function(){if(u.autoSuspend){u._suspendTimer=null,u.state="suspending";var f=function(){u.state="suspended",u._resumeAfterSuspend&&(delete u._resumeAfterSuspend,u._autoResume())};u.ctx.suspend().then(f,f)}},3e4),u}},_autoResume:function(){var u=this;if(u.ctx&&!(typeof u.ctx.resume>"u")&&i.usingWebAudio)return"running"===u.state&&"interrupted"!==u.ctx.state&&u._suspendTimer?(clearTimeout(u._suspendTimer),u._suspendTimer=null):"suspended"===u.state||"running"===u.state&&"interrupted"===u.ctx.state?(u.ctx.resume().then(function(){u.state="running";for(var d=0;d<u._howls.length;d++)u._howls[d]._emit("resume")}),u._suspendTimer&&(clearTimeout(u._suspendTimer),u._suspendTimer=null)):"suspending"===u.state&&(u._resumeAfterSuspend=!0),u}};var i=new t,n=function(u){u.src&&0!==u.src.length?this.init(u):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(u){var d=this;return i.ctx||h(),d._autoplay=u.autoplay||!1,d._format="string"!=typeof u.format?u.format:[u.format],d._html5=u.html5||!1,d._muted=u.mute||!1,d._loop=u.loop||!1,d._pool=u.pool||5,d._preload="boolean"!=typeof u.preload&&"metadata"!==u.preload||u.preload,d._rate=u.rate||1,d._sprite=u.sprite||{},d._src="string"!=typeof u.src?u.src:[u.src],d._volume=void 0!==u.volume?u.volume:1,d._xhr={method:u.xhr&&u.xhr.method?u.xhr.method:"GET",headers:u.xhr&&u.xhr.headers?u.xhr.headers:null,withCredentials:!(!u.xhr||!u.xhr.withCredentials)&&u.xhr.withCredentials},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=u.onend?[{fn:u.onend}]:[],d._onfade=u.onfade?[{fn:u.onfade}]:[],d._onload=u.onload?[{fn:u.onload}]:[],d._onloaderror=u.onloaderror?[{fn:u.onloaderror}]:[],d._onplayerror=u.onplayerror?[{fn:u.onplayerror}]:[],d._onpause=u.onpause?[{fn:u.onpause}]:[],d._onplay=u.onplay?[{fn:u.onplay}]:[],d._onstop=u.onstop?[{fn:u.onstop}]:[],d._onmute=u.onmute?[{fn:u.onmute}]:[],d._onvolume=u.onvolume?[{fn:u.onvolume}]:[],d._onrate=u.onrate?[{fn:u.onrate}]:[],d._onseek=u.onseek?[{fn:u.onseek}]:[],d._onunlock=u.onunlock?[{fn:u.onunlock}]:[],d._onresume=[],d._webAudio=i.usingWebAudio&&!d._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&"none"!==d._preload&&d.load(),d},load:function(){var u=this,d=null;if(i.noAudio)u._emit("loaderror",null,"No audio support.");else{"string"==typeof u._src&&(u._src=[u._src]);for(var p=0;p<u._src.length;p++){var f,m;if(u._format&&u._format[p])f=u._format[p];else{if("string"!=typeof(m=u._src[p])){u._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(f=/^data:audio\/([^;,]+);/i.exec(m))||(f=/\.([^.]+)$/.exec(m.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&i.codecs(f)){d=u._src[p];break}}if(d)return u._src=d,u._state="loading","https:"===window.location.protocol&&"http:"===d.slice(0,5)&&(u._html5=!0,u._webAudio=!1),new r(u),u._webAudio&&o(u),u;u._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(u,d){var p=this,f=null;if("number"==typeof u)f=u,u=null;else{if("string"==typeof u&&"loaded"===p._state&&!p._sprite[u])return null;if(typeof u>"u"&&(u="__default",!p._playLock)){for(var m=0,g=0;g<p._sounds.length;g++)p._sounds[g]._paused&&!p._sounds[g]._ended&&(m++,f=p._sounds[g]._id);1===m?u=null:f=null}}var v=f?p._soundById(f):p._inactiveSound();if(!v)return null;if(f&&!u&&(u=v._sprite||"__default"),"loaded"!==p._state){v._sprite=u,v._ended=!1;var y=v._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(f&&!v._paused)return d||p._loadQueue("play"),v._id;p._webAudio&&i._autoResume();var _=Math.max(0,v._seek>0?v._seek:p._sprite[u][0]/1e3),b=Math.max(0,(p._sprite[u][0]+p._sprite[u][1])/1e3-_),w=1e3*b/Math.abs(v._rate),C=p._sprite[u][0]/1e3,x=(p._sprite[u][0]+p._sprite[u][1])/1e3;v._sprite=u,v._ended=!1;var S=function(){v._paused=!1,v._seek=_,v._start=C,v._stop=x,v._loop=!(!v._loop&&!p._sprite[u][2])};if(!(_>=x)){var E=v._node;if(p._webAudio){var D=function(){p._playLock=!1,S(),p._refreshBuffer(v),E.gain.setValueAtTime(v._muted||p._muted?0:v._volume,i.ctx.currentTime),v._playStart=i.ctx.currentTime,typeof E.bufferSource.start>"u"?E.bufferSource.noteGrainOn(0,_,v._loop?86400:b):E.bufferSource.start(0,_,v._loop?86400:b),w!==1/0&&(p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),w)),d||setTimeout(function(){p._emit("play",v._id),p._loadQueue()},0)};"running"===i.state&&"interrupted"!==i.ctx.state?D():(p._playLock=!0,p.once("resume",D),p._clearTimer(v._id))}else{var T=function(){E.currentTime=_,E.muted=v._muted||p._muted||i._muted||E.muted,E.volume=v._volume*i.volume(),E.playbackRate=v._rate;try{var R=E.play();if(R&&typeof Promise<"u"&&(R instanceof Promise||"function"==typeof R.then)?(p._playLock=!0,S(),R.then(function(){p._playLock=!1,E._unlocked=!0,d?p._loadQueue():p._emit("play",v._id)}).catch(function(){p._playLock=!1,p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):d||(p._playLock=!1,S(),p._emit("play",v._id)),E.playbackRate=v._rate,E.paused)return void p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==u||v._loop?p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),w):(p._endTimers[v._id]=function(){p._ended(v),E.removeEventListener("ended",p._endTimers[v._id],!1)},E.addEventListener("ended",p._endTimers[v._id],!1))}catch(L){p._emit("playerror",v._id,L)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===E.src&&(E.src=p._src,E.load());var I=window&&window.ejecta||!E.readyState&&i._navigator.isCocoonJS;if(E.readyState>=3||I)T();else{p._playLock=!0,p._state="loading";var P=function(){p._state="loaded",T(),E.removeEventListener(i._canPlayEvent,P,!1)};E.addEventListener(i._canPlayEvent,P,!1),p._clearTimer(v._id)}}return v._id}p._ended(v)},pause:function(u){var d=this;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(u)}}),d;for(var p=d._getSoundIds(u),f=0;f<p.length;f++){d._clearTimer(p[f]);var m=d._soundById(p[f]);if(m&&!m._paused&&(m._seek=d.seek(p[f]),m._rateSeek=0,m._paused=!0,d._stopFade(p[f]),m._node))if(d._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||d._emit("pause",m?m._id:null)}return d},stop:function(u,d){var p=this;if("loaded"!==p._state||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(u)}}),p;for(var f=p._getSoundIds(u),m=0;m<f.length;m++){p._clearTimer(f[m]);var g=p._soundById(f[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,p._stopFade(f[m]),g._node&&(p._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),p._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&p._clearSound(g._node))),d||p._emit("stop",g._id))}return p},mute:function(u,d){var p=this;if("loaded"!==p._state||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(u,d)}}),p;if(typeof d>"u"){if("boolean"!=typeof u)return p._muted;p._muted=u}for(var f=p._getSoundIds(d),m=0;m<f.length;m++){var g=p._soundById(f[m]);g&&(g._muted=u,g._interval&&p._stopFade(g._id),p._webAudio&&g._node?g._node.gain.setValueAtTime(u?0:g._volume,i.ctx.currentTime):g._node&&(g._node.muted=!!i._muted||u),p._emit("mute",g._id))}return p},volume:function(){var p,f,v,u=this,d=arguments;if(0===d.length)return u._volume;if(1===d.length||2===d.length&&typeof d[1]>"u"?u._getSoundIds().indexOf(d[0])>=0?f=parseInt(d[0],10):p=parseFloat(d[0]):d.length>=2&&(p=parseFloat(d[0]),f=parseInt(d[1],10)),!(typeof p<"u"&&p>=0&&p<=1))return(v=f?u._soundById(f):u._sounds[0])?v._volume:0;if("loaded"!==u._state||u._playLock)return u._queue.push({event:"volume",action:function(){u.volume.apply(u,d)}}),u;typeof f>"u"&&(u._volume=p),f=u._getSoundIds(f);for(var y=0;y<f.length;y++)(v=u._soundById(f[y]))&&(v._volume=p,d[2]||u._stopFade(f[y]),u._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(p,i.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=p*i.volume()),u._emit("volume",v._id));return u},fade:function(u,d,p,f){var m=this;if("loaded"!==m._state||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(u,d,p,f)}}),m;u=Math.min(Math.max(0,parseFloat(u)),1),d=Math.min(Math.max(0,parseFloat(d)),1),p=parseFloat(p),m.volume(u,f);for(var g=m._getSoundIds(f),v=0;v<g.length;v++){var y=m._soundById(g[v]);if(y){if(f||m._stopFade(g[v]),m._webAudio&&!y._muted){var _=i.ctx.currentTime,b=_+p/1e3;y._volume=u,y._node.gain.setValueAtTime(u,_),y._node.gain.linearRampToValueAtTime(d,b)}m._startFadeInterval(y,u,d,p,g[v],typeof f>"u")}}return m},_startFadeInterval:function(u,d,p,f,m,g){var v=this,y=d,_=p-d,b=Math.abs(_/.01),w=Math.max(4,b>0?f/b:f),C=Date.now();u._fadeTo=p,u._interval=setInterval(function(){var x=(Date.now()-C)/f;C=Date.now(),y+=_*x,y=Math.round(100*y)/100,y=_<0?Math.max(p,y):Math.min(p,y),v._webAudio?u._volume=y:v.volume(y,u._id,!0),g&&(v._volume=y),(p<d&&y<=p||p>d&&y>=p)&&(clearInterval(u._interval),u._interval=null,u._fadeTo=null,v.volume(p,u._id),v._emit("fade",u._id))},w)},_stopFade:function(u){var d=this,p=d._soundById(u);return p&&p._interval&&(d._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,d.volume(p._fadeTo,u),p._fadeTo=null,d._emit("fade",u)),d},loop:function(){var p,f,m,u=this,d=arguments;if(0===d.length)return u._loop;if(1===d.length){if("boolean"!=typeof d[0])return!!(m=u._soundById(parseInt(d[0],10)))&&m._loop;u._loop=p=d[0]}else 2===d.length&&(p=d[0],f=parseInt(d[1],10));for(var g=u._getSoundIds(f),v=0;v<g.length;v++)(m=u._soundById(g[v]))&&(m._loop=p,u._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=p,p&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,u.playing(g[v])&&(u.pause(g[v],!0),u.play(g[v],!0)))));return u},rate:function(){var p,f,v,u=this,d=arguments;if(0===d.length?f=u._sounds[0]._id:1===d.length?u._getSoundIds().indexOf(d[0])>=0?f=parseInt(d[0],10):p=parseFloat(d[0]):2===d.length&&(p=parseFloat(d[0]),f=parseInt(d[1],10)),"number"!=typeof p)return(v=u._soundById(f))?v._rate:u._rate;if("loaded"!==u._state||u._playLock)return u._queue.push({event:"rate",action:function(){u.rate.apply(u,d)}}),u;typeof f>"u"&&(u._rate=p),f=u._getSoundIds(f);for(var y=0;y<f.length;y++)if(v=u._soundById(f[y])){u.playing(f[y])&&(v._rateSeek=u.seek(f[y]),v._playStart=u._webAudio?i.ctx.currentTime:v._playStart),v._rate=p,u._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):v._node&&(v._node.playbackRate=p);var _=u.seek(f[y]),w=1e3*((u._sprite[v._sprite][0]+u._sprite[v._sprite][1])/1e3-_)/Math.abs(v._rate);(u._endTimers[f[y]]||!v._paused)&&(u._clearTimer(f[y]),u._endTimers[f[y]]=setTimeout(u._ended.bind(u,v),w)),u._emit("rate",v._id)}return u},seek:function(){var p,f,u=this,d=arguments;if(0===d.length?u._sounds.length&&(f=u._sounds[0]._id):1===d.length?u._getSoundIds().indexOf(d[0])>=0?f=parseInt(d[0],10):u._sounds.length&&(f=u._sounds[0]._id,p=parseFloat(d[0])):2===d.length&&(p=parseFloat(d[0]),f=parseInt(d[1],10)),typeof f>"u")return 0;if("number"==typeof p&&("loaded"!==u._state||u._playLock))return u._queue.push({event:"seek",action:function(){u.seek.apply(u,d)}}),u;var v=u._soundById(f);if(v){if(!("number"==typeof p&&p>=0)){if(u._webAudio){var w=u.playing(f)?i.ctx.currentTime-v._playStart:0;return v._seek+((v._rateSeek?v._rateSeek-v._seek:0)+w*Math.abs(v._rate))}return v._node.currentTime}var y=u.playing(f);y&&u.pause(f,!0),v._seek=p,v._ended=!1,u._clearTimer(f),!u._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=p);var _=function(){y&&u.play(f,!0),u._emit("seek",f)};if(y&&!u._webAudio){var b=function(){u._playLock?setTimeout(b,0):_()};setTimeout(b,0)}else _()}return u},playing:function(u){var d=this;if("number"==typeof u){var p=d._soundById(u);return!!p&&!p._paused}for(var f=0;f<d._sounds.length;f++)if(!d._sounds[f]._paused)return!0;return!1},duration:function(u){var d=this,p=d._duration,f=d._soundById(u);return f&&(p=d._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var u=this,d=u._sounds,p=0;p<d.length;p++)d[p]._paused||u.stop(d[p]._id),u._webAudio||(u._clearSound(d[p]._node),d[p]._node.removeEventListener("error",d[p]._errorFn,!1),d[p]._node.removeEventListener(i._canPlayEvent,d[p]._loadFn,!1),d[p]._node.removeEventListener("ended",d[p]._endFn,!1),i._releaseHtml5Audio(d[p]._node)),delete d[p]._node,u._clearTimer(d[p]._id);var f=i._howls.indexOf(u);f>=0&&i._howls.splice(f,1);var m=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===u._src||u._src.indexOf(i._howls[p]._src)>=0){m=!1;break}return s&&m&&delete s[u._src],i.noAudio=!1,u._state="unloaded",u._sounds=[],u=null,null},on:function(u,d,p,f){return"function"==typeof d&&this["_on"+u].push(f?{id:p,fn:d,once:f}:{id:p,fn:d}),this},off:function(u,d,p){var f=this,m=f["_on"+u],g=0;if("number"==typeof d&&(p=d,d=null),d||p)for(g=0;g<m.length;g++){var v=p===m[g].id;if(d===m[g].fn&&v||!d&&v){m.splice(g,1);break}}else if(u)f["_on"+u]=[];else{var y=Object.keys(f);for(g=0;g<y.length;g++)0===y[g].indexOf("_on")&&Array.isArray(f[y[g]])&&(f[y[g]]=[])}return f},once:function(u,d,p){return this.on(u,d,p,1),this},_emit:function(u,d,p){for(var f=this,m=f["_on"+u],g=m.length-1;g>=0;g--)(!m[g].id||m[g].id===d||"load"===u)&&(setTimeout(function(v){v.call(this,d,p)}.bind(f,m[g].fn),0),m[g].once&&f.off(u,m[g].fn,m[g].id));return f._loadQueue(u),f},_loadQueue:function(u){var d=this;if(d._queue.length>0){var p=d._queue[0];p.event===u&&(d._queue.shift(),d._loadQueue()),u||p.action()}return d},_ended:function(u){var d=this,p=u._sprite;if(!d._webAudio&&u._node&&!u._node.paused&&!u._node.ended&&u._node.currentTime<u._stop)return setTimeout(d._ended.bind(d,u),100),d;var f=!(!u._loop&&!d._sprite[p][2]);if(d._emit("end",u._id),!d._webAudio&&f&&d.stop(u._id,!0).play(u._id),d._webAudio&&f){d._emit("play",u._id),u._seek=u._start||0,u._rateSeek=0,u._playStart=i.ctx.currentTime;var m=1e3*(u._stop-u._start)/Math.abs(u._rate);d._endTimers[u._id]=setTimeout(d._ended.bind(d,u),m)}return d._webAudio&&!f&&(u._paused=!0,u._ended=!0,u._seek=u._start||0,u._rateSeek=0,d._clearTimer(u._id),d._cleanBuffer(u._node),i._autoSuspend()),!d._webAudio&&!f&&d.stop(u._id,!0),d},_clearTimer:function(u){var d=this;if(d._endTimers[u]){if("function"!=typeof d._endTimers[u])clearTimeout(d._endTimers[u]);else{var p=d._soundById(u);p&&p._node&&p._node.removeEventListener("ended",d._endTimers[u],!1)}delete d._endTimers[u]}return d},_soundById:function(u){for(var d=this,p=0;p<d._sounds.length;p++)if(u===d._sounds[p]._id)return d._sounds[p];return null},_inactiveSound:function(){var u=this;u._drain();for(var d=0;d<u._sounds.length;d++)if(u._sounds[d]._ended)return u._sounds[d].reset();return new r(u)},_drain:function(){var u=this,d=u._pool,p=0,f=0;if(!(u._sounds.length<d)){for(f=0;f<u._sounds.length;f++)u._sounds[f]._ended&&p++;for(f=u._sounds.length-1;f>=0;f--){if(p<=d)return;u._sounds[f]._ended&&(u._webAudio&&u._sounds[f]._node&&u._sounds[f]._node.disconnect(0),u._sounds.splice(f,1),p--)}}},_getSoundIds:function(u){if(typeof u>"u"){for(var p=[],f=0;f<this._sounds.length;f++)p.push(this._sounds[f]._id);return p}return[u]},_refreshBuffer:function(u){return u._node.bufferSource=i.ctx.createBufferSource(),u._node.bufferSource.buffer=s[this._src],u._node.bufferSource.connect(u._panner?u._panner:u._node),u._node.bufferSource.loop=u._loop,u._loop&&(u._node.bufferSource.loopStart=u._start||0,u._node.bufferSource.loopEnd=u._stop||0),u._node.bufferSource.playbackRate.setValueAtTime(u._rate,i.ctx.currentTime),this},_cleanBuffer:function(u){var p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&u.bufferSource&&(u.bufferSource.onended=null,u.bufferSource.disconnect(0),p))try{u.bufferSource.buffer=i._scratchBuffer}catch{}return u.bufferSource=null,this},_clearSound:function(u){/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent)||(u.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(u){this._parent=u,this.init()};r.prototype={init:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++i._counter,d._sounds.push(u),u.create(),u},create:function(){var u=this,d=u._parent,p=i._muted||u._muted||u._parent._muted?0:u._volume;return d._webAudio?(u._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),u._node.gain.setValueAtTime(p,i.ctx.currentTime),u._node.paused=!0,u._node.connect(i.masterGain)):i.noAudio||(u._node=i._obtainHtml5Audio(),u._errorFn=u._errorListener.bind(u),u._node.addEventListener("error",u._errorFn,!1),u._loadFn=u._loadListener.bind(u),u._node.addEventListener(i._canPlayEvent,u._loadFn,!1),u._endFn=u._endListener.bind(u),u._node.addEventListener("ended",u._endFn,!1),u._node.src=d._src,u._node.preload=!0===d._preload?"auto":d._preload,u._node.volume=p*i.volume(),u._node.load()),u},reset:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._rateSeek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++i._counter,u},_errorListener:function(){var u=this;u._parent._emit("loaderror",u._id,u._node.error?u._node.error.code:0),u._node.removeEventListener("error",u._errorFn,!1)},_loadListener:function(){var u=this,d=u._parent;d._duration=Math.ceil(10*u._node.duration)/10,0===Object.keys(d._sprite).length&&(d._sprite={__default:[0,1e3*d._duration]}),"loaded"!==d._state&&(d._state="loaded",d._emit("load"),d._loadQueue()),u._node.removeEventListener(i._canPlayEvent,u._loadFn,!1)},_endListener:function(){var u=this,d=u._parent;d._duration===1/0&&(d._duration=Math.ceil(10*u._node.duration)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=1e3*d._duration),d._ended(u)),u._node.removeEventListener("ended",u._endFn,!1)}};var s={},o=function(u){var d=u._src;if(s[d])return u._duration=s[d].duration,void c(u);if(/^data:[^;]+;base64,/.test(d)){for(var p=atob(d.split(",")[1]),f=new Uint8Array(p.length),m=0;m<p.length;++m)f[m]=p.charCodeAt(m);l(f.buffer,u)}else{var g=new XMLHttpRequest;g.open(u._xhr.method,d,!0),g.withCredentials=u._xhr.withCredentials,g.responseType="arraybuffer",u._xhr.headers&&Object.keys(u._xhr.headers).forEach(function(v){g.setRequestHeader(v,u._xhr.headers[v])}),g.onload=function(){var v=(g.status+"")[0];"0"===v||"2"===v||"3"===v?l(g.response,u):u._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".")},g.onerror=function(){u._webAudio&&(u._html5=!0,u._webAudio=!1,u._sounds=[],delete s[d],u.load())},a(g)}},a=function(u){try{u.send()}catch{u.onerror()}},l=function(u,d){var p=function(){d._emit("loaderror",null,"Decoding audio data failed.")},f=function(m){m&&d._sounds.length>0?(s[d._src]=m,c(d,m)):p()};typeof Promise<"u"&&1===i.ctx.decodeAudioData.length?i.ctx.decodeAudioData(u).then(f).catch(p):i.ctx.decodeAudioData(u,f,p)},c=function(u,d){d&&!u._duration&&(u._duration=d.duration),0===Object.keys(u._sprite).length&&(u._sprite={__default:[0,1e3*u._duration]}),"loaded"!==u._state&&(u._state="loaded",u._emit("load"),u._loadQueue())},h=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var u=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),d=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=d?parseInt(d[1],10):null;if(u&&p&&p<9){var f=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!f&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};"function"==typeof define&&define.amd&&define([],function(){return{Howler:i,Howl:n}}),typeof e<"u"&&(e.Howler=i,e.Howl=n),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=i,global.Howl=n,global.Sound=r):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=i,window.Howl=n,window.Sound=r)})(),function(){var i;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var r=n._howls.length-1;r>=0;r--)n._howls[r].stereo(i);return n},HowlerGlobal.prototype.pos=function(i,n,r){var s=this;return s.ctx&&s.ctx.listener?"number"!=typeof i?s._pos:(s._pos=[i,n="number"!=typeof n?s._pos[1]:n,r="number"!=typeof r?s._pos[2]:r],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]),s):s},HowlerGlobal.prototype.orientation=function(i,n,r,s,o,a){var l=this;if(!l.ctx||!l.ctx.listener)return l;var c=l._orientation;return"number"!=typeof i?c:(l._orientation=[i,n="number"!=typeof n?c[1]:n,r="number"!=typeof r?c[2]:r,s="number"!=typeof s?c[3]:s,o="number"!=typeof o?c[4]:o,a="number"!=typeof a?c[5]:a],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(a,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(i,n,r,s,o,a),l)},Howl.prototype.init=(i=Howl.prototype.init,function(n){var r=this;return r._orientation=n.orientation||[1,0,0],r._stereo=n.stereo||null,r._pos=n.pos||null,r._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},r._onstereo=n.onstereo?[{fn:n.onstereo}]:[],r._onpos=n.onpos?[{fn:n.onpos}]:[],r._onorientation=n.onorientation?[{fn:n.onorientation}]:[],i.call(this,n)}),Howl.prototype.stereo=function(i,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(i,n)}}),r;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u"){if("number"!=typeof i)return r._stereo;r._stereo=i,r._pos=[i,0,0]}for(var o=r._getSoundIds(n),a=0;a<o.length;a++){var l=r._soundById(o[a]);if(l){if("number"!=typeof i)return l._stereo;l._stereo=i,l._pos=[i,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&t(l,s),"spatial"===s?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(i,0,0):l._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),r._emit("stereo",l._id)}}return r},Howl.prototype.pos=function(i,n,r,s){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(i,n,r,s)}}),o;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,typeof s>"u"){if("number"!=typeof i)return o._pos;o._pos=[i,n,r]}for(var a=o._getSoundIds(s),l=0;l<a.length;l++){var c=o._soundById(a[l]);if(c){if("number"!=typeof i)return c._pos;c._pos=[i,n,r],c._node&&((!c._panner||c._panner.pan)&&t(c,"spatial"),typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):c._panner.setPosition(i,n,r)),o._emit("pos",c._id)}}return o},Howl.prototype.orientation=function(i,n,r,s){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(i,n,r,s)}}),o;if(n="number"!=typeof n?o._orientation[1]:n,r="number"!=typeof r?o._orientation[2]:r,typeof s>"u"){if("number"!=typeof i)return o._orientation;o._orientation=[i,n,r]}for(var a=o._getSoundIds(s),l=0;l<a.length;l++){var c=o._soundById(a[l]);if(c){if("number"!=typeof i)return c._orientation;c._orientation=[i,n,r],c._node&&(c._panner||(c._pos||(c._pos=o._pos||[0,0,-.5]),t(c,"spatial")),typeof c._panner.orientationX<"u"?(c._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):c._panner.setOrientation(i,n,r)),o._emit("orientation",c._id)}}return o},Howl.prototype.pannerAttr=function(){var r,s,o,i=this,n=arguments;if(!i._webAudio)return i;if(0===n.length)return i._pannerAttr;if(1===n.length){if("object"!=typeof n[0])return(o=i._soundById(parseInt(n[0],10)))?o._pannerAttr:i._pannerAttr;r=n[0],typeof s>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),i._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:i._panningModel})}else 2===n.length&&(r=n[0],s=parseInt(n[1],10));for(var a=i._getSoundIds(s),l=0;l<a.length;l++)if(o=i._soundById(a[l])){var c=o._pannerAttr;c={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:c.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:c.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:c.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:c.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:c.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:c.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:c.panningModel};var h=o._panner;h?(h.coneInnerAngle=c.coneInnerAngle,h.coneOuterAngle=c.coneOuterAngle,h.coneOuterGain=c.coneOuterGain,h.distanceModel=c.distanceModel,h.maxDistance=c.maxDistance,h.refDistance=c.refDistance,h.rolloffFactor=c.rolloffFactor,h.panningModel=c.panningModel):(o._pos||(o._pos=i._pos||[0,0,-.5]),t(o,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var n=this,r=n._parent;n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,i.call(this),n._stereo?r.stereo(n._stereo):n._pos&&r.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var n=this,r=n._parent;return n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,n._stereo?r.stereo(n._stereo):n._pos?r.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,r._refreshBuffer(n)),i.call(this)}}(Sound.prototype.reset);var t=function(i,n){"spatial"===(n=n||"spatial")?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),yue=fr((e,t)=>{t.exports=function i(n){for(var r=new Array(n),s=0;s<n;++s)r[s]=s;return r}}),_ue=fr((e,t)=>{function i(r){return!!r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}t.exports=function(r){return null!=r&&(i(r)||function n(r){return"function"==typeof r.readFloatLE&&"function"==typeof r.slice&&i(r.slice(0,0))}(r)||!!r._isBuffer)}}),fg=fr((e,t)=>{var i=yue(),n=_ue(),r=typeof Float64Array<"u";function s(u,d){return u[0]-d[0]}function o(){var p,u=this.stride,d=new Array(u.length);for(p=0;p<d.length;++p)d[p]=[Math.abs(u[p]),p];d.sort(s);var f=new Array(d.length);for(p=0;p<f.length;++p)f[p]=d[p][1];return f}function a(u,d){var p=["View",d,"d",u].join("");d<0&&(p="View_Nil"+u);var f="generic"===u;if(-1===d){var m="function "+p+"(a){this.data=a;};var proto="+p+".prototype;proto.dtype='"+u+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+p+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+p+"(a){return new "+p+"(a);}";return new Function(m)()}if(0===d)return m="function "+p+"(a,d) {this.data = a;this.offset = d};var proto="+p+".prototype;proto.dtype='"+u+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+p+"_copy() {return new "+p+"(this.data,this.offset)};proto.pick=function "+p+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+p+"_get(){return "+(f?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+p+"_set(v){return "+(f?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+p+"(a,b,c,d){return new "+p+"(a,d)}",new Function("TrivialArray",m)(c[u][0]);m=["'use strict'"];var g=i(d),v=g.map(function(T){return"i"+T}),y="this.offset+"+g.map(function(T){return"this.stride["+T+"]*i"+T}).join("+"),_=g.map(function(T){return"b"+T}).join(","),b=g.map(function(T){return"c"+T}).join(",");m.push("function "+p+"(a,"+_+","+b+",d){this.data=a","this.shape=["+_+"]","this.stride=["+b+"]","this.offset=d|0}","var proto="+p+".prototype","proto.dtype='"+u+"'","proto.dimension="+d),m.push("Object.defineProperty(proto,'size',{get:function "+p+"_size(){return "+g.map(function(T){return"this.shape["+T+"]"}).join("*"),"}})"),1===d?m.push("proto.order=[0]"):(m.push("Object.defineProperty(proto,'order',{get:"),d<4?(m.push("function "+p+"_order(){"),2===d?m.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&m.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):m.push("ORDER})")),m.push("proto.set=function "+p+"_set("+v.join(",")+",v){"),m.push(f?"return this.data.set("+y+",v)}":"return this.data["+y+"]=v}"),m.push("proto.get=function "+p+"_get("+v.join(",")+"){"),m.push(f?"return this.data.get("+y+")}":"return this.data["+y+"]}"),m.push("proto.index=function "+p+"_index(",v.join(),"){return "+y+"}"),m.push("proto.hi=function "+p+"_hi("+v.join(",")+"){return new "+p+"(this.data,"+g.map(function(T){return["(typeof i",T,"!=='number'||i",T,"<0)?this.shape[",T,"]:i",T,"|0"].join("")}).join(",")+","+g.map(function(T){return"this.stride["+T+"]"}).join(",")+",this.offset)}");var w=g.map(function(T){return"a"+T+"=this.shape["+T+"]"}),C=g.map(function(T){return"c"+T+"=this.stride["+T+"]"});m.push("proto.lo=function "+p+"_lo("+v.join(",")+"){var b=this.offset,d=0,"+w.join(",")+","+C.join(","));for(var x=0;x<d;++x)m.push("if(typeof i"+x+"==='number'&&i"+x+">=0){d=i"+x+"|0;b+=c"+x+"*d;a"+x+"-=d}");for(m.push("return new "+p+"(this.data,"+g.map(function(T){return"a"+T}).join(",")+","+g.map(function(T){return"c"+T}).join(",")+",b)}"),m.push("proto.step=function "+p+"_step("+v.join(",")+"){var "+g.map(function(T){return"a"+T+"=this.shape["+T+"]"}).join(",")+","+g.map(function(T){return"b"+T+"=this.stride["+T+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),x=0;x<d;++x)m.push("if(typeof i"+x+"==='number'){d=i"+x+"|0;if(d<0){c+=b"+x+"*(a"+x+"-1);a"+x+"=ceil(-a"+x+"/d)}else{a"+x+"=ceil(a"+x+"/d)}b"+x+"*=d}");m.push("return new "+p+"(this.data,"+g.map(function(T){return"a"+T}).join(",")+","+g.map(function(T){return"b"+T}).join(",")+",c)}");var S=new Array(d),E=new Array(d);for(x=0;x<d;++x)S[x]="a[i"+x+"]",E[x]="b[i"+x+"]";for(m.push("proto.transpose=function "+p+"_transpose("+v+"){"+v.map(function(T,I){return T+"=("+T+"===undefined?"+I+":"+T+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+p+"(this.data,"+S.join(",")+","+E.join(",")+",this.offset)}"),m.push("proto.pick=function "+p+"_pick("+v+"){var a=[],b=[],c=this.offset"),x=0;x<d;++x)m.push("if(typeof i"+x+"==='number'&&i"+x+">=0){c=(c+this.stride["+x+"]*i"+x+")|0}else{a.push(this.shape["+x+"]);b.push(this.stride["+x+"])}");return m.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),m.push("return function construct_"+p+"(data,shape,stride,offset){return new "+p+"(data,"+g.map(function(T){return"shape["+T+"]"}).join(",")+","+g.map(function(T){return"stride["+T+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",m.join("\n"))(c[u],o)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function h(u,d,p,f){if(void 0===u)return(0,c.array[0])([]);"number"==typeof u&&(u=[u]),void 0===d&&(d=[u.length]);var m=d.length;if(void 0===p){p=new Array(m);for(var g=m-1,v=1;g>=0;--g)p[g]=v,v*=d[g]}if(void 0===f)for(f=0,g=0;g<m;++g)p[g]<0&&(f-=(d[g]-1)*p[g]);for(var y=function l(u){if(n(u))return"buffer";if(r)switch(Object.prototype.toString.call(u)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(u)?"array":"generic"}(u),_=c[y];_.length<=m+1;)_.push(a(y,_.length-1));return(0,_[m+1])(u,d,p,f)}}),bue=fr((e,t)=>{t.exports=function r(s,o,a){return 0===s.length?s:o?(a||s.sort(o),function i(s,o){for(var a=1,l=s.length,c=s[0],h=s[0],u=1;u<l;++u)if(h=c,o(c=s[u],h)){if(u===a){a++;continue}s[a++]=c}return s.length=a,s}(s,o)):(a||s.sort(),function n(s){for(var o=1,a=s.length,l=s[0],c=s[0],h=1;h<a;++h,c=l)if(c=l,(l=s[h])!==c){if(h===o){o++;continue}s[o++]=l}return s.length=o,s}(s))}}),wue=fr((e,t)=>{var i=bue();function n(c,h,u){var _,b,d=c.length,p=h.arrayArgs.length,f=h.indexArgs.length>0,m=[],g=[],v=0,y=0;for(_=0;_<d;++_)g.push(["i",_,"=0"].join(""));for(b=0;b<p;++b)for(_=0;_<d;++_)y=v,v=c[_],g.push(0===_?["d",b,"s",_,"=t",b,"p",v].join(""):["d",b,"s",_,"=(t",b,"p",v,"-s",y,"*t",b,"p",y,")"].join(""));for(g.length>0&&m.push("var "+g.join(",")),_=d-1;_>=0;--_)m.push(["for(i",_,"=0;i",_,"<s",v=c[_],";++i",_,"){"].join(""));for(m.push(u),_=0;_<d;++_){for(y=v,v=c[_],b=0;b<p;++b)m.push(["p",b,"+=d",b,"s",_].join(""));f&&(_>0&&m.push(["index[",y,"]-=s",y].join("")),m.push(["++index[",v,"]"].join(""))),m.push("}")}return m.join("\n")}function o(c,h,u){for(var d=c.body,p=[],f=[],m=0;m<c.args.length;++m){var g=c.args[m];if(!(g.count<=0)){var v=new RegExp(g.name,"g"),y="",_=h.arrayArgs.indexOf(m);switch(h.argTypes[m]){case"offset":var b=h.offsetArgIndex.indexOf(m);_=h.offsetArgs[b].array,y="+q"+b;case"array":y="p"+_+y;var C="l"+m,x="a"+_;if(0===h.arrayBlockIndices[_])1===g.count?"generic"===u[_]?g.lvalue?(p.push(["var ",C,"=",x,".get(",y,")"].join("")),d=d.replace(v,C),f.push([x,".set(",y,",",C,")"].join(""))):d=d.replace(v,[x,".get(",y,")"].join("")):d=d.replace(v,[x,"[",y,"]"].join("")):"generic"===u[_]?(p.push(["var ",C,"=",x,".get(",y,")"].join("")),d=d.replace(v,C),g.lvalue&&f.push([x,".set(",y,",",C,")"].join(""))):(p.push(["var ",C,"=",x,"[",y,"]"].join("")),d=d.replace(v,C),g.lvalue&&f.push([x,"[",y,"]=",C].join("")));else{for(var S=[g.name],E=[y],D=0;D<Math.abs(h.arrayBlockIndices[_]);D++)S.push("\\s*\\[([^\\]]+)\\]"),E.push("$"+(D+1)+"*t"+_+"b"+D);if(v=new RegExp(S.join(""),"g"),y=E.join("+"),"generic"===u[_])throw new Error("cwise: Generic arrays not supported in combination with blocks!");d=d.replace(v,[x,"[",y,"]"].join(""))}break;case"scalar":d=d.replace(v,"Y"+h.scalarArgs.indexOf(m));break;case"index":d=d.replace(v,"index");break;case"shape":d=d.replace(v,"shape")}}}return[p.join("\n"),d,f.join("\n")].join("\n").trim()}function a(c){for(var h=new Array(c.length),u=!0,d=0;d<c.length;++d){var p=c[d],f=p.match(/\d+/);f=f?f[0]:"",h[d]=0===p.charAt(0)?"u"+p.charAt(1)+f:p.charAt(0)+f,d>0&&(u=u&&h[d]===h[d-1])}return u?h[0]:h.join("")}t.exports=function l(c,h){for(var u=h[1].length-Math.abs(c.arrayBlockIndices[0])|0,d=new Array(c.arrayArgs.length),p=new Array(c.arrayArgs.length),f=0;f<c.arrayArgs.length;++f)p[f]=h[2*f],d[f]=h[2*f+1];var m=[],g=[],v=[],y=[],_=[];for(f=0;f<c.arrayArgs.length;++f){c.arrayBlockIndices[f]<0?(v.push(0),y.push(u),m.push(u),g.push(u+c.arrayBlockIndices[f])):(v.push(c.arrayBlockIndices[f]),y.push(c.arrayBlockIndices[f]+u),m.push(0),g.push(c.arrayBlockIndices[f]));for(var b=[],w=0;w<d[f].length;w++)v[f]<=d[f][w]&&d[f][w]<y[f]&&b.push(d[f][w]-v[f]);_.push(b)}var C=["SS"],x=["'use strict'"],S=[];for(w=0;w<u;++w)S.push(["s",w,"=SS[",w,"]"].join(""));for(f=0;f<c.arrayArgs.length;++f){for(C.push("a"+f),C.push("t"+f),C.push("p"+f),w=0;w<u;++w)S.push(["t",f,"p",w,"=t",f,"[",v[f]+w,"]"].join(""));for(w=0;w<Math.abs(c.arrayBlockIndices[f]);++w)S.push(["t",f,"b",w,"=t",f,"[",m[f]+w,"]"].join(""))}for(f=0;f<c.scalarArgs.length;++f)C.push("Y"+f);if(c.shapeArgs.length>0&&S.push("shape=SS.slice(0)"),c.indexArgs.length>0){var E=new Array(u);for(f=0;f<u;++f)E[f]="0";S.push(["index=[",E.join(","),"]"].join(""))}for(f=0;f<c.offsetArgs.length;++f){var D=c.offsetArgs[f],T=[];for(w=0;w<D.offset.length;++w)0!==D.offset[w]&&T.push(1===D.offset[w]?["t",D.array,"p",w].join(""):[D.offset[w],"*t",D.array,"p",w].join(""));S.push(0===T.length?"q"+f+"=0":["q",f,"=",T.join("+")].join(""))}var I=i([].concat(c.pre.thisVars).concat(c.body.thisVars).concat(c.post.thisVars));for((S=S.concat(I)).length>0&&x.push("var "+S.join(",")),f=0;f<c.arrayArgs.length;++f)x.push("p"+f+"|=0");c.pre.body.length>3&&x.push(o(c.pre,c,p));var P=o(c.body,c,p),R=function s(c){for(var h=0,u=c[0].length;h<u;){for(var d=1;d<c.length;++d)if(c[d][h]!==c[0][h])return h;++h}return h}(_);x.push(R<u?function r(c,h,u,d){for(var p=h.length,f=u.arrayArgs.length,m=u.blockSize,g=u.indexArgs.length>0,v=[],y=0;y<f;++y)v.push(["var offset",y,"=p",y].join(""));for(y=c;y<p;++y)v.push(["for(var j"+y+"=SS[",h[y],"]|0;j",y,">0;){"].join("")),v.push(["if(j",y,"<",m,"){"].join("")),v.push(["s",h[y],"=j",y].join("")),v.push(["j",y,"=0"].join("")),v.push(["}else{s",h[y],"=",m].join("")),v.push(["j",y,"-=",m,"}"].join("")),g&&v.push(["index[",h[y],"]=j",y].join(""));for(y=0;y<f;++y){for(var _=["offset"+y],b=c;b<p;++b)_.push(["j",b,"*t",y,"p",h[b]].join(""));v.push(["p",y,"=(",_.join("+"),")"].join(""))}for(v.push(n(h,u,d)),y=c;y<p;++y)v.push("}");return v.join("\n")}(R,_[0],c,P):n(_[0],c,P)),c.post.body.length>3&&x.push(o(c.post,c,p)),c.debug&&console.log("-----Generated cwise routine for ",h,":\n"+x.join("\n")+"\n----------");var L=[c.funcName||"unnamed","_cwise_loop_",d[0].join("s"),"m",R,a(p)].join("");return new Function(["function ",L,"(",C.join(","),"){",x.join("\n"),"} return ",L].join(""))()}}),xue=fr((e,t)=>{var i=wue();t.exports=function n(r){var s=["'use strict'","var CACHED={}"],o=[];s.push(["return function ",r.funcName+"_cwise_thunk","(",r.shimArgs.join(","),"){"].join(""));for(var l=[],c=[],h=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],u=[],d=[],p=0;p<r.arrayArgs.length;++p){var f=r.arrayArgs[p];o.push(["t",f,"=array",f,".dtype,","r",f,"=array",f,".order"].join("")),l.push("t"+f),l.push("r"+f),c.push("t"+f),c.push("r"+f+".join()"),h.push("array"+f+".data"),h.push("array"+f+".stride"),h.push("array"+f+".offset|0"),p>0&&(u.push("array"+r.arrayArgs[0]+".shape.length===array"+f+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[p]))),d.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+f+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[p])+"]"))}for(r.arrayArgs.length>1&&(s.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),s.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),s.push("if (!("+d.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),s.push("}")),p=0;p<r.scalarArgs.length;++p)h.push("scalar"+r.scalarArgs[p]);return o.push(["type=[",c.join(","),"].join()"].join("")),o.push("proc=CACHED[type]"),s.push("var "+o.join(",")),s.push(["if(!proc){","CACHED[type]=proc=compile([",l.join(","),"])}","return proc(",h.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+s.join("\n")+"\n----------"),new Function("compile",s.join("\n"))(i.bind(void 0,r))}}),Sue=fr((e,t)=>{var i=xue();function n(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}t.exports=function r(s){var o=new n;o.pre=s.pre,o.body=s.body,o.post=s.post;var a=s.args.slice(0);o.argTypes=a;for(var l=0;l<a.length;++l){var c=a[l];if("array"===c||"object"==typeof c&&c.blockIndices){if(o.argTypes[l]="array",o.arrayArgs.push(l),o.arrayBlockIndices.push(c.blockIndices?c.blockIndices:0),o.shimArgs.push("array"+l),l<o.pre.args.length&&o.pre.args[l].count>0)throw new Error("cwise: pre() block may not reference array args");if(l<o.post.args.length&&o.post.args[l].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===c)o.scalarArgs.push(l),o.shimArgs.push("scalar"+l);else if("index"===c){if(o.indexArgs.push(l),l<o.pre.args.length&&o.pre.args[l].count>0)throw new Error("cwise: pre() block may not reference array index");if(l<o.body.args.length&&o.body.args[l].lvalue)throw new Error("cwise: body() block may not write to array index");if(l<o.post.args.length&&o.post.args[l].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===c){if(o.shapeArgs.push(l),l<o.pre.args.length&&o.pre.args[l].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(l<o.body.args.length&&o.body.args[l].lvalue)throw new Error("cwise: body() block may not write to array shape");if(l<o.post.args.length&&o.post.args[l].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof c||!c.offset)throw new Error("cwise: Unknown argument type "+a[l]);o.argTypes[l]="offset",o.offsetArgs.push({array:c.array,offset:c.offset}),o.offsetArgIndex.push(l)}}if(o.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(o.pre.args.length>a.length)throw new Error("cwise: Too many arguments in pre() block");if(o.body.args.length>a.length)throw new Error("cwise: Too many arguments in body() block");if(o.post.args.length>a.length)throw new Error("cwise: Too many arguments in post() block");return o.debug=!!s.printCode||!!s.debug,o.funcName=s.funcName||"cwise",o.blockSize=s.blockSize||64,i(o)}}),mg=fr(e=>{var t=Sue(),i={body:"",args:[],thisVars:[],localVars:[]};function n(d){if(!d)return i;for(var p=0;p<d.args.length;++p){var f=d.args[p];d.args[p]=0===p?{name:f,lvalue:!0,rvalue:!!d.rvalue,count:d.count||1}:{name:f,lvalue:!1,rvalue:!0,count:1}}return d.thisVars||(d.thisVars=[]),d.localVars||(d.localVars=[]),d}function s(d){for(var p=[],f=0;f<d.args.length;++f)p.push("a"+f);return new Function("P",["return function ",d.funcName,"_ndarrayops(",p.join(","),") {P(",p.join(","),");return a0}"].join(""))(function r(d){return t({args:d.args,pre:n(d.pre),body:n(d.body),post:n(d.proc),funcName:d.funcName})}(d))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var d in o){var p=o[d];e[d]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+p+"c"},funcName:d}),e[d+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+p+"=b"},rvalue:!0,funcName:d+"eq"}),e[d+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+p+"s"},funcName:d+"s"}),e[d+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+p+"=s"},rvalue:!0,funcName:d+"seq"})}}();var a={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var d in a){var p=a[d];e[d]=s({args:["array","array"],body:{args:["a","b"],body:"a="+p+"b"},funcName:d}),e[d+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+p+"a"},rvalue:!0,count:2,funcName:d+"eq"})}}();var l={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var d in l){var p=l[d];e[d]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+p+"c"},funcName:d}),e[d+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+p+"s"},funcName:d+"s"}),e[d+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+p+"b"},rvalue:!0,count:2,funcName:d+"eq"}),e[d+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+p+"s"},rvalue:!0,count:2,funcName:d+"seq"})}}();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var d=0;d<c.length;++d){var p=c[d];e[p]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:p}),e[p+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var d=0;d<h.length;++d){var p=h[d];e[p]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:p}),e[p+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:p+"s"}),e[p+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"eq"}),e[p+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"seq"})}}();var u=["atan2","pow"];(function(){for(var d=0;d<u.length;++d){var p=u[d];e[p+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:p+"op"}),e[p+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:p+"ops"}),e[p+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"opeq"}),e[p+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"opseq"})}})(),e.any=t({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=t({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=t({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=t({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=t({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=t({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=t({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),Cue=fr((e,t)=>{t.exports=function(i,n){for(var r=i.split("."),s=n.split("."),o=0;o<3;o++){var a=Number(r[o]),l=Number(s[o]);if(a>l)return 1;if(l>a)return-1;if(!isNaN(a)&&isNaN(l))return 1;if(isNaN(a)&&!isNaN(l))return-1}return 0}}),zd="149",Eue=0,qz=1,Mue=2,sM=1,Aue=2,gg=3,No=0,qn=1,hs=2,bn=0,ku=1,Yz=2,Xz=3,Zz=4,Due=5,Ud=100,Tue=101,Iue=102,Qz=103,Kz=104,Pue=200,Rue=201,Oue=202,Lue=203,$z=204,Jz=205,Nue=206,kue=207,Fue=208,Bue=209,Vue=210,zue=0,Uue=1,jue=2,oM=3,Hue=4,Gue=5,Wue=6,que=7,eU=0,Yue=1,Xue=2,gl=0,Zue=1,Que=2,Kue=3,$ue=4,Jue=5,Fu=301,Bu=302,aM=303,lM=304,vg=306,vl=1e3,on=1001,cM=1002,Ei=1003,iU=1004,uM=1005,It=1006,ehe=1007,jd=1008,mr=1009,the=1010,ihe=1011,nU=1012,nhe=1013,yl=1014,zr=1015,Vu=1016,rhe=1017,she=1018,zu=1020,ohe=1021,Ls=1023,ahe=1024,lhe=1025,Uu=1026,ju=1027,che=1028,uhe=1029,__=1030,hhe=1031,rU=1033,hM=33776,dM=33777,pM=33778,fM=33779,sU=35840,oU=35841,aU=35842,lU=35843,dhe=36196,cU=37492,uU=37496,hU=37808,dU=37809,pU=37810,fU=37811,mU=37812,gU=37813,vU=37814,yU=37815,_U=37816,bU=37817,wU=37818,xU=37819,SU=37820,CU=37821,mM=36492,phe=36283,EU=36284,MU=36285,AU=36286,Hd=2400,Gd=2401,_a=3e3,xt=3001,_l=3200,IU=3201,mhe=0,ghe=1,ba="srgb",S_="srgb-linear",PU="300 es",wM=1035,sr=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let i=this._listeners[e];if(void 0!==i){let n=i.indexOf(t);-1!==n&&i.splice(n,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let i=t.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,e);e.target=null}}},gr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],RU=1234567,yg=Math.PI/180,_g=180/Math.PI;function ro(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(gr[255&e]+gr[e>>8&255]+gr[e>>16&255]+gr[e>>24&255]+"-"+gr[255&t]+gr[t>>8&255]+"-"+gr[t>>16&15|64]+gr[t>>24&255]+"-"+gr[63&i|128]+gr[i>>8&255]+"-"+gr[i>>16&255]+gr[i>>24&255]+gr[255&n]+gr[n>>8&255]+gr[n>>16&255]+gr[n>>24&255]).toLowerCase()}function wn(e,t,i){return Math.max(t,Math.min(i,e))}function xM(e,t){return(e%t+t)%t}function bg(e,t,i){return(1-i)*e+i*t}function SM(e){return 0==(e&e-1)&&0!==e}function OU(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function C_(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function bl(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Mi(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var qe=Object.freeze({__proto__:null,DEG2RAD:yg,RAD2DEG:_g,ceilPowerOfTwo:OU,clamp:wn,damp:function whe(e,t,i,n){return bg(e,t,1-Math.exp(-i*n))},degToRad:function The(e){return e*yg},denormalize:bl,euclideanModulo:xM,floorPowerOfTwo:C_,generateUUID:ro,inverseLerp:function bhe(e,t,i){return e!==t?(i-e)/(t-e):0},isPowerOfTwo:SM,lerp:bg,mapLinear:function _he(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},normalize:Mi,pingpong:function xhe(e,t=1){return t-Math.abs(xM(e,2*t)-t)},radToDeg:function Ihe(e){return e*_g},randFloat:function Mhe(e,t){return e+Math.random()*(t-e)},randFloatSpread:function Ahe(e){return e*(.5-Math.random())},randInt:function Ehe(e,t){return e+Math.floor(Math.random()*(t-e+1))},seededRandom:function Dhe(e){void 0!==e&&(RU=e);let t=RU+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function Phe(e,t,i,n,r){let s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((t+n)/2),h=o((t+n)/2),u=s((t-n)/2),d=o((t-n)/2),p=s((n-t)/2),f=o((n-t)/2);switch(r){case"XYX":e.set(a*h,l*u,l*d,a*c);break;case"YZY":e.set(l*d,a*h,l*u,a*c);break;case"ZXZ":e.set(l*u,l*d,a*h,a*c);break;case"XZX":e.set(a*h,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function Che(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},smoothstep:function She(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)}}),z=class{constructor(e=0,t=0){z.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},an=class{constructor(){an.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,s,o,a,l){let c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=r,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],_=n[7],b=n[2],w=n[5],C=n[8];return r[0]=s*f+o*v+a*b,r[3]=s*m+o*y+a*w,r[6]=s*g+o*_+a*C,r[1]=l*f+c*v+h*b,r[4]=l*m+c*y+h*w,r[7]=l*g+c*_+h*C,r[2]=u*f+d*v+p*b,r[5]=u*m+d*y+p*w,r[8]=u*g+d*_+p*C,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-i*r*c+i*o*a+n*r*l-n*s*a}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=c*s-o*l,u=o*a-c*r,d=l*r-s*a,p=t*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(n*l-c*i)*f,e[2]=(o*i-n*s)*f,e[3]=u*f,e[4]=(c*t-n*a)*f,e[5]=(n*r-o*t)*f,e[6]=d*f,e[7]=(i*a-l*t)*f,e[8]=(s*t-i*r)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,o){let a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+e,-n*l,n*a,-n*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(CM.makeScale(e,t)),this}rotate(e){return this.premultiply(CM.makeRotation(-e)),this}translate(e,t){return this.premultiply(CM.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}},CM=new an;function LU(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var Rhe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function E_(e,t){return new Rhe[e](t)}function M_(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Hu(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function A_(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var EM={[ba]:{[S_]:Hu},[S_]:{[ba]:A_}},Ur={legacyMode:!0,get workingColorSpace(){return S_},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(EM[t]&&void 0!==EM[t][i]){let n=EM[t][i];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},NU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nn={r:0,g:0,b:0},ko={h:0,s:0,l:0},D_={h:0,s:0,l:0};function MM(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function T_(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Je=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ba){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ur.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=Ur.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ur.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=Ur.workingColorSpace){if(e=xM(e,1),t=wn(t,0,1),i=wn(i,0,1),0===t)this.r=this.g=this.b=i;else{let r=i<=.5?i*(1+t):i+t-i*t,s=2*i-r;this.r=MM(s,r,e+1/3),this.g=MM(s,r,e),this.b=MM(s,r,e-1/3)}return Ur.toWorkingColorSpace(this,n),this}setStyle(e,t=ba){function i(r){void 0!==r&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r,o=n[2];switch(n[1]){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,Ur.toWorkingColorSpace(this,t),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,Ur.toWorkingColorSpace(this,t),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){let a=parseFloat(r[1])/360,l=parseFloat(r[2])/100,c=parseFloat(r[3])/100;return i(r[4]),this.setHSL(a,l,c,t)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=n[1],s=r.length;if(3===s)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,Ur.toWorkingColorSpace(this,t),this;if(6===s)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,Ur.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=ba){let i=NU[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Hu(e.r),this.g=Hu(e.g),this.b=Hu(e.b),this}copyLinearToSRGB(e){return this.r=A_(e.r),this.g=A_(e.g),this.b=A_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ba){return Ur.fromWorkingColorSpace(T_(this,Nn),e),wn(255*Nn.r,0,255)<<16^wn(255*Nn.g,0,255)<<8^wn(255*Nn.b,0,255)<<0}getHexString(e=ba){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ur.workingColorSpace){Ur.fromWorkingColorSpace(T_(this,Nn),t);let a,l,i=Nn.r,n=Nn.g,r=Nn.b,s=Math.max(i,n,r),o=Math.min(i,n,r),c=(o+s)/2;if(o===s)a=0,l=0;else{let h=s-o;switch(l=c<=.5?h/(s+o):h/(2-s-o),s){case i:a=(n-r)/h+(n<r?6:0);break;case n:a=(r-i)/h+2;break;case r:a=(i-n)/h+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=Ur.workingColorSpace){return Ur.fromWorkingColorSpace(T_(this,Nn),t),e.r=Nn.r,e.g=Nn.g,e.b=Nn.b,e}getStyle(e=ba){return Ur.fromWorkingColorSpace(T_(this,Nn),e),e!==ba?`color(${e} ${Nn.r} ${Nn.g} ${Nn.b})`:`rgb(${255*Nn.r|0},${255*Nn.g|0},${255*Nn.b|0})`}offsetHSL(e,t,i){return this.getHSL(ko),ko.h+=e,ko.s+=t,ko.l+=i,this.setHSL(ko.h,ko.s,ko.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ko),e.getHSL(D_);let i=bg(ko.h,D_.h,t),n=bg(ko.s,D_.s,t),r=bg(ko.l,D_.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Je.NAMES=NU;var Wd,kU=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Wd&&(Wd=M_("canvas")),Wd.width=e.width,Wd.height=e.height;let i=Wd.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Wd}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=M_("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let s=0;s<r.length;s++)r[s]=255*Hu(r[s]/255);return i.putImageData(n,0,0),t}if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Hu(t[i]/255)):Hu(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},FU=class{constructor(e=null){this.isSource=!0,this.uuid=ro(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let r;if(Array.isArray(n)){r=[];for(let s=0,o=n.length;s<o;s++)r.push(AM(n[s].isDataTexture?n[s].image:n[s]))}else r=AM(n);i.url=r}return t||(e.images[this.uuid]=i),i}};function AM(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?kU.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Ohe=0,kn=class extends sr{constructor(e=kn.DEFAULT_IMAGE,t=kn.DEFAULT_MAPPING,i=on,n=on,r=It,s=jd,o=Ls,a=mr,l=kn.DEFAULT_ANISOTROPY,c=_a){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ohe++}),this.uuid=ro(),this.name="",this.source=new FU(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new z(0,0),this.repeat=new z(1,1),this.center=new z(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new an,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case vl:e.x=e.x-Math.floor(e.x);break;case on:e.x=e.x<0?0:1;break;case cM:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case vl:e.y=e.y-Math.floor(e.y);break;case on:e.y=e.y<0?0:1;break;case cM:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}};kn.DEFAULT_IMAGE=null,kn.DEFAULT_MAPPING=300,kn.DEFAULT_ANISOTROPY=1;var St=class{constructor(e=0,t=0,i=0,n=1){St.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r,s=e.elements,o=s[0],a=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(o+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let g=(o+1)/2,v=(h+1)/2,y=(f+1)/2,_=(a+c)/4,b=(l+d)/4,w=(u+p)/4;return g>v&&g>y?g<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(g),n=_/i,r=b/i):v>y?v<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(v),i=_/n,r=w/n):y<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(y),i=b/r,n=w/r),this.set(i,n,r,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((o+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},di=class extends sr{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new St(0,0,e,t),this.scissorTest=!1,this.viewport=new St(0,0,e,t),this.texture=new kn({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:It,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new FU(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},BU=class extends kn{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ei,this.minFilter=Ei,this.wrapR=on,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Nhe=class extends di{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLMultipleRenderTargets=!0;let r=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=r.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ft=class{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,s,o){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(h!==f||a!==u||l!==d||c!==p){let m=1-o,g=a*u+l*d+c*p+h*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){let b=Math.sqrt(y),w=Math.atan2(b,g*v);m=Math.sin(m*w)/b,o=Math.sin(o*w)/b}let _=o*v;if(a=a*m+u*_,l=l*m+d*_,c=c*m+p*_,h=h*m+f*_,m===1-o){let b=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=b,l*=b,c*=b,h*=b}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,s){let o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return e[t]=o*p+c*h+a*d-l*u,e[t+1]=a*p+c*u+l*h-o*d,e[t+2]=l*p+c*d+o*u-a*h,e[t+3]=c*p-o*h-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,n=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),h=o(r/2),u=a(i/2),d=a(n/2),p=a(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],h=t[10],u=i+o+h;if(u>0){let d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(c-a)*d,this._y=(r-l)*d,this._z=(s-n)*d}else if(i>o&&i>h){let d=2*Math.sqrt(1+i-o-h);this._w=(c-a)/d,this._x=.25*d,this._y=(n+s)/d,this._z=(r+l)/d}else if(o>h){let d=2*Math.sqrt(1+o-i-h);this._w=(r-l)/d,this._x=(n+s)/d,this._y=.25*d,this._z=(a+c)/d}else{let d=2*Math.sqrt(1+h-i-o);this._w=(s-n)/d,this._x=(r+l)/d,this._y=(a+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(wn(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,n=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+s*o+n*l-r*a,this._y=n*c+s*a+r*o-i*l,this._z=r*c+s*l+i*a-n*o,this._w=s*c-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,n=this._y,r=this._z,s=this._w,o=s*e._w+i*e._x+n*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;let a=1-o*o;if(a<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*n+t*this._y,this._z=d*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},M=class{constructor(e=0,t=0,i=0){M.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(VU.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(VU.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*n-o*i,c=a*i+o*t-r*n,h=a*n+r*i-s*t,u=-r*t-s*i-o*n;return this.x=l*a+u*-r+c*-o-h*-s,this.y=c*a+u*-s+h*-r-l*-o,this.z=h*a+u*-o+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,n=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return DM.copy(this).projectOnVector(e),this.sub(DM)}reflect(e){return this.sub(DM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(wn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},DM=new M,VU=new ft,ln=class{constructor(e=new M(1/0,1/0,1/0),t=new M(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){let c=e[a],h=e[a+1],u=e[a+2];c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>s&&(s=h),u>o&&(o=u)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){let c=e.getX(a),h=e.getY(a),u=e.getZ(a);c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>s&&(s=h),u>o&&(o=u)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Gu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){let r=i.attributes.position;for(let s=0,o=r.count;s<o;s++)Gu.fromBufferAttribute(r,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Gu)}else null===i.boundingBox&&i.computeBoundingBox(),TM.copy(i.boundingBox),TM.applyMatrix4(e.matrixWorld),this.union(TM);let n=e.children;for(let r=0,s=n.length;r<s;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Gu),Gu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(wg),I_.subVectors(this.max,wg),qd.subVectors(e.a,wg),Yd.subVectors(e.b,wg),Xd.subVectors(e.c,wg),vc.subVectors(Yd,qd),yc.subVectors(Xd,Yd),Wu.subVectors(qd,Xd);let t=[0,-vc.z,vc.y,0,-yc.z,yc.y,0,-Wu.z,Wu.y,vc.z,0,-vc.x,yc.z,0,-yc.x,Wu.z,0,-Wu.x,-vc.y,vc.x,0,-yc.y,yc.x,0,-Wu.y,Wu.x,0];return!(!IM(t,qd,Yd,Xd,I_)||(t=[1,0,0,0,1,0,0,0,1],!IM(t,qd,Yd,Xd,I_)))&&(P_.crossVectors(vc,yc),t=[P_.x,P_.y,P_.z],IM(t,qd,Yd,Xd,I_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Gu.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Gu).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(wl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),wl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),wl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),wl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),wl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),wl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),wl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),wl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(wl)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},wl=[new M,new M,new M,new M,new M,new M,new M,new M],Gu=new M,TM=new ln,qd=new M,Yd=new M,Xd=new M,vc=new M,yc=new M,Wu=new M,wg=new M,I_=new M,P_=new M,qu=new M;function IM(e,t,i,n,r){for(let s=0,o=e.length-3;s<=o;s+=3){qu.fromArray(e,s);let a=r.x*Math.abs(qu.x)+r.y*Math.abs(qu.y)+r.z*Math.abs(qu.z),l=t.dot(qu),c=i.dot(qu),h=n.dot(qu);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}var khe=new ln,xg=new M,PM=new M,ds=class{constructor(e=new M,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;void 0!==t?i.copy(t):khe.setFromPoints(e).getCenter(i);let n=0;for(let r=0,s=e.length;r<s;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;xg.subVectors(e,this.center);let t=xg.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),n=.5*(i-this.radius);this.center.addScaledVector(xg,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(PM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(xg.copy(e.center).add(PM)),this.expandByPoint(xg.copy(e.center).sub(PM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}},xl=new M,RM=new M,R_=new M,_c=new M,OM=new M,O_=new M,LM=new M,Zd=class{constructor(e=new M,t=new M(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xl)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=xl.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(xl.copy(this.direction).multiplyScalar(t).add(this.origin),xl.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){RM.copy(e).add(t).multiplyScalar(.5),R_.copy(t).sub(e).normalize(),_c.copy(this.origin).sub(RM);let h,u,d,p,r=.5*e.distanceTo(t),s=-this.direction.dot(R_),o=_c.dot(this.direction),a=-_c.dot(R_),l=_c.lengthSq(),c=Math.abs(1-s*s);if(c>0)if(h=s*a-o,u=s*o-a,p=r*c,h>=0)if(u>=-p)if(u<=p){let f=1/c;h*=f,u*=f,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-s*r+o)),u=h>0?-r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(h=Math.max(0,-(s*r+o)),u=h>0?r:Math.min(Math.max(-r,-a),r),d=-h*h+u*(u+2*a)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(R_).multiplyScalar(u).add(RM),d}intersectSphere(e,t){xl.subVectors(e.center,this.origin);let i=xl.dot(this.direction),n=xl.dot(xl)-i*i,r=e.radius*e.radius;if(n>r)return null;let s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:this.at(o<0?a:o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,o,a,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,s=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,s=(e.min.y-u.y)*c),i>s||r>n||((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),h>=0?(o=(e.min.z-u.z)*h,a=(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,a=(e.min.z-u.z)*h),i>a||o>n)||((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return null!==this.intersectBox(e,xl)}intersectTriangle(e,t,i,n,r){OM.subVectors(t,e),O_.subVectors(i,e),LM.crossVectors(OM,O_);let o,s=this.direction.dot(LM);if(s>0){if(n)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}_c.subVectors(this.origin,e);let a=o*this.direction.dot(O_.crossVectors(_c,O_));if(a<0)return null;let l=o*this.direction.dot(OM.cross(_c));if(l<0||a+l>s)return null;let c=-o*_c.dot(LM);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},ye=class{constructor(){ye.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,s,o,a,l,c,h,u,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ye).fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,n=1/Qd.setFromMatrixColumn(e,0).length(),r=1/Qd.setFromMatrixColumn(e,1).length(),s=1/Qd.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){let u=s*c,d=s*h,p=o*c,f=o*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=d+p*l,t[5]=u-f*l,t[9]=-o*a,t[2]=f-u*l,t[6]=p+d*l,t[10]=s*a}else if("YXZ"===e.order){let u=a*c,d=a*h,p=l*c,f=l*h;t[0]=u+f*o,t[4]=p*o-d,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-o,t[2]=d*o-p,t[6]=f+u*o,t[10]=s*a}else if("ZXY"===e.order){let u=a*c,d=a*h,p=l*c,f=l*h;t[0]=u-f*o,t[4]=-s*h,t[8]=p+d*o,t[1]=d+p*o,t[5]=s*c,t[9]=f-u*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){let u=s*c,d=s*h,p=o*c,f=o*h;t[0]=a*c,t[4]=p*l-d,t[8]=u*l+f,t[1]=a*h,t[5]=f*l+u,t[9]=d*l-p,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){let u=s*a,d=s*l,p=o*a,f=o*l;t[0]=a*c,t[4]=f-u*h,t[8]=p*h+d,t[1]=h,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=d*h+p,t[10]=u-f*h}else if("XZY"===e.order){let u=s*a,d=s*l,p=o*a,f=o*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=u*h+f,t[5]=s*c,t[9]=d*h-p,t[2]=p*h-d,t[6]=o*c,t[10]=f*h+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Fhe,e,Bhe)}lookAt(e,t,i){let n=this.elements;return Ns.subVectors(e,t),0===Ns.lengthSq()&&(Ns.z=1),Ns.normalize(),bc.crossVectors(i,Ns),0===bc.lengthSq()&&(1===Math.abs(i.z)?Ns.x+=1e-4:Ns.z+=1e-4,Ns.normalize(),bc.crossVectors(i,Ns)),bc.normalize(),L_.crossVectors(Ns,bc),n[0]=bc.x,n[4]=L_.x,n[8]=Ns.x,n[1]=bc.y,n[5]=L_.y,n[9]=Ns.y,n[2]=bc.z,n[6]=L_.z,n[10]=Ns.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],_=i[11],b=i[15],w=n[0],C=n[4],x=n[8],S=n[12],E=n[1],D=n[5],T=n[9],I=n[13],P=n[2],R=n[6],L=n[10],j=n[14],F=n[3],N=n[7],q=n[11],W=n[15];return r[0]=s*w+o*E+a*P+l*F,r[4]=s*C+o*D+a*R+l*N,r[8]=s*x+o*T+a*L+l*q,r[12]=s*S+o*I+a*j+l*W,r[1]=c*w+h*E+u*P+d*F,r[5]=c*C+h*D+u*R+d*N,r[9]=c*x+h*T+u*L+d*q,r[13]=c*S+h*I+u*j+d*W,r[2]=p*w+f*E+m*P+g*F,r[6]=p*C+f*D+m*R+g*N,r[10]=p*x+f*T+m*L+g*q,r[14]=p*S+f*I+m*j+g*W,r[3]=v*w+y*E+_*P+b*F,r[7]=v*C+y*D+_*R+b*N,r[11]=v*x+y*T+_*L+b*q,r[15]=v*S+y*I+_*j+b*W,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+r*a*h-n*l*h-r*o*u+i*l*u+n*o*d-i*a*d)+e[7]*(+t*a*d-t*l*u+r*s*u-n*s*d+n*l*c-r*a*c)+e[11]*(+t*l*h-t*o*d-r*s*h+i*s*d+r*o*c-i*l*c)+e[15]*(-n*o*c-t*a*h+t*o*u+n*s*h-i*s*u+i*a*c)}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*u*l+f*a*d-o*m*d-h*a*g+o*u*g,y=p*u*l-c*m*l-p*a*d+s*m*d+c*a*g-s*u*g,_=c*f*l-p*h*l+p*o*d-s*f*d-c*o*g+s*h*g,b=p*h*a-c*f*a-p*o*u+s*f*u+c*o*m-s*h*m,w=t*v+i*y+n*_+r*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let C=1/w;return e[0]=v*C,e[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*C,e[2]=(o*m*r-f*a*r+f*n*l-i*m*l-o*n*g+i*a*g)*C,e[3]=(h*a*r-o*u*r-h*n*l+i*u*l+o*n*d-i*a*d)*C,e[4]=y*C,e[5]=(c*m*r-p*u*r+p*n*d-t*m*d-c*n*g+t*u*g)*C,e[6]=(p*a*r-s*m*r-p*n*l+t*m*l+s*n*g-t*a*g)*C,e[7]=(s*u*r-c*a*r+c*n*l-t*u*l-s*n*d+t*a*d)*C,e[8]=_*C,e[9]=(p*h*r-c*f*r-p*i*d+t*f*d+c*i*g-t*h*g)*C,e[10]=(s*f*r-p*o*r+p*i*l-t*f*l-s*i*g+t*o*g)*C,e[11]=(c*o*r-s*h*r-c*i*l+t*h*l+s*i*d-t*o*d)*C,e[12]=b*C,e[13]=(c*f*n-p*h*n+p*i*u-t*f*u-c*i*m+t*h*m)*C,e[14]=(p*o*n-s*f*n-p*i*a+t*f*a+s*i*m-t*o*m)*C,e[15]=(s*h*n-c*o*n+c*i*a-t*h*a-s*i*u+t*o*u)*C,this}scale(e){let t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,o=e.y,a=e.z,l=r*s,c=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*s,0,l*a-n*o,c*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){let n=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,c=s+s,h=o+o,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=o*h,v=a*l,y=a*c,_=a*h,b=i.x,w=i.y,C=i.z;return n[0]=(1-(f+g))*b,n[1]=(d+_)*b,n[2]=(p-y)*b,n[3]=0,n[4]=(d-_)*w,n[5]=(1-(u+g))*w,n[6]=(m+v)*w,n[7]=0,n[8]=(p+y)*C,n[9]=(m-v)*C,n[10]=(1-(u+f))*C,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){let n=this.elements,r=Qd.set(n[0],n[1],n[2]).length(),s=Qd.set(n[4],n[5],n[6]).length(),o=Qd.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],Fo.copy(this);let a=1/r,l=1/s,c=1/o;return Fo.elements[0]*=a,Fo.elements[1]*=a,Fo.elements[2]*=a,Fo.elements[4]*=l,Fo.elements[5]*=l,Fo.elements[6]*=l,Fo.elements[8]*=c,Fo.elements[9]*=c,Fo.elements[10]*=c,t.setFromRotationMatrix(Fo),i.x=r,i.y=s,i.z=o,this}makePerspective(e,t,i,n,r,s){let o=this.elements,l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=2*r/(t-e),o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,r,s){let o=this.elements,a=1/(t-e),l=1/(i-n),c=1/(s-r),h=(t+e)*a,u=(i+n)*l,d=(s+r)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},Qd=new M,Fo=new ye,Fhe=new M(0,0,0),Bhe=new M(1,1,1),bc=new M,L_=new M,Ns=new M,zU=new ye,UU=new ft,Yn=class{constructor(e=0,t=0,i=0,n=Yn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let n=e.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(wn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-wn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(wn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-wn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(wn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-wn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return zU.makeRotationFromQuaternion(e),this.setFromRotationMatrix(zU,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return UU.setFromEuler(this),this.setFromQuaternion(UU,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Yn.DEFAULT_ORDER="XYZ";var NM=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}},Vhe=0,jU=new M,Kd=new ft,Sl=new ye,N_=new M,Sg=new M,zhe=new M,Uhe=new ft,HU=new M(1,0,0),GU=new M(0,1,0),WU=new M(0,0,1),jhe={type:"added"},qU={type:"removed"},pi=class extends sr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vhe++}),this.uuid=ro(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=pi.DEFAULT_UP.clone();let e=new M,t=new Yn,i=new ft,n=new M(1,1,1);t._onChange(function r(){i.setFromEuler(t,!1)}),i._onChange(function s(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ye},normalMatrix:{value:new an}}),this.matrix=new ye,this.matrixWorld=new ye,this.matrixAutoUpdate=pi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new NM,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Kd.setFromAxisAngle(e,t),this.quaternion.multiply(Kd),this}rotateOnWorldAxis(e,t){return Kd.setFromAxisAngle(e,t),this.quaternion.premultiply(Kd),this}rotateX(e){return this.rotateOnAxis(HU,e)}rotateY(e){return this.rotateOnAxis(GU,e)}rotateZ(e){return this.rotateOnAxis(WU,e)}translateOnAxis(e,t){return jU.copy(e).applyQuaternion(this.quaternion),this.position.add(jU.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(HU,e)}translateY(e){return this.translateOnAxis(GU,e)}translateZ(e){return this.translateOnAxis(WU,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Sl.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?N_.copy(e):N_.set(e,t,i);let n=this.parent;this.updateWorldMatrix(!0,!1),Sg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Sl.lookAt(Sg,N_,this.up):Sl.lookAt(N_,Sg,this.up),this.quaternion.setFromRotationMatrix(Sl),n&&(Sl.extractRotation(n.matrixWorld),Kd.setFromRotationMatrix(Sl),this.quaternion.premultiply(Kd.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(jhe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(qU)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(qU)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Sl.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Sl.multiply(e.parent.matrixWorld)),e.applyMatrix4(Sl),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){let r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let n=0,r=this.children.length;n<r;n++){let s=this.children[n].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Sg,e,zhe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Sg,Uhe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,n=t.length;i<n;i++){let r=t[i];(!0===r.matrixWorldAutoUpdate||!0===e)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let n=this.children;for(let r=0,s=n.length;r<s;r++){let o=n[r];!0===o.matrixWorldAutoUpdate&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};function r(o,a){return void 0===o[a.uuid]&&(o[a.uuid]=a.toJSON(e)),a.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);let o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){let a=o.shapes;if(Array.isArray(a))for(let l=0,c=a.length;l<c;l++)r(e.shapes,a[l]);else r(e.shapes,a)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let o=[];for(let a=0,l=this.material.length;a<l;a++)o.push(r(e.materials,this.material[a]));n.material=o}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++)n.animations.push(r(e.animations,this.animations[o]))}if(t){let o=s(e.geometries),a=s(e.materials),l=s(e.textures),c=s(e.images),h=s(e.shapes),u=s(e.skeletons),d=s(e.animations),p=s(e.nodes);o.length>0&&(i.geometries=o),a.length>0&&(i.materials=a),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),h.length>0&&(i.shapes=h),u.length>0&&(i.skeletons=u),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=n,i;function s(o){let a=[];for(let l in o){let c=o[l];delete c.metadata,a.push(c)}return a}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++)this.add(e.children[i].clone());return this}};pi.DEFAULT_UP=new M(0,1,0),pi.DEFAULT_MATRIX_AUTO_UPDATE=!0,pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Bo=new M,Cl=new M,kM=new M,El=new M,$d=new M,Jd=new M,YU=new M,FM=new M,BM=new M,VM=new M,vr=class{constructor(e=new M,t=new M,i=new M){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),Bo.subVectors(e,t),n.cross(Bo);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){Bo.subVectors(n,t),Cl.subVectors(i,t),kM.subVectors(e,t);let s=Bo.dot(Bo),o=Bo.dot(Cl),a=Bo.dot(kM),l=Cl.dot(Cl),c=Cl.dot(kM),h=s*l-o*o;if(0===h)return r.set(-2,-1,-1);let u=1/h,d=(l*a-o*c)*u,p=(s*c-o*a)*u;return r.set(1-d-p,p,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,El),El.x>=0&&El.y>=0&&El.x+El.y<=1}static getUV(e,t,i,n,r,s,o,a){return this.getBarycoord(e,t,i,n,El),a.set(0,0),a.addScaledVector(r,El.x),a.addScaledVector(s,El.y),a.addScaledVector(o,El.z),a}static isFrontFacing(e,t,i,n){return Bo.subVectors(i,t),Cl.subVectors(e,t),Bo.cross(Cl).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Bo.subVectors(this.c,this.b),Cl.subVectors(this.a,this.b),.5*Bo.cross(Cl).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return vr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return vr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return vr.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return vr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return vr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let s,o,i=this.a,n=this.b,r=this.c;$d.subVectors(n,i),Jd.subVectors(r,i),FM.subVectors(e,i);let a=$d.dot(FM),l=Jd.dot(FM);if(a<=0&&l<=0)return t.copy(i);BM.subVectors(e,n);let c=$d.dot(BM),h=Jd.dot(BM);if(c>=0&&h<=c)return t.copy(n);let u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(i).addScaledVector($d,s);VM.subVectors(e,r);let d=$d.dot(VM),p=Jd.dot(VM);if(p>=0&&d<=p)return t.copy(r);let f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(i).addScaledVector(Jd,o);let m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return YU.subVectors(r,n),o=(h-c)/(h-c+(d-p)),t.copy(n).addScaledVector(YU,o);let g=1/(m+f+u);return s=f*g,o=u*g,t.copy(i).addScaledVector($d,s).addScaledVector(Jd,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Hhe=0,Cg=class extends sr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Hhe++}),this.uuid=ro(),this.name="",this.type="Material",this.blending=ku,this.side=No,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=$z,this.blendDst=Jz,this.blendEquation=Ud,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=oM,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(r){let s=[];for(let o in r){let a=r[o];delete a.metadata,s.push(a)}return s}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ku&&(i.blending=this.blending),this.side!==No&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){let r=n(e.textures),s=n(e.images);r.length>0&&(i.textures=r),s.length>0&&(i.images=s)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(null!==t){let n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}},Eg=class extends Cg{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=eU,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},xn=new M,k_=new z,st=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)k_.fromBufferAttribute(this,t),k_.applyMatrix3(e),this.setXY(t,k_.x,k_.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)xn.fromBufferAttribute(this,t),xn.applyMatrix3(e),this.setXYZ(t,xn.x,xn.y,xn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)xn.fromBufferAttribute(this,t),xn.applyMatrix4(e),this.setXYZ(t,xn.x,xn.y,xn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)xn.fromBufferAttribute(this,t),xn.applyNormalMatrix(e),this.setXYZ(t,xn.x,xn.y,xn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)xn.fromBufferAttribute(this,t),xn.transformDirection(e),this.setXYZ(t,xn.x,xn.y,xn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=bl(t,this.array)),t}setX(e,t){return this.normalized&&(t=Mi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=bl(t,this.array)),t}setY(e,t){return this.normalized&&(t=Mi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=bl(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Mi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=bl(t,this.array)),t}setW(e,t){return this.normalized&&(t=Mi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Mi(t,this.array),i=Mi(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=Mi(t,this.array),i=Mi(i,this.array),n=Mi(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=Mi(t,this.array),i=Mi(i,this.array),n=Mi(n,this.array),r=Mi(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},XU=class extends st{constructor(e,t,i){super(new Uint16Array(e),t,i)}},ep=class extends st{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Fe=class extends st{constructor(e,t,i){super(new Float32Array(e),t,i)}},Ghe=0,so=new ye,zM=new pi,tp=new M,ks=new ln,Mg=new ln,Xn=new M,Ze=class extends sr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ghe++}),this.uuid=ro(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(LU(e)?ep:XU)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let r=(new an).getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return so.makeRotationFromQuaternion(e),this.applyMatrix4(so),this}rotateX(e){return so.makeRotationX(e),this.applyMatrix4(so),this}rotateY(e){return so.makeRotationY(e),this.applyMatrix4(so),this}rotateZ(e){return so.makeRotationZ(e),this.applyMatrix4(so),this}translate(e,t,i){return so.makeTranslation(e,t,i),this.applyMatrix4(so),this}scale(e,t,i){return so.makeScale(e,t,i),this.applyMatrix4(so),this}lookAt(e){return zM.lookAt(e),zM.updateMatrix(),this.applyMatrix4(zM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tp).negate(),this.translate(tp.x,tp.y,tp.z),this}setFromPoints(e){let t=[];for(let i=0,n=e.length;i<n;i++){let r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Fe(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ln);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new M(-1/0,-1/0,-1/0),new M(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++)ks.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(Xn.addVectors(this.boundingBox.min,ks.min),this.boundingBox.expandByPoint(Xn),Xn.addVectors(this.boundingBox.max,ks.max),this.boundingBox.expandByPoint(Xn)):(this.boundingBox.expandByPoint(ks.min),this.boundingBox.expandByPoint(ks.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ds);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new M,1/0);if(e){let i=this.boundingSphere.center;if(ks.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++)Mg.setFromBufferAttribute(t[r]),this.morphTargetsRelative?(Xn.addVectors(ks.min,Mg.min),ks.expandByPoint(Xn),Xn.addVectors(ks.max,Mg.max),ks.expandByPoint(Xn)):(ks.expandByPoint(Mg.min),ks.expandByPoint(Mg.max));ks.getCenter(i);let n=0;for(let r=0,s=e.count;r<s;r++)Xn.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Xn));if(t)for(let r=0,s=t.length;r<s;r++){let o=t[r],a=this.morphTargetsRelative;for(let l=0,c=o.count;l<c;l++)Xn.fromBufferAttribute(o,l),a&&(tp.fromBufferAttribute(e,l),Xn.add(tp)),n=Math.max(n,i.distanceToSquared(Xn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,o=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new st(new Float32Array(4*o),4));let a=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<o;E++)l[E]=new M,c[E]=new M;let h=new M,u=new M,d=new M,p=new z,f=new z,m=new z,g=new M,v=new M;function y(E,D,T){h.fromArray(n,3*E),u.fromArray(n,3*D),d.fromArray(n,3*T),p.fromArray(s,2*E),f.fromArray(s,2*D),m.fromArray(s,2*T),u.sub(h),d.sub(h),f.sub(p),m.sub(p);let I=1/(f.x*m.y-m.x*f.y);!isFinite(I)||(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(I),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(I),l[E].add(g),l[D].add(g),l[T].add(g),c[E].add(v),c[D].add(v),c[T].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let E=0,D=_.length;E<D;++E){let T=_[E],I=T.start;for(let R=I,L=I+T.count;R<L;R+=3)y(i[R+0],i[R+1],i[R+2])}let b=new M,w=new M,C=new M,x=new M;function S(E){C.fromArray(r,3*E),x.copy(C);let D=l[E];b.copy(D),b.sub(C.multiplyScalar(C.dot(D))).normalize(),w.crossVectors(x,D);let T=w.dot(c[E])<0?-1:1;a[4*E]=b.x,a[4*E+1]=b.y,a[4*E+2]=b.z,a[4*E+3]=T}for(let E=0,D=_.length;E<D;++E){let T=_[E],I=T.start;for(let R=I,L=I+T.count;R<L;R+=3)S(i[R+0]),S(i[R+1]),S(i[R+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new st(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let u=0,d=i.count;u<d;u++)i.setXYZ(u,0,0,0);let n=new M,r=new M,s=new M,o=new M,a=new M,l=new M,c=new M,h=new M;if(e)for(let u=0,d=e.count;u<d;u+=3){let p=e.getX(u+0),f=e.getX(u+1),m=e.getX(u+2);n.fromBufferAttribute(t,p),r.fromBufferAttribute(t,f),s.fromBufferAttribute(t,m),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),o.fromBufferAttribute(i,p),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,m),o.add(c),a.add(c),l.add(c),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let u=0,d=t.count;u<d;u+=3)n.fromBufferAttribute(t,u+0),r.fromBufferAttribute(t,u+1),s.fromBufferAttribute(t,u+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(u+0,c.x,c.y,c.z),i.setXYZ(u+1,c.x,c.y,c.z),i.setXYZ(u+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Xn.fromBufferAttribute(e,t),Xn.normalize(),e.setXYZ(t,Xn.x,Xn.y,Xn.z)}toNonIndexed(){function e(o,a){let l=o.array,c=o.itemSize,h=o.normalized,u=new l.constructor(a.length*c),d=0,p=0;for(let f=0,m=a.length;f<m;f++){d=o.isInterleavedBufferAttribute?a[f]*o.data.stride+o.offset:a[f]*c;for(let g=0;g<c;g++)u[p++]=l[d++]}return new st(u,c,h)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Ze,i=this.index.array,n=this.attributes;for(let o in n){let l=e(n[o],i);t.setAttribute(o,l)}let r=this.morphAttributes;for(let o in r){let a=[],l=r[o];for(let c=0,h=l.length;c<h;c++){let d=e(l[c],i);a.push(d)}t.morphAttributes[o]=a}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let o=0,a=s.length;o<a;o++){let l=s[o];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let a=this.parameters;for(let l in a)void 0!==a[l]&&(e[l]=a[l]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let a in i)e.data.attributes[a]=i[a].toJSON(e.data);let n={},r=!1;for(let a in this.morphAttributes){let l=this.morphAttributes[a],c=[];for(let h=0,u=l.length;h<u;h++)c.push(l[h].toJSON(e.data));c.length>0&&(n[a]=c,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;null!==i&&this.setIndex(i.clone(t));let n=e.attributes;for(let l in n)this.setAttribute(l,n[l].clone(t));let r=e.morphAttributes;for(let l in r){let c=[],h=r[l];for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let h=s[l];this.addGroup(h.start,h.count,h.materialIndex)}let o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());let a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},ZU=new ye,ip=new Zd,UM=new ds,Ag=new M,Dg=new M,Tg=new M,jM=new M,F_=new M,B_=new z,V_=new z,z_=new z,HM=new M,U_=new M,jr=class extends pi{constructor(e=new Ze,t=new Eg){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){let s=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=n}}}}getVertexPosition(e,t){let i=this.geometry,r=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);let o=this.morphTargetInfluences;if(r&&o){F_.set(0,0,0);for(let a=0,l=r.length;a<l;a++){let c=o[a];0!==c&&(jM.fromBufferAttribute(r[a],e),F_.addScaledVector(s?jM:jM.sub(t),c))}t.add(F_)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n||(null===i.boundingSphere&&i.computeBoundingSphere(),UM.copy(i.boundingSphere),UM.applyMatrix4(r),!1===e.ray.intersectsSphere(UM))||(ZU.copy(r).invert(),ip.copy(e.ray).applyMatrix4(ZU),null!==i.boundingBox&&!1===ip.intersectsBox(i.boundingBox)))return;let s,o=i.index,a=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,h=i.groups,u=i.drawRange;if(null!==o)if(Array.isArray(n))for(let d=0,p=h.length;d<p;d++){let f=h[d],m=n[f.materialIndex];for(let y=Math.max(f.start,u.start),_=Math.min(o.count,Math.min(f.start+f.count,u.start+u.count));y<_;y+=3){let b=o.getX(y),w=o.getX(y+1),C=o.getX(y+2);s=j_(this,m,e,ip,l,c,b,w,C),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else for(let f=Math.max(0,u.start),m=Math.min(o.count,u.start+u.count);f<m;f+=3){let g=o.getX(f),v=o.getX(f+1),y=o.getX(f+2);s=j_(this,n,e,ip,l,c,g,v,y),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}else if(void 0!==a)if(Array.isArray(n))for(let d=0,p=h.length;d<p;d++){let f=h[d],m=n[f.materialIndex];for(let y=Math.max(f.start,u.start),_=Math.min(a.count,Math.min(f.start+f.count,u.start+u.count));y<_;y+=3)s=j_(this,m,e,ip,l,c,y,y+1,y+2),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}else for(let f=Math.max(0,u.start),m=Math.min(a.count,u.start+u.count);f<m;f+=3)s=j_(this,n,e,ip,l,c,f,f+1,f+2),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}};function j_(e,t,i,n,r,s,o,a,l){e.getVertexPosition(o,Ag),e.getVertexPosition(a,Dg),e.getVertexPosition(l,Tg);let c=function Whe(e,t,i,n,r,s,o,a){let l;if(l=t.side===qn?n.intersectTriangle(o,s,r,!0,a):n.intersectTriangle(r,s,o,t.side===No,a),null===l)return null;U_.copy(a),U_.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(U_);return c<i.near||c>i.far?null:{distance:c,point:U_.clone(),object:e}}(e,t,i,n,Ag,Dg,Tg,HM);if(c){r&&(B_.fromBufferAttribute(r,o),V_.fromBufferAttribute(r,a),z_.fromBufferAttribute(r,l),c.uv=vr.getUV(HM,Ag,Dg,Tg,B_,V_,z_,new z)),s&&(B_.fromBufferAttribute(s,o),V_.fromBufferAttribute(s,a),z_.fromBufferAttribute(s,l),c.uv2=vr.getUV(HM,Ag,Dg,Tg,B_,V_,z_,new z));let h={a:o,b:a,c:l,normal:new M,materialIndex:0};vr.getNormal(Ag,Dg,Tg,h.normal),c.face=h}return c}var wa=class extends Ze{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};let o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);let a=[],l=[],c=[],h=[],u=0,d=0;function p(f,m,g,v,y,_,b,w,C,x,S){let E=_/C,D=b/x,T=_/2,I=b/2,P=w/2,R=C+1,L=x+1,j=0,F=0,N=new M;for(let q=0;q<L;q++){let W=q*D-I;for(let U=0;U<R;U++)N[f]=(U*E-T)*v,N[m]=W*y,N[g]=P,l.push(N.x,N.y,N.z),N[f]=0,N[m]=0,N[g]=w>0?1:-1,c.push(N.x,N.y,N.z),h.push(U/C),h.push(1-q/x),j+=1}for(let q=0;q<x;q++)for(let W=0;W<C;W++){let V=u+W+R*(q+1),Y=u+(W+1)+R*(q+1),G=u+(W+1)+R*q;a.push(u+W+R*q,V,G),a.push(V,Y,G),F+=6}o.addGroup(d,F,S),d+=F,u+=j}p("z","y","x",-1,-1,i,t,e,s,r,0),p("z","y","x",1,-1,i,t,-e,s,r,1),p("x","z","y",1,1,e,i,t,n,s,2),p("x","z","y",1,-1,e,i,-t,n,s,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new Fe(l,3)),this.setAttribute("normal",new Fe(c,3)),this.setAttribute("uv",new Fe(h,2))}static fromJSON(e){return new wa(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function np(e){let t={};for(let i in e){t[i]={};for(let n in e[i]){let r=e[i][n];t[i][n]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.clone():Array.isArray(r)?r.slice():r}}return t}function Hr(e){let t={};for(let i=0;i<e.length;i++){let n=np(e[i]);for(let r in n)t[r]=n[r]}return t}function QU(e){return null===e.getRenderTarget()&&e.outputEncoding===xt?ba:S_}var rp={clone:np,merge:Hr},bi=class extends Cg{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=np(e.uniforms),this.uniformsGroups=function qhe(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let n in this.uniforms){let r=this.uniforms[n].value;t.uniforms[n]=r&&r.isTexture?{type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},sp=class extends pi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ye,this.projectionMatrix=new ye,this.projectionMatrixInverse=new ye}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},yr=class extends sp{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*_g*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*yg*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*_g*Math.atan(Math.tan(.5*yg*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*yg*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,s=this.view;if(null!==this.view&&this.view.enabled){let a=s.fullWidth,l=s.fullHeight;r+=s.offsetX*n/a,t-=s.offsetY*i/l,n*=s.width/a,i*=s.height/l}let o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Zhe=class extends pi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let n=new yr(-90,1,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);let r=new yr(-90,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);let s=new yr(-90,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let o=new yr(-90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);let a=new yr(-90,1,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(0,0,1),this.add(a);let l=new yr(-90,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();let i=this.renderTarget,[n,r,s,o,a,l]=this.children,c=e.getRenderTarget(),h=e.toneMapping,u=e.xr.enabled;e.toneMapping=gl,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=u,i.texture.needsPMREMUpdate=!0}},GM=class extends kn{constructor(e,t,i,n,r,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Fu,i,n,r,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Qhe=class extends di{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1};this.texture=new GM([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:It}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",n=new wa(5,5,5),r=new bi({name:"CubemapFromEquirect",uniforms:np(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:qn,blending:bn});r.uniforms.tEquirect.value=t;let s=new jr(n,r),o=t.minFilter;return t.minFilter===jd&&(t.minFilter=It),new Zhe(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,n){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(r)}},WM=new M,Khe=new M,$he=new an,Fs=class{constructor(e=new M(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let n=WM.subVectors(i,t).cross(Khe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(WM),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||$he.getNormalMatrix(e),n=this.coplanarPoint(WM).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}},lp=new ds,H_=new M,qM=class{constructor(e=new Fs,t=new Fs,i=new Fs,n=new Fs,r=new Fs,s=new Fs){this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){let o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(o-n,h-a,f-u,y-m).normalize(),t[1].setComponents(o+n,h+a,f+u,y+m).normalize(),t[2].setComponents(o+r,h+l,f+d,y+g).normalize(),t[3].setComponents(o-r,h-l,f-d,y-g).normalize(),t[4].setComponents(o-s,h-c,f-p,y-v).normalize(),t[5].setComponents(o+s,h+c,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),lp.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(lp)}intersectsSprite(e){return lp.center.set(0,0,0),lp.radius=.7071067811865476,lp.applyMatrix4(e.matrixWorld),this.intersectsSphere(lp)}intersectsSphere(e){let t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let n=t[i];if(H_.x=n.normal.x>0?e.max.x:e.min.x,H_.y=n.normal.y>0?e.max.y:e.min.y,H_.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(H_)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function KU(){let e=null,t=!1,i=null,n=null;function r(s,o){i(s,o),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function Jhe(e,t){let i=t.isWebGL2,n=new WeakMap;return{get:function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)},remove:function a(c){c.isInterleavedBufferAttribute&&(c=c.data);let h=n.get(c);h&&(e.deleteBuffer(h.buffer),n.delete(c))},update:function l(c,h){if(c.isGLBufferAttribute){let d=n.get(c);return void((!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version}))}c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);void 0===u?n.set(c,function r(c,h){let f,u=c.array,d=c.usage,p=e.createBuffer();if(e.bindBuffer(h,p),e.bufferData(h,u,d),c.onUploadCallback(),u instanceof Float32Array)f=5126;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");f=5131}else f=5123;else if(u instanceof Int16Array)f=5122;else if(u instanceof Uint32Array)f=5125;else if(u instanceof Int32Array)f=5124;else if(u instanceof Int8Array)f=5120;else if(u instanceof Uint8Array)f=5121;else{if(!(u instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);f=5121}return{buffer:p,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}(c,h)):u.version<c.version&&(function s(c,h,u){let d=h.array,p=h.updateRange;e.bindBuffer(u,c),-1===p.count?e.bufferSubData(u,0,d):(i?e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),h.onUploadCallback()}(u.buffer,c,h),u.version=c.version)}}}var G_=class extends Ze{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};let r=e/2,s=t/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,h=e/o,u=t/a,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){let v=g*u-s;for(let y=0;y<l;y++)p.push(y*h-r,-v,0),f.push(0,0,1),m.push(y/o),m.push(1-g/a)}for(let g=0;g<a;g++)for(let v=0;v<o;v++){let _=v+l*(g+1),b=v+1+l*(g+1),w=v+1+l*g;d.push(v+l*g,_,w),d.push(_,b,w)}this.setIndex(d),this.setAttribute("position",new Fe(p,3)),this.setAttribute("normal",new Fe(f,3)),this.setAttribute("uv",new Fe(m,2))}static fromJSON(e){return new G_(e.width,e.height,e.widthSegments,e.heightSegments)}},Mt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Ae={common:{diffuse:{value:new Je(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new an},uv2Transform:{value:new an},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new z(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Je(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Je(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new an}},sprite:{diffuse:{value:new Je(16777215)},opacity:{value:1},center:{value:new z(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new an}}},xa={basic:{uniforms:Hr([Ae.common,Ae.specularmap,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.fog]),vertexShader:Mt.meshbasic_vert,fragmentShader:Mt.meshbasic_frag},lambert:{uniforms:Hr([Ae.common,Ae.specularmap,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.fog,Ae.lights,{emissive:{value:new Je(0)}}]),vertexShader:Mt.meshlambert_vert,fragmentShader:Mt.meshlambert_frag},phong:{uniforms:Hr([Ae.common,Ae.specularmap,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.fog,Ae.lights,{emissive:{value:new Je(0)},specular:{value:new Je(1118481)},shininess:{value:30}}]),vertexShader:Mt.meshphong_vert,fragmentShader:Mt.meshphong_frag},standard:{uniforms:Hr([Ae.common,Ae.envmap,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.roughnessmap,Ae.metalnessmap,Ae.fog,Ae.lights,{emissive:{value:new Je(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Mt.meshphysical_vert,fragmentShader:Mt.meshphysical_frag},toon:{uniforms:Hr([Ae.common,Ae.aomap,Ae.lightmap,Ae.emissivemap,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.gradientmap,Ae.fog,Ae.lights,{emissive:{value:new Je(0)}}]),vertexShader:Mt.meshtoon_vert,fragmentShader:Mt.meshtoon_frag},matcap:{uniforms:Hr([Ae.common,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,Ae.fog,{matcap:{value:null}}]),vertexShader:Mt.meshmatcap_vert,fragmentShader:Mt.meshmatcap_frag},points:{uniforms:Hr([Ae.points,Ae.fog]),vertexShader:Mt.points_vert,fragmentShader:Mt.points_frag},dashed:{uniforms:Hr([Ae.common,Ae.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mt.linedashed_vert,fragmentShader:Mt.linedashed_frag},depth:{uniforms:Hr([Ae.common,Ae.displacementmap]),vertexShader:Mt.depth_vert,fragmentShader:Mt.depth_frag},normal:{uniforms:Hr([Ae.common,Ae.bumpmap,Ae.normalmap,Ae.displacementmap,{opacity:{value:1}}]),vertexShader:Mt.meshnormal_vert,fragmentShader:Mt.meshnormal_frag},sprite:{uniforms:Hr([Ae.sprite,Ae.fog]),vertexShader:Mt.sprite_vert,fragmentShader:Mt.sprite_frag},background:{uniforms:{uvTransform:{value:new an},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Mt.background_vert,fragmentShader:Mt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Mt.backgroundCube_vert,fragmentShader:Mt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Mt.cube_vert,fragmentShader:Mt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Mt.equirect_vert,fragmentShader:Mt.equirect_frag},distanceRGBA:{uniforms:Hr([Ae.common,Ae.displacementmap,{referencePosition:{value:new M},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Mt.distanceRGBA_vert,fragmentShader:Mt.distanceRGBA_frag},shadow:{uniforms:Hr([Ae.lights,Ae.fog,{color:{value:new Je(0)},opacity:{value:1}}]),vertexShader:Mt.shadow_vert,fragmentShader:Mt.shadow_frag}};xa.physical={uniforms:Hr([xa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new z(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Je(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new z},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Je(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Je(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Mt.meshphysical_vert,fragmentShader:Mt.meshphysical_frag};var W_={r:0,b:0,g:0};function Rfe(e,t,i,n,r,s,o){let c,h,a=new Je(0),l=!0===s?0:1,u=null,d=0,p=null;function m(g,v){g.getRGB(W_,QU(e)),n.buffers.color.setClear(W_.r,W_.g,W_.b,v,o)}return{getClearColor:function(){return a},setClearColor:function(g,v=1){a.set(g),l=v,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(a,l)},render:function f(g,v){let y=!1,_=!0===v.isScene?v.background:null;_&&_.isTexture&&(_=(v.backgroundBlurriness>0?i:t).get(_));let b=e.xr,w=b.getSession&&b.getSession();w&&"additive"===w.environmentBlendMode&&(_=null),null===_?m(a,l):_&&_.isColor&&(m(_,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===vg)?(void 0===h&&(h=new jr(new wa(1,1,1),new bi({name:"BackgroundCubeMaterial",uniforms:np(xa.backgroundCube.uniforms),vertexShader:xa.backgroundCube.vertexShader,fragmentShader:xa.backgroundCube.fragmentShader,side:qn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(C,x,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=_.encoding!==xt,(u!==_||d!==_.version||p!==e.toneMapping)&&(h.material.needsUpdate=!0,u=_,d=_.version,p=e.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(void 0===c&&(c=new jr(new G_(2,2),new bi({name:"BackgroundMaterial",uniforms:np(xa.background.uniforms),vertexShader:xa.background.vertexShader,fragmentShader:xa.background.fragmentShader,side:No,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=_.encoding!==xt,!0===_.matrixAutoUpdate&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(u!==_||d!==_.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,u=_,d=_.version,p=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}}}function Ofe(e,t,i,n){let r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=g(null),c=l,h=!1;function p(R){return n.isWebGL2?e.bindVertexArray(R):s.bindVertexArrayOES(R)}function f(R){return n.isWebGL2?e.deleteVertexArray(R):s.deleteVertexArrayOES(R)}function g(R){let L=[],j=[],F=[];for(let N=0;N<r;N++)L[N]=0,j[N]=0,F[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:j,attributeDivisors:F,object:R,attributes:{},index:null}}function _(){let R=c.newAttributes;for(let L=0,j=R.length;L<j;L++)R[L]=0}function b(R){w(R,0)}function w(R,L){let F=c.enabledAttributes,N=c.attributeDivisors;c.newAttributes[R]=1,0===F[R]&&(e.enableVertexAttribArray(R),F[R]=1),N[R]!==L&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,L),N[R]=L)}function C(){let R=c.newAttributes,L=c.enabledAttributes;for(let j=0,F=L.length;j<F;j++)L[j]!==R[j]&&(e.disableVertexAttribArray(j),L[j]=0)}function x(R,L,j,F,N,q){!0!==n.isWebGL2||5124!==j&&5125!==j?e.vertexAttribPointer(R,L,j,F,N,q):e.vertexAttribIPointer(R,L,j,N,q)}function I(){P(),h=!0,c!==l&&(c=l,p(c.object))}function P(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function u(R,L,j,F,N){let q=!1;if(o){let W=function m(R,L,j){let F=!0===j.wireframe,N=a[R.id];void 0===N&&(N={},a[R.id]=N);let q=N[L.id];void 0===q&&(q={},N[L.id]=q);let W=q[F];return void 0===W&&(W=g(function d(){return n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}()),q[F]=W),W}(F,j,L);c!==W&&(c=W,p(c.object)),q=function v(R,L,j,F){let N=c.attributes,q=L.attributes,W=0,U=j.getAttributes();for(let V in U)if(U[V].location>=0){let Y=N[V],G=q[V];if(void 0===G&&("instanceMatrix"===V&&R.instanceMatrix&&(G=R.instanceMatrix),"instanceColor"===V&&R.instanceColor&&(G=R.instanceColor)),void 0===Y||Y.attribute!==G||G&&Y.data!==G.data)return!0;W++}return c.attributesNum!==W||c.index!==F}(R,F,j,N),q&&function y(R,L,j,F){let N={},q=L.attributes,W=0,U=j.getAttributes();for(let V in U)if(U[V].location>=0){let Y=q[V];void 0===Y&&("instanceMatrix"===V&&R.instanceMatrix&&(Y=R.instanceMatrix),"instanceColor"===V&&R.instanceColor&&(Y=R.instanceColor));let G={};G.attribute=Y,Y&&Y.data&&(G.data=Y.data),N[V]=G,W++}c.attributes=N,c.attributesNum=W,c.index=F}(R,F,j,N)}else{let W=!0===L.wireframe;(c.geometry!==F.id||c.program!==j.id||c.wireframe!==W)&&(c.geometry=F.id,c.program=j.id,c.wireframe=W,q=!0)}null!==N&&i.update(N,34963),(q||h)&&(h=!1,function S(R,L,j,F){if(!1===n.isWebGL2&&(R.isInstancedMesh||F.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;_();let N=F.attributes,q=j.getAttributes(),W=L.defaultAttributeValues;for(let U in q){let V=q[U];if(V.location>=0){let Y=N[U];if(void 0===Y&&("instanceMatrix"===U&&R.instanceMatrix&&(Y=R.instanceMatrix),"instanceColor"===U&&R.instanceColor&&(Y=R.instanceColor)),void 0!==Y){let G=Y.normalized,X=Y.itemSize,H=i.get(Y);if(void 0===H)continue;let re=H.buffer,K=H.type,se=H.bytesPerElement;if(Y.isInterleavedBufferAttribute){let $=Y.data,ge=$.stride,ce=Y.offset;if($.isInstancedInterleavedBuffer){for(let ae=0;ae<V.locationSize;ae++)w(V.location+ae,$.meshPerAttribute);!0!==R.isInstancedMesh&&void 0===F._maxInstanceCount&&(F._maxInstanceCount=$.meshPerAttribute*$.count)}else for(let ae=0;ae<V.locationSize;ae++)b(V.location+ae);e.bindBuffer(34962,re);for(let ae=0;ae<V.locationSize;ae++)x(V.location+ae,X/V.locationSize,K,G,ge*se,(ce+X/V.locationSize*ae)*se)}else{if(Y.isInstancedBufferAttribute){for(let $=0;$<V.locationSize;$++)w(V.location+$,Y.meshPerAttribute);!0!==R.isInstancedMesh&&void 0===F._maxInstanceCount&&(F._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let $=0;$<V.locationSize;$++)b(V.location+$);e.bindBuffer(34962,re);for(let $=0;$<V.locationSize;$++)x(V.location+$,X/V.locationSize,K,G,X*se,X/V.locationSize*$*se)}}else if(void 0!==W){let G=W[U];if(void 0!==G)switch(G.length){case 2:e.vertexAttrib2fv(V.location,G);break;case 3:e.vertexAttrib3fv(V.location,G);break;case 4:e.vertexAttrib4fv(V.location,G);break;default:e.vertexAttrib1fv(V.location,G)}}}}C()}(R,L,j,F),null!==N&&e.bindBuffer(34963,i.get(N).buffer))},reset:I,resetDefaultState:P,dispose:function E(){I();for(let R in a){let L=a[R];for(let j in L){let F=L[j];for(let N in F)f(F[N].object),delete F[N];delete L[j]}delete a[R]}},releaseStatesOfGeometry:function D(R){if(void 0===a[R.id])return;let L=a[R.id];for(let j in L){let F=L[j];for(let N in F)f(F[N].object),delete F[N];delete L[j]}delete a[R.id]},releaseStatesOfProgram:function T(R){for(let L in a){let j=a[L];if(void 0===j[R.id])continue;let F=j[R.id];for(let N in F)f(F[N].object),delete F[N];delete j[R.id]}},initAttributes:_,enableAttribute:b,disableUnusedAttributes:C}}function Lfe(e,t,i,n){let s,r=n.isWebGL2;this.setMode=function o(c){s=c},this.render=function a(c,h){e.drawArrays(s,c,h),i.update(h,s,1)},this.renderInstances=function l(c,h,u){if(0===u)return;let d,p;if(r)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",null===d)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[p](s,c,h,u),i.update(h,s,u)}}function Nfe(e,t,i){let n;function s(x){if("highp"===x){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";x="mediump"}return"mediump"===x&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let o=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,a=void 0!==i.precision?i.precision:"highp",l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);let c=o||t.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,u=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),m=e.getParameter(34921),g=e.getParameter(36347),v=e.getParameter(36348),y=e.getParameter(36349),_=d>0,b=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:function r(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let x=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(x.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:_,floatFragmentTextures:b,floatVertexTextures:_&&b,maxSamples:o?e.getParameter(36183):0}}function kfe(e){let t=this,i=null,n=0,r=!1,s=!1,o=new Fs,a=new an,l={value:null,needsUpdate:!1};function h(u,d,p,f){let m=null!==u?u.length:0,g=null;if(0!==m){if(g=l.value,!0!==f||null===g){let v=p+4*m,y=d.matrixWorldInverse;a.getNormalMatrix(y),(null===g||g.length<v)&&(g=new Float32Array(v));for(let _=0,b=p;_!==m;++_,b+=4)o.copy(u[_]).applyMatrix4(y,a),o.normal.toArray(g,b),g[b+3]=o.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){let p=0!==u.length||d||0!==n||r;return r=d,n=u.length,p},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,d){i=h(u,d,0)},this.setState=function(u,d,p){let f=u.clippingPlanes,m=u.clipIntersection,g=u.clipShadows,v=e.get(u);if(!r||null===f||0===f.length||s&&!g)s?h(null):function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}();else{let y=s?0:n,_=4*y,b=v.clippingState||null;l.value=b,b=h(f,d,_,p);for(let w=0;w!==_;++w)b[w]=i[w];v.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}}}function Ffe(e){let t=new WeakMap;function i(o,a){return a===aM?o.mapping=Fu:a===lM&&(o.mapping=Bu),o}function r(o){let a=o.target;a.removeEventListener("dispose",r);let l=t.get(a);void 0!==l&&(t.delete(a),l.dispose())}return{get:function n(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){let a=o.mapping;if(a===aM||a===lM){if(t.has(o))return i(t.get(o).texture,o.mapping);{let l=o.image;if(l&&l.height>0){let c=new Qhe(l.height/2);return c.fromEquirectangularTexture(e,o),t.set(o,c),o.addEventListener("dispose",r),i(c.texture,o.mapping)}return null}}}return o},dispose:function s(){t=new WeakMap}}}var YM=class extends sp{constructor(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,s=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,s=r+l*this.view.width,o-=c*this.view.offsetY,a=o-c*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},$U=[.125,.215,.35,.446,.526,.582],XM=new YM,JU=new Je,ZM=null,Xu=(1+Math.sqrt(5))/2,up=1/Xu,ej=[new M(1,1,1),new M(-1,1,1),new M(1,1,-1),new M(-1,1,-1),new M(0,Xu,up),new M(0,Xu,-up),new M(up,0,Xu),new M(-up,0,Xu),new M(Xu,up,0),new M(-Xu,up,0)],tj=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){ZM=this._renderer.getRenderTarget(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=rj(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=nj(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ZM),e.scissorTest=!1,q_(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Fu||e.mapping===Bu?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),ZM=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:It,minFilter:It,generateMipmaps:!1,type:Vu,format:Ls,encoding:_a,depthBuffer:!1},n=ij(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ij(e,t,i);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function Bfe(e){let t=[],i=[],n=[],r=e,s=e-4+1+$U.length;for(let o=0;o<s;o++){let a=Math.pow(2,r);i.push(a);let l=1/a;o>e-4?l=$U[o-e+4-1]:0===o&&(l=0),n.push(l);let c=1/(a-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),_=new Float32Array(g*f*p),b=new Float32Array(v*f*p);for(let C=0;C<p;C++){let x=C%3*2/3-1,S=C>2?0:-1;y.set([x,S,0,x+2/3,S,0,x+2/3,S+1,0,x,S,0,x+2/3,S+1,0,x,S+1,0],m*f*C),_.set(d,g*f*C),b.set([C,C,C,C,C,C],v*f*C)}let w=new Ze;w.setAttribute("position",new st(y,m)),w.setAttribute("uv",new st(_,g)),w.setAttribute("faceIndex",new st(b,v)),t.push(w),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(r)),this._blurMaterial=function Vfe(e,t,i){let n=new Float32Array(20),r=new M(0,1,0);return new bi({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:bn,depthTest:!1,depthWrite:!1})}(r,e,t)}return n}_compileMaterial(e){let t=new jr(this._lodPlanes[0],e);this._renderer.compile(t,XM)}_sceneToCubeUV(e,t,i,n){let r=new yr(90,1,t,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(JU),a.toneMapping=gl,a.autoClear=!1;let h=new Eg({name:"PMREM.Background",side:qn,depthWrite:!1,depthTest:!1}),u=new jr(new wa,h),d=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(JU),d=!0);for(let f=0;f<6;f++){let m=f%3;0===m?(r.up.set(0,s[f],0),r.lookAt(o[f],0,0)):1===m?(r.up.set(0,0,s[f]),r.lookAt(0,o[f],0)):(r.up.set(0,s[f],0),r.lookAt(0,0,o[f]));let g=this._cubeSize;q_(n,m*g,f>2?g:0,g,g),a.setRenderTarget(n),d&&a.render(u,r),a.render(e,r)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,n=e.mapping===Fu||e.mapping===Bu;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=rj()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=nj());let r=n?this._cubemapMaterial:this._equirectMaterial,s=new jr(this._lodPlanes[0],r);r.uniforms.envMap.value=e;let a=this._cubeSize;q_(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(s,XM)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let r=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]);this._blur(e,n-1,n,r,ej[(n-1)%ej.length])}t.autoClear=i}_blur(e,t,i,n,r){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,o){let a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");let h=new jr(this._lodPlanes[n],l),u=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,f=r/p,m=isFinite(r)?1+Math.floor(3*f):20;m>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);let g=[],v=0;for(let C=0;C<20;++C){let x=C/f,S=Math.exp(-x*x/2);g.push(S),0===C?v+=S:C<m&&(v+=2*S)}for(let C=0;C<g.length;C++)g[C]=g[C]/v;u.envMap.value=e.texture,u.samples.value=m,u.weights.value=g,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);let{_lodMax:y}=this;u.dTheta.value=p,u.mipInt.value=y-i;let _=this._sizeLods[n];q_(t,3*_*(n>y-4?n-y+4:0),4*(this._cubeSize-_),3*_,2*_),a.setRenderTarget(t),a.render(h,XM)}};function ij(e,t,i){let n=new di(e,t,i);return n.texture.mapping=vg,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function q_(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function nj(){return new bi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:bn,depthTest:!1,depthWrite:!1})}function rj(){return new bi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:bn,depthTest:!1,depthWrite:!1})}function zfe(e){let t=new WeakMap,i=null;function s(a){let l=a.target;l.removeEventListener("dispose",s);let c=t.get(l);void 0!==c&&(t.delete(l),c.dispose())}return{get:function n(a){if(a&&a.isTexture){let l=a.mapping,c=l===aM||l===lM,h=l===Fu||l===Bu;if(c||h){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let u=t.get(a);return null===i&&(i=new tj(e)),u=c?i.fromEquirectangular(a,u):i.fromCubemap(a,u),t.set(a,u),u.texture}if(t.has(a))return t.get(a).texture;{let u=a.image;if(c&&u&&u.height>0||h&&u&&function r(a){let l=0;for(let h=0;h<6;h++)void 0!==a[h]&&l++;return 6===l}(u)){null===i&&(i=new tj(e));let d=c?i.fromEquirectangular(a):i.fromCubemap(a);return t.set(a,d),a.addEventListener("dispose",s),d.texture}return null}}}return a},dispose:function o(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Ufe(e){let t={};function i(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(n){return null!==i(n)},init:function(n){n.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(n){let r=i(n);return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function jfe(e,t,i,n){let r={},s=new WeakMap;function o(u){let d=u.target;null!==d.index&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",o),delete r[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),n.releaseStatesOfGeometry(d),!0===d.isInstancedBufferGeometry&&delete d._maxInstanceCount,i.memory.geometries--}function c(u){let d=[],p=u.index,f=u.attributes.position,m=0;if(null!==p){let y=p.array;m=p.version;for(let _=0,b=y.length;_<b;_+=3){let w=y[_+0],C=y[_+1],x=y[_+2];d.push(w,C,C,x,x,w)}}else{m=f.version;for(let _=0,b=f.array.length/3-1;_<b;_+=3){let w=_+0,C=_+1,x=_+2;d.push(w,C,C,x,x,w)}}let g=new(LU(d)?ep:XU)(d,1);g.version=m;let v=s.get(u);v&&t.remove(v),s.set(u,g)}return{get:function a(u,d){return!0===r[d.id]||(d.addEventListener("dispose",o),r[d.id]=!0,i.memory.geometries++),d},update:function l(u){let d=u.attributes;for(let f in d)t.update(d[f],34962);let p=u.morphAttributes;for(let f in p){let m=p[f];for(let g=0,v=m.length;g<v;g++)t.update(m[g],34962)}},getWireframeAttribute:function h(u){let d=s.get(u);if(d){let p=u.index;null!==p&&d.version<p.version&&c(u)}else c(u);return s.get(u)}}}function Hfe(e,t,i,n){let s,a,l,r=n.isWebGL2;this.setMode=function o(d){s=d},this.setIndex=function c(d){a=d.type,l=d.bytesPerElement},this.render=function h(d,p){e.drawElements(s,p,a,d*l),i.update(p,s,1)},this.renderInstances=function u(d,p,f){if(0===f)return;let m,g;if(r)m=e,g="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",null===m)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m[g](s,p,a,d*l,f),i.update(p,s,f)}}function Gfe(e){let i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function r(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function n(s,o,a){switch(i.calls++,o){case 4:i.triangles+=a*(s/3);break;case 1:i.lines+=a*(s/2);break;case 3:i.lines+=a*(s-1);break;case 2:i.lines+=a*s;break;case 0:i.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function Wfe(e,t){return e[0]-t[0]}function qfe(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Yfe(e,t,i){let n={},r=new Float32Array(8),s=new WeakMap,o=new St,a=[];for(let c=0;c<8;c++)a[c]=[c,0];return{update:function l(c,h,u,d){let p=c.morphTargetInfluences;if(!0===t.isWebGL2){let f=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=void 0!==f?f.length:0,g=s.get(h);if(void 0===g||g.count!==m){let _=function(){R.dispose(),s.delete(h),h.removeEventListener("dispose",_)};void 0!==g&&g.texture.dispose();let b=void 0!==h.morphAttributes.position,w=void 0!==h.morphAttributes.normal,C=void 0!==h.morphAttributes.color,x=h.morphAttributes.position||[],S=h.morphAttributes.normal||[],E=h.morphAttributes.color||[],D=0;!0===b&&(D=1),!0===w&&(D=2),!0===C&&(D=3);let T=h.attributes.position.count*D,I=1;T>t.maxTextureSize&&(I=Math.ceil(T/t.maxTextureSize),T=t.maxTextureSize);let P=new Float32Array(T*I*4*m),R=new BU(P,T,I,m);R.type=zr,R.needsUpdate=!0;let L=4*D;for(let j=0;j<m;j++){let F=x[j],N=S[j],q=E[j],W=T*I*4*j;for(let U=0;U<F.count;U++){let V=U*L;!0===b&&(o.fromBufferAttribute(F,U),P[W+V+0]=o.x,P[W+V+1]=o.y,P[W+V+2]=o.z,P[W+V+3]=0),!0===w&&(o.fromBufferAttribute(N,U),P[W+V+4]=o.x,P[W+V+5]=o.y,P[W+V+6]=o.z,P[W+V+7]=0),!0===C&&(o.fromBufferAttribute(q,U),P[W+V+8]=o.x,P[W+V+9]=o.y,P[W+V+10]=o.z,P[W+V+11]=4===q.itemSize?o.w:1)}}g={count:m,texture:R,size:new z(T,I)},s.set(h,g),h.addEventListener("dispose",_)}let v=0;for(let _=0;_<p.length;_++)v+=p[_];let y=h.morphTargetsRelative?1:1-v;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{let f=void 0===p?0:p.length,m=n[h.id];if(void 0===m||m.length!==f){m=[];for(let b=0;b<f;b++)m[b]=[b,0];n[h.id]=m}for(let b=0;b<f;b++){let w=m[b];w[0]=b,w[1]=p[b]}m.sort(qfe);for(let b=0;b<8;b++)b<f&&m[b][1]?(a[b][0]=m[b][0],a[b][1]=m[b][1]):(a[b][0]=Number.MAX_SAFE_INTEGER,a[b][1]=0);a.sort(Wfe);let g=h.morphAttributes.position,v=h.morphAttributes.normal,y=0;for(let b=0;b<8;b++){let w=a[b],C=w[0],x=w[1];C!==Number.MAX_SAFE_INTEGER&&x?(g&&h.getAttribute("morphTarget"+b)!==g[C]&&h.setAttribute("morphTarget"+b,g[C]),v&&h.getAttribute("morphNormal"+b)!==v[C]&&h.setAttribute("morphNormal"+b,v[C]),r[b]=x,y+=x):(g&&!0===h.hasAttribute("morphTarget"+b)&&h.deleteAttribute("morphTarget"+b),v&&!0===h.hasAttribute("morphNormal"+b)&&h.deleteAttribute("morphNormal"+b),r[b]=0)}let _=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",_),d.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Xfe(e,t,i,n){let r=new WeakMap;function a(l){let c=l.target;c.removeEventListener("dispose",a),i.remove(c.instanceMatrix),null!==c.instanceColor&&i.remove(c.instanceColor)}return{update:function s(l){let c=n.render.frame,u=t.get(l,l.geometry);return r.get(u)!==c&&(t.update(u),r.set(u,c)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),i.update(l.instanceMatrix,34962),null!==l.instanceColor&&i.update(l.instanceColor,34962)),u},dispose:function o(){r=new WeakMap}}}var sj=new kn,oj=new BU,aj=new class extends kn{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ei,this.minFilter=Ei,this.wrapR=on,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},lj=new GM,cj=[],uj=[],hj=new Float32Array(16),dj=new Float32Array(9),pj=new Float32Array(4);function hp(e,t,i){let n=e[0];if(n<=0||n>0)return e;let r=t*i,s=cj[r];if(void 0===s&&(s=new Float32Array(r),cj[r]=s),0!==t){n.toArray(s,0);for(let o=1,a=0;o!==t;++o)a+=i,e[o].toArray(s,a)}return s}function Fn(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Bn(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function Y_(e,t){let i=uj[t];void 0===i&&(i=new Int32Array(t),uj[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Zfe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Qfe(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Fn(i,t))return;e.uniform2fv(this.addr,t),Bn(i,t)}}function Kfe(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Fn(i,t))return;e.uniform3fv(this.addr,t),Bn(i,t)}}function $fe(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Fn(i,t))return;e.uniform4fv(this.addr,t),Bn(i,t)}}function Jfe(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(Fn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Bn(i,t)}else{if(Fn(i,n))return;pj.set(n),e.uniformMatrix2fv(this.addr,!1,pj),Bn(i,n)}}function eme(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(Fn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Bn(i,t)}else{if(Fn(i,n))return;dj.set(n),e.uniformMatrix3fv(this.addr,!1,dj),Bn(i,n)}}function tme(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(Fn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Bn(i,t)}else{if(Fn(i,n))return;hj.set(n),e.uniformMatrix4fv(this.addr,!1,hj),Bn(i,n)}}function ime(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function nme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Fn(i,t))return;e.uniform2iv(this.addr,t),Bn(i,t)}}function rme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Fn(i,t))return;e.uniform3iv(this.addr,t),Bn(i,t)}}function sme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Fn(i,t))return;e.uniform4iv(this.addr,t),Bn(i,t)}}function ome(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function ame(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Fn(i,t))return;e.uniform2uiv(this.addr,t),Bn(i,t)}}function lme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Fn(i,t))return;e.uniform3uiv(this.addr,t),Bn(i,t)}}function cme(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Fn(i,t))return;e.uniform4uiv(this.addr,t),Bn(i,t)}}function ume(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||sj,r)}function hme(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||aj,r)}function dme(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||lj,r)}function pme(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||oj,r)}function mme(e,t){e.uniform1fv(this.addr,t)}function gme(e,t){let i=hp(t,this.size,2);e.uniform2fv(this.addr,i)}function vme(e,t){let i=hp(t,this.size,3);e.uniform3fv(this.addr,i)}function yme(e,t){let i=hp(t,this.size,4);e.uniform4fv(this.addr,i)}function _me(e,t){let i=hp(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function bme(e,t){let i=hp(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function wme(e,t){let i=hp(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function xme(e,t){e.uniform1iv(this.addr,t)}function Sme(e,t){e.uniform2iv(this.addr,t)}function Cme(e,t){e.uniform3iv(this.addr,t)}function Eme(e,t){e.uniform4iv(this.addr,t)}function Mme(e,t){e.uniform1uiv(this.addr,t)}function Ame(e,t){e.uniform2uiv(this.addr,t)}function Dme(e,t){e.uniform3uiv(this.addr,t)}function Tme(e,t){e.uniform4uiv(this.addr,t)}function Ime(e,t,i){let n=this.cache,r=t.length,s=Y_(i,r);Fn(n,s)||(e.uniform1iv(this.addr,s),Bn(n,s));for(let o=0;o!==r;++o)i.setTexture2D(t[o]||sj,s[o])}function Pme(e,t,i){let n=this.cache,r=t.length,s=Y_(i,r);Fn(n,s)||(e.uniform1iv(this.addr,s),Bn(n,s));for(let o=0;o!==r;++o)i.setTexture3D(t[o]||aj,s[o])}function Rme(e,t,i){let n=this.cache,r=t.length,s=Y_(i,r);Fn(n,s)||(e.uniform1iv(this.addr,s),Bn(n,s));for(let o=0;o!==r;++o)i.setTextureCube(t[o]||lj,s[o])}function Ome(e,t,i){let n=this.cache,r=t.length,s=Y_(i,r);Fn(n,s)||(e.uniform1iv(this.addr,s),Bn(n,s));for(let o=0;o!==r;++o)i.setTexture2DArray(t[o]||oj,s[o])}var Nme=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function fme(e){switch(e){case 5126:return Zfe;case 35664:return Qfe;case 35665:return Kfe;case 35666:return $fe;case 35674:return Jfe;case 35675:return eme;case 35676:return tme;case 5124:case 35670:return ime;case 35667:case 35671:return nme;case 35668:case 35672:return rme;case 35669:case 35673:return sme;case 5125:return ome;case 36294:return ame;case 36295:return lme;case 36296:return cme;case 35678:case 36198:case 36298:case 36306:case 35682:return ume;case 35679:case 36299:case 36307:return hme;case 35680:case 36300:case 36308:case 36293:return dme;case 36289:case 36303:case 36311:case 36292:return pme}}(t.type)}},kme=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function Lme(e){switch(e){case 5126:return mme;case 35664:return gme;case 35665:return vme;case 35666:return yme;case 35674:return _me;case 35675:return bme;case 35676:return wme;case 5124:case 35670:return xme;case 35667:case 35671:return Sme;case 35668:case 35672:return Cme;case 35669:case 35673:return Eme;case 5125:return Mme;case 36294:return Ame;case 36295:return Dme;case 36296:return Tme;case 35678:case 36198:case 36298:case 36306:case 35682:return Ime;case 35679:case 36299:case 36307:return Pme;case 35680:case 36300:case 36308:case 36293:return Rme;case 36289:case 36303:case 36311:case 36292:return Ome}}(t.type)}},Fme=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let n=this.seq;for(let r=0,s=n.length;r!==s;++r){let o=n[r];o.setValue(e,t[o.id],i)}}},KM=/(\w+)(\])?(\[|\.)?/g;function fj(e,t){e.seq.push(t),e.map[t.id]=t}function Bme(e,t,i){let n=e.name,r=n.length;for(KM.lastIndex=0;;){let s=KM.exec(n),a=s[1],c=s[3];if("]"===s[2]&&(a|=0),void 0===c||"["===c&&KM.lastIndex+2===r){fj(i,void 0===c?new Nme(a,e,t):new kme(a,e,t));break}{let h=i.map[a];void 0===h&&(h=new Fme(a),fj(i,h)),i=h}}}var X_=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){let r=e.getActiveUniform(t,n);Bme(r,e.getUniformLocation(t,r.name),this)}}setValue(e,t,i,n){let r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){let n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){let o=t[r],a=i[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,n)}}static seqWithValue(e,t){let i=[];for(let n=0,r=e.length;n!==r;++n){let s=e[n];s.id in t&&i.push(s)}return i}};function mj(e,t,i){let n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}var Vme=0;function gj(e,t,i){let n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";let s=/ERROR: 0:(\d+)/.exec(r);if(s){let o=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function zme(e,t){let i=e.split("\n"),n=[],r=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let o=r;o<s;o++){let a=o+1;n.push(`${a===t?">":" "} ${a}: ${i[o]}`)}return n.join("\n")}(e.getShaderSource(t),o)}return r}function jme(e,t){let i=function Ume(e){switch(e){case _a:return["Linear","( value )"];case xt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Hme(e,t){let i;switch(t){case Zue:i="Linear";break;case Que:i="Reinhard";break;case Kue:i="OptimizedCineon";break;case $ue:i="ACESFilmic";break;case Jue:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Ig(e){return""!==e}function vj(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function yj(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Yme=/^[ \t]*#include +<([\w\d./]+)>/gm;function $M(e){return e.replace(Yme,Xme)}function Xme(e,t){let i=Mt[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return $M(i)}var Zme=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _j(e){return e.replace(Zme,Qme)}function Qme(e,t,i,n){let r="";for(let s=parseInt(t);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function bj(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ige(e,t,i,n){let g,v,r=e.getContext(),s=i.defines,o=i.vertexShader,a=i.fragmentShader,l=function Kme(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===sM?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Aue?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===gg&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function $me(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Fu:case Bu:t="ENVMAP_TYPE_CUBE";break;case vg:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function Jme(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===Bu&&(t="ENVMAP_MODE_REFRACTION"),t}(i),u=function ege(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case eU:t="ENVMAP_BLENDING_MULTIPLY";break;case Yue:t="ENVMAP_BLENDING_MIX";break;case Xue:t="ENVMAP_BLENDING_ADD"}return t}(i),d=function tge(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),p=i.isWebGL2?"":function Gme(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ig).join("\n")}(i),f=function Wme(e){let t=[];for(let i in e){let n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(s),m=r.createProgram(),y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=[f].filter(Ig).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(Ig).join("\n"),v.length>0&&(v+="\n")):(g=[bj(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ig).join("\n"),v=[p,bj(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==gl?"#define TONE_MAPPING":"",i.toneMapping!==gl?Mt.tonemapping_pars_fragment:"",i.toneMapping!==gl?Hme("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Mt.encodings_pars_fragment,jme("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Ig).join("\n")),o=$M(o),o=vj(o,i),o=yj(o,i),a=$M(a),a=vj(a,i),a=yj(a,i),o=_j(o),a=_j(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",i.glslVersion===PU?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===PU?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);let x,S,b=y+v+a,w=mj(r,35633,y+g+o),C=mj(r,35632,b);if(r.attachShader(m,w),r.attachShader(m,C),void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){let E=r.getProgramInfoLog(m).trim(),D=r.getShaderInfoLog(w).trim(),T=r.getShaderInfoLog(C).trim(),I=!0,P=!0;if(!1===r.getProgramParameter(m,35714)){I=!1;let R=gj(r,w,"vertex"),L=gj(r,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+E+"\n"+R+"\n"+L)}else""!==E?console.warn("THREE.WebGLProgram: Program Info Log:",E):(""===D||""===T)&&(P=!1);P&&(this.diagnostics={runnable:I,programLog:E,vertexShader:{log:D,prefix:g},fragmentShader:{log:T,prefix:v}})}return r.deleteShader(w),r.deleteShader(C),this.getUniforms=function(){return void 0===x&&(x=new X_(r,m)),x},this.getAttributes=function(){return void 0===S&&(S=function qme(e,t){let i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){let s=e.getActiveAttrib(t,r),o=s.name,a=1;35674===s.type&&(a=2),35675===s.type&&(a=3),35676===s.type&&(a=4),i[o]={type:s.type,location:e.getAttribLocation(t,o),locationSize:a}}return i}(r,m)),S},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=Vme++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=C,this}var nge=0,rge=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let i=e.fragmentShader,n=this._getShaderStage(e.vertexShader),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return void 0===i&&(i=new sge(e),t.set(e,i)),i}},sge=class{constructor(e){this.id=nge++,this.code=e,this.usedTimes=0}};function oge(e,t,i,n,r,s,o){let a=new NM,l=new rge,c=[],h=r.isWebGL2,u=r.logarithmicDepthBuffer,d=r.vertexTextures,p=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function m(S,E,D,T,I){let P=T.fog,R=I.geometry,j=(S.isMeshStandardMaterial?i:t).get(S.envMap||(S.isMeshStandardMaterial?T.environment:null)),F=j&&j.mapping===vg?j.image.height:null,N=f[S.type];null!==S.precision&&(p=r.getMaxPrecision(S.precision),p!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",p,"instead."));let V,Y,G,X,q=R.morphAttributes.position||R.morphAttributes.normal||R.morphAttributes.color,W=void 0!==q?q.length:0,U=0;if(void 0!==R.morphAttributes.position&&(U=1),void 0!==R.morphAttributes.normal&&(U=2),void 0!==R.morphAttributes.color&&(U=3),N){let $=xa[N];V=$.vertexShader,Y=$.fragmentShader}else V=S.vertexShader,Y=S.fragmentShader,l.update(S),G=l.getVertexShaderID(S),X=l.getFragmentShaderID(S);let H=e.getRenderTarget(),K=S.clearcoat>0,se=S.iridescence>0;return{isWebGL2:h,shaderID:N,shaderName:S.type,vertexShader:V,fragmentShader:Y,defines:S.defines,customVertexShaderID:G,customFragmentShaderID:X,isRawShaderMaterial:!0===S.isRawShaderMaterial,glslVersion:S.glslVersion,precision:p,instancing:!0===I.isInstancedMesh,instancingColor:!0===I.isInstancedMesh&&null!==I.instanceColor,supportsVertexTextures:d,outputEncoding:null===H?e.outputEncoding:!0===H.isXRRenderTarget?H.texture.encoding:_a,map:!!S.map,matcap:!!S.matcap,envMap:!!j,envMapMode:j&&j.mapping,envMapCubeUVHeight:F,lightMap:!!S.lightMap,aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===ghe,tangentSpaceNormalMap:S.normalMapType===mhe,decodeVideoTexture:!!S.map&&!0===S.map.isVideoTexture&&S.map.encoding===xt,clearcoat:K,clearcoatMap:K&&!!S.clearcoatMap,clearcoatRoughnessMap:K&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:K&&!!S.clearcoatNormalMap,iridescence:se,iridescenceMap:se&&!!S.iridescenceMap,iridescenceThicknessMap:se&&!!S.iridescenceThicknessMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularColorMap:!!S.specularColorMap,opaque:!1===S.transparent&&S.blending===ku,alphaMap:!!S.alphaMap,alphaTest:S.alphaTest>0,gradientMap:!!S.gradientMap,sheen:S.sheen>0,sheenColorMap:!!S.sheenColorMap,sheenRoughnessMap:!!S.sheenRoughnessMap,transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!R.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:!0===S.vertexColors&&!!R.attributes.color&&4===R.attributes.color.itemSize,vertexUvs:!!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatMap||S.clearcoatRoughnessMap||S.clearcoatNormalMap||S.iridescenceMap||S.iridescenceThicknessMap||S.displacementMap||S.transmissionMap||S.thicknessMap||S.specularIntensityMap||S.specularColorMap||S.sheenColorMap||S.sheenRoughnessMap),uvsVertexOnly:!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatNormalMap||S.iridescenceMap||S.iridescenceThicknessMap||S.transmission>0||S.transmissionMap||S.thicknessMap||S.specularIntensityMap||S.specularColorMap||S.sheen>0||S.sheenColorMap||S.sheenRoughnessMap||!S.displacementMap),fog:!!P,useFog:!0===S.fog,fogExp2:P&&P.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===I.isSkinnedMesh,morphTargets:void 0!==R.morphAttributes.position,morphNormals:void 0!==R.morphAttributes.normal,morphColors:void 0!==R.morphAttributes.color,morphTargetsCount:W,morphTextureStride:U,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:S.dithering,shadowMapEnabled:e.shadowMap.enabled&&D.length>0,shadowMapType:e.shadowMap.type,toneMapping:S.toneMapped?e.toneMapping:gl,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===hs,flipSided:S.side===qn,useDepthPacking:!!S.depthPacking,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}},getProgramCacheKey:function g(S){let E=[];if(S.shaderID?E.push(S.shaderID):(E.push(S.customVertexShaderID),E.push(S.customFragmentShaderID)),void 0!==S.defines)for(let D in S.defines)E.push(D),E.push(S.defines[D]);return!1===S.isRawShaderMaterial&&(function v(S,E){S.push(E.precision),S.push(E.outputEncoding),S.push(E.envMapMode),S.push(E.envMapCubeUVHeight),S.push(E.combine),S.push(E.vertexUvs),S.push(E.fogExp2),S.push(E.sizeAttenuation),S.push(E.morphTargetsCount),S.push(E.morphAttributeCount),S.push(E.numDirLights),S.push(E.numPointLights),S.push(E.numSpotLights),S.push(E.numSpotLightMaps),S.push(E.numHemiLights),S.push(E.numRectAreaLights),S.push(E.numDirLightShadows),S.push(E.numPointLightShadows),S.push(E.numSpotLightShadows),S.push(E.numSpotLightShadowsWithMaps),S.push(E.shadowMapType),S.push(E.toneMapping),S.push(E.numClippingPlanes),S.push(E.numClipIntersection),S.push(E.depthPacking)}(E,S),function y(S,E){a.disableAll(),E.isWebGL2&&a.enable(0),E.supportsVertexTextures&&a.enable(1),E.instancing&&a.enable(2),E.instancingColor&&a.enable(3),E.map&&a.enable(4),E.matcap&&a.enable(5),E.envMap&&a.enable(6),E.lightMap&&a.enable(7),E.aoMap&&a.enable(8),E.emissiveMap&&a.enable(9),E.bumpMap&&a.enable(10),E.normalMap&&a.enable(11),E.objectSpaceNormalMap&&a.enable(12),E.tangentSpaceNormalMap&&a.enable(13),E.clearcoat&&a.enable(14),E.clearcoatMap&&a.enable(15),E.clearcoatRoughnessMap&&a.enable(16),E.clearcoatNormalMap&&a.enable(17),E.iridescence&&a.enable(18),E.iridescenceMap&&a.enable(19),E.iridescenceThicknessMap&&a.enable(20),E.displacementMap&&a.enable(21),E.specularMap&&a.enable(22),E.roughnessMap&&a.enable(23),E.metalnessMap&&a.enable(24),E.gradientMap&&a.enable(25),E.alphaMap&&a.enable(26),E.alphaTest&&a.enable(27),E.vertexColors&&a.enable(28),E.vertexAlphas&&a.enable(29),E.vertexUvs&&a.enable(30),E.vertexTangents&&a.enable(31),E.uvsVertexOnly&&a.enable(32),S.push(a.mask),a.disableAll(),E.fog&&a.enable(0),E.useFog&&a.enable(1),E.flatShading&&a.enable(2),E.logarithmicDepthBuffer&&a.enable(3),E.skinning&&a.enable(4),E.morphTargets&&a.enable(5),E.morphNormals&&a.enable(6),E.morphColors&&a.enable(7),E.premultipliedAlpha&&a.enable(8),E.shadowMapEnabled&&a.enable(9),E.physicallyCorrectLights&&a.enable(10),E.doubleSided&&a.enable(11),E.flipSided&&a.enable(12),E.useDepthPacking&&a.enable(13),E.dithering&&a.enable(14),E.specularIntensityMap&&a.enable(15),E.specularColorMap&&a.enable(16),E.transmission&&a.enable(17),E.transmissionMap&&a.enable(18),E.thicknessMap&&a.enable(19),E.sheen&&a.enable(20),E.sheenColorMap&&a.enable(21),E.sheenRoughnessMap&&a.enable(22),E.decodeVideoTexture&&a.enable(23),E.opaque&&a.enable(24),S.push(a.mask)}(E,S),E.push(e.outputEncoding)),E.push(S.customProgramCacheKey),E.join()},getUniforms:function _(S){let D,E=f[S.type];return D=E?rp.clone(xa[E].uniforms):S.uniforms,D},acquireProgram:function b(S,E){let D;for(let T=0,I=c.length;T<I;T++){let P=c[T];if(P.cacheKey===E){D=P,++D.usedTimes;break}}return void 0===D&&(D=new ige(e,E,S,s),c.push(D)),D},releaseProgram:function w(S){if(0==--S.usedTimes){let E=c.indexOf(S);c[E]=c[c.length-1],c.pop(),S.destroy()}},releaseShaderCache:function C(S){l.remove(S)},programs:c,dispose:function x(){l.dispose()}}}function age(){let e=new WeakMap;return{get:function t(s){let o=e.get(s);return void 0===o&&(o={},e.set(s,o)),o},remove:function i(s){e.delete(s)},update:function n(s,o,a){e.get(s)[o]=a},dispose:function r(){e=new WeakMap}}}function lge(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function wj(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function xj(){let e=[],t=0,i=[],n=[],r=[];function o(u,d,p,f,m,g){let v=e[t];return void 0===v?(v={id:u.id,object:u,geometry:d,material:p,groupOrder:f,renderOrder:u.renderOrder,z:m,group:g},e[t]=v):(v.id=u.id,v.object=u,v.geometry=d,v.material=p,v.groupOrder=f,v.renderOrder=u.renderOrder,v.z=m,v.group=g),t++,v}return{opaque:i,transmissive:n,transparent:r,init:function s(){t=0,i.length=0,n.length=0,r.length=0},push:function a(u,d,p,f,m,g){let v=o(u,d,p,f,m,g);p.transmission>0?n.push(v):!0===p.transparent?r.push(v):i.push(v)},unshift:function l(u,d,p,f,m,g){let v=o(u,d,p,f,m,g);p.transmission>0?n.unshift(v):!0===p.transparent?r.unshift(v):i.unshift(v)},finish:function h(){for(let u=t,d=e.length;u<d;u++){let p=e[u];if(null===p.id)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}},sort:function c(u,d){i.length>1&&i.sort(u||lge),n.length>1&&n.sort(d||wj),r.length>1&&r.sort(d||wj)}}}function cge(){let e=new WeakMap;return{get:function t(n,r){let o,s=e.get(n);return void 0===s?(o=new xj,e.set(n,[o])):r>=s.length?(o=new xj,s.push(o)):o=s[r],o},dispose:function i(){e=new WeakMap}}}function uge(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new M,color:new Je};break;case"SpotLight":i={position:new M,direction:new M,color:new Je,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new M,color:new Je,distance:0,decay:0};break;case"HemisphereLight":i={direction:new M,skyColor:new Je,groundColor:new Je};break;case"RectAreaLight":i={color:new Je,position:new M,halfWidth:new M,halfHeight:new M}}return e[t.id]=i,i}}}var dge=0;function pge(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function fge(e,t){let i=new uge,n=function hge(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new z};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new z,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)r.probe.push(new M);let s=new M,o=new ye,a=new ye;return{setup:function l(h,u){let d=0,p=0,f=0;for(let T=0;T<9;T++)r.probe[T].set(0,0,0);let m=0,g=0,v=0,y=0,_=0,b=0,w=0,C=0,x=0,S=0;h.sort(pge);let E=!0!==u?Math.PI:1;for(let T=0,I=h.length;T<I;T++){let P=h[T],R=P.color,L=P.intensity,j=P.distance,F=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)d+=R.r*L*E,p+=R.g*L*E,f+=R.b*L*E;else if(P.isLightProbe)for(let N=0;N<9;N++)r.probe[N].addScaledVector(P.sh.coefficients[N],L);else if(P.isDirectionalLight){let N=i.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity*E),P.castShadow){let q=P.shadow,W=n.get(P);W.shadowBias=q.bias,W.shadowNormalBias=q.normalBias,W.shadowRadius=q.radius,W.shadowMapSize=q.mapSize,r.directionalShadow[m]=W,r.directionalShadowMap[m]=F,r.directionalShadowMatrix[m]=P.shadow.matrix,b++}r.directional[m]=N,m++}else if(P.isSpotLight){let N=i.get(P);N.position.setFromMatrixPosition(P.matrixWorld),N.color.copy(R).multiplyScalar(L*E),N.distance=j,N.coneCos=Math.cos(P.angle),N.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),N.decay=P.decay,r.spot[v]=N;let q=P.shadow;if(P.map&&(r.spotLightMap[x]=P.map,x++,q.updateMatrices(P),P.castShadow&&S++),r.spotLightMatrix[v]=q.matrix,P.castShadow){let W=n.get(P);W.shadowBias=q.bias,W.shadowNormalBias=q.normalBias,W.shadowRadius=q.radius,W.shadowMapSize=q.mapSize,r.spotShadow[v]=W,r.spotShadowMap[v]=F,C++}v++}else if(P.isRectAreaLight){let N=i.get(P);N.color.copy(R).multiplyScalar(L),N.halfWidth.set(.5*P.width,0,0),N.halfHeight.set(0,.5*P.height,0),r.rectArea[y]=N,y++}else if(P.isPointLight){let N=i.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity*E),N.distance=P.distance,N.decay=P.decay,P.castShadow){let q=P.shadow,W=n.get(P);W.shadowBias=q.bias,W.shadowNormalBias=q.normalBias,W.shadowRadius=q.radius,W.shadowMapSize=q.mapSize,W.shadowCameraNear=q.camera.near,W.shadowCameraFar=q.camera.far,r.pointShadow[g]=W,r.pointShadowMap[g]=F,r.pointShadowMatrix[g]=P.shadow.matrix,w++}r.point[g]=N,g++}else if(P.isHemisphereLight){let N=i.get(P);N.skyColor.copy(P.color).multiplyScalar(L*E),N.groundColor.copy(P.groundColor).multiplyScalar(L*E),r.hemi[_]=N,_++}}y>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Ae.LTC_FLOAT_1,r.rectAreaLTC2=Ae.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Ae.LTC_HALF_1,r.rectAreaLTC2=Ae.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=p,r.ambient[2]=f;let D=r.hash;(D.directionalLength!==m||D.pointLength!==g||D.spotLength!==v||D.rectAreaLength!==y||D.hemiLength!==_||D.numDirectionalShadows!==b||D.numPointShadows!==w||D.numSpotShadows!==C||D.numSpotMaps!==x)&&(r.directional.length=m,r.spot.length=v,r.rectArea.length=y,r.point.length=g,r.hemi.length=_,r.directionalShadow.length=b,r.directionalShadowMap.length=b,r.pointShadow.length=w,r.pointShadowMap.length=w,r.spotShadow.length=C,r.spotShadowMap.length=C,r.directionalShadowMatrix.length=b,r.pointShadowMatrix.length=w,r.spotLightMatrix.length=C+x-S,r.spotLightMap.length=x,r.numSpotLightShadowsWithMaps=S,D.directionalLength=m,D.pointLength=g,D.spotLength=v,D.rectAreaLength=y,D.hemiLength=_,D.numDirectionalShadows=b,D.numPointShadows=w,D.numSpotShadows=C,D.numSpotMaps=x,r.version=dge++)},setupView:function c(h,u){let d=0,p=0,f=0,m=0,g=0,v=u.matrixWorldInverse;for(let y=0,_=h.length;y<_;y++){let b=h[y];if(b.isDirectionalLight){let w=r.directional[d];w.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(v),d++}else if(b.isSpotLight){let w=r.spot[f];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),w.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(v),f++}else if(b.isRectAreaLight){let w=r.rectArea[m];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),a.identity(),o.copy(b.matrixWorld),o.premultiply(v),a.extractRotation(o),w.halfWidth.set(.5*b.width,0,0),w.halfHeight.set(0,.5*b.height,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),m++}else if(b.isPointLight){let w=r.point[p];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),p++}else if(b.isHemisphereLight){let w=r.hemi[g];w.direction.setFromMatrixPosition(b.matrixWorld),w.direction.transformDirection(v),g++}}},state:r}}function Sj(e,t){let i=new fge(e,t),n=[],r=[];return{init:function s(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function l(h){i.setup(n,h)},setupLightsView:function c(h){i.setupView(n,h)},pushLight:function o(h){n.push(h)},pushShadow:function a(h){r.push(h)}}}function mge(e,t){let i=new WeakMap;return{get:function n(s,o=0){let l,a=i.get(s);return void 0===a?(l=new Sj(e,t),i.set(s,[l])):o>=a.length?(l=new Sj(e,t),a.push(l)):l=a[o],l},dispose:function r(){i=new WeakMap}}}var Cj=class extends Cg{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=_l,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},gge=class extends Cg{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new M,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},vge="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",yge="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function _ge(e,t,i){let n=new qM,r=new z,s=new z,o=new St,a=new Cj({depthPacking:IU}),l=new gge,c={},h=i.maxTextureSize,u={[No]:qn,[qn]:No,[hs]:hs},d=new bi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new z},radius:{value:4}},vertexShader:vge,fragmentShader:yge}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Ze;f.setAttribute("position",new st(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new jr(f,d),g=this;function v(b,w){let C=t.update(m);d.defines.VSM_SAMPLES!==b.blurSamples&&(d.defines.VSM_SAMPLES=b.blurSamples,p.defines.VSM_SAMPLES=b.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===b.mapPass&&(b.mapPass=new di(r.x,r.y)),d.uniforms.shadow_pass.value=b.map.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,e.setRenderTarget(b.mapPass),e.clear(),e.renderBufferDirect(w,null,C,d,m,null),p.uniforms.shadow_pass.value=b.mapPass.texture,p.uniforms.resolution.value=b.mapSize,p.uniforms.radius.value=b.radius,e.setRenderTarget(b.map),e.clear(),e.renderBufferDirect(w,null,C,p,m,null)}function y(b,w,C,x,S,E){let D=null,T=!0===C.isPointLight?b.customDistanceMaterial:b.customDepthMaterial;if(void 0!==T)D=T;else if(D=!0===C.isPointLight?l:a,e.localClippingEnabled&&!0===w.clipShadows&&Array.isArray(w.clippingPlanes)&&0!==w.clippingPlanes.length||w.displacementMap&&0!==w.displacementScale||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){let I=D.uuid,P=w.uuid,R=c[I];void 0===R&&(R={},c[I]=R);let L=R[P];void 0===L&&(L=D.clone(),R[P]=L),D=L}return D.visible=w.visible,D.wireframe=w.wireframe,D.side=E===gg?null!==w.shadowSide?w.shadowSide:w.side:null!==w.shadowSide?w.shadowSide:u[w.side],D.alphaMap=w.alphaMap,D.alphaTest=w.alphaTest,D.map=w.map,D.clipShadows=w.clipShadows,D.clippingPlanes=w.clippingPlanes,D.clipIntersection=w.clipIntersection,D.displacementMap=w.displacementMap,D.displacementScale=w.displacementScale,D.displacementBias=w.displacementBias,D.wireframeLinewidth=w.wireframeLinewidth,D.linewidth=w.linewidth,!0===C.isPointLight&&!0===D.isMeshDistanceMaterial&&(D.referencePosition.setFromMatrixPosition(C.matrixWorld),D.nearDistance=x,D.farDistance=S),D}function _(b,w,C,x,S){if(!1===b.visible)return;if(b.layers.test(w.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&S===gg)&&(!b.frustumCulled||n.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,b.matrixWorld);let D=t.update(b),T=b.material;if(Array.isArray(T)){let I=D.groups;for(let P=0,R=I.length;P<R;P++){let L=I[P],j=T[L.materialIndex];if(j&&j.visible){let F=y(b,j,x,C.near,C.far,S);e.renderBufferDirect(C,null,D,F,b,L)}}}else if(T.visible){let I=y(b,T,x,C.near,C.far,S);e.renderBufferDirect(C,null,D,I,b,null)}}let E=b.children;for(let D=0,T=E.length;D<T;D++)_(E[D],w,C,x,S)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sM,this.render=function(b,w,C){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===b.length)return;let x=e.getRenderTarget(),S=e.getActiveCubeFace(),E=e.getActiveMipmapLevel(),D=e.state;D.setBlending(bn),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);for(let T=0,I=b.length;T<I;T++){let P=b[T],R=P.shadow;if(void 0===R){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(!1===R.autoUpdate&&!1===R.needsUpdate)continue;r.copy(R.mapSize);let L=R.getFrameExtents();r.multiply(L),s.copy(R.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/L.x),r.x=s.x*L.x,R.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/L.y),r.y=s.y*L.y,R.mapSize.y=s.y)),null===R.map&&(R.map=new di(r.x,r.y,this.type!==gg?{minFilter:Ei,magFilter:Ei}:{}),R.map.texture.name=P.name+".shadowMap",R.camera.updateProjectionMatrix()),e.setRenderTarget(R.map),e.clear();let j=R.getViewportCount();for(let F=0;F<j;F++){let N=R.getViewport(F);o.set(s.x*N.x,s.y*N.y,s.x*N.z,s.y*N.w),D.viewport(o),R.updateMatrices(P,F),n=R.getFrustum(),_(w,C,R.camera,P,this.type)}!0!==R.isPointLightShadow&&this.type===gg&&v(R,C),R.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(x,S,E)}}function bge(e,t,i){let n=i.isWebGL2,a=new function r(){let Q=!1,le=new St,Se=null,Ie=new St(0,0,0,0);return{setMask:function(ct){Se!==ct&&!Q&&(e.colorMask(ct,ct,ct,ct),Se=ct)},setLocked:function(ct){Q=ct},setClear:function(ct,Jt,Gi,Cr,Mh){!0===Mh&&(ct*=Cr,Jt*=Cr,Gi*=Cr),le.set(ct,Jt,Gi,Cr),!1===Ie.equals(le)&&(e.clearColor(ct,Jt,Gi,Cr),Ie.copy(le))},reset:function(){Q=!1,Se=null,Ie.set(-1,0,0,0)}}},l=new function s(){let Q=!1,le=null,Se=null,Ie=null;return{setTest:function(ct){ct?re(2929):K(2929)},setMask:function(ct){le!==ct&&!Q&&(e.depthMask(ct),le=ct)},setFunc:function(ct){if(Se!==ct){switch(ct){case zue:e.depthFunc(512);break;case Uue:e.depthFunc(519);break;case jue:e.depthFunc(513);break;case oM:e.depthFunc(515);break;case Hue:e.depthFunc(514);break;case Gue:e.depthFunc(518);break;case Wue:e.depthFunc(516);break;case que:e.depthFunc(517);break;default:e.depthFunc(515)}Se=ct}},setLocked:function(ct){Q=ct},setClear:function(ct){Ie!==ct&&(e.clearDepth(ct),Ie=ct)},reset:function(){Q=!1,le=null,Se=null,Ie=null}}},c=new function o(){let Q=!1,le=null,Se=null,Ie=null,ct=null,Jt=null,Gi=null,Cr=null,Mh=null;return{setTest:function(zi){Q||(zi?re(2960):K(2960))},setMask:function(zi){le!==zi&&!Q&&(e.stencilMask(zi),le=zi)},setFunc:function(zi,Ql,wo){(Se!==zi||Ie!==Ql||ct!==wo)&&(e.stencilFunc(zi,Ql,wo),Se=zi,Ie=Ql,ct=wo)},setOp:function(zi,Ql,wo){(Jt!==zi||Gi!==Ql||Cr!==wo)&&(e.stencilOp(zi,Ql,wo),Jt=zi,Gi=Ql,Cr=wo)},setLocked:function(zi){Q=zi},setClear:function(zi){Mh!==zi&&(e.clearStencil(zi),Mh=zi)},reset:function(){Q=!1,le=null,Se=null,Ie=null,ct=null,Jt=null,Gi=null,Cr=null,Mh=null}}},h=new WeakMap,u=new WeakMap,d={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,_=null,b=null,w=null,C=null,x=null,S=null,E=!1,D=null,T=null,I=null,P=null,R=null,L=e.getParameter(35661),j=!1,F=0,N=e.getParameter(7938);-1!==N.indexOf("WebGL")?(F=parseFloat(/^WebGL (\d)/.exec(N)[1]),j=F>=1):-1!==N.indexOf("OpenGL ES")&&(F=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),j=F>=2);let q=null,W={},U=e.getParameter(3088),V=e.getParameter(2978),Y=(new St).fromArray(U),G=(new St).fromArray(V);function X(Q,le,Se){let Ie=new Uint8Array(4),ct=e.createTexture();e.bindTexture(Q,ct),e.texParameteri(Q,10241,9728),e.texParameteri(Q,10240,9728);for(let Jt=0;Jt<Se;Jt++)e.texImage2D(le+Jt,0,6408,1,1,0,6408,5121,Ie);return ct}let H={};function re(Q){!0!==d[Q]&&(e.enable(Q),d[Q]=!0)}function K(Q){!1!==d[Q]&&(e.disable(Q),d[Q]=!1)}H[3553]=X(3553,3553,1),H[34067]=X(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),re(2929),l.setFunc(oM),Ne(!1),Ue(qz),re(2884),Oe(bn);let ce={[Ud]:32774,[Tue]:32778,[Iue]:32779};if(n)ce[Qz]=32775,ce[Kz]=32776;else{let Q=t.get("EXT_blend_minmax");null!==Q&&(ce[Qz]=Q.MIN_EXT,ce[Kz]=Q.MAX_EXT)}let ae={[Pue]:0,[Rue]:1,[Oue]:768,[$z]:770,[Vue]:776,[Fue]:774,[Nue]:772,[Lue]:769,[Jz]:771,[Bue]:775,[kue]:773};function Oe(Q,le,Se,Ie,ct,Jt,Gi,Cr){if(Q!==bn){if(!1===v&&(re(3042),v=!0),Q===Due)ct=ct||le,Jt=Jt||Se,Gi=Gi||Ie,(le!==_||ct!==C)&&(e.blendEquationSeparate(ce[le],ce[ct]),_=le,C=ct),(Se!==b||Ie!==w||Jt!==x||Gi!==S)&&(e.blendFuncSeparate(ae[Se],ae[Ie],ae[Jt],ae[Gi]),b=Se,w=Ie,x=Jt,S=Gi),y=Q,E=!1;else if(Q!==y||Cr!==E){if((_!==Ud||C!==Ud)&&(e.blendEquation(32774),_=Ud,C=Ud),Cr)switch(Q){case ku:e.blendFuncSeparate(1,771,1,771);break;case Yz:e.blendFunc(1,1);break;case Xz:e.blendFuncSeparate(0,769,0,1);break;case Zz:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q)}else switch(Q){case ku:e.blendFuncSeparate(770,771,1,771);break;case Yz:e.blendFunc(770,1);break;case Xz:e.blendFuncSeparate(0,769,0,1);break;case Zz:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q)}b=null,w=null,x=null,S=null,y=Q,E=Cr}}else!0===v&&(K(3042),v=!1)}function Ne(Q){D!==Q&&(e.frontFace(Q?2304:2305),D=Q)}function Ue(Q){Q!==Eue?(re(2884),Q!==T&&e.cullFace(Q===qz?1029:Q===Mue?1028:1032)):K(2884),T=Q}function Ce(Q,le,Se){Q?(re(32823),(P!==le||R!==Se)&&(e.polygonOffset(le,Se),P=le,R=Se)):K(32823)}return{buffers:{color:a,depth:l,stencil:c},enable:re,disable:K,bindFramebuffer:function se(Q,le){return p[Q]!==le&&(e.bindFramebuffer(Q,le),p[Q]=le,n&&(36009===Q&&(p[36160]=le),36160===Q&&(p[36009]=le)),!0)},drawBuffers:function $(Q,le){let Se=m,Ie=!1;if(Q)if(Se=f.get(le),void 0===Se&&(Se=[],f.set(le,Se)),Q.isWebGLMultipleRenderTargets){let ct=Q.texture;if(Se.length!==ct.length||36064!==Se[0]){for(let Jt=0,Gi=ct.length;Jt<Gi;Jt++)Se[Jt]=36064+Jt;Se.length=ct.length,Ie=!0}}else 36064!==Se[0]&&(Se[0]=36064,Ie=!0);else 1029!==Se[0]&&(Se[0]=1029,Ie=!0);Ie&&(i.isWebGL2?e.drawBuffers(Se):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Se))},useProgram:function ge(Q){return g!==Q&&(e.useProgram(Q),g=Q,!0)},setBlending:Oe,setMaterial:function Re(Q,le){Q.side===hs?K(2884):re(2884);let Se=Q.side===qn;le&&(Se=!Se),Ne(Se),Q.blending===ku&&!1===Q.transparent?Oe(bn):Oe(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst,Q.blendEquationAlpha,Q.blendSrcAlpha,Q.blendDstAlpha,Q.premultipliedAlpha),l.setFunc(Q.depthFunc),l.setTest(Q.depthTest),l.setMask(Q.depthWrite),a.setMask(Q.colorWrite);let Ie=Q.stencilWrite;c.setTest(Ie),Ie&&(c.setMask(Q.stencilWriteMask),c.setFunc(Q.stencilFunc,Q.stencilRef,Q.stencilFuncMask),c.setOp(Q.stencilFail,Q.stencilZFail,Q.stencilZPass)),Ce(Q.polygonOffset,Q.polygonOffsetFactor,Q.polygonOffsetUnits),!0===Q.alphaToCoverage?re(32926):K(32926)},setFlipSided:Ne,setCullFace:Ue,setLineWidth:function De(Q){Q!==I&&(j&&e.lineWidth(Q),I=Q)},setPolygonOffset:Ce,setScissorTest:function Qe(Q){Q?re(3089):K(3089)},activeTexture:function mt(Q){void 0===Q&&(Q=33984+L-1),q!==Q&&(e.activeTexture(Q),q=Q)},bindTexture:function B(Q,le,Se){void 0===Se&&(Se=null===q?33984+L-1:q);let Ie=W[Se];void 0===Ie&&(Ie={type:void 0,texture:void 0},W[Se]=Ie),(Ie.type!==Q||Ie.texture!==le)&&(q!==Se&&(e.activeTexture(Se),q=Se),e.bindTexture(Q,le||H[Q]),Ie.type=Q,Ie.texture=le)},unbindTexture:function O(){let Q=W[q];void 0!==Q&&void 0!==Q.type&&(e.bindTexture(Q.type,null),Q.type=void 0,Q.texture=void 0)},compressedTexImage2D:function te(){try{e.compressedTexImage2D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},compressedTexImage3D:function xe(){try{e.compressedTexImage3D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},texImage2D:function Xe(){try{e.texImage2D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},texImage3D:function Ge(){try{e.texImage3D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},updateUBOMapping:function Xt(Q,le){let Se=u.get(le);void 0===Se&&(Se=new WeakMap,u.set(le,Se));let Ie=Se.get(Q);void 0===Ie&&(Ie=e.getUniformBlockIndex(le,Q.name),Se.set(Q,Ie))},uniformBlockBinding:function ki(Q,le){let Se=u.get(le).get(Q);h.get(le)!==Se&&(e.uniformBlockBinding(le,Se,Q.__bindingPointIndex),h.set(le,Se))},texStorage2D:function me(){try{e.texStorage2D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},texStorage3D:function He(){try{e.texStorage3D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},texSubImage2D:function fe(){try{e.texSubImage2D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},texSubImage3D:function Ee(){try{e.texSubImage3D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},compressedTexSubImage2D:function Ye(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},compressedTexSubImage3D:function Be(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},scissor:function ut(Q){!1===Y.equals(Q)&&(e.scissor(Q.x,Q.y,Q.z,Q.w),Y.copy(Q))},viewport:function nt(Q){!1===G.equals(Q)&&(e.viewport(Q.x,Q.y,Q.z,Q.w),G.copy(Q))},reset:function Dn(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},q=null,W={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,_=null,b=null,w=null,C=null,x=null,S=null,E=!1,D=null,T=null,I=null,P=null,R=null,Y.set(0,0,e.canvas.width,e.canvas.height),G.set(0,0,e.canvas.width,e.canvas.height),a.reset(),l.reset(),c.reset()}}}function wge(e,t,i,n,r,s,o){let m,a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function y(B,O){return v?new OffscreenCanvas(B,O):M_("canvas")}function _(B,O,te,xe){let fe=1;if((B.width>xe||B.height>xe)&&(fe=xe/Math.max(B.width,B.height)),fe<1||!0===O){if(typeof HTMLImageElement<"u"&&B instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&B instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&B instanceof ImageBitmap){let Ee=O?C_:Math.floor,Ye=Ee(fe*B.width),Be=Ee(fe*B.height);void 0===m&&(m=y(Ye,Be));let me=te?y(Ye,Be):m;return me.width=Ye,me.height=Be,me.getContext("2d").drawImage(B,0,0,Ye,Be),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+B.width+"x"+B.height+") to ("+Ye+"x"+Be+")."),me}return"data"in B&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+B.width+"x"+B.height+")."),B}return B}function b(B){return SM(B.width)&&SM(B.height)}function C(B,O){return B.generateMipmaps&&O&&B.minFilter!==Ei&&B.minFilter!==It}function x(B){e.generateMipmap(B)}function S(B,O,te,xe,fe=!1){if(!1===a)return O;if(null!==B){if(void 0!==e[B])return e[B];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+B+"'")}let Ee=O;return 6403===O&&(5126===te&&(Ee=33326),5131===te&&(Ee=33325),5121===te&&(Ee=33321)),33319===O&&(5126===te&&(Ee=33328),5131===te&&(Ee=33327),5121===te&&(Ee=33323)),6408===O&&(5126===te&&(Ee=34836),5131===te&&(Ee=34842),5121===te&&(Ee=xe===xt&&!1===fe?35907:32856),32819===te&&(Ee=32854),32820===te&&(Ee=32855)),(33325===Ee||33326===Ee||33327===Ee||33328===Ee||34842===Ee||34836===Ee)&&t.get("EXT_color_buffer_float"),Ee}function E(B,O,te){return!0===C(B,te)||B.isFramebufferTexture&&B.minFilter!==Ei&&B.minFilter!==It?Math.log2(Math.max(O.width,O.height))+1:void 0!==B.mipmaps&&B.mipmaps.length>0?B.mipmaps.length:B.isCompressedTexture&&Array.isArray(B.image)?O.mipmaps.length:1}function D(B){return B===Ei||B===iU||B===uM?9728:9729}function T(B){let O=B.target;O.removeEventListener("dispose",T),function P(B){let O=n.get(B);if(void 0===O.__webglInit)return;let te=B.source,xe=g.get(te);if(xe){let fe=xe[O.__cacheKey];fe.usedTimes--,0===fe.usedTimes&&R(B),0===Object.keys(xe).length&&g.delete(te)}n.remove(B)}(O),O.isVideoTexture&&f.delete(O)}function I(B){let O=B.target;O.removeEventListener("dispose",I),function L(B){let O=B.texture,te=n.get(B),xe=n.get(O);if(void 0!==xe.__webglTexture&&(e.deleteTexture(xe.__webglTexture),o.memory.textures--),B.depthTexture&&B.depthTexture.dispose(),B.isWebGLCubeRenderTarget)for(let fe=0;fe<6;fe++)e.deleteFramebuffer(te.__webglFramebuffer[fe]),te.__webglDepthbuffer&&e.deleteRenderbuffer(te.__webglDepthbuffer[fe]);else{if(e.deleteFramebuffer(te.__webglFramebuffer),te.__webglDepthbuffer&&e.deleteRenderbuffer(te.__webglDepthbuffer),te.__webglMultisampledFramebuffer&&e.deleteFramebuffer(te.__webglMultisampledFramebuffer),te.__webglColorRenderbuffer)for(let fe=0;fe<te.__webglColorRenderbuffer.length;fe++)te.__webglColorRenderbuffer[fe]&&e.deleteRenderbuffer(te.__webglColorRenderbuffer[fe]);te.__webglDepthRenderbuffer&&e.deleteRenderbuffer(te.__webglDepthRenderbuffer)}if(B.isWebGLMultipleRenderTargets)for(let fe=0,Ee=O.length;fe<Ee;fe++){let Ye=n.get(O[fe]);Ye.__webglTexture&&(e.deleteTexture(Ye.__webglTexture),o.memory.textures--),n.remove(O[fe])}n.remove(O),n.remove(B)}(O)}function R(B){let O=n.get(B);e.deleteTexture(O.__webglTexture),delete g.get(B.source)[O.__cacheKey],o.memory.textures--}let j=0;function W(B,O){let te=n.get(B);if(B.isVideoTexture&&function Qe(B){let O=o.render.frame;f.get(B)!==O&&(f.set(B,O),B.update())}(B),!1===B.isRenderTargetTexture&&B.version>0&&te.__version!==B.version){let xe=B.image;if(null===xe)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==xe.complete)return void K(te,B,O);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(3553,te.__webglTexture,33984+O)}let G={[vl]:10497,[on]:33071,[cM]:33648},X={[Ei]:9728,[iU]:9984,[uM]:9986,[It]:9729,[ehe]:9985,[jd]:9987};function H(B,O,te){if(te?(e.texParameteri(B,10242,G[O.wrapS]),e.texParameteri(B,10243,G[O.wrapT]),(32879===B||35866===B)&&e.texParameteri(B,32882,G[O.wrapR]),e.texParameteri(B,10240,X[O.magFilter]),e.texParameteri(B,10241,X[O.minFilter])):(e.texParameteri(B,10242,33071),e.texParameteri(B,10243,33071),(32879===B||35866===B)&&e.texParameteri(B,32882,33071),(O.wrapS!==on||O.wrapT!==on)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(B,10240,D(O.magFilter)),e.texParameteri(B,10241,D(O.minFilter)),O.minFilter!==Ei&&O.minFilter!==It&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){let xe=t.get("EXT_texture_filter_anisotropic");if(O.magFilter===Ei||O.minFilter!==uM&&O.minFilter!==jd||O.type===zr&&!1===t.has("OES_texture_float_linear")||!1===a&&O.type===Vu&&!1===t.has("OES_texture_half_float_linear"))return;(O.anisotropy>1||n.get(O).__currentAnisotropy)&&(e.texParameterf(B,xe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,r.getMaxAnisotropy())),n.get(O).__currentAnisotropy=O.anisotropy)}}function re(B,O){let te=!1;void 0===B.__webglInit&&(B.__webglInit=!0,O.addEventListener("dispose",T));let xe=O.source,fe=g.get(xe);void 0===fe&&(fe={},g.set(xe,fe));let Ee=function q(B){let O=[];return O.push(B.wrapS),O.push(B.wrapT),O.push(B.wrapR||0),O.push(B.magFilter),O.push(B.minFilter),O.push(B.anisotropy),O.push(B.internalFormat),O.push(B.format),O.push(B.type),O.push(B.generateMipmaps),O.push(B.premultiplyAlpha),O.push(B.flipY),O.push(B.unpackAlignment),O.push(B.encoding),O.join()}(O);if(Ee!==B.__cacheKey){void 0===fe[Ee]&&(fe[Ee]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,te=!0),fe[Ee].usedTimes++;let Ye=fe[B.__cacheKey];void 0!==Ye&&(fe[B.__cacheKey].usedTimes--,0===Ye.usedTimes&&R(O)),B.__cacheKey=Ee,B.__webglTexture=fe[Ee].texture}return te}function K(B,O,te){let xe=3553;(O.isDataArrayTexture||O.isCompressedArrayTexture)&&(xe=35866),O.isData3DTexture&&(xe=32879);let fe=re(B,O),Ee=O.source;i.bindTexture(xe,B.__webglTexture,33984+te);let Ye=n.get(Ee);if(Ee.version!==Ye.__version||!0===fe){i.activeTexture(33984+te),e.pixelStorei(37440,O.flipY),e.pixelStorei(37441,O.premultiplyAlpha),e.pixelStorei(3317,O.unpackAlignment),e.pixelStorei(37443,0);let Be=function w(B){return!a&&(B.wrapS!==on||B.wrapT!==on||B.minFilter!==Ei&&B.minFilter!==It)}(O)&&!1===b(O.image),me=_(O.image,Be,!1,h);me=mt(O,me);let He=b(me)||a,Xe=s.convert(O.format,O.encoding),Ge=s.convert(O.type),ut=S(O.internalFormat,Xe,Ge,O.encoding,O.isVideoTexture);H(xe,O,He);let nt,Xt=O.mipmaps,ki=a&&!0!==O.isVideoTexture,Dn=void 0===Ye.__version||!0===fe,Q=E(O,me,He);if(O.isDepthTexture)ut=6402,a?ut=O.type===zr?36012:O.type===yl?33190:O.type===zu?35056:33189:O.type===zr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),O.format===Uu&&6402===ut&&O.type!==nU&&O.type!==yl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),O.type=yl,Ge=s.convert(O.type)),O.format===ju&&6402===ut&&(ut=34041,O.type!==zu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),O.type=zu,Ge=s.convert(O.type))),Dn&&(ki?i.texStorage2D(3553,1,ut,me.width,me.height):i.texImage2D(3553,0,ut,me.width,me.height,0,Xe,Ge,null));else if(O.isDataTexture)if(Xt.length>0&&He){ki&&Dn&&i.texStorage2D(3553,Q,ut,Xt[0].width,Xt[0].height);for(let le=0,Se=Xt.length;le<Se;le++)nt=Xt[le],ki?i.texSubImage2D(3553,le,0,0,nt.width,nt.height,Xe,Ge,nt.data):i.texImage2D(3553,le,ut,nt.width,nt.height,0,Xe,Ge,nt.data);O.generateMipmaps=!1}else ki?(Dn&&i.texStorage2D(3553,Q,ut,me.width,me.height),i.texSubImage2D(3553,0,0,0,me.width,me.height,Xe,Ge,me.data)):i.texImage2D(3553,0,ut,me.width,me.height,0,Xe,Ge,me.data);else if(O.isCompressedTexture)if(O.isCompressedArrayTexture){ki&&Dn&&i.texStorage3D(35866,Q,ut,Xt[0].width,Xt[0].height,me.depth);for(let le=0,Se=Xt.length;le<Se;le++)nt=Xt[le],O.format!==Ls?null!==Xe?ki?i.compressedTexSubImage3D(35866,le,0,0,0,nt.width,nt.height,me.depth,Xe,nt.data,0,0):i.compressedTexImage3D(35866,le,ut,nt.width,nt.height,me.depth,0,nt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ki?i.texSubImage3D(35866,le,0,0,0,nt.width,nt.height,me.depth,Xe,Ge,nt.data):i.texImage3D(35866,le,ut,nt.width,nt.height,me.depth,0,Xe,Ge,nt.data)}else{ki&&Dn&&i.texStorage2D(3553,Q,ut,Xt[0].width,Xt[0].height);for(let le=0,Se=Xt.length;le<Se;le++)nt=Xt[le],O.format!==Ls?null!==Xe?ki?i.compressedTexSubImage2D(3553,le,0,0,nt.width,nt.height,Xe,nt.data):i.compressedTexImage2D(3553,le,ut,nt.width,nt.height,0,nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ki?i.texSubImage2D(3553,le,0,0,nt.width,nt.height,Xe,Ge,nt.data):i.texImage2D(3553,le,ut,nt.width,nt.height,0,Xe,Ge,nt.data)}else if(O.isDataArrayTexture)ki?(Dn&&i.texStorage3D(35866,Q,ut,me.width,me.height,me.depth),i.texSubImage3D(35866,0,0,0,0,me.width,me.height,me.depth,Xe,Ge,me.data)):i.texImage3D(35866,0,ut,me.width,me.height,me.depth,0,Xe,Ge,me.data);else if(O.isData3DTexture)ki?(Dn&&i.texStorage3D(32879,Q,ut,me.width,me.height,me.depth),i.texSubImage3D(32879,0,0,0,0,me.width,me.height,me.depth,Xe,Ge,me.data)):i.texImage3D(32879,0,ut,me.width,me.height,me.depth,0,Xe,Ge,me.data);else if(O.isFramebufferTexture){if(Dn)if(ki)i.texStorage2D(3553,Q,ut,me.width,me.height);else{let le=me.width,Se=me.height;for(let Ie=0;Ie<Q;Ie++)i.texImage2D(3553,Ie,ut,le,Se,0,Xe,Ge,null),le>>=1,Se>>=1}}else if(Xt.length>0&&He){ki&&Dn&&i.texStorage2D(3553,Q,ut,Xt[0].width,Xt[0].height);for(let le=0,Se=Xt.length;le<Se;le++)nt=Xt[le],ki?i.texSubImage2D(3553,le,0,0,Xe,Ge,nt):i.texImage2D(3553,le,ut,Xe,Ge,nt);O.generateMipmaps=!1}else ki?(Dn&&i.texStorage2D(3553,Q,ut,me.width,me.height),i.texSubImage2D(3553,0,0,0,Xe,Ge,me)):i.texImage2D(3553,0,ut,Xe,Ge,me);C(O,He)&&x(xe),Ye.__version=Ee.version,O.onUpdate&&O.onUpdate(O)}B.__version=O.version}function $(B,O,te,xe,fe){let Ee=s.convert(te.format,te.encoding),Ye=s.convert(te.type),Be=S(te.internalFormat,Ee,Ye,te.encoding);n.get(O).__hasExternalTextures||(32879===fe||35866===fe?i.texImage3D(fe,0,Be,O.width,O.height,O.depth,0,Ee,Ye,null):i.texImage2D(fe,0,Be,O.width,O.height,0,Ee,Ye,null)),i.bindFramebuffer(36160,B),Ce(O)?d.framebufferTexture2DMultisampleEXT(36160,xe,fe,n.get(te).__webglTexture,0,De(O)):(3553===fe||fe>=34069&&fe<=34074)&&e.framebufferTexture2D(36160,xe,fe,n.get(te).__webglTexture,0),i.bindFramebuffer(36160,null)}function ge(B,O,te){if(e.bindRenderbuffer(36161,B),O.depthBuffer&&!O.stencilBuffer){let xe=33189;if(te||Ce(O)){let fe=O.depthTexture;fe&&fe.isDepthTexture&&(fe.type===zr?xe=36012:fe.type===yl&&(xe=33190));let Ee=De(O);Ce(O)?d.renderbufferStorageMultisampleEXT(36161,Ee,xe,O.width,O.height):e.renderbufferStorageMultisample(36161,Ee,xe,O.width,O.height)}else e.renderbufferStorage(36161,xe,O.width,O.height);e.framebufferRenderbuffer(36160,36096,36161,B)}else if(O.depthBuffer&&O.stencilBuffer){let xe=De(O);te&&!1===Ce(O)?e.renderbufferStorageMultisample(36161,xe,35056,O.width,O.height):Ce(O)?d.renderbufferStorageMultisampleEXT(36161,xe,35056,O.width,O.height):e.renderbufferStorage(36161,34041,O.width,O.height),e.framebufferRenderbuffer(36160,33306,36161,B)}else{let xe=!0===O.isWebGLMultipleRenderTargets?O.texture:[O.texture];for(let fe=0;fe<xe.length;fe++){let Ee=xe[fe],Ye=s.convert(Ee.format,Ee.encoding),Be=s.convert(Ee.type),me=S(Ee.internalFormat,Ye,Be,Ee.encoding),He=De(O);te&&!1===Ce(O)?e.renderbufferStorageMultisample(36161,He,me,O.width,O.height):Ce(O)?d.renderbufferStorageMultisampleEXT(36161,He,me,O.width,O.height):e.renderbufferStorage(36161,me,O.width,O.height)}}e.bindRenderbuffer(36161,null)}function ae(B){let O=n.get(B),te=!0===B.isWebGLCubeRenderTarget;if(B.depthTexture&&!O.__autoAllocateDepthBuffer){if(te)throw new Error("target.depthTexture not supported in Cube render targets");!function ce(B,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,B),!O.depthTexture||!O.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(O.depthTexture).__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),W(O.depthTexture,0);let te=n.get(O.depthTexture).__webglTexture,xe=De(O);if(O.depthTexture.format===Uu)Ce(O)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,te,0,xe):e.framebufferTexture2D(36160,36096,3553,te,0);else{if(O.depthTexture.format!==ju)throw new Error("Unknown depthTexture format");Ce(O)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,te,0,xe):e.framebufferTexture2D(36160,33306,3553,te,0)}}(O.__webglFramebuffer,B)}else if(te){O.__webglDepthbuffer=[];for(let xe=0;xe<6;xe++)i.bindFramebuffer(36160,O.__webglFramebuffer[xe]),O.__webglDepthbuffer[xe]=e.createRenderbuffer(),ge(O.__webglDepthbuffer[xe],B,!1)}else i.bindFramebuffer(36160,O.__webglFramebuffer),O.__webglDepthbuffer=e.createRenderbuffer(),ge(O.__webglDepthbuffer,B,!1);i.bindFramebuffer(36160,null)}function De(B){return Math.min(u,B.samples)}function Ce(B){let O=n.get(B);return a&&B.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==O.__useRenderToTexture}function mt(B,O){let te=B.encoding,xe=B.format,fe=B.type;return!0===B.isCompressedTexture||!0===B.isVideoTexture||B.format===wM||te!==_a&&(te===xt?!1===a?!0===t.has("EXT_sRGB")&&xe===Ls?(B.format=wM,B.minFilter=It,B.generateMipmaps=!1):O=kU.sRGBToLinear(O):(xe!==Ls||fe!==mr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",te)),O}this.allocateTextureUnit=function N(){let B=j;return B>=l&&console.warn("THREE.WebGLTextures: Trying to use "+B+" texture units while this GPU supports only "+l),j+=1,B},this.resetTextureUnits=function F(){j=0},this.setTexture2D=W,this.setTexture2DArray=function U(B,O){let te=n.get(B);B.version>0&&te.__version!==B.version?K(te,B,O):i.bindTexture(35866,te.__webglTexture,33984+O)},this.setTexture3D=function V(B,O){let te=n.get(B);B.version>0&&te.__version!==B.version?K(te,B,O):i.bindTexture(32879,te.__webglTexture,33984+O)},this.setTextureCube=function Y(B,O){let te=n.get(B);B.version>0&&te.__version!==B.version?function se(B,O,te){if(6!==O.image.length)return;let xe=re(B,O),fe=O.source;i.bindTexture(34067,B.__webglTexture,33984+te);let Ee=n.get(fe);if(fe.version!==Ee.__version||!0===xe){i.activeTexture(33984+te),e.pixelStorei(37440,O.flipY),e.pixelStorei(37441,O.premultiplyAlpha),e.pixelStorei(3317,O.unpackAlignment),e.pixelStorei(37443,0);let Ye=O.isCompressedTexture||O.image[0].isCompressedTexture,Be=O.image[0]&&O.image[0].isDataTexture,me=[];for(let le=0;le<6;le++)me[le]=Ye||Be?Be?O.image[le].image:O.image[le]:_(O.image[le],!1,!0,c),me[le]=mt(O,me[le]);let Q,He=me[0],Xe=b(He)||a,Ge=s.convert(O.format,O.encoding),ut=s.convert(O.type),nt=S(O.internalFormat,Ge,ut,O.encoding),Xt=a&&!0!==O.isVideoTexture,ki=void 0===Ee.__version||!0===xe,Dn=E(O,He,Xe);if(H(34067,O,Xe),Ye){Xt&&ki&&i.texStorage2D(34067,Dn,nt,He.width,He.height);for(let le=0;le<6;le++){Q=me[le].mipmaps;for(let Se=0;Se<Q.length;Se++){let Ie=Q[Se];O.format!==Ls?null!==Ge?Xt?i.compressedTexSubImage2D(34069+le,Se,0,0,Ie.width,Ie.height,Ge,Ie.data):i.compressedTexImage2D(34069+le,Se,nt,Ie.width,Ie.height,0,Ie.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Xt?i.texSubImage2D(34069+le,Se,0,0,Ie.width,Ie.height,Ge,ut,Ie.data):i.texImage2D(34069+le,Se,nt,Ie.width,Ie.height,0,Ge,ut,Ie.data)}}}else{Q=O.mipmaps,Xt&&ki&&(Q.length>0&&Dn++,i.texStorage2D(34067,Dn,nt,me[0].width,me[0].height));for(let le=0;le<6;le++)if(Be){Xt?i.texSubImage2D(34069+le,0,0,0,me[le].width,me[le].height,Ge,ut,me[le].data):i.texImage2D(34069+le,0,nt,me[le].width,me[le].height,0,Ge,ut,me[le].data);for(let Se=0;Se<Q.length;Se++){let Ie=Q[Se].image[le].image;Xt?i.texSubImage2D(34069+le,Se+1,0,0,Ie.width,Ie.height,Ge,ut,Ie.data):i.texImage2D(34069+le,Se+1,nt,Ie.width,Ie.height,0,Ge,ut,Ie.data)}}else{Xt?i.texSubImage2D(34069+le,0,0,0,Ge,ut,me[le]):i.texImage2D(34069+le,0,nt,Ge,ut,me[le]);for(let Se=0;Se<Q.length;Se++){let Ie=Q[Se];Xt?i.texSubImage2D(34069+le,Se+1,0,0,Ge,ut,Ie.image[le]):i.texImage2D(34069+le,Se+1,nt,Ge,ut,Ie.image[le])}}}C(O,Xe)&&x(34067),Ee.__version=fe.version,O.onUpdate&&O.onUpdate(O)}B.__version=O.version}(te,B,O):i.bindTexture(34067,te.__webglTexture,33984+O)},this.rebindTextures=function Oe(B,O,te){let xe=n.get(B);void 0!==O&&$(xe.__webglFramebuffer,B,B.texture,36064,3553),void 0!==te&&ae(B)},this.setupRenderTarget=function Re(B){let O=B.texture,te=n.get(B),xe=n.get(O);B.addEventListener("dispose",I),!0!==B.isWebGLMultipleRenderTargets&&(void 0===xe.__webglTexture&&(xe.__webglTexture=e.createTexture()),xe.__version=O.version,o.memory.textures++);let fe=!0===B.isWebGLCubeRenderTarget,Ee=!0===B.isWebGLMultipleRenderTargets,Ye=b(B)||a;if(fe){te.__webglFramebuffer=[];for(let Be=0;Be<6;Be++)te.__webglFramebuffer[Be]=e.createFramebuffer()}else{if(te.__webglFramebuffer=e.createFramebuffer(),Ee)if(r.drawBuffers){let Be=B.texture;for(let me=0,He=Be.length;me<He;me++){let Xe=n.get(Be[me]);void 0===Xe.__webglTexture&&(Xe.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&B.samples>0&&!1===Ce(B)){let Be=Ee?O:[O];te.__webglMultisampledFramebuffer=e.createFramebuffer(),te.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,te.__webglMultisampledFramebuffer);for(let me=0;me<Be.length;me++){let He=Be[me];te.__webglColorRenderbuffer[me]=e.createRenderbuffer(),e.bindRenderbuffer(36161,te.__webglColorRenderbuffer[me]);let Xe=s.convert(He.format,He.encoding),Ge=s.convert(He.type),ut=S(He.internalFormat,Xe,Ge,He.encoding,!0===B.isXRRenderTarget),nt=De(B);e.renderbufferStorageMultisample(36161,nt,ut,B.width,B.height),e.framebufferRenderbuffer(36160,36064+me,36161,te.__webglColorRenderbuffer[me])}e.bindRenderbuffer(36161,null),B.depthBuffer&&(te.__webglDepthRenderbuffer=e.createRenderbuffer(),ge(te.__webglDepthRenderbuffer,B,!0)),i.bindFramebuffer(36160,null)}}if(fe){i.bindTexture(34067,xe.__webglTexture),H(34067,O,Ye);for(let Be=0;Be<6;Be++)$(te.__webglFramebuffer[Be],B,O,36064,34069+Be);C(O,Ye)&&x(34067),i.unbindTexture()}else if(Ee){let Be=B.texture;for(let me=0,He=Be.length;me<He;me++){let Xe=Be[me],Ge=n.get(Xe);i.bindTexture(3553,Ge.__webglTexture),H(3553,Xe,Ye),$(te.__webglFramebuffer,B,Xe,36064+me,3553),C(Xe,Ye)&&x(3553)}i.unbindTexture()}else{let Be=3553;(B.isWebGL3DRenderTarget||B.isWebGLArrayRenderTarget)&&(a?Be=B.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Be,xe.__webglTexture),H(Be,O,Ye),$(te.__webglFramebuffer,B,O,36064,Be),C(O,Ye)&&x(Be),i.unbindTexture()}B.depthBuffer&&ae(B)},this.updateRenderTargetMipmap=function Ne(B){let O=b(B)||a,te=!0===B.isWebGLMultipleRenderTargets?B.texture:[B.texture];for(let xe=0,fe=te.length;xe<fe;xe++){let Ee=te[xe];if(C(Ee,O)){let Ye=B.isWebGLCubeRenderTarget?34067:3553,Be=n.get(Ee).__webglTexture;i.bindTexture(Ye,Be),x(Ye),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function Ue(B){if(a&&B.samples>0&&!1===Ce(B)){let O=B.isWebGLMultipleRenderTargets?B.texture:[B.texture],te=B.width,xe=B.height,fe=16384,Ee=[],Ye=B.stencilBuffer?33306:36096,Be=n.get(B),me=!0===B.isWebGLMultipleRenderTargets;if(me)for(let He=0;He<O.length;He++)i.bindFramebuffer(36160,Be.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+He,36161,null),i.bindFramebuffer(36160,Be.__webglFramebuffer),e.framebufferTexture2D(36009,36064+He,3553,null,0);i.bindFramebuffer(36008,Be.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Be.__webglFramebuffer);for(let He=0;He<O.length;He++){Ee.push(36064+He),B.depthBuffer&&Ee.push(Ye);let Xe=void 0!==Be.__ignoreDepthValues&&Be.__ignoreDepthValues;if(!1===Xe&&(B.depthBuffer&&(fe|=256),B.stencilBuffer&&(fe|=1024)),me&&e.framebufferRenderbuffer(36008,36064,36161,Be.__webglColorRenderbuffer[He]),!0===Xe&&(e.invalidateFramebuffer(36008,[Ye]),e.invalidateFramebuffer(36009,[Ye])),me){let Ge=n.get(O[He]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,Ge,0)}e.blitFramebuffer(0,0,te,xe,0,0,te,xe,fe,9728),p&&e.invalidateFramebuffer(36008,Ee)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),me)for(let He=0;He<O.length;He++){i.bindFramebuffer(36160,Be.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+He,36161,Be.__webglColorRenderbuffer[He]);let Xe=n.get(O[He]).__webglTexture;i.bindFramebuffer(36160,Be.__webglFramebuffer),e.framebufferTexture2D(36009,36064+He,3553,Xe,0)}i.bindFramebuffer(36009,Be.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ae,this.setupFrameBufferTexture=$,this.useMultisampledRTT=Ce}function xge(e,t,i){let n=i.isWebGL2;return{convert:function r(s,o=null){let a;if(s===mr)return 5121;if(s===rhe)return 32819;if(s===she)return 32820;if(s===the)return 5120;if(s===ihe)return 5122;if(s===nU)return 5123;if(s===nhe)return 5124;if(s===yl)return 5125;if(s===zr)return 5126;if(s===Vu)return n?5131:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(s===ohe)return 6406;if(s===Ls)return 6408;if(s===ahe)return 6409;if(s===lhe)return 6410;if(s===Uu)return 6402;if(s===ju)return 34041;if(s===wM)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(s===che)return 6403;if(s===uhe)return 36244;if(s===__)return 33319;if(s===hhe)return 33320;if(s===rU)return 36249;if(s===hM||s===dM||s===pM||s===fM)if(o===xt){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(s===hM)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===dM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===pM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===fM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(s===hM)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===dM)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===pM)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===fM)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(s===sU||s===oU||s===aU||s===lU){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(s===sU)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===oU)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===aU)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===lU)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(s===dhe)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===cU||s===uU){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(s===cU)return o===xt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===uU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(s===hU||s===dU||s===pU||s===fU||s===mU||s===gU||s===vU||s===yU||s===_U||s===bU||s===wU||s===xU||s===SU||s===CU){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(s===hU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===dU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===pU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===fU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===mU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===gU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===vU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===yU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===_U)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===bU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===wU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===xU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===SU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===CU)return o===xt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(s===mM){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(s===mM)return o===xt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(s===phe||s===EU||s===MU||s===AU){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(s===mM)return a.COMPRESSED_RED_RGTC1_EXT;if(s===EU)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===MU)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===AU)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===zu?n?34042:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[s]?e[s]:null}}}var Sge=class extends yr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},dp=class extends pi{constructor(){super(),this.isGroup=!0,this.type="Group"}},Cge={type:"move"},JM=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new dp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new dp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new M,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new M),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new dp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new M,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new M),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null,o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(let f of e.hand.values()){let m=t.getJointPose(f,i),g=this._getHandJoint(l,f);null!==m&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=m.radius),g.visible=null!==m}let u=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),d=.02,p=.005;l.inputState.pinching&&u>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&u<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(n=t.getPose(e.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Cge)))}return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let i=new dp;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},pp=class extends kn{constructor(e,t,i,n,r,s,o,a,l,c){if((c=void 0!==c?c:Uu)!==Uu&&c!==ju)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Uu&&(i=yl),void 0===i&&c===ju&&(i=zu),super(null,n,r,s,o,a,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:Ei,this.minFilter=void 0!==a?a:Ei,this.flipY=!1,this.generateMipmaps=!1}},Ege=class extends sr{constructor(e,t){super();let i=this,n=null,r=1,s=null,o="local-floor",a=1,l=null,c=null,h=null,u=null,d=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],_=new Set,b=new Map,w=new yr;w.layers.enable(1),w.viewport=new St;let C=new yr;C.layers.enable(2),C.viewport=new St;let x=[w,C],S=new Sge;S.layers.enable(1),S.layers.enable(2);let E=null,D=null;function T(U){let V=y.indexOf(U.inputSource);if(-1===V)return;let Y=v[V];void 0!==Y&&Y.dispatchEvent({type:U.type,data:U.inputSource})}function I(){n.removeEventListener("select",T),n.removeEventListener("selectstart",T),n.removeEventListener("selectend",T),n.removeEventListener("squeeze",T),n.removeEventListener("squeezestart",T),n.removeEventListener("squeezeend",T),n.removeEventListener("end",I),n.removeEventListener("inputsourceschange",P);for(let U=0;U<v.length;U++){let V=y[U];null!==V&&(y[U]=null,v[U].disconnect(V))}E=null,D=null,e.setRenderTarget(m),d=null,u=null,h=null,n=null,g=null,W.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function P(U){for(let V=0;V<U.removed.length;V++){let Y=U.removed[V],G=y.indexOf(Y);G>=0&&(y[G]=null,v[G].disconnect(Y))}for(let V=0;V<U.added.length;V++){let Y=U.added[V],G=y.indexOf(Y);if(-1===G){for(let H=0;H<v.length;H++){if(H>=y.length){y.push(Y),G=H;break}if(null===y[H]){y[H]=Y,G=H;break}}if(-1===G)break}let X=v[G];X&&X.connect(Y)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(U){let V=v[U];return void 0===V&&(V=new JM,v[U]=V),V.getTargetRaySpace()},this.getControllerGrip=function(U){let V=v[U];return void 0===V&&(V=new JM,v[U]=V),V.getGripSpace()},this.getHand=function(U){let V=v[U];return void 0===V&&(V=new JM,v[U]=V),V.getHandSpace()},this.setFramebufferScaleFactor=function(U){r=U,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(U){o=U,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(U){l=U},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=function(){var U=(0,sn.Z)(function*(V){if(n=V,null!==n){if(m=e.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",I),n.addEventListener("inputsourceschange",P),!0!==f.xrCompatible&&(yield t.makeXRCompatible()),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2)d=new XRWebGLLayer(n,t,{antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r}),n.updateRenderState({baseLayer:d}),g=new di(d.framebufferWidth,d.framebufferHeight,{format:Ls,type:mr,encoding:e.outputEncoding,stencilBuffer:f.stencil});else{let Y=null,G=null,X=null;f.depth&&(X=f.stencil?35056:33190,Y=f.stencil?ju:Uu,G=f.stencil?zu:yl);let H={colorFormat:32856,depthFormat:X,scaleFactor:r};h=new XRWebGLBinding(n,t),u=h.createProjectionLayer(H),n.updateRenderState({layers:[u]}),g=new di(u.textureWidth,u.textureHeight,{format:Ls,type:mr,depthTexture:new pp(u.textureWidth,u.textureHeight,G,void 0,void 0,void 0,void 0,void 0,void 0,Y),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=yield n.requestReferenceSpace(o),W.setContext(n),W.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(V){return U.apply(this,arguments)}}();let R=new M,L=new M;function F(U,V){null===V?U.matrixWorld.copy(U.matrix):U.matrixWorld.multiplyMatrices(V.matrixWorld,U.matrix),U.matrixWorldInverse.copy(U.matrixWorld).invert()}this.updateCamera=function(U){if(null===n)return;S.near=C.near=w.near=U.near,S.far=C.far=w.far=U.far,(E!==S.near||D!==S.far)&&(n.updateRenderState({depthNear:S.near,depthFar:S.far}),E=S.near,D=S.far);let V=U.parent,Y=S.cameras;F(S,V);for(let X=0;X<Y.length;X++)F(Y[X],V);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),U.matrix.copy(S.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale);let G=U.children;for(let X=0,H=G.length;X<H;X++)G[X].updateMatrixWorld(!0);2===Y.length?function j(U,V,Y){R.setFromMatrixPosition(V.matrixWorld),L.setFromMatrixPosition(Y.matrixWorld);let G=R.distanceTo(L),X=V.projectionMatrix.elements,H=Y.projectionMatrix.elements,re=X[14]/(X[10]-1),K=X[14]/(X[10]+1),se=(X[9]+1)/X[5],$=(X[9]-1)/X[5],ge=(X[8]-1)/X[0],ce=(H[8]+1)/H[0],ae=re*ge,Oe=re*ce,Re=G/(-ge+ce),Ne=Re*-ge;V.matrixWorld.decompose(U.position,U.quaternion,U.scale),U.translateX(Ne),U.translateZ(Re),U.matrixWorld.compose(U.position,U.quaternion,U.scale),U.matrixWorldInverse.copy(U.matrixWorld).invert();let Ue=re+Re,De=K+Re;U.projectionMatrix.makePerspective(ae-Ne,Oe+(G-Ne),se*K/De*Ue,$*K/De*Ue,Ue,De)}(S,w,C):S.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){if(null!==u||null!==d)return a},this.setFoveation=function(U){a=U,null!==u&&(u.fixedFoveation=U),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=U)},this.getPlanes=function(){return _};let N=null,W=new KU;W.setAnimationLoop(function q(U,V){if(c=V.getViewerPose(l||s),p=V,null!==c){let Y=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let G=!1;Y.length!==S.cameras.length&&(S.cameras.length=0,G=!0);for(let X=0;X<Y.length;X++){let H=Y[X],re=null;if(null!==d)re=d.getViewport(H);else{let se=h.getViewSubImage(u,H);re=se.viewport,0===X&&(e.setRenderTargetTextures(g,se.colorTexture,u.ignoreDepthValues?void 0:se.depthStencilTexture),e.setRenderTarget(g))}let K=x[X];void 0===K&&(K=new yr,K.layers.enable(X),K.viewport=new St,x[X]=K),K.matrix.fromArray(H.transform.matrix),K.projectionMatrix.fromArray(H.projectionMatrix),K.viewport.set(re.x,re.y,re.width,re.height),0===X&&S.matrix.copy(K.matrix),!0===G&&S.cameras.push(K)}}for(let Y=0;Y<v.length;Y++){let G=y[Y],X=v[Y];null!==G&&void 0!==X&&X.update(G,V,l||s)}if(N&&N(U,V),V.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:V.detectedPlanes});let Y=null;for(let G of _)V.detectedPlanes.has(G)||(null===Y&&(Y=[]),Y.push(G));if(null!==Y)for(let G of Y)_.delete(G),b.delete(G),i.dispatchEvent({type:"planeremoved",data:G});for(let G of V.detectedPlanes)if(_.has(G)){let X=b.get(G);G.lastChangedTime>X&&(b.set(G,G.lastChangedTime),i.dispatchEvent({type:"planechanged",data:G}))}else _.add(G),b.set(G,V.lastChangedTime),i.dispatchEvent({type:"planeadded",data:G})}p=null}),this.setAnimationLoop=function(U){N=U},this.dispose=function(){}}};function Mge(e,t){function r(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===qn&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===qn&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let y,_,v=t.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;let b=!0!==e.physicallyCorrectLights?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*b}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity),g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),void 0!==y&&(y.isWebGLRenderTarget&&(y=y.texture),!0===y.matrixAutoUpdate&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix)),g.aoMap?_=g.aoMap:g.lightMap&&(_=g.lightMap),void 0!==_&&(_.isWebGLRenderTarget&&(_=_.texture),!0===_.matrixAutoUpdate&&_.updateMatrix(),m.uv2Transform.value.copy(_.matrix))}return{refreshFogUniforms:function i(m,g){g.color.getRGB(m.fogColor.value,QU(e)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)},refreshMaterialUniforms:function n(m,g,v,y,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?r(m,g):g.isMeshToonMaterial?(r(m,g),function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}(m,g)):g.isMeshPhongMaterial?(r(m,g),function c(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}(m,g)):g.isMeshStandardMaterial?(r(m,g),function u(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}(m,g),g.isMeshPhysicalMaterial&&function d(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===qn&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}(m,g,_)):g.isMeshMatcapMaterial?(r(m,g),function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}(m,g)):g.isMeshDepthMaterial?r(m,g):g.isMeshDistanceMaterial?(r(m,g),function f(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}(m,g)):g.isMeshNormalMaterial?r(m,g):g.isLineBasicMaterial?(function s(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}(m,g),g.isLineDashedMaterial&&function o(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}(m,g)):g.isPointsMaterial?function a(m,g,v,y){let _;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=.5*y,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),void 0!==_&&(!0===_.matrixAutoUpdate&&_.updateMatrix(),m.uvTransform.value.copy(_.matrix))}(m,g,v,y):g.isSpriteMaterial?function l(m,g){let v;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),void 0!==v&&(!0===v.matrixAutoUpdate&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function Age(e,t,i,n){let r={},s={},o=[],a=i.isWebGL2?e.getParameter(35375):0;function p(y,_,b){let w=y.value;if(void 0===b[_]){if("number"==typeof w)b[_]=w;else{let C=Array.isArray(w)?w:[w],x=[];for(let S=0;S<C.length;S++)x.push(C[S].clone());b[_]=x}return!0}if("number"==typeof w){if(b[_]!==w)return b[_]=w,!0}else{let C=Array.isArray(b[_])?b[_]:[b[_]],x=Array.isArray(w)?w:[w];for(let S=0;S<C.length;S++){let E=C[S];if(!1===E.equals(x[S]))return E.copy(x[S]),!0}}return!1}function m(y){let _={boundary:0,storage:0};return"number"==typeof y?(_.boundary=4,_.storage=4):y.isVector2?(_.boundary=8,_.storage=8):y.isVector3||y.isColor?(_.boundary=16,_.storage=12):y.isVector4?(_.boundary=16,_.storage=16):y.isMatrix3?(_.boundary=48,_.storage=48):y.isMatrix4?(_.boundary=64,_.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),_}function g(y){let _=y.target;_.removeEventListener("dispose",g);let b=o.indexOf(_.__bindingPointIndex);o.splice(b,1),e.deleteBuffer(r[_.id]),delete r[_.id],delete s[_.id]}return{bind:function l(y,_){n.uniformBlockBinding(y,_.program)},update:function c(y,_){let b=r[y.id];void 0===b&&(function f(y){let _=y.uniforms,b=0,C=0;for(let x=0,S=_.length;x<S;x++){let E=_[x],D={boundary:0,storage:0},T=Array.isArray(E.value)?E.value:[E.value];for(let I=0,P=T.length;I<P;I++){let L=m(T[I]);D.boundary+=L.boundary,D.storage+=L.storage}E.__data=new Float32Array(D.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=b,x>0&&(C=b%16,0!==C&&16-C-D.boundary<0&&(b+=16-C,E.__offset=b)),b+=D.storage}C=b%16,C>0&&(b+=16-C),y.__size=b,y.__cache={}}(y),b=function h(y){let _=function u(){for(let y=0;y<a;y++)if(-1===o.indexOf(y))return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();y.__bindingPointIndex=_;let b=e.createBuffer(),w=y.__size,C=y.usage;return e.bindBuffer(35345,b),e.bufferData(35345,w,C),e.bindBuffer(35345,null),e.bindBufferBase(35345,_,b),b}(y),r[y.id]=b,y.addEventListener("dispose",g)),n.updateUBOMapping(y,_.program);let C=t.render.frame;s[y.id]!==C&&(function d(y){let b=y.uniforms,w=y.__cache;e.bindBuffer(35345,r[y.id]);for(let C=0,x=b.length;C<x;C++){let S=b[C];if(!0===p(S,C,w)){let E=S.__offset,D=Array.isArray(S.value)?S.value:[S.value],T=0;for(let I=0;I<D.length;I++){let P=D[I],R=m(P);"number"==typeof P?(S.__data[0]=P,e.bufferSubData(35345,E+T,S.__data)):P.isMatrix3?(S.__data[0]=P.elements[0],S.__data[1]=P.elements[1],S.__data[2]=P.elements[2],S.__data[3]=P.elements[0],S.__data[4]=P.elements[3],S.__data[5]=P.elements[4],S.__data[6]=P.elements[5],S.__data[7]=P.elements[0],S.__data[8]=P.elements[6],S.__data[9]=P.elements[7],S.__data[10]=P.elements[8],S.__data[11]=P.elements[0]):(P.toArray(S.__data,T),T+=R.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,E,S.__data)}}e.bindBuffer(35345,null)}(y),s[y.id]=C)},dispose:function v(){for(let y in r)e.deleteBuffer(r[y]);o=[],r={},s={}}}}function Ej(e={}){this.isWebGLRenderer=!0;let h,t=void 0!==e.canvas?e.canvas:function Dge(){let e=M_("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,a=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;h=null!==i?i.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let u=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=_a,this.physicallyCorrectLights=!1,this.toneMapping=gl,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,_=null,b=-1,w=null,C=new St,x=new St,S=null,E=t.width,D=t.height,T=1,I=null,P=null,R=new St(0,0,E,D),L=new St(0,0,E,D),j=!1,F=new qM,N=!1,q=!1,W=null,U=new ye,V=new z,Y=new M,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===_?T:1}let K,se,$,ge,ce,ae,Oe,Re,Ne,Ue,De,Ce,Qe,mt,B,O,te,xe,fe,Ee,Ye,Be,me,He,H=i;function re(k,ie){for(let ue=0;ue<k.length;ue++){let he=t.getContext(k[ue],ie);if(null!==he)return he}return null}try{let k={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${zd}`),t.addEventListener("webglcontextlost",ut,!1),t.addEventListener("webglcontextrestored",nt,!1),t.addEventListener("webglcontextcreationerror",Xt,!1),null===H){let ie=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&ie.shift(),H=re(ie,k),null===H)throw re(ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===H.getShaderPrecisionFormat&&(H.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(k){throw console.error("THREE.WebGLRenderer: "+k.message),k}function Xe(){K=new Ufe(H),se=new Nfe(H,K,e),K.init(se),Be=new xge(H,K,se),$=new bge(H,K,se),ge=new Gfe,ce=new age,ae=new wge(H,K,$,ce,se,Be,ge),Oe=new Ffe(m),Re=new zfe(m),Ne=new Jhe(H,se),me=new Ofe(H,K,Ne,se),Ue=new jfe(H,Ne,ge,me),De=new Xfe(H,Ue,Ne,ge),fe=new Yfe(H,se,ae),O=new kfe(ce),Ce=new oge(m,Oe,Re,K,se,me,O),Qe=new Mge(m,ce),mt=new cge,B=new mge(K,se),xe=new Rfe(m,Oe,Re,$,De,h,o),te=new _ge(m,De,se),He=new Age(H,ge,se,$),Ee=new Lfe(H,K,ge,se),Ye=new Hfe(H,K,ge,se),ge.programs=Ce.programs,m.capabilities=se,m.extensions=K,m.properties=ce,m.renderLists=mt,m.shadowMap=te,m.state=$,m.info=ge}Xe();let Ge=new Ege(m,H);function ut(k){k.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function nt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let k=ge.autoReset,ie=te.enabled,ue=te.autoUpdate,ee=te.needsUpdate,he=te.type;Xe(),ge.autoReset=k,te.enabled=ie,te.autoUpdate=ue,te.needsUpdate=ee,te.type=he}function Xt(k){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",k.statusMessage)}function ki(k){let ie=k.target;ie.removeEventListener("dispose",ki),function Dn(k){(function Q(k){let ie=ce.get(k).programs;void 0!==ie&&(ie.forEach(function(ue){Ce.releaseProgram(ue)}),k.isShaderMaterial&&Ce.releaseShaderCache(k))})(k),ce.remove(k)}(ie)}this.xr=Ge,this.getContext=function(){return H},this.getContextAttributes=function(){return H.getContextAttributes()},this.forceContextLoss=function(){let k=K.get("WEBGL_lose_context");k&&k.loseContext()},this.forceContextRestore=function(){let k=K.get("WEBGL_lose_context");k&&k.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(k){void 0!==k&&(T=k,this.setSize(E,D,!1))},this.getSize=function(k){return k.set(E,D)},this.setSize=function(k,ie,ue){Ge.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=k,D=ie,t.width=Math.floor(k*T),t.height=Math.floor(ie*T),!1!==ue&&(t.style.width=k+"px",t.style.height=ie+"px"),this.setViewport(0,0,k,ie))},this.getDrawingBufferSize=function(k){return k.set(E*T,D*T).floor()},this.setDrawingBufferSize=function(k,ie,ue){E=k,D=ie,T=ue,t.width=Math.floor(k*ue),t.height=Math.floor(ie*ue),this.setViewport(0,0,k,ie)},this.getCurrentViewport=function(k){return k.copy(C)},this.getViewport=function(k){return k.copy(R)},this.setViewport=function(k,ie,ue,ee){k.isVector4?R.set(k.x,k.y,k.z,k.w):R.set(k,ie,ue,ee),$.viewport(C.copy(R).multiplyScalar(T).floor())},this.getScissor=function(k){return k.copy(L)},this.setScissor=function(k,ie,ue,ee){k.isVector4?L.set(k.x,k.y,k.z,k.w):L.set(k,ie,ue,ee),$.scissor(x.copy(L).multiplyScalar(T).floor())},this.getScissorTest=function(){return j},this.setScissorTest=function(k){$.setScissorTest(j=k)},this.setOpaqueSort=function(k){I=k},this.setTransparentSort=function(k){P=k},this.getClearColor=function(k){return k.copy(xe.getClearColor())},this.setClearColor=function(){xe.setClearColor.apply(xe,arguments)},this.getClearAlpha=function(){return xe.getClearAlpha()},this.setClearAlpha=function(){xe.setClearAlpha.apply(xe,arguments)},this.clear=function(k=!0,ie=!0,ue=!0){let ee=0;k&&(ee|=16384),ie&&(ee|=256),ue&&(ee|=1024),H.clear(ee)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ut,!1),t.removeEventListener("webglcontextrestored",nt,!1),t.removeEventListener("webglcontextcreationerror",Xt,!1),mt.dispose(),B.dispose(),ce.dispose(),Oe.dispose(),Re.dispose(),De.dispose(),me.dispose(),He.dispose(),Ce.dispose(),Ge.dispose(),Ge.removeEventListener("sessionstart",Ie),Ge.removeEventListener("sessionend",ct),W&&(W.dispose(),W=null),Jt.stop()},this.renderBufferDirect=function(k,ie,ue,ee,he,Ke){null===ie&&(ie=G);let Dt=he.isMesh&&he.matrixWorld.determinant()<0,Nt=function YLe(k,ie,ue,ee,he){!0!==ie.isScene&&(ie=G),ae.resetTextureUnits();let Ke=ie.fog,Nt=null===_?m.outputEncoding:!0===_.isXRRenderTarget?_.texture.encoding:_a,Ut=(ee.isMeshStandardMaterial?Re:Oe).get(ee.envMap||(ee.isMeshStandardMaterial?ie.environment:null)),Ai=!0===ee.vertexColors&&!!ue.attributes.color&&4===ue.attributes.color.itemSize,ei=!!ee.normalMap&&!!ue.attributes.tangent,Zt=!!ue.morphAttributes.position,Er=!!ue.morphAttributes.normal,js=!!ue.morphAttributes.color,Kl=ee.toneMapped?m.toneMapping:gl,Ah=ue.morphAttributes.position||ue.morphAttributes.normal||ue.morphAttributes.color,Tn=void 0!==Ah?Ah.length:0,Qt=ce.get(ee),L2=d.state.lights;!0!==N||!0!==q&&k===w||O.setState(ee,k,k===w&&ee.id===b);let N2=!1;ee.version===Qt.__version?(Qt.needsLights&&Qt.lightsStateVersion!==L2.state.version||Qt.outputEncoding!==Nt||he.isInstancedMesh&&!1===Qt.instancing||!he.isInstancedMesh&&!0===Qt.instancing||he.isSkinnedMesh&&!1===Qt.skinning||!he.isSkinnedMesh&&!0===Qt.skinning||Qt.envMap!==Ut||!0===ee.fog&&Qt.fog!==Ke||void 0!==Qt.numClippingPlanes&&(Qt.numClippingPlanes!==O.numPlanes||Qt.numIntersection!==O.numIntersection)||Qt.vertexAlphas!==Ai||Qt.vertexTangents!==ei||Qt.morphTargets!==Zt||Qt.morphNormals!==Er||Qt.morphColors!==js||Qt.toneMapping!==Kl||!0===se.isWebGL2&&Qt.morphTargetsCount!==Tn)&&(N2=!0):(N2=!0,Qt.__version=ee.version);let Dh=Qt.currentProgram;!0===N2&&(Dh=wo(ee,ie,he));let gq=!1,Gv=!1,k2=!1,lr=Dh.getUniforms(),Th=Qt.uniforms;if($.useProgram(Dh.program)&&(gq=!0,Gv=!0,k2=!0),ee.id!==b&&(b=ee.id,Gv=!0),gq||w!==k){if(lr.setValue(H,"projectionMatrix",k.projectionMatrix),se.logarithmicDepthBuffer&&lr.setValue(H,"logDepthBufFC",2/(Math.log(k.far+1)/Math.LN2)),w!==k&&(w=k,Gv=!0,k2=!0),ee.isShaderMaterial||ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshStandardMaterial||ee.envMap){let Hs=lr.map.cameraPosition;void 0!==Hs&&Hs.setValue(H,Y.setFromMatrixPosition(k.matrixWorld))}(ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshLambertMaterial||ee.isMeshBasicMaterial||ee.isMeshStandardMaterial||ee.isShaderMaterial)&&lr.setValue(H,"isOrthographic",!0===k.isOrthographicCamera),(ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshLambertMaterial||ee.isMeshBasicMaterial||ee.isMeshStandardMaterial||ee.isShaderMaterial||ee.isShadowMaterial||he.isSkinnedMesh)&&lr.setValue(H,"viewMatrix",k.matrixWorldInverse)}if(he.isSkinnedMesh){lr.setOptional(H,he,"bindMatrix"),lr.setOptional(H,he,"bindMatrixInverse");let Hs=he.skeleton;Hs&&(se.floatVertexTextures?(null===Hs.boneTexture&&Hs.computeBoneTexture(),lr.setValue(H,"boneTexture",Hs.boneTexture,ae),lr.setValue(H,"boneTextureSize",Hs.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let F2=ue.morphAttributes;if((void 0!==F2.position||void 0!==F2.normal||void 0!==F2.color&&!0===se.isWebGL2)&&fe.update(he,ue,ee,Dh),(Gv||Qt.receiveShadow!==he.receiveShadow)&&(Qt.receiveShadow=he.receiveShadow,lr.setValue(H,"receiveShadow",he.receiveShadow)),ee.isMeshGouraudMaterial&&null!==ee.envMap&&(Th.envMap.value=Ut,Th.flipEnvMap.value=Ut.isCubeTexture&&!1===Ut.isRenderTargetTexture?-1:1),Gv&&(lr.setValue(H,"toneMappingExposure",m.toneMappingExposure),Qt.needsLights&&function XLe(k,ie){k.ambientLightColor.needsUpdate=ie,k.lightProbe.needsUpdate=ie,k.directionalLights.needsUpdate=ie,k.directionalLightShadows.needsUpdate=ie,k.pointLights.needsUpdate=ie,k.pointLightShadows.needsUpdate=ie,k.spotLights.needsUpdate=ie,k.spotLightShadows.needsUpdate=ie,k.rectAreaLights.needsUpdate=ie,k.hemisphereLights.needsUpdate=ie}(Th,k2),Ke&&!0===ee.fog&&Qe.refreshFogUniforms(Th,Ke),Qe.refreshMaterialUniforms(Th,ee,T,D,W),X_.upload(H,Qt.uniformsList,Th,ae)),ee.isShaderMaterial&&!0===ee.uniformsNeedUpdate&&(X_.upload(H,Qt.uniformsList,Th,ae),ee.uniformsNeedUpdate=!1),ee.isSpriteMaterial&&lr.setValue(H,"center",he.center),lr.setValue(H,"modelViewMatrix",he.modelViewMatrix),lr.setValue(H,"normalMatrix",he.normalMatrix),lr.setValue(H,"modelMatrix",he.matrixWorld),he.previousModelViewMatrix&&lr.setValue(H,"previousModelViewMatrix",he.previousModelViewMatrix),k.previousProjectionMatrix&&lr.setValue(H,"previousProjectionMatrix",k.previousProjectionMatrix),ee.isShaderMaterial||ee.isRawShaderMaterial){let Hs=ee.uniformsGroups;for(let B2=0,QLe=Hs.length;B2<QLe;B2++)if(se.isWebGL2){let vq=Hs[B2];He.update(vq,Dh),He.bind(vq,Dh)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Dh}(k,ie,ue,ee,he);$.setMaterial(ee,Dt);let Ut=ue.index,Ai=1;!0===ee.wireframe&&(Ut=Ue.getWireframeAttribute(ue),Ai=2);let ei=ue.drawRange,Zt=ue.attributes.position,Er=ei.start*Ai,js=(ei.start+ei.count)*Ai;null!==Ke&&(Er=Math.max(Er,Ke.start*Ai),js=Math.min(js,(Ke.start+Ke.count)*Ai)),null!==Ut?(Er=Math.max(Er,0),js=Math.min(js,Ut.count)):null!=Zt&&(Er=Math.max(Er,0),js=Math.min(js,Zt.count));let Kl=js-Er;if(Kl<0||Kl===1/0)return;me.setup(he,ee,Nt,ue,Ut);let Ah,Tn=Ee;if(null!==Ut&&(Ah=Ne.get(Ut),Tn=Ye,Tn.setIndex(Ah)),he.isMesh)!0===ee.wireframe?($.setLineWidth(ee.wireframeLinewidth*X()),Tn.setMode(1)):Tn.setMode(4);else if(he.isLine){let Qt=ee.linewidth;void 0===Qt&&(Qt=1),$.setLineWidth(Qt*X()),Tn.setMode(he.isLineSegments?1:he.isLineLoop?2:3)}else he.isPoints?Tn.setMode(0):he.isSprite&&Tn.setMode(4);if(he.isInstancedMesh)Tn.renderInstances(Er,Kl,he.count);else if(ue.isInstancedBufferGeometry){let L2=Math.min(ue.instanceCount,void 0!==ue._maxInstanceCount?ue._maxInstanceCount:1/0);Tn.renderInstances(Er,Kl,L2)}else Tn.render(Er,Kl)},this.compile=function(k,ie){function ue(ee,he,Ke){!0===ee.transparent&&ee.side===hs&&!1===ee.forceSinglePass?(ee.side=qn,ee.needsUpdate=!0,wo(ee,he,Ke),ee.side=No,ee.needsUpdate=!0,wo(ee,he,Ke),ee.side=hs):wo(ee,he,Ke)}d=B.get(k),d.init(),f.push(d),k.traverseVisible(function(ee){ee.isLight&&ee.layers.test(ie.layers)&&(d.pushLight(ee),ee.castShadow&&d.pushShadow(ee))}),d.setupLights(m.physicallyCorrectLights),k.traverse(function(ee){let he=ee.material;if(he)if(Array.isArray(he))for(let Ke=0;Ke<he.length;Ke++)ue(he[Ke],k,ee);else ue(he,k,ee)}),f.pop(),d=null};let le=null;function Ie(){Jt.stop()}function ct(){Jt.start()}let Jt=new KU;function Gi(k,ie,ue,ee){if(!1===k.visible)return;if(k.layers.test(ie.layers))if(k.isGroup)ue=k.renderOrder;else if(k.isLOD)!0===k.autoUpdate&&k.update(ie);else if(k.isLight)d.pushLight(k),k.castShadow&&d.pushShadow(k);else if(k.isSprite){if(!k.frustumCulled||F.intersectsSprite(k)){ee&&Y.setFromMatrixPosition(k.matrixWorld).applyMatrix4(U);let Ke=De.update(k),Dt=k.material;Dt.visible&&u.push(k,Ke,Dt,ue,Y.z,null)}}else if((k.isMesh||k.isLine||k.isPoints)&&(k.isSkinnedMesh&&k.skeleton.frame!==ge.render.frame&&(k.skeleton.update(),k.skeleton.frame=ge.render.frame),!k.frustumCulled||F.intersectsObject(k))){ee&&Y.setFromMatrixPosition(k.matrixWorld).applyMatrix4(U);let Ke=De.update(k),Dt=k.material;if(Array.isArray(Dt)){let Nt=Ke.groups;for(let Ut=0,Ai=Nt.length;Ut<Ai;Ut++){let ei=Nt[Ut],Zt=Dt[ei.materialIndex];Zt&&Zt.visible&&u.push(k,Ke,Zt,ue,Y.z,ei)}}else Dt.visible&&u.push(k,Ke,Dt,ue,Y.z,null)}let he=k.children;for(let Ke=0,Dt=he.length;Ke<Dt;Ke++)Gi(he[Ke],ie,ue,ee)}function Cr(k,ie,ue,ee){let he=k.opaque,Ke=k.transmissive,Dt=k.transparent;d.setupLightsView(ue),!0===N&&O.setGlobalState(m.clippingPlanes,ue),Ke.length>0&&function Mh(k,ie,ue){let ee=se.isWebGL2;null===W&&(W=new di(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")?Vu:mr,minFilter:jd,samples:ee&&!0===s?4:0})),m.getDrawingBufferSize(V),ee?W.setSize(V.x,V.y):W.setSize(C_(V.x),C_(V.y));let he=m.getRenderTarget();m.setRenderTarget(W),m.clear();let Ke=m.toneMapping;m.toneMapping=gl,zi(k,ie,ue),m.toneMapping=Ke,ae.updateMultisampleRenderTarget(W),ae.updateRenderTargetMipmap(W),m.setRenderTarget(he)}(he,ie,ue),ee&&$.viewport(C.copy(ee)),he.length>0&&zi(he,ie,ue),Ke.length>0&&zi(Ke,ie,ue),Dt.length>0&&zi(Dt,ie,ue),$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1)}function zi(k,ie,ue){let ee=!0===ie.isScene?ie.overrideMaterial:null;for(let he=0,Ke=k.length;he<Ke;he++){let Dt=k[he],Nt=Dt.object,Ut=Dt.geometry,Ai=null===ee?Dt.material:ee,ei=Dt.group;Nt.layers.test(ue.layers)&&Ql(Nt,ie,ue,Ut,Ai,ei)}}function Ql(k,ie,ue,ee,he,Ke){k.onBeforeRender(m,ie,ue,ee,he,Ke),k.modelViewMatrix.multiplyMatrices(ue.matrixWorldInverse,k.matrixWorld),k.normalMatrix.getNormalMatrix(k.modelViewMatrix),he.onBeforeRender(m,ie,ue,ee,k,Ke),!0===he.transparent&&he.side===hs&&!1===he.forceSinglePass?(he.side=qn,he.needsUpdate=!0,m.renderBufferDirect(ue,ie,ee,he,k,Ke),he.side=No,he.needsUpdate=!0,m.renderBufferDirect(ue,ie,ee,he,k,Ke),he.side=hs):m.renderBufferDirect(ue,ie,ee,he,k,Ke),k.onAfterRender(m,ie,ue,ee,he,Ke)}function wo(k,ie,ue){!0!==ie.isScene&&(ie=G);let ee=ce.get(k),he=d.state.lights,Dt=he.state.version,Nt=Ce.getParameters(k,he.state,d.state.shadowsArray,ie,ue),Ut=Ce.getProgramCacheKey(Nt),Ai=ee.programs;ee.environment=k.isMeshStandardMaterial?ie.environment:null,ee.fog=ie.fog,ee.envMap=(k.isMeshStandardMaterial?Re:Oe).get(k.envMap||ee.environment),void 0===Ai&&(k.addEventListener("dispose",ki),Ai=new Map,ee.programs=Ai);let ei=Ai.get(Ut);if(void 0!==ei){if(ee.currentProgram===ei&&ee.lightsStateVersion===Dt)return mq(k,Nt),ei}else Nt.uniforms=Ce.getUniforms(k),k.onBuild(ue,Nt,m),k.onBeforeCompile(Nt,m),ei=Ce.acquireProgram(Nt,Ut),Ai.set(Ut,ei),ee.uniforms=Nt.uniforms;let Zt=ee.uniforms;(!k.isShaderMaterial&&!k.isRawShaderMaterial||!0===k.clipping)&&(Zt.clippingPlanes=O.uniform),mq(k,Nt),ee.needsLights=function ZLe(k){return k.isMeshLambertMaterial||k.isMeshToonMaterial||k.isMeshPhongMaterial||k.isMeshStandardMaterial||k.isShadowMaterial||k.isShaderMaterial&&!0===k.lights}(k),ee.lightsStateVersion=Dt,ee.needsLights&&(Zt.ambientLightColor.value=he.state.ambient,Zt.lightProbe.value=he.state.probe,Zt.directionalLights.value=he.state.directional,Zt.directionalLightShadows.value=he.state.directionalShadow,Zt.spotLights.value=he.state.spot,Zt.spotLightShadows.value=he.state.spotShadow,Zt.rectAreaLights.value=he.state.rectArea,Zt.ltc_1.value=he.state.rectAreaLTC1,Zt.ltc_2.value=he.state.rectAreaLTC2,Zt.pointLights.value=he.state.point,Zt.pointLightShadows.value=he.state.pointShadow,Zt.hemisphereLights.value=he.state.hemi,Zt.directionalShadowMap.value=he.state.directionalShadowMap,Zt.directionalShadowMatrix.value=he.state.directionalShadowMatrix,Zt.spotShadowMap.value=he.state.spotShadowMap,Zt.spotLightMatrix.value=he.state.spotLightMatrix,Zt.spotLightMap.value=he.state.spotLightMap,Zt.pointShadowMap.value=he.state.pointShadowMap,Zt.pointShadowMatrix.value=he.state.pointShadowMatrix);let Er=ei.getUniforms(),js=X_.seqWithValue(Er.seq,Zt);return ee.currentProgram=ei,ee.uniformsList=js,ei}function mq(k,ie){let ue=ce.get(k);ue.outputEncoding=ie.outputEncoding,ue.instancing=ie.instancing,ue.skinning=ie.skinning,ue.morphTargets=ie.morphTargets,ue.morphNormals=ie.morphNormals,ue.morphColors=ie.morphColors,ue.morphTargetsCount=ie.morphTargetsCount,ue.numClippingPlanes=ie.numClippingPlanes,ue.numIntersection=ie.numClipIntersection,ue.vertexAlphas=ie.vertexAlphas,ue.vertexTangents=ie.vertexTangents,ue.toneMapping=ie.toneMapping}Jt.setAnimationLoop(function Se(k){le&&le(k)}),typeof self<"u"&&Jt.setContext(self),this.setAnimationLoop=function(k){le=k,Ge.setAnimationLoop(k),null===k?Jt.stop():Jt.start()},Ge.addEventListener("sessionstart",Ie),Ge.addEventListener("sessionend",ct),this.render=function(k,ie){if(void 0===ie||!0===ie.isCamera){if(!0!==g){if(!0===k.matrixWorldAutoUpdate&&k.updateMatrixWorld(),null===ie.parent&&!0===ie.matrixWorldAutoUpdate&&ie.updateMatrixWorld(),!0===Ge.enabled&&!0===Ge.isPresenting&&(!0===Ge.cameraAutoUpdate&&Ge.updateCamera(ie),ie=Ge.getCamera()),!0===k.isScene&&k.onBeforeRender(m,k,ie,_),d=B.get(k,f.length),d.init(),f.push(d),U.multiplyMatrices(ie.projectionMatrix,ie.matrixWorldInverse),F.setFromProjectionMatrix(U),q=this.localClippingEnabled,N=O.init(this.clippingPlanes,q),u=mt.get(k,p.length),u.init(),p.push(u),Gi(k,ie,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(I,P),!0===N&&O.beginShadows(),te.render(d.state.shadowsArray,k,ie),!0===N&&O.endShadows(),!0===this.info.autoReset&&this.info.reset(),xe.render(u,k),d.setupLights(m.physicallyCorrectLights),ie.isArrayCamera){let ee=ie.cameras;for(let he=0,Ke=ee.length;he<Ke;he++){let Dt=ee[he];Cr(u,k,Dt,Dt.viewport)}}else Cr(u,k,ie);null!==_&&(ae.updateMultisampleRenderTarget(_),ae.updateRenderTargetMipmap(_)),!0===k.isScene&&k.onAfterRender(m,k,ie),me.resetDefaultState(),b=-1,w=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(k,ie,ue){ce.get(k.texture).__webglTexture=ie,ce.get(k.depthTexture).__webglTexture=ue;let ee=ce.get(k);ee.__hasExternalTextures=!0,ee.__hasExternalTextures&&(ee.__autoAllocateDepthBuffer=void 0===ue,ee.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ee.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(k,ie){let ue=ce.get(k);ue.__webglFramebuffer=ie,ue.__useDefaultFramebuffer=void 0===ie},this.setRenderTarget=function(k,ie=0,ue=0){_=k,v=ie,y=ue;let ee=!0,he=null,Ke=!1,Dt=!1;if(k){let Nt=ce.get(k);void 0!==Nt.__useDefaultFramebuffer?($.bindFramebuffer(36160,null),ee=!1):void 0===Nt.__webglFramebuffer?ae.setupRenderTarget(k):Nt.__hasExternalTextures&&ae.rebindTextures(k,ce.get(k.texture).__webglTexture,ce.get(k.depthTexture).__webglTexture);let Ut=k.texture;(Ut.isData3DTexture||Ut.isDataArrayTexture||Ut.isCompressedArrayTexture)&&(Dt=!0);let Ai=ce.get(k).__webglFramebuffer;k.isWebGLCubeRenderTarget?(he=Ai[ie],Ke=!0):he=se.isWebGL2&&k.samples>0&&!1===ae.useMultisampledRTT(k)?ce.get(k).__webglMultisampledFramebuffer:Ai,C.copy(k.viewport),x.copy(k.scissor),S=k.scissorTest}else C.copy(R).multiplyScalar(T).floor(),x.copy(L).multiplyScalar(T).floor(),S=j;if($.bindFramebuffer(36160,he)&&se.drawBuffers&&ee&&$.drawBuffers(k,he),$.viewport(C),$.scissor(x),$.setScissorTest(S),Ke){let Nt=ce.get(k.texture);H.framebufferTexture2D(36160,36064,34069+ie,Nt.__webglTexture,ue)}else if(Dt){let Nt=ce.get(k.texture);H.framebufferTextureLayer(36160,36064,Nt.__webglTexture,ue||0,ie||0)}b=-1},this.readRenderTargetPixels=function(k,ie,ue,ee,he,Ke,Dt){if(!k||!k.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Nt=ce.get(k).__webglFramebuffer;if(k.isWebGLCubeRenderTarget&&void 0!==Dt&&(Nt=Nt[Dt]),Nt){$.bindFramebuffer(36160,Nt);try{let Ut=k.texture,Ai=Ut.format,ei=Ut.type;if(Ai!==Ls&&Be.convert(Ai)!==H.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let Zt=ei===Vu&&(K.has("EXT_color_buffer_half_float")||se.isWebGL2&&K.has("EXT_color_buffer_float"));if(!(ei===mr||Be.convert(ei)===H.getParameter(35738)||ei===zr&&(se.isWebGL2||K.has("OES_texture_float")||K.has("WEBGL_color_buffer_float"))||Zt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ie>=0&&ie<=k.width-ee&&ue>=0&&ue<=k.height-he&&H.readPixels(ie,ue,ee,he,Be.convert(Ai),Be.convert(ei),Ke)}finally{let Ut=null!==_?ce.get(_).__webglFramebuffer:null;$.bindFramebuffer(36160,Ut)}}},this.copyFramebufferToTexture=function(k,ie,ue=0){let ee=Math.pow(2,-ue),he=Math.floor(ie.image.width*ee),Ke=Math.floor(ie.image.height*ee);ae.setTexture2D(ie,0),H.copyTexSubImage2D(3553,ue,0,0,k.x,k.y,he,Ke),$.unbindTexture()},this.copyTextureToTexture=function(k,ie,ue,ee=0){let he=ie.image.width,Ke=ie.image.height,Dt=Be.convert(ue.format),Nt=Be.convert(ue.type);ae.setTexture2D(ue,0),H.pixelStorei(37440,ue.flipY),H.pixelStorei(37441,ue.premultiplyAlpha),H.pixelStorei(3317,ue.unpackAlignment),ie.isDataTexture?H.texSubImage2D(3553,ee,k.x,k.y,he,Ke,Dt,Nt,ie.image.data):ie.isCompressedTexture?H.compressedTexSubImage2D(3553,ee,k.x,k.y,ie.mipmaps[0].width,ie.mipmaps[0].height,Dt,ie.mipmaps[0].data):H.texSubImage2D(3553,ee,k.x,k.y,Dt,Nt,ie.image),0===ee&&ue.generateMipmaps&&H.generateMipmap(3553),$.unbindTexture()},this.copyTextureToTexture3D=function(k,ie,ue,ee,he=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let ei,Ke=k.max.x-k.min.x+1,Dt=k.max.y-k.min.y+1,Nt=k.max.z-k.min.z+1,Ut=Be.convert(ee.format),Ai=Be.convert(ee.type);if(ee.isData3DTexture)ae.setTexture3D(ee,0),ei=32879;else{if(!ee.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ae.setTexture2DArray(ee,0),ei=35866}H.pixelStorei(37440,ee.flipY),H.pixelStorei(37441,ee.premultiplyAlpha),H.pixelStorei(3317,ee.unpackAlignment);let Zt=H.getParameter(3314),Er=H.getParameter(32878),js=H.getParameter(3316),Kl=H.getParameter(3315),Ah=H.getParameter(32877),Tn=ue.isCompressedTexture?ue.mipmaps[0]:ue.image;H.pixelStorei(3314,Tn.width),H.pixelStorei(32878,Tn.height),H.pixelStorei(3316,k.min.x),H.pixelStorei(3315,k.min.y),H.pixelStorei(32877,k.min.z),ue.isDataTexture||ue.isData3DTexture?H.texSubImage3D(ei,he,ie.x,ie.y,ie.z,Ke,Dt,Nt,Ut,Ai,Tn.data):ue.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),H.compressedTexSubImage3D(ei,he,ie.x,ie.y,ie.z,Ke,Dt,Nt,Ut,Tn.data)):H.texSubImage3D(ei,he,ie.x,ie.y,ie.z,Ke,Dt,Nt,Ut,Ai,Tn),H.pixelStorei(3314,Zt),H.pixelStorei(32878,Er),H.pixelStorei(3316,js),H.pixelStorei(3315,Kl),H.pixelStorei(32877,Ah),0===he&&ee.generateMipmaps&&H.generateMipmap(ei),$.unbindTexture()},this.initTexture=function(k){k.isCubeTexture?ae.setTextureCube(k,0):k.isData3DTexture?ae.setTexture3D(k,0):k.isDataArrayTexture||k.isCompressedArrayTexture?ae.setTexture2DArray(k,0):ae.setTexture2D(k,0),$.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,$.reset(),me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends Ej{}).prototype.isWebGL1Renderer=!0;var Mj=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Je(e),this.near=t,this.far=i}clone(){return new Mj(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},wc=class extends pi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},Gr=new M,eA=class{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Gr.fromBufferAttribute(this,t),Gr.applyMatrix4(e),this.setXYZ(t,Gr.x,Gr.y,Gr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Gr.fromBufferAttribute(this,t),Gr.applyNormalMatrix(e),this.setXYZ(t,Gr.x,Gr.y,Gr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Gr.fromBufferAttribute(this,t),Gr.transformDirection(e),this.setXYZ(t,Gr.x,Gr.y,Gr.z);return this}setX(e,t){return this.normalized&&(t=Mi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Mi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Mi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Mi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=bl(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=bl(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=bl(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=bl(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mi(t,this.array),i=Mi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mi(t,this.array),i=Mi(i,this.array),n=Mi(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mi(t,this.array),i=Mi(i,this.array),n=Mi(n,this.array),r=Mi(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new st(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new eA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},Aj=class extends pi{constructor(){super(),this.isBone=!0,this.type="Bone"}},xc=class extends kn{constructor(e=null,t=1,i=1,n,r,s,o,a,l=Ei,c=Ei,h,u){super(null,s,o,a,l,c,n,r,h,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Dj=new ye,Pge=new ye,tA=class{constructor(e=[],t=[]){this.uuid=ro(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new ye)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new ye;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,s=e.length;r<s;r++)Dj.multiplyMatrices(e[r]?e[r].matrixWorld:Pge,t[r]),Dj.toArray(i,16*r);null!==n&&(n.needsUpdate=!0)}clone(){return new tA(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=OU(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new xc(t,e,e,Ls,zr);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let r=e.bones[i],s=t[r];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new Aj),this.bones.push(s),this.boneInverses.push((new ye).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++)e.bones.push(t[n].uuid),e.boneInverses.push(i[n].toArray());return e}},Tj=class extends st{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},Sc=class extends Cg{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Je(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},Ij=new M,Pj=new M,Rj=new ye,iA=new Zd,Z_=new ds,Q_=class extends pi{constructor(e=new Ze,t=new Sc){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)Ij.fromBufferAttribute(t,n-1),Pj.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=Ij.distanceTo(Pj);e.setAttribute("lineDistance",new Fe(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Z_.copy(i.boundingSphere),Z_.applyMatrix4(n),Z_.radius+=r,!1===e.ray.intersectsSphere(Z_))return;Rj.copy(n).invert(),iA.copy(e.ray).applyMatrix4(Rj);let o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new M,c=new M,h=new M,u=new M,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p)for(let v=Math.max(0,s.start),y=Math.min(p.count,s.start+s.count)-1;v<y;v+=d){let _=p.getX(v),b=p.getX(v+1);if(l.fromBufferAttribute(f,_),c.fromBufferAttribute(f,b),iA.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);let w=e.ray.origin.distanceTo(u);w<e.near||w>e.far||t.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else for(let v=Math.max(0,s.start),y=Math.min(f.count,s.start+s.count)-1;v<y;v+=d){if(l.fromBufferAttribute(f,v),c.fromBufferAttribute(f,v+1),iA.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(u);_<e.near||_>e.far||t.push({distance:_,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){let s=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=n}}}}},Oj=new M,Lj=new M,Pg=class extends Q_{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)Oj.fromBufferAttribute(t,n),Lj.fromBufferAttribute(t,n+1),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+Oj.distanceTo(Lj);e.setAttribute("lineDistance",new Fe(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Rge=class extends kn{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,r,s,o,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:It,this.magFilter=void 0!==r?r:It,this.generateMipmaps=!1;let c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function h(){c.needsUpdate=!0,e.requestVideoFrameCallback(h)})}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Sa=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let i,t=[],n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let s,i=this.getLengths(),n=0,r=i.length;s=t||e*i[r-1];let l,o=0,a=r-1;for(;o<=a;)if(n=Math.floor(o+(a-o)/2),l=i[n]-s,l<0)o=n+1;else{if(!(l>0)){a=n;break}a=n-1}if(n=a,i[n]===s)return n/(r-1);let c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),s=this.getPoint(n),o=t||(r.isVector2?new z:new M);return o.copy(s).sub(r).normalize(),o}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new M,n=[],r=[],s=[],o=new M,a=new ye;for(let d=0;d<=e;d++)n[d]=this.getTangentAt(d/e,new M);r[0]=new M,s[0]=new M;let l=Number.MAX_VALUE,c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),o.crossVectors(n[d-1],n[d]),o.length()>Number.EPSILON){o.normalize();let p=Math.acos(wn(n[d-1].dot(n[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(o,p))}s[d].crossVectors(n[d],r[d])}if(!0===t){let d=Math.acos(wn(r[0].dot(r[e]),-1,1));d/=e,n[0].dot(o.crossVectors(r[0],r[e]))>0&&(d=-d);for(let p=1;p<=e;p++)r[p].applyMatrix4(a.makeRotationAxis(n[p],d*p)),s[p].crossVectors(n[p],r[p])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},K_=class extends Sa{constructor(e=0,t=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){let i=t||new z,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0===this.aClockwise&&!s&&(r===n?r=-n:r-=n);let o=this.aStartAngle+e*r,a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){let c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=a-this.aX,d=l-this.aY;a=u*c-d*h+this.aX,l=u*h+d*c+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};function nA(){let e=0,t=0,i=0,n=0;function r(s,o,a,l){e=s,t=a,i=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,h,u){let d=(o-s)/c-(a-s)/(c+h)+(a-o)/h,p=(a-o)/h-(l-o)/(h+u)+(l-a)/u;d*=h,p*=h,r(o,a,d,p)},calc:function(s){let o=s*s;return e+t*s+i*o+n*(o*s)}}}var $_=new M,rA=new nA,sA=new nA,oA=new nA;function Nj(e,t,i,n,r){let s=.5*(n-t),o=.5*(r-i),a=e*e;return(2*i-2*n+s+o)*(e*a)+(-3*i+3*n-2*s-o)*a+s*e+i}function Rg(e,t,i,n){return function Nge(e,t){let i=1-e;return i*i*t}(e,t)+function kge(e,t){return 2*(1-e)*e*t}(e,i)+function Fge(e,t){return e*e*t}(e,n)}function Og(e,t,i,n,r){return function Bge(e,t){let i=1-e;return i*i*i*t}(e,t)+function Vge(e,t){let i=1-e;return 3*i*i*e*t}(e,i)+function zge(e,t){return 3*(1-e)*e*e*t}(e,n)+function Uge(e,t){return e*e*e*t}(e,r)}var Vo=class extends Sa{constructor(e=new z,t=new z,i=new z,n=new z){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new z){let i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(Og(e,n.x,r.x,s.x,o.x),Og(e,n.y,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},J_=class extends Sa{constructor(e=new M,t=new M,i=new M,n=new M){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new M){let i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(Og(e,n.x,r.x,s.x,o.x),Og(e,n.y,r.y,s.y,o.y),Og(e,n.z,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},zo=class extends Sa{constructor(e=new z,t=new z){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new z){let i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new z;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},kj=class extends Sa{constructor(e=new M,t=new M){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new M){let i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Cc=class extends Sa{constructor(e=new z,t=new z,i=new z){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new z){let i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(Rg(e,n.x,r.x,s.x),Rg(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},aA=class extends Sa{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new z){let i=t,n=this.points,r=(n.length-1)*e,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(Nj(o,a.x,l.x,c.x,h.x),Nj(o,a.y,l.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push((new z).fromArray(n))}return this}},Hge=Object.freeze({__proto__:null,ArcCurve:class extends K_{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Sa{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new M){let l,c,i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e,o=Math.floor(s),a=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:0===a&&o===r-1&&(o=r-2,a=1),this.closed||o>0?l=n[(o-1)%r]:($_.subVectors(n[0],n[1]).add(n[0]),l=$_);let h=n[o%r],u=n[(o+1)%r];if(this.closed||o+2<r?c=n[(o+2)%r]:($_.subVectors(n[r-1],n[r-2]).add(n[r-1]),c=$_),"centripetal"===this.curveType||"chordal"===this.curveType){let d="chordal"===this.curveType?.5:.25,p=Math.pow(l.distanceToSquared(h),d),f=Math.pow(h.distanceToSquared(u),d),m=Math.pow(u.distanceToSquared(c),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),rA.initNonuniformCatmullRom(l.x,h.x,u.x,c.x,p,f,m),sA.initNonuniformCatmullRom(l.y,h.y,u.y,c.y,p,f,m),oA.initNonuniformCatmullRom(l.z,h.z,u.z,c.z,p,f,m)}else"catmullrom"===this.curveType&&(rA.initCatmullRom(l.x,h.x,u.x,c.x,this.tension),sA.initCatmullRom(l.y,h.y,u.y,c.y,this.tension),oA.initCatmullRom(l.z,h.z,u.z,c.z,this.tension));return i.set(rA.calc(a),sA.calc(a),oA.calc(a)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let n=e.points[t];this.points.push((new M).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:Vo,CubicBezierCurve3:J_,EllipseCurve:K_,LineCurve:zo,LineCurve3:kj,QuadraticBezierCurve:Cc,QuadraticBezierCurve3:class extends Sa{constructor(e=new M,t=new M,i=new M){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new M){let i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(Rg(e,n.x,r.x,s.x),Rg(e,n.y,r.y,s.y),Rg(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:aA}),Fj=class extends Sa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new zo(t,e))}getPoint(e,t){let i=e*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let s=n[r]-i,o=this.curves[r],a=o.getLength();return o.getPointAt(0===a?0:1-s/a,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let i,t=[];for(let n=0,r=this.curves;n<r.length;n++){let s=r[n],a=s.getPoints(s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e);for(let l=0;l<a.length;l++){let c=a[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let n=e.curves[t];this.curves.push((new Hge[n.type]).fromJSON(n))}return this}},eb=class extends Fj{constructor(e){super(),this.type="Path",this.currentPoint=new z,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new zo(this.currentPoint.clone(),new z(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){let r=new Cc(this.currentPoint.clone(),new z(e,t),new z(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,s){let o=new Vo(this.currentPoint.clone(),new z(e,t),new z(i,n),new z(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new aA(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,o,a){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,s,o,a),this}absellipse(e,t,i,n,r,s,o,a){let l=new K_(e,t,i,n,r,s,o,a);if(this.curves.length>0){let h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},Bj=class extends Ze{constructor(e=[new z(0,-.5),new z(.5,0),new z(0,.5)],t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=wn(n,0,2*Math.PI);let r=[],s=[],o=[],a=[],l=[],c=1/t,h=new M,u=new z,d=new M,p=new M,f=new M,m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){let y=i+v*c*n,_=Math.sin(y),b=Math.cos(y);for(let w=0;w<=e.length-1;w++)h.x=e[w].x*_,h.y=e[w].y,h.z=e[w].x*b,s.push(h.x,h.y,h.z),u.x=v/t,u.y=w/(e.length-1),o.push(u.x,u.y),l.push(a[3*w+0]*_,a[3*w+1],a[3*w+0]*b)}for(let v=0;v<t;v++)for(let y=0;y<e.length-1;y++){let _=y+v*e.length,w=_+e.length,C=_+e.length+1,x=_+1;r.push(_,w,x),r.push(C,x,w)}this.setIndex(r),this.setAttribute("position",new Fe(s,3)),this.setAttribute("uv",new Fe(o,2)),this.setAttribute("normal",new Fe(l,3))}static fromJSON(e){return new Bj(e.points,e.segments,e.phiStart,e.phiLength)}},lA=class extends Ze{constructor(e=1,t=1,i=1,n=32,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};let l=this;n=Math.floor(n),r=Math.floor(r);let c=[],h=[],u=[],d=[],p=0,f=[],m=i/2,g=0;function y(_){let b=p,w=new z,C=new M,x=0,S=!0===_?e:t,E=!0===_?1:-1;for(let T=1;T<=n;T++)h.push(0,m*E,0),u.push(0,E,0),d.push(.5,.5),p++;let D=p;for(let T=0;T<=n;T++){let I=T/n*a+o,P=Math.cos(I),R=Math.sin(I);C.x=S*R,C.y=m*E,C.z=S*P,h.push(C.x,C.y,C.z),u.push(0,E,0),w.x=.5*P+.5,w.y=.5*R*E+.5,d.push(w.x,w.y),p++}for(let T=0;T<n;T++){let I=b+T,P=D+T;!0===_?c.push(P,P+1,I):c.push(P+1,P,I),x+=3}l.addGroup(g,x,!0===_?1:2),g+=x}(function v(){let _=new M,b=new M,w=0,C=(t-e)/i;for(let x=0;x<=r;x++){let S=[],E=x/r,D=E*(t-e)+e;for(let T=0;T<=n;T++){let I=T/n,P=I*a+o,R=Math.sin(P),L=Math.cos(P);b.x=D*R,b.y=-E*i+m,b.z=D*L,h.push(b.x,b.y,b.z),_.set(R,C,L).normalize(),u.push(_.x,_.y,_.z),d.push(I,1-E),S.push(p++)}f.push(S)}for(let x=0;x<n;x++)for(let S=0;S<r;S++){let D=f[S+1][x],T=f[S+1][x+1],I=f[S][x+1];c.push(f[S][x],D,I),c.push(D,T,I),w+=6}l.addGroup(g,w,0),g+=w})(),!1===s&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new Fe(h,3)),this.setAttribute("normal",new Fe(u,3)),this.setAttribute("uv",new Fe(d,2))}static fromJSON(e){return new lA(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Vj=class extends lA{constructor(e=1,t=1,i=32,n=1,r=!1,s=0,o=2*Math.PI){super(0,e,t,i,n,r,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(e){return new Vj(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},cA=class extends Ze{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};let r=[],s=[];function a(v,y,_,b){let w=b+1,C=[];for(let x=0;x<=w;x++){C[x]=[];let S=v.clone().lerp(_,x/w),E=y.clone().lerp(_,x/w),D=w-x;for(let T=0;T<=D;T++)C[x][T]=0===T&&x===w?S:S.clone().lerp(E,T/D)}for(let x=0;x<w;x++)for(let S=0;S<2*(w-x)-1;S++){let E=Math.floor(S/2);S%2==0?(u(C[x][E+1]),u(C[x+1][E]),u(C[x][E])):(u(C[x][E+1]),u(C[x+1][E+1]),u(C[x+1][E]))}}function u(v){r.push(v.x,v.y,v.z)}function d(v,y){let _=3*v;y.x=e[_+0],y.y=e[_+1],y.z=e[_+2]}function f(v,y,_,b){b<0&&1===v.x&&(s[y]=v.x-1),0===_.x&&0===_.z&&(s[y]=b/2/Math.PI+.5)}function m(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}(function o(v){let y=new M,_=new M,b=new M;for(let w=0;w<t.length;w+=3)d(t[w+0],y),d(t[w+1],_),d(t[w+2],b),a(y,_,b,v)})(n),function l(v){let y=new M;for(let _=0;_<r.length;_+=3)y.x=r[_+0],y.y=r[_+1],y.z=r[_+2],y.normalize().multiplyScalar(v),r[_+0]=y.x,r[_+1]=y.y,r[_+2]=y.z}(i),function c(){let v=new M;for(let y=0;y<r.length;y+=3){v.x=r[y+0],v.y=r[y+1],v.z=r[y+2];let _=m(v)/2/Math.PI+.5,b=g(v)/Math.PI+.5;s.push(_,1-b)}(function p(){let v=new M,y=new M,_=new M,b=new M,w=new z,C=new z,x=new z;for(let S=0,E=0;S<r.length;S+=9,E+=6){v.set(r[S+0],r[S+1],r[S+2]),y.set(r[S+3],r[S+4],r[S+5]),_.set(r[S+6],r[S+7],r[S+8]),w.set(s[E+0],s[E+1]),C.set(s[E+2],s[E+3]),x.set(s[E+4],s[E+5]),b.copy(v).add(y).add(_).divideScalar(3);let D=m(b);f(w,E+0,v,D),f(C,E+2,y,D),f(x,E+4,_,D)}})(),function h(){for(let v=0;v<s.length;v+=6){let y=s[v+0],_=s[v+2],b=s[v+4],w=Math.max(y,_,b),C=Math.min(y,_,b);w>.9&&C<.1&&(y<.2&&(s[v+0]+=1),_<.2&&(s[v+2]+=1),b<.2&&(s[v+4]+=1))}}()}(),this.setAttribute("position",new Fe(r,3)),this.setAttribute("normal",new Fe(r.slice(),3)),this.setAttribute("uv",new Fe(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new cA(e.vertices,e.indices,e.radius,e.details)}},zj=class extends cA{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zj(e.radius,e.detail)}},tb=class extends eb{constructor(e){super(e),this.uuid=ro(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let n=e.holes[t];this.holes.push((new eb).fromJSON(n))}return this}};function Uj(e,t,i,n,r){let s,o;if(r===function ove(e,t,i,n){let r=0;for(let s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,i,n)>0)for(s=t;s<i;s+=n)o=Gj(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=Gj(s,e[s],e[s+1],o);return o&&ib(o,o.next)&&(kg(o),o=o.next),o}function Zu(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!ib(i,i.next)&&0!==ji(i.prev,i,i.next))i=i.next;else{if(kg(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Lg(e,t,i,n,r,s,o){if(!e)return;!o&&s&&function eve(e,t,i,n){let r=e;do{0===r.z&&(r.z=uA(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function tve(e){let t,i,n,r,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}(e,n,r,s);let l,c,a=e;for(;e.prev!==e.next;)if(l=e.prev,c=e.next,s?qge(e,n,r,s):Wge(e))t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),kg(e),e=c.next,a=c.next;else if((e=c)===a){o?1===o?Lg(e=Yge(Zu(e),t,i),t,i,n,r,s,2):2===o&&Xge(e,t,i,n,r,s):Lg(Zu(e),t,i,n,r,s,1);break}}function Wge(e){let t=e.prev,i=e,n=e.next;if(ji(t,i,n)>=0)return!1;let r=t.x,s=i.x,o=n.x,a=t.y,l=i.y,c=n.y,h=r<s?r<o?r:o:s<o?s:o,u=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c,f=n.next;for(;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&fp(r,a,s,l,o,c,f.x,f.y)&&ji(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function qge(e,t,i,n){let r=e.prev,s=e,o=e.next;if(ji(r,s,o)>=0)return!1;let a=r.x,l=s.x,c=o.x,h=r.y,u=s.y,d=o.y,p=a<l?a<c?a:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=a>l?a>c?a:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,v=uA(p,f,t,i,n),y=uA(m,g,t,i,n),_=e.prevZ,b=e.nextZ;for(;_&&_.z>=v&&b&&b.z<=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&fp(a,h,l,u,c,d,_.x,_.y)&&ji(_.prev,_,_.next)>=0||(_=_.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&fp(a,h,l,u,c,d,b.x,b.y)&&ji(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;_&&_.z>=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&fp(a,h,l,u,c,d,_.x,_.y)&&ji(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&fp(a,h,l,u,c,d,b.x,b.y)&&ji(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Yge(e,t,i){let n=e;do{let r=n.prev,s=n.next.next;!ib(r,s)&&jj(r,n,n.next,s)&&Ng(r,s)&&Ng(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),kg(n),kg(n.next),n=e=s),n=n.next}while(n!==e);return Zu(n)}function Xge(e,t,i,n,r,s){let o=e;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&nve(o,a)){let l=Hj(o,a);return o=Zu(o,o.next),l=Zu(l,l.next),Lg(o,t,i,n,r,s,0),void Lg(l,t,i,n,r,s,0)}a=a.next}o=o.next}while(o!==e)}function Qge(e,t){return e.x-t.x}function Kge(e,t){let i=function $ge(e,t){let r,i=t,n=-1/0,s=e.x,o=e.y;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){let d=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>n&&(n=d,r=i.x<i.next.x?i:i.next,d===s))return r}i=i.next}while(i!==t);if(!r)return null;let u,a=r,l=r.x,c=r.y,h=1/0;i=r;do{s>=i.x&&i.x>=l&&s!==i.x&&fp(o<c?s:n,o,l,c,o<c?n:s,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(s-i.x),Ng(i,e)&&(u<h||u===h&&(i.x>r.x||i.x===r.x&&Jge(r,i)))&&(r=i,h=u)),i=i.next}while(i!==a);return r}(e,t);if(!i)return t;let n=Hj(i,e);return Zu(n,n.next),Zu(i,i.next)}function Jge(e,t){return ji(e.prev,e,t.prev)<0&&ji(t.next,e,e.next)<0}function uA(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ive(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function fp(e,t,i,n,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(i-o)*(t-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function nve(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function rve(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&jj(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Ng(e,t)&&Ng(t,e)&&function sve(e,t){let i=e,n=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(ji(e.prev,e,t.prev)||ji(e,t.prev,t))||ib(e,t)&&ji(e.prev,e,e.next)>0&&ji(t.prev,t,t.next)>0)}function ji(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ib(e,t){return e.x===t.x&&e.y===t.y}function jj(e,t,i,n){let r=rb(ji(e,t,i)),s=rb(ji(e,t,n)),o=rb(ji(i,n,e)),a=rb(ji(i,n,t));return!!(r!==s&&o!==a||0===r&&nb(e,i,t)||0===s&&nb(e,n,t)||0===o&&nb(i,e,n)||0===a&&nb(i,t,n))}function nb(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function rb(e){return e>0?1:e<0?-1:0}function Ng(e,t){return ji(e.prev,e,e.next)<0?ji(e,t,e.next)>=0&&ji(e,e.prev,t)>=0:ji(e,t,e.prev)<0||ji(e,e.next,t)<0}function Hj(e,t){let i=new hA(e.i,e.x,e.y),n=new hA(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Gj(e,t,i,n){let r=new hA(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function kg(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function hA(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Wj=class{static area(e){let t=e.length,i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return Wj.area(e)<0}static triangulateShape(e,t){let i=[],n=[],r=[];qj(e),Yj(i,e);let s=e.length;t.forEach(qj);for(let a=0;a<t.length;a++)n.push(s),s+=t[a].length,Yj(i,t[a]);let o=function(e,t,i=2){let a,l,c,h,u,d,p,n=t&&t.length,r=n?t[0]*i:e.length,s=Uj(e,0,r,i,!0),o=[];if(!s||s.next===s.prev)return o;if(n&&(s=function Zge(e,t,i,n){let s,o,a,l,c,r=[];for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:e.length,c=Uj(e,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(ive(c));for(r.sort(Qge),s=0;s<r.length;s++)i=Kge(r[s],i);return i}(e,t,s,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let f=i;f<r;f+=i)u=e[f],d=e[f+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?32767/p:0}return Lg(s,o,i,a,l,p,0),o}(i,n);for(let a=0;a<o.length;a+=3)r.push(o.slice(a,a+3));return r}};function qj(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Yj(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var Xj=class extends cA{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Xj(e.radius,e.detail)}},dA=class extends Ze{constructor(e=1,t=32,i=16,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let a=Math.min(s+o,Math.PI),l=0,c=[],h=new M,u=new M,d=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){let v=[],y=g/i,_=0;0==g&&0==s?_=.5/t:g==i&&a==Math.PI&&(_=-.5/t);for(let b=0;b<=t;b++){let w=b/t;h.x=-e*Math.cos(n+w*r)*Math.sin(s+y*o),h.y=e*Math.cos(s+y*o),h.z=e*Math.sin(n+w*r)*Math.sin(s+y*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(w+_,1-y),v.push(l++)}c.push(v)}for(let g=0;g<i;g++)for(let v=0;v<t;v++){let _=c[g][v],b=c[g+1][v],w=c[g+1][v+1];(0!==g||s>0)&&d.push(c[g][v+1],_,w),(g!==i-1||a<Math.PI)&&d.push(_,b,w)}this.setIndex(d),this.setAttribute("position",new Fe(p,3)),this.setAttribute("normal",new Fe(f,3)),this.setAttribute("uv",new Fe(m,2))}static fromJSON(e){return new dA(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Zj=class extends Ze{constructor(e=1,t=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);let o=[],a=[],l=[],c=[],h=new M,u=new M,d=new M,p=new M,f=new M,m=new M,g=new M;for(let y=0;y<=i;++y){let _=y/i*r*Math.PI*2;v(_,r,s,e,d),v(_+.01,r,s,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let b=0;b<=n;++b){let w=b/n*Math.PI*2,C=-t*Math.cos(w),x=t*Math.sin(w);h.x=d.x+(C*g.x+x*f.x),h.y=d.y+(C*g.y+x*f.y),h.z=d.z+(C*g.z+x*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(y/i),c.push(b/n)}}for(let y=1;y<=i;y++)for(let _=1;_<=n;_++){let w=(n+1)*y+(_-1),C=(n+1)*y+_,x=(n+1)*(y-1)+_;o.push((n+1)*(y-1)+(_-1),w,x),o.push(w,C,x)}function v(y,_,b,w,C){let x=Math.cos(y),S=Math.sin(y),E=b/_*y,D=Math.cos(E);C.x=w*(2+D)*.5*x,C.y=w*(2+D)*S*.5,C.z=w*Math.sin(E)*.5}this.setIndex(o),this.setAttribute("position",new Fe(a,3)),this.setAttribute("normal",new Fe(l,3)),this.setAttribute("uv",new Fe(c,2))}static fromJSON(e){return new Zj(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}};function Ec(e,t,i){return Qj(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function sb(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Qj(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ave(e){let i=e.length,n=new Array(i);for(let r=0;r!==i;++r)n[r]=r;return n.sort(function t(r,s){return e[r]-e[s]}),n}function Kj(e,t,i){let n=e.length,r=new e.constructor(n);for(let s=0,o=0;o!==n;++s){let a=i[s]*t;for(let l=0;l!==t;++l)r[o++]=e[a+l]}return r}function $j(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(t.push(s.time),i.push.apply(i,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(t.push(s.time),o.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(t.push(s.time),i.push(o)),s=e[r++]}while(void 0!==s)}var ob=class{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let o=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{let o=t[1];e<o&&(i=2,r=o);for(let a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===a)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){let o=i+s>>>1;e<t[o]?s=o:i=o+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let s=0;s!==n;++s)t[s]=i[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},lve=class extends ob{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Hd,endingEnd:Hd}}intervalChanged_(e,t,i){let n=this.parameterPositions,r=e-2,s=e+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case Gd:r=e,o=2*t-i;break;case 2402:r=n.length-2,o=t+n[r]-n[r+1];break;default:r=e,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case Gd:s=e,a=2*i-t;break;case 2402:s=1,a=i+n[1]-n[0];break;default:s=e-1,a=t}let l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==o;++b)r[b]=g*s[c+b]+v*s[l+b]+y*s[a+b]+_*s[h+b];return r}},Jj=class extends ob{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(i-t)/(n-t),h=1-c;for(let u=0;u!==o;++u)r[u]=s[l+u]*h+s[a+u]*c;return r}},cve=class extends ob{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}},Ca=class{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=sb(t,this.TimeBufferType),this.values=sb(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let i,t=e.constructor;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:sb(e.times,Array),values:sb(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new cve(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Jj(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new lve(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){let i=this.times,n=i.length,r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);let o=this.getValueSize();this.times=Ec(i,r,s),this.values=Ec(this.values,r*o,s*o)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let o=0;o!==r;o++){let a=i[o];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),e=!1;break}if(null!==s&&s>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,s),e=!1;break}s=a}if(void 0!==n&&Qj(n))for(let o=0,a=n.length;o!==a;++o){let l=n[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),e=!1;break}}return e}optimize(){let e=Ec(this.times),t=Ec(this.values),i=this.getValueSize(),n=2302===this.getInterpolation(),r=e.length-1,s=1;for(let o=1;o<r;++o){let a=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0]))if(n)a=!0;else{let h=o*i,u=h-i,d=h+i;for(let p=0;p!==i;++p){let f=t[h+p];if(f!==t[u+p]||f!==t[d+p]){a=!0;break}}}if(a){if(o!==s){e[s]=e[o];let h=o*i,u=s*i;for(let d=0;d!==i;++d)t[u+d]=t[h+d]}++s}}if(r>0){e[s]=e[r];for(let o=r*i,a=s*i,l=0;l!==i;++l)t[a+l]=t[o+l];++s}return s!==e.length?(this.times=Ec(e,0,s),this.values=Ec(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=Ec(this.times,0),t=Ec(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}};Ca.prototype.TimeBufferType=Float32Array,Ca.prototype.ValueBufferType=Float32Array,Ca.prototype.DefaultInterpolation=2301;var mp=class extends Ca{};mp.prototype.ValueTypeName="bool",mp.prototype.ValueBufferType=Array,mp.prototype.DefaultInterpolation=2300,mp.prototype.InterpolantFactoryMethodLinear=void 0,mp.prototype.InterpolantFactoryMethodSmooth=void 0;var e4=class extends Ca{};e4.prototype.ValueTypeName="color";var ab=class extends Ca{};ab.prototype.ValueTypeName="number";var uve=class extends ob{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-t)/(n-t),l=e*o;for(let c=l+o;l!==c;l+=4)ft.slerpFlat(r,0,s,l-o,s,l,a);return r}},Fg=class extends Ca{InterpolantFactoryMethodLinear(e){return new uve(this.times,this.values,this.getValueSize(),e)}};Fg.prototype.ValueTypeName="quaternion",Fg.prototype.DefaultInterpolation=2301,Fg.prototype.InterpolantFactoryMethodSmooth=void 0;var gp=class extends Ca{};gp.prototype.ValueTypeName="string",gp.prototype.ValueBufferType=Array,gp.prototype.DefaultInterpolation=2300,gp.prototype.InterpolantFactoryMethodLinear=void 0,gp.prototype.InterpolantFactoryMethodSmooth=void 0;var lb=class extends Ca{};lb.prototype.ValueTypeName="vector";var pA=class{constructor(e,t=-1,i,n=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=ro(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,n=1/(e.fps||1);for(let s=0,o=i.length;s!==o;++s)t.push(dve(i[s]).scale(n));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=i.length;r!==s;++r)t.push(Ca.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){let r=t.length,s=[];for(let o=0;o<r;o++){let a=[],l=[];a.push((o+r-1)%r,o,(o+1)%r),l.push(0,1,0);let c=ave(a);a=Kj(a,1,c),l=Kj(l,1,c),!n&&0===a[0]&&(a.push(r),l.push(l[0])),s.push(new ab(".morphTargetInfluences["+t[o].name+"]",a,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,a=e.length;o<a;o++){let l=e[o],c=l.name.match(r);if(c&&c.length>1){let h=c[1],u=n[h];u||(n[h]=u=[]),u.push(l)}}let s=[];for(let o in n)s.push(this.CreateFromMorphTargetSequence(o,n[o],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,h,u,d,p){if(0!==u.length){let f=[],m=[];$j(u,f,m,d),0!==f.length&&p.push(new c(h,f,m))}},n=[],r=e.name||"default",s=e.fps||30,o=e.blendMode,a=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let h=l[c].keys;if(h&&0!==h.length)if(h[0].morphTargets){let d,u={};for(d=0;d<h.length;d++)if(h[d].morphTargets)for(let p=0;p<h[d].morphTargets.length;p++)u[h[d].morphTargets[p]]=-1;for(let p in u){let f=[],m=[];for(let g=0;g!==h[d].morphTargets.length;++g){let v=h[d];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new ab(".morphTargetInfluence["+p+"]",f,m))}a=u.length*s}else{let u=".bones["+t[c].name+"]";i(lb,u+".position",h,"pos",n),i(Fg,u+".quaternion",h,"rot",n),i(lb,u+".scale",h,"scl",n)}}return 0===n.length?null:new this(r,a,n,o)}resetDuration(){let t=0;for(let i=0,n=this.tracks.length;i!==n;++i){let r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function dve(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function hve(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ab;case"vector":case"vector2":case"vector3":case"vector4":return lb;case"color":return e4;case"quaternion":return Fg;case"bool":case"boolean":return mp;case"string":return gp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let i=[],n=[];$j(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var t4={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},i4=class{constructor(e,t,i){let a,n=this,r=!1,s=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){o++,!1===r&&void 0!==n.onStart&&n.onStart(c,s,o),r=!0},this.itemEnd=function(c){s++,void 0!==n.onProgress&&n.onProgress(c,s,o),s===o&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(c){void 0!==n.onError&&n.onError(c)},this.resolveURL=function(c){return a?a(c):c},this.setURLModifier=function(c){return a=c,this},this.addHandler=function(c,h){return l.push(c,h),this},this.removeHandler=function(c){let h=l.indexOf(c);return-1!==h&&l.splice(h,2),this},this.getHandler=function(c){for(let h=0,u=l.length;h<u;h+=2){let d=l[h],p=l[h+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},pve=new i4,fA=class{constructor(e){this.manager=void 0!==e?e:pve,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Ml={},fve=class extends Error{constructor(e,t){super(e),this.response=t}},mA=class extends fA{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=t4.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==Ml[e])return void Ml[e].push({onLoad:t,onProgress:i,onError:n});Ml[e]=[],Ml[e].push({onLoad:t,onProgress:i,onError:n});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(l=>{if(200===l.status||0===l.status){if(0===l.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===l.body||void 0===l.body.getReader)return l;let c=Ml[e],h=l.body.getReader(),u=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=u?parseInt(u):0,p=0!==d,f=0,m=new ReadableStream({start(g){!function v(){h.read().then(({done:y,value:_})=>{if(y)g.close();else{f+=_.byteLength;let b=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:d});for(let w=0,C=c.length;w<C;w++){let x=c[w];x.onProgress&&x.onProgress(b)}g.enqueue(_),v()}})}()}});return new Response(m)}throw new fve(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(a){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>(new DOMParser).parseFromString(c,o));case"json":return l.json();default:if(void 0===o)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(o),h=c&&c[1]?c[1].toLowerCase():void 0,u=new TextDecoder(h);return l.arrayBuffer().then(d=>u.decode(d))}}}).then(l=>{t4.add(e,l);let c=Ml[e];delete Ml[e];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=Ml[e];if(void 0===c)throw this.manager.itemError(e),l;delete Ml[e];for(let h=0,u=c.length;h<u;h++){let d=c[h];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Bg=class extends pi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Je(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}},mve=class extends Bg{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Je(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},gA=new ye,n4=new M,r4=new M,vA=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new z(512,512),this.map=null,this.mapPass=null,this.matrix=new ye,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new qM,this._frameExtents=new z(1,1),this._viewportCount=1,this._viewports=[new St(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;n4.setFromMatrixPosition(e.matrixWorld),t.position.copy(n4),r4.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(r4),t.updateMatrixWorld(),gA.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gA),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(gA)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},gve=class extends vA{constructor(){super(new yr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=2*_g*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},vve=class extends Bg{constructor(e,t,i=0,n=Math.PI/3,r=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.target=new pi,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new gve}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},s4=new ye,Vg=new M,yA=new M,yve=class extends vA{constructor(){super(new yr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new z(4,2),this._viewportCount=6,this._viewports=[new St(2,1,1,1),new St(0,1,1,1),new St(3,1,1,1),new St(1,1,1,1),new St(3,0,1,1),new St(1,0,1,1)],this._cubeDirections=[new M(1,0,0),new M(-1,0,0),new M(0,0,1),new M(0,0,-1),new M(0,1,0),new M(0,-1,0)],this._cubeUps=[new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,0,1),new M(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Vg.setFromMatrixPosition(e.matrixWorld),i.position.copy(Vg),yA.copy(i.position),yA.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(yA),i.updateMatrixWorld(),n.makeTranslation(-Vg.x,-Vg.y,-Vg.z),s4.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s4)}},_ve=class extends Bg{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new yve}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},bve=class extends vA{constructor(){super(new YM(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},wve=class extends Bg{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.target=new pi,this.shadow=new bve}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},o4=class extends Ze{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},a4=class extends fA{constructor(e){super(e)}load(e,t,i,n){let r=this,s=new mA(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(a){n?n(a):console.error(a),r.manager.itemError(e)}},i,n)}parse(e){let t={},i={};function n(u,d){if(void 0!==t[d])return t[d];let p=u.interleavedBuffers[d],f=function r(u,d){if(void 0!==i[d])return i[d];let f=new Uint32Array(u.arrayBuffers[d]).buffer;return i[d]=f,f}(u,p.buffer),m=E_(p.type,f),g=new class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ro()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ro()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ro()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}(m,p.stride);return g.uuid=p.uuid,t[d]=g,g}let s=e.isInstancedBufferGeometry?new o4:new Ze,o=e.data.index;if(void 0!==o){let u=E_(o.type,o.array);s.setIndex(new st(u,1))}let a=e.data.attributes;for(let u in a){let p,d=a[u];if(d.isInterleavedBufferAttribute){let f=n(e.data,d.data);p=new eA(f,d.itemSize,d.offset,d.normalized)}else{let f=E_(d.type,d.array);p=new(d.isInstancedBufferAttribute?Tj:st)(f,d.itemSize,d.normalized)}void 0!==d.name&&(p.name=d.name),void 0!==d.usage&&p.setUsage(d.usage),void 0!==d.updateRange&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(u,p)}let l=e.data.morphAttributes;if(l)for(let u in l){let d=l[u],p=[];for(let f=0,m=d.length;f<m;f++){let v,g=d[f];if(g.isInterleavedBufferAttribute){let y=n(e.data,g.data);v=new eA(y,g.itemSize,g.offset,g.normalized)}else{let y=E_(g.type,g.array);v=new st(y,g.itemSize,g.normalized)}void 0!==g.name&&(v.name=g.name),p.push(v)}s.morphAttributes[u]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let u=0,d=c.length;u!==d;++u){let p=c[u];s.addGroup(p.start,p.count,p.materialIndex)}let h=e.data.boundingSphere;if(void 0!==h){let u=new M;void 0!==h.center&&u.fromArray(h.center),s.boundingSphere=new ds(u,h.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}};function l4(){return(typeof performance>"u"?Date:performance).now()}var Sve=class{constructor(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,n=this.valueSize,r=e*n+n,s=this.cumulativeWeight;if(0===s){for(let o=0;o!==n;++o)i[r+o]=i[o];s=t}else s+=t,this._mixBufferRegion(i,r,0,t/s,n);this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1&&this._mixBufferRegion(i,n,t*this._origIndex,1-r,t),s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(i[a]!==i[a+t]){o.setValue(i,n);break}}saveOriginalState(){let t=this.buffer,i=this.valueSize,n=i*this._origIndex;this.binding.getValue(t,n);for(let r=i,s=n;r!==s;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let s=0;s!==r;++s)e[t+s]=e[i+s]}_slerp(e,t,i,n){ft.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){let s=this._workIndex*r;ft.multiplyQuaternionsFlat(e,s,e,t,e,i),ft.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){let s=1-n;for(let o=0;o!==r;++o){let a=t+o;e[a]=e[a]*s+e[i+o]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){let o=t+s;e[o]=e[o]+e[i+s]*n}}},_A="\\[\\]\\.:\\/",Cve=new RegExp("["+_A+"]","g"),bA="[^"+_A+"]",Eve="[^"+_A.replace("\\.","")+"]",Mve=/((?:WC+[\/:])*)/.source.replace("WC",bA),Ave=/(WCOD+)?/.source.replace("WCOD",Eve),Dve=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bA),Tve=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bA),Ive=new RegExp("^"+Mve+Ave+Dve+Tve+"$"),Pve=["material","materials","bones","map"],wi=class{constructor(e,t,i){this.path=t,this.parsedPath=i||wi.parseTrackName(t),this.node=wi.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new wi.Composite(e,t,i):new wi(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Cve,"")}static parseTrackName(e){let t=Ive.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let r=i.nodeName.substring(n+1);-1!==Pve.indexOf(r)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){let i=function(r){for(let s=0;s<r.length;s++){let o=r[s];if(o.name===t||o.uuid===t)return o;let a=i(o.children);if(a)return a}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=wi.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==l){if(void 0===e[l])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[l]}}let s=e[n];if(void 0===s)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};wi.Composite=class{constructor(e,t,i){let n=i||wi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},wi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},wi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},wi.prototype.GetterByBindingType=[wi.prototype._getValue_direct,wi.prototype._getValue_array,wi.prototype._getValue_arrayElement,wi.prototype._getValue_toArray],wi.prototype.SetterByBindingTypeAndVersioning=[[wi.prototype._setValue_direct,wi.prototype._setValue_direct_setNeedsUpdate,wi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[wi.prototype._setValue_array,wi.prototype._setValue_array_setNeedsUpdate,wi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[wi.prototype._setValue_arrayElement,wi.prototype._setValue_arrayElement_setNeedsUpdate,wi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[wi.prototype._setValue_fromArray,wi.prototype._setValue_fromArray_setNeedsUpdate,wi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Lve=new Float32Array(1),Nve=class extends sr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,o=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(c={},l[a]=c);for(let h=0;h!==r;++h){let u=n[h],d=u.name,p=c[d];if(void 0!==p)++p.referenceCount,s[h]=p;else{if(p=s[h],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}p=new Sve(wi.create(i,d,t&&t._propertyBindings[h].binding.parsedPath),u.ValueTypeName,u.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,a,d),s[h]=p}o[h].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let i=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,i)}let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){let n=this._actions,r=this._actionsByClip,s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let o=s.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let r=t[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){let n=this._bindingsByRootAndName,r=this._bindings,s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,o=s[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[r],0===Object.keys(o).length&&delete s[n]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&(i=new Jj(new Float32Array(2),new Float32Array(2),1,Lve),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){let n=t||this._root,r=n.uuid,s="string"==typeof e?pA.findByName(n,e):e,o=null!==s?s.uuid:e,a=this._actionsByClip[o],l=null;if(void 0===i&&(i=null!==s?s.blendMode:2500),void 0!==a){let h=a.actionByRoot[r];if(void 0!==h&&h.blendMode===i)return h;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;let c=new class{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;let r=t.tracks,s=r.length,o=new Array(s),a={endingStart:Hd,endingEnd:Hd};for(let l=0;l!==s;++l){let c=r[l].createInterpolant(null);o[l]=c,c.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let n=this._clip.duration,r=e._clip.duration,o=n/r;e.warp(1,r/n,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let n=this._mixer,r=n.time,s=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);let a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);let r=this._startTime;if(null!==r){let a=(e-r)*i;a<0||0===i?t=0:(this._startTime=null,t=i*a)}t*=this._updateTimeScale(e);let s=this._updateTime(t),o=this._updateWeight(e);if(o>0){let a=this._interpolants,l=this._propertyBindings;if(2501===this.blendMode)for(let c=0,h=a.length;c!==h;++c)a[c].evaluate(s),l[c].accumulateAdditive(o);else for(let c=0,h=a.length;c!==h;++c)a[c].evaluate(s),l[c].accumulate(n,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(null!==i){let n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,n=this.time+e,r=this._loopCount,s=2202===i;if(0===e)return-1===r?n:s&&1==(1&r)?t-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){let o=Math.floor(n/t);n-=t*o,r+=Math.abs(o);let a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(s&&1==(1&r))return t-n}return n}_setEndings(e,t,i){let n=this._interpolantSettings;i?(n.endingStart=Gd,n.endingEnd=Gd):(n.endingStart=e?this.zeroSlopeAtStart?Gd:Hd:2402,n.endingEnd=t?this.zeroSlopeAtEnd?Gd:Hd:2402)}_scheduleFading(e,t,i){let n=this._mixer,r=n.time,s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);let o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=t,o[1]=r+e,a[1]=i,this}}(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(e,t){let i=t||this._root,n=i.uuid,r="string"==typeof e?pA.findByName(i,e):e,o=this._actionsByClip[r?r.uuid:e];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){let e=this._actions;for(let i=this._nActiveActions-1;i>=0;--i)e[i].stop();return this}update(e){let t=this._actions,i=this._nActiveActions,n=this.time+=e*=this.timeScale,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(n,e,r,s);let o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){let s=r.knownActions;for(let o=0,a=s.length;o!==a;++o){let l=s[o];this._deactivateAction(l);let c=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=c,t[c]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}let r=this._bindingsByRootAndName[t];if(void 0!==r)for(let s in r){let o=r[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){let i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},_e=class{constructor(e){this.value=e}clone(){return new _e(void 0===this.value.clone?this.value:this.value.clone())}},c4=class{constructor(e,t,i=0,n=1/0){this.ray=new Zd(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new NM,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return wA(e,this,i,t),i.sort(u4),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)wA(e[n],this,i,t);return i.sort(u4),i}};function u4(e,t){return e.distance-t.distance}function wA(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){let r=e.children;for(let s=0,o=r.length;s<o;s++)wA(r[s],t,i,!0)}}var h4=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(wn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},d4=new z,p4=class{constructor(e=new z(1/0,1/0),t=new z(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=d4.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return d4.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},f4=new M,cb=new M,oo=class{constructor(e=new M,t=new M){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){f4.subVectors(e,this.start),cb.subVectors(this.end,this.start);let i=cb.dot(cb),n=cb.dot(f4)/i;return t&&(n=wn(n,0,1)),n}closestPointToPoint(e,t,i){let n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},m4=new M,kve=class extends pi{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Ze,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,o=1,a=32;s<a;s++,o++){let l=s/a*Math.PI*2,c=o/a*Math.PI*2;n.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Fe(n,3));let r=new Sc({fog:!1,toneMapped:!1});this.cone=new Pg(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),m4.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(m4),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Fve=class extends jr{constructor(e,t,i){super(new dA(t,4,2),new Eg({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},g4=new M,ub=new M,v4=new M,Bve=class extends pi{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===t&&(t=1);let n=new Ze;n.setAttribute("position",new Fe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new Sc({fog:!1,toneMapped:!1});this.lightPlane=new Q_(n,r),this.add(this.lightPlane),n=new Ze,n.setAttribute("position",new Fe([0,0,0,0,0,1],3)),this.targetLine=new Q_(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),g4.setFromMatrixPosition(this.light.matrixWorld),ub.setFromMatrixPosition(this.light.target.matrixWorld),v4.subVectors(ub,g4),this.lightPlane.lookAt(ub),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ub),this.targetLine.scale.z=v4.length()}},hb=new M,Xi=new sp,db=class extends Pg{constructor(e){let t=new Ze,i=new Sc({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={};function o(p,f){a(p),a(f)}function a(p){n.push(0,0,0),r.push(0,0,0),void 0===s[p]&&(s[p]=[]),s[p].push(n.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),t.setAttribute("position",new Fe(n,3)),t.setAttribute("color",new Fe(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Je(16755200),c=new Je(16711680),h=new Je(43775),u=new Je(16777215),d=new Je(3355443);this.setColors(l,c,h,u,d)}setColors(e,t,i,n,r){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;Xi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),cn("c",t,e,Xi,0,0,-1),cn("t",t,e,Xi,0,0,1),cn("n1",t,e,Xi,-1,-1,-1),cn("n2",t,e,Xi,1,-1,-1),cn("n3",t,e,Xi,-1,1,-1),cn("n4",t,e,Xi,1,1,-1),cn("f1",t,e,Xi,-1,-1,1),cn("f2",t,e,Xi,1,-1,1),cn("f3",t,e,Xi,-1,1,1),cn("f4",t,e,Xi,1,1,1),cn("u1",t,e,Xi,.7,1.1,-1),cn("u2",t,e,Xi,-.7,1.1,-1),cn("u3",t,e,Xi,0,2,-1),cn("cf1",t,e,Xi,-1,0,1),cn("cf2",t,e,Xi,1,0,1),cn("cf3",t,e,Xi,0,-1,1),cn("cf4",t,e,Xi,0,1,1),cn("cn1",t,e,Xi,-1,0,-1),cn("cn2",t,e,Xi,1,0,-1),cn("cn3",t,e,Xi,0,-1,-1),cn("cn4",t,e,Xi,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function cn(e,t,i,n,r,s,o){hb.set(r,s,o).unproject(n);let a=t[e];if(void 0!==a){let l=i.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],hb.x,hb.y,hb.z)}}var pb=class extends Pg{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Ze;r.setIndex(new st(i,1)),r.setAttribute("position",new Fe([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Sc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Vve=class extends Pg{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Ze;n.setAttribute("position",new Fe(t,3)),n.setAttribute("color",new Fe([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new Sc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){let n=new Je,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Al=function zve(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(n[l]=0,n[256|l]=32768,r[l]=24,r[256|l]=24):c<-14?(n[l]=1024>>-c-14,n[256|l]=1024>>-c-14|32768,r[l]=-c-1,r[256|l]=-c-1):c<=15?(n[l]=c+15<<10,n[256|l]=c+15<<10|32768,r[l]=13,r[256|l]=13):c<128?(n[l]=31744,n[256|l]=64512,r[l]=24,r[256|l]=24):(n[l]=31744,n[256|l]=64512,r[l]=13,r[256|l]=13)}let s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(8388608&c);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,s[l]=c|h}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}(),Hve=Object.freeze({__proto__:null,fromHalfFloat:function jve(e){let t=e>>10;return Al.uint32View[0]=Al.mantissaTable[Al.offsetTable[t]+(1023&e)]+Al.exponentTable[t],Al.floatView[0]},toHalfFloat:function Uve(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=wn(e,-65504,65504),Al.floatView[0]=e;let t=Al.uint32View[0],i=t>>23&511;return Al.baseTable[i]+((8388607&t)>>Al.shiftTable[i])}});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:zd}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=zd);var xA=Symbol("target"),y4=Symbol("unsubscribe");function SA(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}var Ea=Array.isArray;function CA(e){return"symbol"==typeof e}var Wve={after:(e,t)=>Ea(e)?e.slice(t.length):""===t?e:e.slice(t.length+1),concat:(e,t)=>Ea(e)?(e=[...e],t&&e.push(t),e):t&&void 0!==t.toString?(""!==e&&(e+="."),CA(t)?e+t.toString():e+t):e,initial:e=>{if(Ea(e))return e.slice(0,-1);if(""===e)return e;let t=e.lastIndexOf(".");return-1===t?"":e.slice(0,t)},last:e=>{if(Ea(e))return e[e.length-1]||"";if(""===e)return e;let t=e.lastIndexOf(".");return-1===t?e:e.slice(t+1)},walk:(e,t)=>{if(Ea(e))for(let i of e)t(i);else if(""!==e){let i=0,n=e.indexOf(".");if(-1===n)t(e);else for(;i<e.length;)-1===n&&(n=e.length),t(e.slice(i,n)),i=n+1,n=e.indexOf(".",i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},ao=Wve;function _4(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&CA(i)||t.ignoreUnderscores&&"_"===i.charAt(0)||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}function EA(e){return"[object Object]"===toString.call(e)}function fb(){return!0}function vp(e,t){return e.length!==t.length||e.some((i,n)=>t[n]!==i)}var b4=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),Zve=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),w4={push:fb,pop:fb,shift:fb,unshift:fb,copyWithin:vp,reverse:vp,sort:vp,splice:vp,flat:vp,fill:vp},Qve=new Set([...b4,...Zve,...Object.keys(w4)]);function mb(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var x4=["keys","values","entries"],S4=new Set(["has","toString"]),C4={add:mb,clear:mb,delete:mb,forEach:mb},Kve=new Set([...S4,...Object.keys(C4),...x4]);function gb(e,t){if(e.size!==t.size)return!0;let i;for(let[n,r]of e)if(i=t.get(n),i!==r||void 0===i&&!t.has(n))return!0;return!1}var $ve=new Set([...S4,"get"]),E4={set:gb,clear:gb,delete:gb,forEach:gb},Jve=new Set([...$ve,...Object.keys(E4),...x4]),Mc=class{constructor(e,t,i,n){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=n,this._changes=n?[]:null,this.clone=void 0===t?e:this._shallowClone(e)}static isHandledMethod(e){return b4.has(e)}_shallowClone(e){let t=e;if(EA(e))t={...e};else if(Ea(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,n]of e.entries())t.set(i,this._shallowClone(n))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,n){return e?(Ea(n)?this._onIsChanged=w4[t]:n instanceof Set?this._onIsChanged=C4[t]:n instanceof Map&&(this._onIsChanged=E4[t]),n):i}update(e,t,i){let n=ao.after(e,this._path);if("length"!==t){let r=this.clone;ao.walk(n,s=>{r&&r[s]&&(this._clonedCache.has(r[s])||(r[s]=this._shallowClone(r[s])),r=r[s])}),this._hasOnValidate&&this._changes.push({path:n,property:t,previous:i}),r&&r[t]&&(r[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;-1!==i;i--)t=this._changes[i],ao.get(e,t.path)[t.property]=t.previous}isChanged(e){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,e)}},M4=class extends Mc{static isHandledMethod(e){return Qve.has(e)}},eye=class extends Mc{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},A4=class extends Mc{static isHandledMethod(e){return Kve.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},D4=class extends Mc{static isHandledMethod(e){return Jve.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},tye=class extends Mc{constructor(e,t,i,n){super(void 0,t,i,n),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},iye=class extends Mc{constructor(e,t,i,n){super(void 0,t,i,n),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},yp=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return EA(e)||Ea(e)||SA(e)}static isHandledMethod(e,t){return EA(e)?Mc.isHandledMethod(t):Ea(e)?M4.isHandledMethod(t):e instanceof Set?A4.isHandledMethod(t):e instanceof Map?D4.isHandledMethod(t):SA(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let n=Mc;Ea(e)?n=M4:e instanceof Date?n=eye:e instanceof Set?n=A4:e instanceof Map?n=D4:e instanceof WeakSet?n=tye:e instanceof WeakMap&&(n=iye),this._stack.push(new n(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:n}=e,r=yp.isHandledMethod(i,n);return this._stack[this._stack.length-1].preferredThisArg(r,n,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){void 0!==this._previousClone&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},nye={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},MA=(e,t,i={})=>{i={...nye,...i};let n=Symbol("ProxyTarget"),{equals:r,isShallow:s,ignoreDetached:o,details:a}=i,l=new class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),n=i[t];return void 0===n&&(n=Reflect.getOwnPropertyDescriptor(e,t),i[t]=n),n}getProxy(e,t,i,n){if(this.isUnsubscribed)return e;let r=e[n],s=r||e;this._pathCache.set(s,t);let o=this._proxyCache.get(s);return void 0===o&&(o=void 0===r?new Proxy(e,i):e,this._proxyCache.set(s,o)),o}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,ao.get(t,this.getPath(e)))}defineProperty(e,t,i){return!!Reflect.defineProperty(e,t,i)&&(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0)}setProperty(e,t,i,n,r){if(!this._equals(r,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return void 0!==s&&"set"in s?Reflect.set(e,t,i,n):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let n=this._getDescriptorCache().get(e);n&&(delete n[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let n=this._getOwnPropertyDescriptor(t,i);return void 0!==e&&void 0!==n&&Object.is(e.value,n.value)&&(e.writable||!1)===(n.writable||!1)&&(e.enumerable||!1)===(n.enumerable||!1)&&(e.configurable||!1)===(n.configurable||!1)&&e.get===n.get&&e.set===n.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return void 0!==i&&!0!==i.configurable&&!0!==i.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}}(r),c="function"==typeof i.onValidate,h=new yp(c),u=(y,_,b,w,C)=>!c||h.isCloning||!0===i.onValidate(ao.concat(l.getPath(y),_),b,w,C),d=(y,_,b,w)=>{!_4(l,i,_)&&(!o||!l.isDetached(y,e))&&p(l.getPath(y),_,b,w)},p=(y,_,b,w,C)=>{h.isCloning?h.update(y,_,w):t(ao.concat(y,_),b,w,C)},f=y=>y&&(y[n]||y),m=(y,_,b,w)=>function Gve(e){return("object"==typeof e?null===e:"function"!=typeof e)||e instanceof RegExp}(y)||"constructor"===b||s&&!yp.isHandledMethod(_,b)||_4(l,i,b)||l.isGetInvariant(_,b)||o&&l.isDetached(_,e)?y:(void 0===w&&(w=l.getPath(_)),l.getProxy(y,ao.concat(w,b),g,n)),g={get(y,_,b){if(CA(_)){if(_===n||_===xA)return y;if(_===y4&&!l.isUnsubscribed&&0===l.getPath(y).length)return l.unsubscribe(),y}let w=SA(y)?Reflect.get(y,_):Reflect.get(y,_,b);return m(w,y,_)},set(y,_,b,w){b=f(b);let C=y[n]||y,x=C[_];if(r(x,b)&&_ in y)return!0;let S=u(y,_,b,x);return S&&l.setProperty(C,_,b,w,x)?(d(y,_,y[_],x),!0):!S},defineProperty(y,_,b){if(!l.isSameDescriptor(b,y,_)){let w=y[_];u(y,_,b.value,w)&&l.defineProperty(y,_,b,w)&&d(y,_,b.value,w)}return!0},deleteProperty(y,_){if(!Reflect.has(y,_))return!0;let b=Reflect.get(y,_),w=u(y,_,void 0,b);return w&&l.deleteProperty(y,_,b)?(d(y,_,void 0,b),!0):!w},apply(y,_,b){let w=_[n]||_;if(l.isUnsubscribed)return Reflect.apply(y,w,b);if((!1===a||!0!==a&&!a.includes(y.name))&&yp.isHandledType(w)){let C=ao.initial(l.getPath(y)),x=yp.isHandledMethod(w,y.name);h.start(w,C,b);let S=Reflect.apply(y,h.preferredThisArg(y,_,w),x?b.map(T=>f(T)):b),E=h.isChanged(w,r),D=h.stop();if(yp.isHandledType(S)&&x&&(_ instanceof Map&&"get"===y.name&&(C=ao.concat(C,b[0])),S=l.getProxy(S,C,g)),E){let T={name:y.name,args:b,result:S},I=h.isCloning?ao.initial(C):C,P=h.isCloning?ao.last(C):"";u(ao.get(e,I),P,w,D,T)?p(I,P,w,D,T):h.undo(w)}return(_ instanceof Map||_ instanceof Set)&&function qve(e){return"object"==typeof e&&"function"==typeof e.next}(S)?function Yve(e,t,i,n,r){let s=e.next;if("entries"===t.name)e.next=function(){let o=s.call(this);return!1===o.done&&(o.value[0]=r(o.value[0],t,o.value[0],n),o.value[1]=r(o.value[1],t,o.value[0],n)),o};else if("values"===t.name){let o=i[xA].keys();e.next=function(){let a=s.call(this);return!1===a.done&&(a.value=r(a.value,t,o.next().value,n)),a}}else e.next=function(){let o=s.call(this);return!1===o.done&&(o.value=r(o.value,t,o.value,n)),o};return e}(S,y,_,C,m):S}return Reflect.apply(y,_,b)}},v=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};MA.target=e=>e&&e[xA]||e,MA.unsubscribe=e=>e[y4]||e;var e,T4=MA,I4="object"==typeof global&&global&&global.Object===Object&&global,sye="object"==typeof self&&self&&self.Object===Object&&self,Uo=I4||sye||Function("return this")(),lo=Uo.Symbol,P4=Object.prototype,lye=P4.hasOwnProperty,cye=P4.toString,Ug=lo?lo.toStringTag:void 0,pye=Object.prototype.toString,R4=lo?lo.toStringTag:void 0,Qu=function yye(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":R4&&R4 in Object(e)?function uye(e){var t=lye.call(e,Ug),i=e[Ug];try{e[Ug]=void 0;var n=!0}catch{}var r=cye.call(e);return n&&(t?e[Ug]=i:delete e[Ug]),r}(e):function fye(e){return pye.call(e)}(e)},Dl=function _ye(e){return null!=e&&"object"==typeof e},vb=function wye(e){return"symbol"==typeof e||Dl(e)&&"[object Symbol]"==Qu(e)},O4=function xye(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r},Ma=Array.isArray,L4=lo?lo.prototype:void 0,N4=L4?L4.toString:void 0,Eye=function k4(e){if("string"==typeof e)return e;if(Ma(e))return O4(e,k4)+"";if(vb(e))return N4?N4.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},Mye=/\s/,Tye=/^\s+/,Pye=function Iye(e){return e&&e.slice(0,function Aye(e){for(var t=e.length;t--&&Mye.test(e.charAt(t)););return t}(e)+1).replace(Tye,"")},jo=function Rye(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Oye=/^[-+]0x[0-9a-f]+$/i,Lye=/^0b[01]+$/i,Nye=/^0o[0-7]+$/i,kye=parseInt,B4=function Fye(e){if("number"==typeof e)return e;if(vb(e))return NaN;if(jo(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=jo(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Pye(e);var i=Lye.test(e);return i||Nye.test(e)?kye(e.slice(2),i?2:8):Oye.test(e)?NaN:+e},V4=function Gye(e){if(!jo(e))return!1;var t=Qu(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Wye=Uo["__core-js_shared__"],z4=(e=/[^.]+$/.exec(Wye&&Wye.keys&&Wye.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"",Zye=Function.prototype.toString,Ku=function Qye(e){if(null!=e){try{return Zye.call(e)}catch{}try{return e+""}catch{}}return""},$ye=/^\[object .+?Constructor\]$/,n0e=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),s0e=function r0e(e){return!(!jo(e)||function qye(e){return!!z4&&z4 in e}(e))&&(V4(e)?n0e:$ye).test(Ku(e))},$u=function l0e(e,t){var i=function o0e(e,t){return e?.[t]}(e,t);return s0e(i)?i:void 0},DA=$u(Uo,"WeakMap"),U4=Object.create,u0e=function(){function e(){}return function(t){if(!jo(t))return{};if(U4)return U4(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),h0e=u0e,y0e=Date.now,x0e=function w0e(e){return function(){return e}},S0e=function(){try{var e=$u(Object,"defineProperty");return e({},"",{}),e}catch{}}(),yb=S0e,C0e=yb?function(e,t){return yb(e,"toString",{configurable:!0,enumerable:!1,value:x0e(t),writable:!0})}:function Bye(e){return e},A0e=function _0e(e){var t=0,i=0;return function(){var n=y0e(),r=16-(n-i);if(i=n,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(C0e),P0e=/^(?:0|[1-9]\d*)$/,TA=function R0e(e,t){var i=typeof e;return!!(t=t??9007199254740991)&&("number"==i||"symbol"!=i&&P0e.test(e))&&e>-1&&e%1==0&&e<t},j4=function O0e(e,t,i){"__proto__"==t&&yb?yb(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i},IA=function L0e(e,t){return e===t||e!=e&&t!=t},k0e=Object.prototype.hasOwnProperty,PA=function F0e(e,t,i){var n=e[t];(!k0e.call(e,t)||!IA(n,i)||void 0===i&&!(t in e))&&j4(e,t,i)},jg=function B0e(e,t,i,n){var r=!i;i||(i={});for(var s=-1,o=t.length;++s<o;){var a=t[s],l=n?n(i[a],e[a],a,i,e):void 0;void 0===l&&(l=e[a]),r?j4(i,a,l):PA(i,a,l)}return i},H4=Math.max,RA=function j0e(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},G4=function H0e(e){return null!=e&&RA(e.length)&&!V4(e)},G0e=Object.prototype,OA=function W0e(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||G0e)},W4=function Z0e(e){return Dl(e)&&"[object Arguments]"==Qu(e)},q4=Object.prototype,Q0e=q4.hasOwnProperty,K0e=q4.propertyIsEnumerable,$0e=W4(function(){return arguments}())?W4:function(e){return Dl(e)&&Q0e.call(e,"callee")&&!K0e.call(e,"callee")},LA=$0e,Y4="object"==typeof exports&&exports&&!exports.nodeType&&exports,X4=Y4&&"object"==typeof module&&module&&!module.nodeType&&module,Z4=X4&&X4.exports===Y4?Uo.Buffer:void 0,_b=(Z4?Z4.isBuffer:void 0)||function J0e(){return!1},Fi={};Fi["[object Float32Array]"]=Fi["[object Float64Array]"]=Fi["[object Int8Array]"]=Fi["[object Int16Array]"]=Fi["[object Int32Array]"]=Fi["[object Uint8Array]"]=Fi["[object Uint8ClampedArray]"]=Fi["[object Uint16Array]"]=Fi["[object Uint32Array]"]=!0,Fi["[object Arguments]"]=Fi["[object Array]"]=Fi["[object ArrayBuffer]"]=Fi["[object Boolean]"]=Fi["[object DataView]"]=Fi["[object Date]"]=Fi["[object Error]"]=Fi["[object Function]"]=Fi["[object Map]"]=Fi["[object Number]"]=Fi["[object Object]"]=Fi["[object RegExp]"]=Fi["[object Set]"]=Fi["[object String]"]=Fi["[object WeakMap]"]=!1;var NA=function I_e(e){return function(t){return e(t)}},Q4="object"==typeof exports&&exports&&!exports.nodeType&&exports,Hg=Q4&&"object"==typeof module&&module&&!module.nodeType&&module,kA=Hg&&Hg.exports===Q4&&I4.process,_p=function(){try{return Hg&&Hg.require&&Hg.require("util").types||kA&&kA.binding&&kA.binding("util")}catch{}}(),K4=_p&&_p.isTypedArray,$4=K4?NA(K4):function D_e(e){return Dl(e)&&RA(e.length)&&!!Fi[Qu(e)]},N_e=Object.prototype.hasOwnProperty,J4=function k_e(e,t){var i=Ma(e),n=!i&&LA(e),r=!i&&!n&&_b(e),s=!i&&!n&&!r&&$4(e),o=i||n||r||s,a=o?function q0e(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],l=a.length;for(var c in e)(t||N_e.call(e,c))&&(!o||!("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||TA(c,l)))&&a.push(c);return a},eH=function F_e(e,t){return function(i){return e(t(i))}},V_e=eH(Object.keys,Object),U_e=Object.prototype.hasOwnProperty,FA=function G_e(e){return G4(e)?J4(e):function j_e(e){if(!OA(e))return V_e(e);var t=[];for(var i in Object(e))U_e.call(e,i)&&"constructor"!=i&&t.push(i);return t}(e)},X_e=Object.prototype.hasOwnProperty,Q_e=function Z_e(e){if(!jo(e))return function W_e(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=OA(e),i=[];for(var n in e)"constructor"==n&&(t||!X_e.call(e,n))||i.push(n);return i},BA=function K_e(e){return G4(e)?J4(e,!0):Q_e(e)},$_e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J_e=/^\w*$/,Gg=$u(Object,"create"),cbe=Object.prototype.hasOwnProperty,pbe=Object.prototype.hasOwnProperty;function bp(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}bp.prototype.clear=function nbe(){this.__data__=Gg?Gg(null):{},this.size=0},bp.prototype.delete=function sbe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},bp.prototype.get=function ube(e){var t=this.__data__;if(Gg){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return cbe.call(t,e)?t[e]:void 0},bp.prototype.has=function fbe(e){var t=this.__data__;return Gg?void 0!==t[e]:pbe.call(t,e)},bp.prototype.set=function vbe(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Gg&&void 0===t?"__lodash_hash_undefined__":t,this};var tH=bp,bb=function wbe(e,t){for(var i=e.length;i--;)if(IA(e[i][0],t))return i;return-1},Sbe=Array.prototype.splice;function wp(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}wp.prototype.clear=function _be(){this.__data__=[],this.size=0},wp.prototype.delete=function Cbe(e){var t=this.__data__,i=bb(t,e);return!(i<0||(i==t.length-1?t.pop():Sbe.call(t,i,1),--this.size,0))},wp.prototype.get=function Mbe(e){var t=this.__data__,i=bb(t,e);return i<0?void 0:t[i][1]},wp.prototype.has=function Dbe(e){return bb(this.__data__,e)>-1},wp.prototype.set=function Ibe(e,t){var i=this.__data__,n=bb(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};var wb=wp,Wg=$u(Uo,"Map"),xb=function Fbe(e,t){var i=e.__data__;return function Nbe(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?i["string"==typeof t?"string":"hash"]:i.map};function xp(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}xp.prototype.clear=function Obe(){this.size=0,this.__data__={hash:new tH,map:new(Wg||wb),string:new tH}},xp.prototype.delete=function Bbe(e){var t=xb(this,e).delete(e);return this.size-=t?1:0,t},xp.prototype.get=function zbe(e){return xb(this,e).get(e)},xp.prototype.has=function jbe(e){return xb(this,e).has(e)},xp.prototype.set=function Gbe(e,t){var i=xb(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};var Sb=xp;function VA(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var o=e.apply(this,n);return i.cache=s.set(r,o)||s,o};return i.cache=new(VA.Cache||Sb),i}VA.Cache=Sb;var Ybe=VA,Kbe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$be=/\\(\\)?/g,Jbe=function Zbe(e){var t=Ybe(e,function(n){return 500===i.size&&i.clear(),n}),i=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Kbe,function(i,n,r,s){t.push(r?s.replace($be,"$1"):n||i)}),t}),ewe=Jbe,iwe=function twe(e){return null==e?"":Eye(e)},Sp=function nwe(e,t){return Ma(e)?e:function ebe(e,t){if(Ma(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!vb(e))||J_e.test(e)||!$_e.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:ewe(iwe(e))},Cb=function swe(e){if("string"==typeof e||vb(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},iH=function owe(e,t){for(var i=0,n=(t=Sp(t,e)).length;null!=e&&i<n;)e=e[Cb(t[i++])];return i&&i==n?e:void 0},zA=function awe(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e},nH=lo?lo.isConcatSpreadable:void 0,cwe=function lwe(e){return Ma(e)||LA(e)||!!(nH&&e&&e[nH])},uwe=function rH(e,t,i,n,r){var s=-1,o=e.length;for(i||(i=cwe),r||(r=[]);++s<o;){var a=e[s];t>0&&i(a)?t>1?rH(a,t-1,i,n,r):zA(r,a):n||(r[r.length]=a)}return r},dwe=function hwe(e){return null!=e&&e.length?uwe(e,1):[]},sH=function pwe(e){return A0e(function V0e(e,t,i){return t=H4(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,s=H4(n.length-t,0),o=Array(s);++r<s;)o[r]=n[t+r];r=-1;for(var a=Array(t+1);++r<t;)a[r]=n[r];return a[t]=i(o),function d0e(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}(e,this,a)}}(e,void 0,dwe),e+"")},UA=eH(Object.getPrototypeOf,Object),oH=Function.prototype.toString,ywe=Object.prototype.hasOwnProperty,_we=oH.call(Object);function Cp(e){var t=this.__data__=new wb(e);this.size=t.size}Cp.prototype.clear=function Cwe(){this.__data__=new wb,this.size=0},Cp.prototype.delete=function Mwe(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Cp.prototype.get=function Dwe(e){return this.__data__.get(e)},Cp.prototype.has=function Iwe(e){return this.__data__.has(e)},Cp.prototype.set=function Owe(e,t){var i=this.__data__;if(i instanceof wb){var n=i.__data__;if(!Wg||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Sb(n)}return i.set(e,t),this.size=i.size,this};var Eb=Cp,aH="object"==typeof exports&&exports&&!exports.nodeType&&exports,lH=aH&&"object"==typeof module&&module&&!module.nodeType&&module,cH=lH&&lH.exports===aH?Uo.Buffer:void 0,uH=cH?cH.allocUnsafe:void 0,hH=function Gwe(){return[]},qwe=Object.prototype.propertyIsEnumerable,dH=Object.getOwnPropertySymbols,Ywe=dH?function(e){return null==e?[]:(e=Object(e),function jwe(e,t){for(var i=-1,n=null==e?0:e.length,r=0,s=[];++i<n;){var o=e[i];t(o,i,e)&&(s[r++]=o)}return s}(dH(e),function(t){return qwe.call(e,t)}))}:hH,jA=Ywe,Kwe=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)zA(t,jA(e)),e=UA(e);return t}:hH,pH=Kwe,fH=function exe(e,t,i){var n=t(e);return Ma(e)?n:zA(n,i(e))},HA=function txe(e){return fH(e,FA,jA)},mH=function ixe(e){return fH(e,BA,pH)},GA=$u(Uo,"DataView"),WA=$u(Uo,"Promise"),qA=$u(Uo,"Set"),gH="[object Map]",vH="[object Promise]",yH="[object Set]",_H="[object WeakMap]",bH="[object DataView]",axe=Ku(GA),lxe=Ku(Wg),cxe=Ku(WA),uxe=Ku(qA),hxe=Ku(DA),Ju=Qu;(GA&&Ju(new GA(new ArrayBuffer(1)))!=bH||Wg&&Ju(new Wg)!=gH||WA&&Ju(WA.resolve())!=vH||qA&&Ju(new qA)!=yH||DA&&Ju(new DA)!=_H)&&(Ju=function(e){var t=Qu(e),i="[object Object]"==t?e.constructor:void 0,n=i?Ku(i):"";if(n)switch(n){case axe:return bH;case lxe:return gH;case cxe:return vH;case uxe:return yH;case hxe:return _H}return t});var qg=Ju,pxe=Object.prototype.hasOwnProperty,Mb=Uo.Uint8Array,YA=function vxe(e){var t=new e.constructor(e.byteLength);return new Mb(t).set(new Mb(e)),t},bxe=/\w*$/,wH=lo?lo.prototype:void 0,xH=wH?wH.valueOf:void 0,Yxe=function qxe(e,t,i){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return YA(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return function yxe(e,t){var i=t?YA(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function Exe(e,t){var i=t?YA(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}(e,i);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return function wxe(e){var t=new e.constructor(e.source,bxe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Symbol]":return function Sxe(e){return xH?Object(xH.call(e)):{}}(e)}},SH=_p&&_p.isMap,e1e=SH?NA(SH):function Kxe(e){return Dl(e)&&"[object Map]"==qg(e)},CH=_p&&_p.isSet,s1e=CH?NA(CH):function i1e(e){return Dl(e)&&"[object Set]"==qg(e)},EH="[object Arguments]",MH="[object Function]",AH="[object Object]",Li={};Li[EH]=Li["[object Array]"]=Li["[object ArrayBuffer]"]=Li["[object DataView]"]=Li["[object Boolean]"]=Li["[object Date]"]=Li["[object Float32Array]"]=Li["[object Float64Array]"]=Li["[object Int8Array]"]=Li["[object Int16Array]"]=Li["[object Int32Array]"]=Li["[object Map]"]=Li["[object Number]"]=Li[AH]=Li["[object RegExp]"]=Li["[object Set]"]=Li["[object String]"]=Li["[object Symbol]"]=Li["[object Uint8Array]"]=Li["[object Uint8ClampedArray]"]=Li["[object Uint16Array]"]=Li["[object Uint32Array]"]=!0,Li["[object Error]"]=Li[MH]=Li["[object WeakMap]"]=!1;var DH=function Ab(e,t,i,n,r,s){var o,a=1&t,l=2&t,c=4&t;if(i&&(o=r?i(e,n,r,s):i(e)),void 0!==o)return o;if(!jo(e))return e;var h=Ma(e);if(h){if(o=function fxe(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&pxe.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(e),!a)return function f0e(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}(e,o)}else{var u=qg(e),d=u==MH||"[object GeneratorFunction]"==u;if(_b(e))return function zwe(e,t){if(t)return e.slice();var i=e.length,n=uH?uH(i):new e.constructor(i);return e.copy(n),n}(e,a);if(u==AH||u==EH||d&&!r){if(o=l||d?{}:function Xxe(e){return"function"!=typeof e.constructor||OA(e)?{}:h0e(UA(e))}(e),!a)return l?function $we(e,t){return jg(e,pH(e),t)}(e,function Fwe(e,t){return e&&jg(t,BA(t),e)}(o,e)):function Xwe(e,t){return jg(e,jA(e),t)}(e,function Nwe(e,t){return e&&jg(t,FA(t),e)}(o,e))}else{if(!Li[u])return r?e:{};o=Yxe(e,u,a)}}s||(s=new Eb);var p=s.get(e);if(p)return p;s.set(e,o),s1e(e)?e.forEach(function(g){o.add(Ab(g,t,i,g,e,s))}):e1e(e)&&e.forEach(function(g,v){o.set(v,Ab(g,t,i,v,e,s))});var m=h?void 0:(c?l?mH:HA:l?BA:FA)(e);return function D0e(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););}(m||e,function(g,v){m&&(g=e[v=g]),PA(o,v,Ab(g,t,i,v,e,s))}),o},Db=function L1e(e){return DH(e,5)};function Tb(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Sb;++t<i;)this.add(e[t])}Tb.prototype.add=Tb.prototype.push=function k1e(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Tb.prototype.has=function B1e(e){return this.__data__.has(e)};var z1e=Tb,j1e=function U1e(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1},G1e=function H1e(e,t){return e.has(t)},TH=function Y1e(e,t,i,n,r,s){var o=1&i,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=s.get(e),h=s.get(t);if(c&&h)return c==t&&h==e;var u=-1,d=!0,p=2&i?new z1e:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var f=e[u],m=t[u];if(n)var g=o?n(m,f,u,t,e,s):n(f,m,u,e,t,s);if(void 0!==g){if(g)continue;d=!1;break}if(p){if(!j1e(t,function(v,y){if(!G1e(p,y)&&(f===v||r(f,v,i,n,s)))return p.push(y)})){d=!1;break}}else if(f!==m&&!r(f,m,i,n,s)){d=!1;break}}return s.delete(e),s.delete(t),d},Z1e=function X1e(e){var t=-1,i=Array(e.size);return e.forEach(function(n,r){i[++t]=[r,n]}),i},K1e=function Q1e(e){var t=-1,i=Array(e.size);return e.forEach(function(n){i[++t]=n}),i},IH=lo?lo.prototype:void 0,XA=IH?IH.valueOf:void 0,mSe=Object.prototype.hasOwnProperty,PH="[object Arguments]",RH="[object Array]",Ib="[object Object]",OH=Object.prototype.hasOwnProperty,wSe=function bSe(e,t,i,n,r,s){var o=Ma(e),a=Ma(t),l=o?RH:qg(e),c=a?RH:qg(t),h=(l=l==PH?Ib:l)==Ib,u=(c=c==PH?Ib:c)==Ib,d=l==c;if(d&&_b(e)){if(!_b(t))return!1;o=!0,h=!1}if(d&&!h)return s||(s=new Eb),o||$4(e)?TH(e,t,i,n,r,s):function hSe(e,t,i,n,r,s,o){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new Mb(e),new Mb(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return IA(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Z1e;case"[object Set]":if(a||(a=K1e),e.size!=t.size&&!(1&n))return!1;var c=o.get(e);if(c)return c==t;n|=2,o.set(e,t);var h=TH(a(e),a(t),n,r,s,o);return o.delete(e),h;case"[object Symbol]":if(XA)return XA.call(e)==XA.call(t)}return!1}(e,t,l,i,n,r,s);if(!(1&i)){var p=h&&OH.call(e,"__wrapped__"),f=u&&OH.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return s||(s=new Eb),r(m,g,i,n,s)}}return!!d&&(s||(s=new Eb),function gSe(e,t,i,n,r,s){var o=1&i,a=HA(e),l=a.length;if(l!=HA(t).length&&!o)return!1;for(var u=l;u--;){var d=a[u];if(!(o?d in t:mSe.call(t,d)))return!1}var p=s.get(e),f=s.get(t);if(p&&f)return p==t&&f==e;var m=!0;s.set(e,t),s.set(t,e);for(var g=o;++u<l;){var v=e[d=a[u]],y=t[d];if(n)var _=o?n(y,v,d,t,e,s):n(v,y,d,e,t,s);if(!(void 0===_?v===y||r(v,y,i,n,s):_)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var b=e.constructor,w=t.constructor;b!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w)&&(m=!1)}return s.delete(e),s.delete(t),m}(e,t,i,n,r,s))},xSe=function LH(e,t,i,n,r){return e===t||(null==e||null==t||!Dl(e)&&!Dl(t)?e!=e&&t!=t:wSe(e,t,i,n,LH,r))},CSe=function SSe(e,t){return null!=e&&t in Object(e)},DSe=function ASe(e,t){return null!=e&&function ESe(e,t,i){for(var n=-1,r=(t=Sp(t,e)).length,s=!1;++n<r;){var o=Cb(t[n]);if(!(s=null!=e&&i(e,o)))break;e=e[o]}return s||++n!=r?s:!!(r=null==e?0:e.length)&&RA(r)&&TA(o,r)&&(Ma(e)||LA(e))}(e,t,CSe)},ZA=function(){return Uo.Date.now()},PSe=Math.max,RSe=Math.min,QA=function OSe(e,t,i){var n,r,s,o,a,l,c=0,h=!1,u=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(C){var x=n,S=r;return n=r=void 0,c=C,o=e.apply(S,x)}function g(C){var x=C-l;return void 0===l||x>=t||x<0||u&&C-c>=s}function v(){var C=ZA();if(g(C))return y(C);a=setTimeout(v,function m(C){var E=t-(C-l);return u?RSe(E,s-(C-c)):E}(C))}function y(C){return a=void 0,d&&n?p(C):(n=r=void 0,o)}function w(){var C=ZA(),x=g(C);if(n=arguments,r=this,l=C,x){if(void 0===a)return function f(C){return c=C,a=setTimeout(v,t),h?p(C):o}(l);if(u)return clearTimeout(a),a=setTimeout(v,t),p(l)}return void 0===a&&(a=setTimeout(v,t)),o}return t=B4(t)||0,jo(i)&&(h=!!i.leading,s=(u="maxWait"in i)?PSe(B4(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d),w.cancel=function _(){void 0!==a&&clearTimeout(a),c=0,n=l=r=a=void 0},w.flush=function b(){return void 0===a?o:y(ZA())},w},FSe=function kSe(e,t){return t.length<2?e:iH(e,function xwe(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(r);++n<r;)s[n]=e[n+t];return s}(t,0,-1))},NH=function BSe(e,t){return xSe(e,t)},zSe=function VSe(e,t){return t=Sp(t,e),null==(e=FSe(e,t))||delete e[Cb(function LSe(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}(t))]},jSe=function USe(e){return function bwe(e){if(!Dl(e)||"[object Object]"!=Qu(e))return!1;var t=UA(e);if(null===t)return!0;var i=ywe.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&oH.call(i)==_we}(e)?void 0:e},qSe=sH(function(e,t){var i={};if(null==e)return i;var n=!1;t=O4(t,function(s){return s=Sp(s,e),n||(n=s.length>1),s}),jg(e,mH(e),i),n&&(i=DH(i,7,jSe));for(var r=t.length;r--;)zSe(i,t[r]);return i}),KA=qSe,XSe=function YSe(e,t,i,n){if(!jo(e))return e;for(var r=-1,s=(t=Sp(t,e)).length,o=s-1,a=e;null!=a&&++r<s;){var l=Cb(t[r]),c=i;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=o){var h=a[l];void 0===(c=n?n(h,l,a):void 0)&&(c=jo(h)?h:TA(t[r+1])?[]:{})}PA(a,l,c),a=a[l]}return e},$Se=function KSe(e,t){return function ZSe(e,t,i){for(var n=-1,r=t.length,s={};++n<r;){var o=t[n],a=iH(e,o);i(a,o)&&XSe(s,Sp(o,e),a)}return s}(e,t,function(i,n){return DSe(e,n)})},JSe=sH(function(e,t){return null==e?{}:$Se(e,t)}),Tl=JSe;function Il(e,t){return Object.setPrototypeOf(e,t),e}!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/")&&(()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");e?window.localStorage.setItem("desktop-app-version",e):window.localStorage.getItem("desktop-app-version")})();var Pb=!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC"),kH=!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||Pb&&"ontouchend"in document),pCe=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Bs=!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),FH=(()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)})(),BH=Number((()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]})());function VH(e){return Array.isArray(e)?e:[e]}function Rb(e){return Pb?e.metaKey:e.ctrlKey}var ot=[],Ob={},Yg={},Lb={};function zH(e){ot.includes(e)||ot.push(e)}function Ep(e){delete Ob[e.pointerId];for(let t=0;t<ot.length;t++)if(ot[t].pointerId===e.pointerId){ot.splice(t,1);break}}function Nb(e){if("touch"!==e.pointerType)return;let t=Ob[e.pointerId];void 0===t&&(t={x:0,y:0},Ob[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function $A(e){return Ob[(e.pointerId===ot[0].pointerId?ot[1]:ot[0]).pointerId]}function UH(e){Yg[e.key]=!0,Lb[e.key]=void 0===Lb[e.key]?1:Lb[e.key]+1}function jH(e){if(Pb&&Yg.Meta)for(let t in Yg)Yg[t]=!1;else Yg[e.key]=!1;Lb={}}var HH,kb,yCe=new Promise(e=>{HH=e});function _Ce(){if(kb)return kb;function t(){return(t=(0,sn.Z)(function*(){let n=In.e(575).then(In.bind(In,575)),[r,s]=yield Promise.all([n,fetch("https://unpkg.com/@splinetool/navmesh-wasm@0.9.507/build/navmesh.wasm").then(l=>l.arrayBuffer())]),o=r.default,a=yield o({wasmBinary:s});HH(a)})).apply(this,arguments)}return kb=function e(){return t.apply(this,arguments)}(),kb}var GH,Fb,bCe=new Promise(e=>{GH=e});function wCe(){if(Fb)return Fb;function t(){return(t=(0,sn.Z)(function*(){let i=yield In.e(193).then(In.bind(In,193));yield i.init(),GH(i)})).apply(this,arguments)}return Fb=function e(){return t.apply(this,arguments)}(),Fb}var Pt=class{modifyById(e,t){let i=this;if(void 0===i[e])throw new Error("not expected");{let n={...i,[e]:t};return Object.setPrototypeOf(n,Pt.prototype),n}}add(e,t){return this.runOp({type:1,id:e,data:t})?.data??this}runOp(e){let t=this;if(1===e.type){let n,i=t[e.id];n=void 0===i?{type:2,id:e.id}:{type:1,id:e.id,data:i};let{id:r,data:s}=e,o={...t,[r]:s};return Object.setPrototypeOf(o,Pt.prototype),{data:o,actual:e,reverse:n}}if(2===e.type){let{id:i}=e,n=t[i];if(void 0===n)return null;{let r={...t};return Object.setPrototypeOf(r,Pt.prototype),delete r[i],{data:r,actual:e,reverse:{type:1,id:i,data:n}}}}return null}};function JA(e){if(void 0!==e.deepFreeze)return void e.deepFreeze(e);let t=Object.getOwnPropertyNames(e);for(let i of t){let n=e[i];n&&"object"==typeof n&&JA(n)}return Object.freeze(e)}var WH=class extends Error{};function eD(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function Ac(e,t,i){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){let s=e;e=t,t=s}let n=[],r=1/(i+1);for(let s=0;s<i;s++){let o=e+(t-e)*(s+.75+.5*Math.random())*r;n.push(o)}return n}function tD(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function qH(e,t){for(let i of e)!0!==t(i.id,i.data)&&qH(i.children,t)}function YH(e,t){if(!0!==t(e.id,e.data))for(let i of e.children)YH(i,t)}var Bb,ps=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,ps.prototype)}deepFreeze(){let e=0;for(;e<this.length;)JA(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(!t)return e;e=t}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){return this.get(e)?.data}has(e){return void 0!==this.childrenOf(e)}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){return null===e?this:this.get(e)?.children}traverseFrom(e,t){if(null===e)this.traverse(t);else{let i=this.get(e);i&&YH(i,t)}}traverse(e){qH(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return null===e?this:this.get(e).children}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this.parent(e),n=this.childrenArray(i),r=n.findIndex(o=>o.id===e);if(r<0)throw new Error("not expected");let s=n[r];return n=[...n],n[r]={...s,data:t},this.modifyArrayBy(i,n)}}modifyArrayBy(e,t){let i=e,n=t;for(;null!==i;){let s=n,o=i;if(i=this.parent(i),void 0===i)throw new Error;n=this.childrenArray(i);let a=n.findIndex(l=>l.id===o);if(a<0)throw new Error;n=[...n],n[a]={...n[a],children:s}}Object.setPrototypeOf(n,ps.prototype);let r=n;return r.fillCaches(),r}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(void 0!==this.get(e))return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:n,data:r,children:s}=e;if(null!==t&&void 0===this.get(t)||this.checkDuplicatedIdRec(e))return null;{let o=t,a=this.childrenArray(o),l={fi:i,id:n,data:r,children:s};return a=[...a,l],a.sort((c,h)=>c.fi-h.fi),e.localIndex=a.indexOf(l),{data:this.modifyArrayBy(o,a),actual:e,reverse:{type:8,id:n}}}}deleteOp(e){let{id:t}=e;if(null===this.get(t))return null;{let i=this.parent(t);if(void 0===i)return null;let n=this.childrenArray(i),r=n.findIndex(o=>o.id===t);e.localIndex=r,n=[...n];let s=n.splice(r,1)[0];return{data:this.modifyArrayBy(i,n),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:n}=e;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:n});if(null!==t){let u=t;for(;null!==u;){if(void 0===u)throw new Error;if(u===n)throw new WH("cyclic tree");u=this.parent(u)}}let r=this.parent(n);if(void 0===r)return null;let s=r,o=this.childrenArray(r),a=o.findIndex(u=>u.id===n);o=[...o];let l=o.splice(a,1)[0],c=this.modifyArrayBy(r,o);r=t,o=c.childrenArray(r);let h=l.fi;return l={...l,fi:i},o=[...o,l],o.sort((u,d)=>u.fi-d.fi),e.localIndex=o.indexOf(l),c=c.modifyArrayBy(r,o),{data:c,actual:e,reverse:{type:9,parent:s,fi:h,id:n}}}previous(e,t){if(null===t){let n=this.childrenArray(e);return 0===n.length?null:n[n.length-1].id}let i=null;for(let n of this.childrenArray(e)){if(n.id===t)return i;i=n.id}return null}traverseSortNext(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex(r=>r.id===e)+1;if(n<i.length)return i[n].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex(r=>r.id===e)-1;return n>=0?this.traverseSortPrevious(i[n].id):t}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);void 0!==n&&t.push({...i,...n})}t.sort((i,n)=>function xCe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}(i.sortKey,n.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],n=this.get(t),r=n;if(void 0!==n){for(;t;)i.splice(0,0,n.fi),null!==(t=this.parent(t))&&(n=this.get(t));return{...r,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let n=this.childrenArray(e);if(null===t){if(0===n.length)return Ac(0,i,i);{let r=n[0].fi;return Ac(r-i,r,i)}}{let r=this.get(t);if(void 0===r||this.parent(t)!==e)throw new Error("illegal args");let s=n.find(o=>o.fi>r.fi);if(void 0===s){let o=n[n.length-1].fi;return Ac(o,o+i,i)}return Ac(r.fi,s.fi,i)}}};(e=>{e.runOp=function t(i,n){if(0!==n.type)return null;if(Array.isArray(i)){let r=n.props,s={},o=[...i],a=!1;if(r)for(let l of Object.keys(r)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=o[c],o[c]=r[l],a=!0}return a?{data:o,actual:n,reverse:{type:0,props:s}}:null}{let r=n.props,s={},o={...i},a=!1;if(r)for(let l of Object.keys(r)){s[l]=o[l];let c=r[l];void 0===c?delete o[l]:o[l]=c,a=!0}return a?{data:o,actual:n,reverse:{type:0,props:s}}:null}}})(Bb||(Bb={}));var rt=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,rt.prototype)}deepFreeze(){let e=0;for(;e<this.length;)JA(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){return this.get(e)?.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this,n=i.findIndex(s=>s.id===e);if(n<0)throw new Error("not expected");let r=i[n];return i=[...i],i[n]={...r,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,rt.prototype);let t=e;return function SCe(){return typeof process<"u"}()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:n}=e,r=this,s={fi:t,id:i,data:n};return r=[...r,s],r.sort((o,a)=>o.fi-a.fi),e.localIndex=r.indexOf(s),{data:this.modifyArrayBy(r),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,n=i.findIndex(s=>s.id===t);if(-1===n)return null;e.localIndex=n,i=[...i];let r=i.splice(n,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...r}}}moveOp(e){let{fi:t,id:i}=e,n=this;n=[...n];let r=n.findIndex(a=>a.id===i);if(-1===r)return null;let s=n[r].fi,o={...n[r],fi:t};return n[r]=o,n.sort((a,l)=>a.fi-l.fi),e.localIndex=n.indexOf(o),{data:this.modifyArrayBy(n),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(null===e)return 0===this.length?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(null===e){if(0===i.length)return Ac(0,t,t);{let n=i[0].fi;return Ac(n-t,n,t)}}{let n=this.get(e);if(void 0===n)throw new Error("illegal args");let r=i.find(s=>s.fi>n.fi);if(void 0===r){let s=i[i.length-1].fi;return Ac(s,s+t,t)}return Ac(n.fi,r.fi,t)}}};function Mp(e){return e&&"object"==typeof e&&e instanceof Vn}var Dc,rD,_r,sD,Vn=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,n=0,r={};for(;n<e.path.length;){if(t.push(i),i=void 0===i?void 0:i[e.path[n]],void 0!==i&&!Mp(i))return null;n+=1}i=i?eD(i):new Vn;for(let[a,l]of Object.entries(e.props))r[a]=i[a],void 0===l?delete i[a]:i[a]=l;for(;n>0;){if(0===Object.keys(i).length){let a=t[n-1];a&&(i=eD(a),delete i[e.path[n-1]])}else{let a=t[n-1];if(a){let l=eD(a);l[e.path[n-1]]=i,i=l}else{let l=new Vn;l[e.path[n-1]]=i,i=l}}n-=1}return{data:Object.setPrototypeOf(i,Vn.prototype),actual:e,reverse:{...e,props:r}}}};function iD(e,t){if(void 0===t)return;let i=!1,n=e.map(r=>{let s=r.id,o=Xg(r.data,t[s]);if(i=i||void 0!==o,void 0===o&&(o=r.data),r.children){let a=iD(r.children,t);return void 0!==a?i=!0:a=r.children,{...r,id:s,data:o,children:a}}return{...r,id:s,data:o}});return i?n:void 0}function Xg(e,t){if(!Mp(t))return t;if(e instanceof ps){let i=iD(e,t);return void 0!==i&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}if(e instanceof rt)return function CCe(e,t){if(void 0===t)return;let i=!1,n=e.map(r=>{let s=r.id,o=Xg(r.data,t[s]);return i=i||void 0!==o,void 0===o&&(o=r.data),{...r,id:s,data:o}});return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}(e,t);if(Array.isArray(e)){let i=!1,n=e.map((r,s)=>{let o=Xg(r,t[s]);return i=i||void 0!==o,void 0===o&&(o=r),o});return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if(e instanceof Vn)return nD(e,t);if(e&&"object"==typeof e){let i={},n=!1;for(let[r,s]of Object.entries(e)){let o=Xg(s,t[r]);n=n||void 0!==o,void 0===o&&(o=s),i[r]=o}return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}function nD(e,t){if(void 0===e)return t;if(void 0===t)return e;if(!Mp(t))return t;if(!Mp(e))return Dc.apply(e,t);let i=new Set;for(let r of Object.keys(e))i.add(r);for(let r of Object.keys(t))i.add(r);let n=new Vn;for(let r of i){let s=nD(void 0===e?void 0:e[r],void 0===t?void 0:t[r]);n[r]=s}return n}function ECe(e,t){let i={cur:[],result:[],len:0};return[e=Zg(e,t,i)??e,i.result]}function Vb(e,t){return null===e?null:(e.cur[e.len]=t,e.len+=1,e)}function zb(e){e&&(e.len-=1)}function XH(e,t,i){let n=!1,r=e.map(s=>{let o=s.id,a=t[o];if(void 0!==a&&"string"==typeof a&&(n=!0,o=a,null!==i))throw new Error("not supported");let l=Zg(s.data,t,Vb(i,o));zb(i),n=n||void 0!==l,void 0===l&&(l=s.data);let c=XH(s.children,t,i);return void 0!==c?n=!0:c=s.children,{...s,id:o,data:l,children:c}});if(n)return r}function Zg(e,t,i){if(e instanceof ps){let n=XH(e,t,i);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}if(e instanceof rt)return function ACe(e,t,i){let n=!1,r=e.map(s=>{let o=s.id,a=t[o];if(void 0!==a&&"string"==typeof a&&(n=!0,o=a,null!==i))throw new Error("not supported");let l=Zg(s.data,t,Vb(i,o));return zb(i),n=n||void 0!==l,void 0===l&&(l=s.data),{...s,id:o,data:l}});if(n)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}(e,t,i);if(Array.isArray(e)){let n=!1,r=e.map((s,o)=>{let a=Zg(s,t,Vb(i,o));return zb(i),n=n||void 0!==a,void 0===a&&(a=s),a});return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}if(e&&"object"==typeof e&&!tD(e)){let n={},r=!1;for(let[s,o]of Object.entries(e))if("name"!==s){let a=t[s];if("string"==typeof a){if(null!==i)throw new Error("not supported");r=!0,s=a}let l=Zg(o,t,Vb(i,s));zb(i),r=r||void 0!==l,void 0===l&&(l=o),n[s]=l}else n[s]=o;return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if("string"==typeof e){let n=t[e];return void 0!==n&&function MCe(e){if(null===e)return null;e.result.push(e.cur.slice(0,e.len))}(i),n}}(e=>{e.apply=function t(r,s){return Xg(r,s)??r},e.merge=function i(r,s){return nD(r,s)},e.filterOp=function n(r,s){let o=0,a=s.path,l=r;for(;o<a.length&&void 0!==l;){if(l=Wr.zoomOnce(l,a[o]),void 0===l)return s;if(!Mp(l))return;o+=1}if(void 0===l)return s;if(Mp(l)){if(0===s.type){let c={...s.props};for(let h of Object.keys(l))delete c[h];return{...s,props:c}}if(1===s.type||4===s.type||7===s.type){let c=iD([s],l);return c?(console.log(c),c):s}return s}}})(Dc||(Dc={})),(e=>{e.replaceProps=function t(i,n){let r=Wr.zoom(n,i.path);if("object"==typeof r){let s={};for(let o of Object.keys(i.props))s[o]=r[o];return{...i,props:s}}return{...i,props:{}}}})(rD||(rD={})),(e=>{function n(l,c){let h=c.path;for(var u=[];;){let d;if(l instanceof Vn&&0===c.type&&(d=l.runOp({...c,path:h.slice(u.length)}),null===d&&(d=void 0)),void 0===d&&u.length===h.length&&(d=l instanceof ps||l instanceof rt||l instanceof Pt?l.runOp(c):Bb.runOp(l,c)),void 0!==d){if(null!==d){let m=d.data;for(let g=u.length-1;g>=0;g--){let v=h[g],y=u[g];if(y instanceof ps){if("number"==typeof v)throw new Error("illegal arg");m=y.modifyById(v,m)}else if(y instanceof rt){if("number"==typeof v)throw new Error("illegal arg");m=y.modifyById(v,m)}else if(y instanceof Pt){if("number"==typeof v)throw new Error("illegal arg");m=y.modifyById(v,m)}else if(y instanceof Vn){let _={...y,[v]:m};m=Object.setPrototypeOf(_,Vn.prototype)}else{if("object"!=typeof y)return null;if(Array.isArray(y)){if("string"==typeof v&&(v=parseInt(v),isNaN(v)))throw new Error("Invalid path");let _=m;m=[...y],m[v]=_}else m={...y,[v]:m}}}return{data:m,actual:{...d.actual,path:h},reverse:{...d.reverse,path:h}}}return null}let f,p=h[u.length];if(l instanceof ps){if("number"==typeof p)throw new Error("");f=l.get(p)?.data}else if(l instanceof rt){if("number"==typeof p)throw new Error("");f=l.get(p)?.data}else null!==l&&(f=l[p]);if(void 0===f)return null;u.push(l),l=f}}function r(l,c){for(let h=0;h<l.length&&h<c.length;h++)if(l[h]!==c[h])return!0;return!1}function s(l,c){if(l.length!==c.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==c[h])return!1;return!0}e.drop=function t(l,c){return{...l,path:l.path.slice(c)}},e.applySimple=function i(l,c){return n(l,c)?.data??l},e.apply=n,e.pathDisjoint=r,e.pathEq=s,e.commutative=function o(l,c){return r(l.path,c.path)},e.subsumed=function a(l,c){return!(0!==l.type||0!==c.type||!s(l.path,c.path))&&Object.keys(l.props).every(h=>void 0!==c.props[h])}})(_r||(_r={})),(e=>{function l(c,h){var u=c;let d=[],p=[];for(let f of h)try{if(3===f.type||5===f.type&&"variables"===f.path[f.path.length-1]){let m,g,v;if(3===f.type?(m=Wr.zoom(u,[...f.path,f.id]),v=_r.apply(u,{...f,type:2})):(m=Wr.zoom(u,[...f.path,f.id,"value"]),v=_r.apply(u,f)),null!==v){u=v.data;let[y,_]=ECe(u,{[f.id]:m});u=y;for(let b=0;b<_.length;b++){let w=_[b],C=w.pop();if("number"==typeof C){let x=[C];for(let E=b+1;E<_.length;E++){let D=_[E],T=D[D.length-1];if("number"!=typeof T||!Wr.equal(w,D.slice(0,D.length-1)))break;x.push(T),_.splice(E,1)}let S=Wr.zoom(u,w);g=S.map((E,D)=>x.includes(D)?f.id:E),m=S,C=w.pop()}else{if("alphaOverride"===C||"alpha"===C){m/=100;let x=m,S=Wr.zoom(u,w.slice(0,w.length-2)),E=S.layers.map(D=>D.id===w[w.length-1]?{...D,data:{...D.data,[C]:x}}:D);Object.setPrototypeOf(E,Object.getPrototypeOf(S.layers)),S.layers=E}g=f.id}d.push({type:0,path:w,props:{[C]:m}}),p.push({type:0,path:w,props:{[C]:g}})}p.push(v.reverse),d.push(v.actual)}}else{let m=_r.apply(u,f);null!==m&&(d.push(m.actual),u=m.data,p.push(m.reverse))}}catch(m){if(m instanceof WH)return null;throw m}return{data:u,actual:d,reverse:p.reverse()}}e.empty=function t(){return[]},e.removePrefix=function i(c,h){let u=[];for(let d of c){let[p,...f]=d.path;p===h&&u.push({...d,path:f})}return u},e.addPrefix=function n(c,h){return c.map(u=>({...u,path:[h,...u.path]}))},e.concat=function r(c,h){return[...c,...h]},e.compress=function s(c,h){return[...c.filter(u=>!h.some(d=>_r.subsumed(u,d))),...h]},e.commutative=function o(c,h){return c.every(u=>h.every(d=>_r.commutative(u,d)))},e.applyAll=function a(c,h){for(let u of h){let d=l(c,u);null!==d&&(c=d.data)}return c},e.apply=l})(sD||(sD={}));var ZH=Symbol(),DCe=Symbol(),Ub=Symbol(),Qg=class{reportOp(e,t,i=[]){let n=this;if(null===t)return;n._current=t.data;let r=i;for(;!(n instanceof KH);){let s=n._path,o=n._current;if(""!==s&&r.splice(0,0,s),n=n._parent,null===n)return;n.update(s,o)}n.push(r,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[Ub];i&&i(),delete this._children[e]}}}},TCe=class extends Qg{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,Bb.runOp(this._current,e),e.path)}},ICe=class extends Qg{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,Pt.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},QH={get(e,t){if(t===Ub)return()=>{e._parent=null};if(t===ZH)return e._current;if(t===DCe)return e;let{_current:i,_children:n}=e;if("push"===t&&Array.isArray(i))throw new Error("not supported to expand array");let r=void 0===n?void 0:n[t];if(void 0!==r)return r;let s=i[t],o=jb(e,t,s);return o!==s?(void 0===n&&(n={},e._children=n),n[t]=o,o):s},has:(e,t)=>t in e._current,ownKeys:e=>Reflect.ownKeys(e._current),defineProperty(){throw Error("not supported")},getPrototypeOf:e=>Object.getPrototypeOf(e._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,n=Reflect.getOwnPropertyDescriptor(i,t);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:i[t]}}},PCe={...QH,set(e,t,i){let n={type:0,props:{[t]:Sn(i)??i}};return e.deleteChildren(t),e.runOp(n),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},RCe={...QH,set(e,t,i){return void 0===i?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty:(e,t)=>(e.runOp({type:2,id:t}),!0)},oD=class extends Qg{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[Ub]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){let{_current:t,_children:i}=this,n=void 0===i?void 0:i[e];if(void 0!==n)return n;let r=t.get(e)?.data,s=jb(this,e,r);return s!==r?(void 0===i&&(i={},this._children=i),i[e]=s,s):r}add(e,t,i,n,r){this.runOp({type:7,parent:e,fi:t,id:i,data:n,children:r})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let s=i[r];this.add(e,n[r],s.id,s.data,s.children)}}insertBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let s=i[r];this.add(e,n[r],s.id,s.data,s.children)}}moveAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++)this.move(e,n[r],i[r])}moveBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++)this.move(e,n[r],i[r])}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},aD=class extends Qg{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[Ub]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let n=this._current[i].id,r=this._current[i].fi;e(this.data(this._current[i].id),n,r)}}find(e){let t=this.length;for(let i=0;i<t;i++){let n=this._current[i].id;if(e(this.data(n),n))return this.get(n)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){let{_current:t,_children:i}=this,n=void 0===i?void 0:i[e];if(void 0!==n)return n;let r=t.get(e)?.data,s=jb(this,e,r);return s!==r?(void 0===i&&(i={},this._children=i),i[e]=s,s):r}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.add(i[n],r.id,r.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let r=t[n];this.add(i[n],r.id,r.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++)this.move(i[n],t[n])}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++)this.move(i[n],t[n])}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function lD(e,t,i){if(e.length>0){let n=e[e.length-1];if(0===n.type&&0===t.type&&Wr.equal(n.path,i))return void Object.assign(n.props,t.props)}e.push({...t,path:i})}var Wr,KH=class extends Qg{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(""!==e)throw new Error("");this._current=t}push(e,t,i,n){lD(this.ts,t,e),lD(this.actual,i,e),lD(this.reverse,n,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function jb(e,t,i){return i instanceof ps?new oD(e,t,i):i instanceof rt?new aD(e,t,i):i instanceof Pt?new Proxy(new ICe(e,t,i),RCe):null!==i&&"object"==typeof i?tD(i)?i:new Proxy(new TCe(e,t,i),PCe):i}function $H(e){let t=new KH(e);return[jb(t,"",e),t]}function Kg(e,t){let[i,n]=$H(e);return t(i),n.result()}function Sn(e){return e instanceof oD||e instanceof aD?e._current:null!==e&&"object"==typeof e?e[ZH]:e}function co(e,t){let i=[];if(!(t.length<=e.length))return null;for(var n=0;n<t.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e=>{function n(s,o){return(s instanceof ps||s instanceof oD)&&"string"==typeof o||(s instanceof rt||s instanceof aD)&&"string"==typeof o?s.data(o):"number"==typeof o&&Array.isArray(s)||"string"==typeof o&&"object"==typeof s&&null!==s?s[o]:void 0}function r(s,o,a=0){for(;a<o.length&&void 0!==s;)s=n(s,o[a]),a+=1;return s}e.equal=function t(s,o){if(o.length!==s.length)return!1;for(var a=0;a<s.length;){if(s[a]!==o[a])return!1;a+=1}return!0},e.removeOverridden=function i(s,o,a){let l=r(a,s);if(void 0!==l&&"object"==typeof l&&null!==l){let c={...o};return Object.keys(l).forEach(h=>{delete c[h]}),c}return o},e.zoomOnce=n,e.zoom=r})(Wr||(Wr={}));var cD,JH=class{},e5=class extends JH{constructor(e){super(),this.id=e}},t5=class extends JH{constructor(e){super(),this.data=e}};try{cD=new TextDecoder}catch{}var ze,Tc,$t,Ic,Vs,Pl,li,J=0,n5=[],uD=n5,hD=0,fs={},uo=0,Aa=0,qr=[],r5={useRecords:!1,mapsAsObjects:!0},s5=class{},o5=new s5;o5.name="MessagePack 0xC1";var Ap=!1,Hb=class{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(ze)return y5(()=>(gD(),this?this.unpack(e,t):Hb.prototype.unpack.call(r5,e,t)));Tc=t>-1?t:e.length,J=0,hD=0,Aa=0,Ic=null,uD=n5,Vs=null,ze=e;try{li=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw ze=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof Hb){if(fs=this,this.structures)return $t=this.structures,Gb();(!$t||$t.length>0)&&($t=[])}else fs=r5,(!$t||$t.length>0)&&($t=[]);return Gb()}unpackMultiple(e,t){let i,n=0;try{Ap=!0;let r=e.length,s=this?this.unpack(e,r):qb.unpack(e,r);if(!t){for(i=[s];J<r;)n=J,i.push(Gb());return i}for(t(s);J<r;)if(n=J,!1===t(Gb()))return}catch(r){throw r.lastPosition=n,r.values=i,r}finally{Ap=!1,gD()}}_mergeStructures(e,t){for(let i=0,n=(e=e||[]).length;i<n;i++){let r=e[i];r&&(r.isShared=!0,i>=32&&(r.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let n=e[i],r=t[i];r&&(n&&((e.restoreStructures||(e.restoreStructures=[]))[i]=n),e[i]=r)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function Gb(){try{if(!fs.trusted&&!Ap){let t=$t.sharedLength||0;t<$t.length&&($t.length=t)}let e=Zi();if(J==Tc)$t.restoreStructures&&a5(),$t=null,ze=null,Pl&&(Pl=null);else{if(J>Tc){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}if(!Ap)throw new Error("Data read, but end of buffer not reached")}return e}catch(e){throw $t.restoreStructures&&a5(),gD(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function a5(){for(let e in $t.restoreStructures)$t[e]=$t.restoreStructures[e];$t.restoreStructures=null}function Zi(){let e=ze[J++];if(e<160){if(e<128){if(e<64)return e;{let t=$t[63&e]||fs.getStructures&&c5()[63&e];return t?(t.read||(t.read=dD(t,63&e)),t.read()):e}}if(e<144){if(e-=128,fs.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[f5()]=Zi();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(Zi(),Zi());return t}}{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Zi();return t}}if(e<192){let t=e-160;if(Aa>=J)return Ic.slice(J-uo,(J+=t)-uo);if(0==Aa&&Tc<140){let i=t<16?fD(t):d5(t);if(null!=i)return i}return pD(t)}{let t;switch(e){case 192:return null;case 193:return Vs?(t=Zi(),t>0?Vs[1].slice(Vs.position1,Vs.position1+=t):Vs[0].slice(Vs.position0,Vs.position0-=t)):o5;case 194:return!1;case 195:return!0;case 196:return mD(ze[J++]);case 197:return t=li.getUint16(J),J+=2,mD(t);case 198:return t=li.getUint32(J),J+=4,mD(t);case 199:return eh(ze[J++]);case 200:return t=li.getUint16(J),J+=2,eh(t);case 201:return t=li.getUint32(J),J+=4,eh(t);case 202:if(t=li.getFloat32(J),fs.useFloat32>2){let i=vD[(127&ze[J])<<1|ze[J+1]>>7];return J+=4,(i*t+(t>0?.5:-.5)>>0)/i}return J+=4,t;case 203:return t=li.getFloat64(J),J+=8,t;case 204:return ze[J++];case 205:return t=li.getUint16(J),J+=2,t;case 206:return t=li.getUint32(J),J+=4,t;case 207:return fs.int64AsNumber?(t=4294967296*li.getUint32(J),t+=li.getUint32(J+4)):t=li.getBigUint64(J),J+=8,t;case 208:return li.getInt8(J++);case 209:return t=li.getInt16(J),J+=2,t;case 210:return t=li.getInt32(J),J+=4,t;case 211:return fs.int64AsNumber?(t=4294967296*li.getInt32(J),t+=li.getUint32(J+4)):t=li.getBigInt64(J),J+=8,t;case 212:if(t=ze[J++],114==t)return m5(63&ze[J++]);{let i=qr[t];if(i)return i.read?(J++,i.read(Zi())):i.noBuffer?(J++,i()):i(ze.subarray(J,++J));throw new Error("Unknown extension "+t)}case 213:return t=ze[J],114==t?(J++,m5(63&ze[J++],ze[J++])):eh(2);case 214:return eh(4);case 215:return eh(8);case 216:return eh(16);case 217:return t=ze[J++],Aa>=J?Ic.slice(J-uo,(J+=t)-uo):NCe(t);case 218:return t=li.getUint16(J),Aa>=(J+=2)?Ic.slice(J-uo,(J+=t)-uo):kCe(t);case 219:return t=li.getUint32(J),Aa>=(J+=4)?Ic.slice(J-uo,(J+=t)-uo):FCe(t);case 220:return t=li.getUint16(J),J+=2,u5(t);case 221:return t=li.getUint32(J),J+=4,u5(t);case 222:return t=li.getUint16(J),J+=2,h5(t);case 223:return t=li.getUint32(J),J+=4,h5(t);default:if(e>=224)return e-256;if(void 0===e){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var LCe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function dD(e,t){function i(){if(i.count++>2){let r=e.read=new Function("r","return function(){return {"+e.map(s=>LCe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Zi);return 0===e.highByte&&(e.read=l5(t,e.read)),r()}let n={};for(let r=0,s=e.length;r<s;r++)n[e[r]]=Zi();return n}return i.count=0,0===e.highByte?l5(t,i):i}var l5=(e,t)=>function(){let i=ze[J++];if(0===i)return t();let n=e<32?-(e+(i<<5)):e+(i<<5),r=$t[n]||c5()[n];if(!r)throw new Error("Record id is not defined for "+n);return r.read||(r.read=dD(r,e)),r.read()};function c5(){let e=y5(()=>(ze=null,fs.getStructures()));return $t=fs._mergeStructures(e,$t)}var pD=Wb,NCe=Wb,kCe=Wb,FCe=Wb;function Wb(e){let t;if(e<16&&(t=fD(e)))return t;if(e>64&&cD)return cD.decode(ze.subarray(J,J+=e));let i=J+e,n=[];for(t="";J<i;){let r=ze[J++];if(128&r)if(192==(224&r)){let s=63&ze[J++];n.push((31&r)<<6|s)}else if(224==(240&r)){let s=63&ze[J++],o=63&ze[J++];n.push((31&r)<<12|s<<6|o)}else if(240==(248&r)){let l=(7&r)<<18|(63&ze[J++])<<12|(63&ze[J++])<<6|63&ze[J++];l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l)}else n.push(r);else n.push(r);n.length>=4096&&(t+=Zn.apply(String,n),n.length=0)}return n.length>0&&(t+=Zn.apply(String,n)),t}function u5(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Zi();return t}function h5(e){if(fs.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[f5()]=Zi();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(Zi(),Zi());return t}}var Zn=String.fromCharCode;function d5(e){let t=J,i=new Array(e);for(let n=0;n<e;n++){let r=ze[J++];if((128&r)>0)return void(J=t);i[n]=r}return Zn.apply(String,i)}function fD(e){if(e<4){if(e<2){if(0===e)return"";{let t=ze[J++];return(128&t)>1?void(J-=1):Zn(t)}}{let t=ze[J++],i=ze[J++];if((128&t)>0||(128&i)>0)return void(J-=2);if(e<3)return Zn(t,i);let n=ze[J++];return(128&n)>0?void(J-=3):Zn(t,i,n)}}{let t=ze[J++],i=ze[J++],n=ze[J++],r=ze[J++];if((128&t)>0||(128&i)>0||(128&n)>0||(128&r)>0)return void(J-=4);if(e<6){if(4===e)return Zn(t,i,n,r);{let s=ze[J++];return(128&s)>0?void(J-=5):Zn(t,i,n,r,s)}}if(e<8){let s=ze[J++],o=ze[J++];if((128&s)>0||(128&o)>0)return void(J-=6);if(e<7)return Zn(t,i,n,r,s,o);let a=ze[J++];return(128&a)>0?void(J-=7):Zn(t,i,n,r,s,o,a)}{let s=ze[J++],o=ze[J++],a=ze[J++],l=ze[J++];if((128&s)>0||(128&o)>0||(128&a)>0||(128&l)>0)return void(J-=8);if(e<10){if(8===e)return Zn(t,i,n,r,s,o,a,l);{let c=ze[J++];return(128&c)>0?void(J-=9):Zn(t,i,n,r,s,o,a,l,c)}}if(e<12){let c=ze[J++],h=ze[J++];if((128&c)>0||(128&h)>0)return void(J-=10);if(e<11)return Zn(t,i,n,r,s,o,a,l,c,h);let u=ze[J++];return(128&u)>0?void(J-=11):Zn(t,i,n,r,s,o,a,l,c,h,u)}{let c=ze[J++],h=ze[J++],u=ze[J++],d=ze[J++];if((128&c)>0||(128&h)>0||(128&u)>0||(128&d)>0)return void(J-=12);if(e<14){if(12===e)return Zn(t,i,n,r,s,o,a,l,c,h,u,d);{let p=ze[J++];return(128&p)>0?void(J-=13):Zn(t,i,n,r,s,o,a,l,c,h,u,d,p)}}{let p=ze[J++],f=ze[J++];if((128&p)>0||(128&f)>0)return void(J-=14);if(e<15)return Zn(t,i,n,r,s,o,a,l,c,h,u,d,p,f);let m=ze[J++];return(128&m)>0?void(J-=15):Zn(t,i,n,r,s,o,a,l,c,h,u,d,p,f,m)}}}}}function mD(e){return fs.copyBuffers?Uint8Array.prototype.slice.call(ze,J,J+=e):ze.subarray(J,J+=e)}function eh(e){let t=ze[J++];if(qr[t])return qr[t](ze.subarray(J,J+=e));throw new Error("Unknown extension type "+t)}var p5=new Array(4096);function f5(){let e=ze[J++];if(!(e>=160&&e<192))return J--,Zi();if(e-=160,Aa>=J)return Ic.slice(J-uo,(J+=e)-uo);if(!(0==Aa&&Tc<180))return pD(e);let s,t=4095&(e<<5^(e>1?li.getUint16(J):e>0?ze[J]:0)),i=p5[t],n=J,r=J+e-3,o=0;if(i&&i.bytes==e){for(;n<r;){if(s=li.getUint32(n),s!=i[o++]){n=1879048192;break}n+=4}for(r+=3;n<r;)if(s=ze[n++],s!=i[o++]){n=1879048192;break}if(n===r)return J=n,i.string;r-=3,n=J}for(i=[],p5[t]=i,i.bytes=e;n<r;)s=li.getUint32(n),i.push(s),n+=4;for(r+=3;n<r;)s=ze[n++],i.push(s);let a=e<16?fD(e):d5(e);return i.string=null!=a?a:pD(e)}var m5=(e,t)=>{var i=Zi();let n=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let r=$t[e];return r&&r.isShared&&(($t.restoreStructures||($t.restoreStructures=[]))[e]=r),$t[e]=i,i.read=dD(i,n),i.read()},g5="object"==typeof self?self:global;qr[0]=()=>{},qr[0].noBuffer=!0,qr[101]=()=>{let e=Zi();return(g5[e[0]]||Error)(e[1])},qr[105]=e=>{let t=li.getUint32(J-4);Pl||(Pl=new Map);let n,i=ze[J];n=i>=144&&i<160||220==i||221==i?[]:{};let r={target:n};Pl.set(t,r);let s=Zi();return r.used?Object.assign(n,s):(r.target=s,s)},qr[112]=e=>{let t=li.getUint32(J-4),i=Pl.get(t);return i.used=!0,i.target},qr[115]=()=>new Set(Zi());var v5=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");function y5(e){let t=Tc,i=J,n=hD,r=uo,s=Aa,o=Ic,a=uD,l=Pl,c=Vs,h=new Uint8Array(ze.slice(0,Tc)),u=$t,d=$t.slice(0,$t.length),p=fs,f=Ap,m=e();return Tc=t,J=i,hD=n,uo=r,Aa=s,Ic=o,uD=a,Pl=l,Vs=c,ze=h,Ap=f,($t=u).splice(0,$t.length,...d),fs=p,li=new DataView(ze.buffer,ze.byteOffset,ze.byteLength),m}function gD(){ze=null,Pl=null,$t=null}qr[116]=e=>{let t=e[0],i=v5[t];if(!i)throw new Error("Could not find typed array for code "+t);return new g5[i](Uint8Array.prototype.slice.call(e,1).buffer)},qr[120]=()=>{let e=Zi();return new RegExp(e[0],e[1])},qr[98]=e=>{let i=J;J+=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]-4,(Vs=[Zi(),Zi()]).position0=0,Vs.position1=0;let n=J;J=i;try{return Zi()}finally{J=n}},qr[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");var vD=new Array(147);for(let e=0;e<256;e++)vD[e]=+("1e"+Math.floor(45.15-.30103*e));var Yb,qb=new Hb({useRecords:!1}),zCe=new Float32Array(1);new Uint8Array(zCe.buffer,0,4);try{Yb=new TextEncoder}catch{}var Xb,yD,de,un,Da,Zb=typeof Buffer<"u",_D=Zb?Buffer.allocUnsafeSlow:Uint8Array,_5=Zb?Buffer:Uint8Array,b5=Zb?4294967296:2144337920,ne=0,Ta=null,UCe=/[\u0080-\uFFFF]/,$g=Symbol("record-id"),w5=class extends Hb{constructor(e){super(e),this.offset=0;let i,n,r,s,o,a=0,l=_5.prototype.utf8Write?function(x,S,E){return de.utf8Write(x,S,E)}:!(!Yb||!Yb.encodeInto)&&function(x,S){return Yb.encodeInto(x,de.subarray(S)).written},c=this;e||(e={});let h=e&&e.sequential,u=e.structures||e.saveStructures,d=e.maxSharedStructures;if(null==d&&(d=u?32:0),d>8160)throw new Error("Maximum maxSharedStructure is 8160");let p=e.maxOwnStructures;null==p&&(p=u?32:64),h&&!e.saveStructures&&(this.structures=[]);let f=d>32||p+d>64,m=d+64,g=d+p+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let v=[],y=0,_=0;this.pack=this.encode=function(x,S){if(de||(de=new _D(8192),un=new DataView(de.buffer,0,8192),ne=0),(Da=de.length-10)-ne<2048?(de=new _D(de.length),un=new DataView(de.buffer,0,de.length),Da=de.length-10,ne=0):ne=ne+7&2147483640,i=ne,o=c.structuredClone?new Map:null,c.bundleStrings?(Ta=["",""],de[ne++]=214,de[ne++]=98,Ta.position=ne-i,ne+=4):Ta=null,n=c.structures,n){n.uninitialized&&(n=c._mergeStructures(c.getStructures()));let E=n.sharedLength||0;if(E>d)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+n.sharedLength);if(!n.transitions){n.transitions=Object.create(null);for(let D=0;D<E;D++){let T=n[D];if(!T)continue;let I,P=n.transitions;for(let R=0,L=T.length;R<L;R++){let j=T[R];I=P[j],I||(I=P[j]=Object.create(null)),P=I}P[$g]=D+64}a=E}h||(n.nextId=E+64)}r&&(r=!1),s=n||[];try{if(b(x),Ta){un.setUint32(Ta.position+i,ne-Ta.position-i);let E=Ta;Ta=null,b(E[0]),b(E[1])}if(c.offset=ne,o&&o.idsToInsert){(ne+=6*o.idsToInsert.length)>Da&&C(ne),c.offset=ne;let E=function HCe(e,t){let i,n=6*t.length,r=e.length-n;for(t.sort((s,o)=>s.offset>o.offset?1:-1);i=t.pop();){let s=i.offset,o=i.id;e.copyWithin(s+n,s,r),n-=6;let a=s+n;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=255&o,r=s}return e}(de.subarray(i,ne),o.idsToInsert);return o=null,E}return S&GCe?(de.start=i,de.end=ne,de):de.subarray(i,ne)}finally{if(n){if(_<10&&_++,y>1e4)n.transitions=null,_=0,y=0,v.length>0&&(v=[]);else if(v.length>0&&!h){for(let E=0,D=v.length;E<D;E++)v[E][$g]=0;v=[]}if(r&&c.saveStructures){let E=n.sharedLength||d;n.length>E&&(n=n.slice(0,E));let D=de.subarray(i,ne);return!1===c.saveStructures(n,a)?(c._mergeStructures(c.getStructures()),c.pack(x)):(a=E,D)}}S&WCe&&(ne=i)}};let b=x=>{ne>Da&&(de=C(ne));var E,S=typeof x;if("string"===S){let T,D=x.length;if(Ta&&D>=8&&D<4096){let P=UCe.test(x);return Ta[P?0:1]+=x,de[ne++]=193,void b(P?-D:D)}T=D<32?1:D<256?2:D<65536?3:5;let I=3*D;if(ne+I>Da&&(de=C(ne+I)),D<64||!l){let P,R,L,j=ne+T;for(P=0;P<D;P++)R=x.charCodeAt(P),R<128?de[j++]=R:R<2048?(de[j++]=R>>6|192,de[j++]=63&R|128):55296==(64512&R)&&56320==(64512&(L=x.charCodeAt(P+1)))?(R=65536+((1023&R)<<10)+(1023&L),P++,de[j++]=R>>18|240,de[j++]=R>>12&63|128,de[j++]=R>>6&63|128,de[j++]=63&R|128):(de[j++]=R>>12|224,de[j++]=R>>6&63|128,de[j++]=63&R|128);E=j-ne-T}else E=l(x,ne+T,I);E<32?de[ne++]=160|E:E<256?(T<2&&de.copyWithin(ne+2,ne+1,ne+1+E),de[ne++]=217,de[ne++]=E):E<65536?(T<3&&de.copyWithin(ne+3,ne+2,ne+2+E),de[ne++]=218,de[ne++]=E>>8,de[ne++]=255&E):(T<5&&de.copyWithin(ne+5,ne+3,ne+3+E),de[ne++]=219,un.setUint32(ne,E),ne+=4),ne+=E}else if("number"===S)if(x>>>0===x)x<64?de[ne++]=x:x<256?(de[ne++]=204,de[ne++]=x):x<65536?(de[ne++]=205,de[ne++]=x>>8,de[ne++]=255&x):(de[ne++]=206,un.setUint32(ne,x),ne+=4);else if(x>>0===x)x>=-32?de[ne++]=256+x:x>=-128?(de[ne++]=208,de[ne++]=x+256):x>=-32768?(de[ne++]=209,un.setInt16(ne,x),ne+=2):(de[ne++]=210,un.setInt32(ne,x),ne+=4);else{let D;if((D=this.useFloat32)>0&&x<4294967296&&x>=-2147483648){let T;if(de[ne++]=202,un.setFloat32(ne,x),D<4||(T=x*vD[(127&de[ne])<<1|de[ne+1]>>7])>>0===T)return void(ne+=4);ne--}de[ne++]=203,un.setFloat64(ne,x),ne+=8}else if("object"===S)if(x){if(o){let T=o.get(x);if(T){if(!T.id){let I=o.idsToInsert||(o.idsToInsert=[]);T.id=I.push(T)}return de[ne++]=214,de[ne++]=112,un.setUint32(ne,T.id),void(ne+=4)}o.set(x,{offset:ne-i})}let D=x.constructor;if(D===Object)w(x,!0);else if(D===Array){(E=x.length)<16?de[ne++]=144|E:E<65536?(de[ne++]=220,de[ne++]=E>>8,de[ne++]=255&E):(de[ne++]=221,un.setUint32(ne,E),ne+=4);for(let T=0;T<E;T++)b(x[T])}else if(D===Map){(E=x.size)<16?de[ne++]=128|E:E<65536?(de[ne++]=222,de[ne++]=E>>8,de[ne++]=255&E):(de[ne++]=223,un.setUint32(ne,E),ne+=4);for(let[T,I]of x)b(T),b(I)}else{for(let T=0,I=Xb.length;T<I;T++)if(x instanceof yD[T]){let R=Xb[T];if(R.write)return R.type&&(de[ne++]=212,de[ne++]=R.type,de[ne++]=0),void b(R.write.call(this,x));let N,L=de,j=un,F=ne;de=null;try{N=R.pack.call(this,x,q=>(de=L,L=null,(ne+=q)>Da&&C(ne),{target:de,targetView:un,position:ne-q}),b)}finally{L&&(un=j,ne=F,Da=(de=L).length-10)}return void(N&&(N.length+ne>Da&&C(N.length+ne),ne=jCe(N,de,ne,R.type)))}w(x,!x.hasOwnProperty)}}else de[ne++]=192;else if("boolean"===S)de[ne++]=x?195:194;else if("bigint"===S){if(x<BigInt(1)<<BigInt(63)&&x>=-(BigInt(1)<<BigInt(63)))de[ne++]=211,un.setBigInt64(ne,x);else if(x<BigInt(1)<<BigInt(64)&&x>0)de[ne++]=207,un.setBigUint64(ne,x);else{if(!this.largeBigIntToFloat)throw new RangeError(x+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");de[ne++]=203,un.setFloat64(ne,Number(x))}ne+=8}else if("undefined"===S)this.encodeUndefinedAsNil?de[ne++]=192:(de[ne++]=212,de[ne++]=0,de[ne++]=0);else{if("function"!==S)throw new Error("Unknown type: "+S);b(this.writeFunction&&this.writeFunction())}},w=!1===this.useRecords?this.variableMapSize?x=>{let D,S=Object.keys(x),E=S.length;E<16?de[ne++]=128|E:E<65536?(de[ne++]=222,de[ne++]=E>>8,de[ne++]=255&E):(de[ne++]=223,un.setUint32(ne,E),ne+=4);for(let T=0;T<E;T++)b(D=S[T]),b(x[D])}:(x,S)=>{de[ne++]=222;let E=ne-i;ne+=2;let D=0;for(let T in x)(S||x.hasOwnProperty(T))&&(b(T),b(x[T]),D++);de[E+++i]=D>>8,de[E+i]=255&D}:x=>{let E,S=Object.keys(x),D=s.transitions||(s.transitions=Object.create(null)),T=0;for(let P=0,R=S.length;P<R;P++){let L=S[P];E=D[L],E||(E=D[L]=Object.create(null),T++),D=E}let I=D[$g];if(I)I>=96&&f?(de[ne++]=96+(31&(I-=96)),de[ne++]=I>>5):de[ne++]=I;else{I=s.nextId,I||(I=64),I<m&&this.shouldShareStructure&&!this.shouldShareStructure(S)?(I=s.nextOwnId,I<g||(I=m),s.nextOwnId=I+1):(I>=g&&(I=m),s.nextId=I+1);let P=S.highByte=I>=96&&f?I-96>>5:-1;D[$g]=I,s[I-64]=S,I<m?(S.isShared=!0,s.sharedLength=I-63,r=!0,P>=0?(de[ne++]=96+(31&I),de[ne++]=P):de[ne++]=I):(P>=0?(de[ne++]=213,de[ne++]=114,de[ne++]=96+(31&I),de[ne++]=P):(de[ne++]=212,de[ne++]=114,de[ne++]=I),T&&(y+=_*T),v.length>=p&&(v.shift()[$g]=0),v.push(D),b(S))}for(let P=0,R=S.length;P<R;P++)b(x[S[P]])},C=x=>{let S;if(x>16777216){if(x-i>b5)throw new Error("Packed buffer would be larger than maximum buffer size");S=Math.min(b5,4096*Math.round(Math.max((x-i)*(x>67108864?1.25:2),4194304)/4096))}else S=1+(Math.max(x-i<<2,de.length-1)>>12)<<12;let E=new _D(S);return un=new DataView(E.buffer,0,S),de.copy?de.copy(E,0,i,x):E.set(de.slice(i,x)),ne-=i,i=0,Da=E.length-10,de=E}}useBuffer(e){de=e,un=new DataView(de.buffer,de.byteOffset,de.byteLength),ne=0}};function x5(e,t,i,n){let r=e.byteLength;if(r+1<256){var{target:s,position:o}=i(4+r);s[o++]=199,s[o++]=r+1}else if(r+1<65536){var{target:s,position:o}=i(5+r);s[o++]=200,s[o++]=r+1>>8,s[o++]=r+1&255}else{var{target:s,position:o,targetView:a}=i(7+r);s[o++]=201,a.setUint32(o,r+1),o+=4}s[o++]=116,s[o++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function S5(e,t){let i=e.byteLength;var n,r;if(i<256){var{target:n,position:r}=t(i+2);n[r++]=196,n[r++]=i}else if(i<65536){var{target:n,position:r}=t(i+3);n[r++]=197,n[r++]=i>>8,n[r++]=255&i}else{var{target:n,position:r,targetView:s}=t(i+5);n[r++]=198,s.setUint32(r,i),r+=4}n.set(e,r)}function jCe(e,t,i,n){let r=e.length;switch(r){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:r<256?(t[i++]=199,t[i++]=r):r<65536?(t[i++]=200,t[i++]=r>>8,t[i++]=255&r):(t[i++]=201,t[i++]=r>>24,t[i++]=r>>16&255,t[i++]=r>>8&255,t[i++]=255&r)}return t[i++]=n,t.set(e,i),i+r}function Dp(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");yD.unshift(e.Class),Xb.unshift(e)}!function BCe(e){qr[e.type]=e.unpack?e.unpack:e}(e)}yD=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,s5],Xb=[{pack(e,t,i){let n=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&n>=0&&n<4294967296){let{target:r,targetView:s,position:o}=t(6);r[o++]=214,r[o++]=255,s.setUint32(o,n)}else if(n>0&&n<17179869184){let{target:r,targetView:s,position:o}=t(10);r[o++]=215,r[o++]=255,s.setUint32(o,4e6*e.getMilliseconds()+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:r,position:o}=t(3);r[o++]=212,r[o++]=255,r[o++]=255}else{let{target:r,targetView:s,position:o}=t(15);r[o++]=199,r[o++]=12,r[o++]=255,s.setUint32(o,1e6*e.getMilliseconds()),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(e,t,i){let n=Array.from(e),{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=115,r[s++]=0),i(n)}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=101,n[r++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=120,n[r++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?x5(e,16,t):S5(Zb?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==_5&&this.structuredClone?x5(e,v5.indexOf(i.name),t):S5(e,t)}},{pack(e,t){let{target:i,position:n}=t(1);i[n]=193}}],new w5({useRecords:!1});var wD,M5,GCe=512,WCe=1024,E5=new w5({structuredClone:!0});function bD(e){if(tD(e))return e;if(Array.isArray(e))return e.map(bD);if("object"==typeof e&&null!==e){let t={};for(let i of Object.keys(e).sort())t[i]=bD(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}Dp({Class:Pt.prototype.constructor,type:1,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,Pt.prototype),e)}),Dp({Class:rt.prototype.constructor,type:2,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,rt.prototype),e)}),Dp({Class:ps.prototype.constructor,type:3,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,ps.prototype),e)}),Dp({Class:e5.prototype.constructor,type:4,write:e=>e.id,read:e=>new e5(e)}),Dp({Class:t5.prototype.constructor,type:5,write:e=>e.data,read:e=>new t5(e)}),Dp({Class:Vn.prototype.constructor,type:6,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,Vn.prototype),e)}),(e=>{function t(r){return E5.pack(r)}e.serialize=t,e.deserialize=function i(r){return E5.unpack(r)},e.checksum=function n(r){return function qCe(e){var t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e[i],t&=t;return t}(t(bD(r))).toString()}})(wD||(wD={})),(e=>{e.toEventUIType=function t(n){return"Conditional"===n.type?"Distance"===n.condition.type?"Distance":"StateChange":n.type},e.fromEventUIType=function i(n){return"Distance"===n||"StateChange"===n?"Conditional":n}})(M5||(M5={}));var A5,Qb,xD,D5,T5,SD,CD,I5,P5,R5,O5,L5,ED,MD,zs={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Create","SetVariable","DynamicVariablePlay","Conditional"],MouseHover:["Transition","Animation","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional"],Start:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Conditional:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MousePress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyPress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional"],GameControl:["Transition","Animation","Audio","Create","Conditional"],Collision:["Transition","Animation","Audio","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional"],Trigger:["Transition","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Resize:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],VariableChange:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"]};(e=>{e.is=function t(n){return"MouseDown"===n.type||"MouseUp"===n.type||"MousePress"===n.type||"KeyDown"===n.type||"KeyUp"===n.type||"KeyPress"===n.type},e.defaultData=function i(n){return"MouseDown"===n||"MouseUp"===n||"MousePress"===n?{type:n,mode:"Object",disabled:!1,runMode:"Once",actions:new rt}:{type:n,disabled:!1,key:void 0,runMode:"Once",actions:new rt}}})(A5||(A5={})),(e=>{e.propertyDefaultData=function t(i){return{type:"Property",value:[i??null,"position","x"]}},e.valueDefaultData={type:"Literal",value:0}})(Qb||(Qb={})),(e=>{e.comparisonDefaultData=function t(r){return{type:"Comparison",operator:"==",lOperand:Qb.propertyDefaultData(r),rOperand:{...Qb.valueDefaultData}}},e.distanceDefaultData=function i(r){return{type:"Distance",toObject:r??null,fromObject:r??null,distance:200}},e.stateDefaultData=function n(r,s){return{type:"State",object:r??null,state:s??null}}})(xD||(xD={})),(e=>{e.is=function t(n){return"Conditional"===n.type},e.defaultData=function i(n){return{type:"Conditional",disabled:!1,inActions:new rt,outActions:new rt,condition:xD.distanceDefaultData(n)}}})(D5||(D5={})),(e=>{e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new rt,drop:new rt}}})(T5||(T5={})),(e=>{e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new rt}})(SD||(SD={})),(e=>{e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5}})(CD||(CD={})),(e=>{e.is=function t(n){return"MouseHover"===n.type},e.defaultData=function i(){return{type:"MouseHover",disabled:!1,actions:new rt}}})(I5||(I5={})),(e=>{e.is=function t(n){return"Scroll"===n.type},e.defaultData=function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new rt}}})(P5||(P5={})),(e=>{e.is=function t(n){return"Start"===n.type},e.defaultData=function i(){return{type:"Start",disabled:!1,actions:new rt}}})(R5||(R5={})),(e=>{e.is=function t(n){return"Collision"===n.type},e.defaultData=function i(){return{type:"Collision",disabled:!1,runMode:"Once",target:"character",actions:new rt}}})(O5||(O5={})),(e=>{e.is=function t(n){return"Trigger"===n.type},e.defaultData=function i(n,r){return{type:"Trigger",disabled:!1,runMode:"Once",target:"all",triggeringObjects:[],actions:new rt,triggerZone:"box",position:r.toArray(),rotation:[0,0,0],size:n.toArray(),radius:n.length()/2,helperVisible:!0}}})(L5||(L5={})),(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]},e.is=function t(o){return"Resize"===o.type},e.sizeToDevice=function i(o){return"string"==typeof o?o:"custom"},e.deviceToSize=function n(o){return"string"==typeof o?[...e.defaultSizes[o]]:[...o]},e.defaultData=function r(){let o={size:"mobile",operator:"<",actions:new rt},a={size:"tablet",operator:"<",actions:new rt},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new rt},c=new rt;return c.push({id:qe.generateUUID(),fi:0,data:o},{id:qe.generateUUID(),fi:1,data:a},{id:qe.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}},e.defaultBreakpointData=function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new rt}}})(ED||(ED={})),(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]},e.is=function t(n){return"VariableChange"===n.type},e.defaultData=function i(){return{disabled:!1,type:"VariableChange",actions:new rt,variableId:"",objectId:null,property:"Position X"}}})(MD||(MD={}));var Ip,th,Kb,Pp,Yr,Ho,AD,N5,k5,Pc,ih,Rp,Rc,DD,Tp="personal camera",Jg="a218fcc3-276b-49b9-b485-49037fd14f5f",ho=5526619;function XCe(e){return"string"==typeof e&&36===e.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}(e=>{e.isEqual=function t(n,r){return n[0]===r[0]&&n[1]===r[1]},e.lerp=function i(n,r,s){return[n[0]+(r[0]-n[0])*s,n[1]+(r[1]-n[1])*s]}})(Ip||(Ip={})),(e=>{e.isEqual=function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]},e.add=function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]},e.sub=function n(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]},e.div=function r(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]},e.mul=function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]},e.dist=function o(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])},e.lerp=function a(l,c,h){return[l[0]+(c[0]-l[0])*h,l[1]+(c[1]-l[1])*h,l[2]+(c[2]-l[2])*h]}})(th||(th={})),(e=>{e.isEqual=function t(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]},e.lerp=function i(n,r,s){return[n[0]+(r[0]-n[0])*s,n[1]+(r[1]-n[1])*s,n[2]+(r[2]-n[2])*s,n[3]+(r[3]-n[3])*s]}})(Kb||(Kb={})),(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.isEqual=function t(r,s){for(let o=0;o<16;o++)if(r[o]!==s[o])return!1;return!0},e.simplify=function i(r){return r??e.identity},e.applyMatrix4=function n(r,s){let o=s.slice(0);for(var a=0,l=s.length;a<l;a+=3){let c=r[3]*s[a]+r[7]*s[a+1]+r[11]*s[a+2]+r[15];o[a]=(r[0]*s[a]+r[4]*s[a+1]+r[8]*s[a+2]+r[12])/c,o[a+1]=(r[1]*s[a]+r[5]*s[a+1]+r[9]*s[a+2]+r[13])/c,o[a+2]=(r[2]*s[a]+r[6]*s[a+1]+r[10]*s[a+2]+r[14])/c}return o}})(Pp||(Pp={})),(e=>{e.isRGB=function t(l){return"object"==typeof l&&"number"==typeof l.r&&"number"==typeof l.g&&"number"==typeof l.b},e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0},e.toRgb255a1=function i(l){return{r:Math.round(255*l.r),g:Math.round(255*l.g),b:Math.round(255*l.b),a:1}},e.clone=function n(l){return{r:l.r,g:l.g,b:l.b}},e.fromHex=function r(l){return{r:((l=Math.floor(l))>>16&255)/255,g:(l>>8&255)/255,b:(255&l)/255}},e.toHex=function s(l){return 65536*Math.round(255*l.r)+256*Math.round(255*l.g)+Math.round(255*l.b)},e.equals=function o(l,c){return l.r===c.r&&l.g===c.g&&l.b===c.b},e.lerp=function a(l,c,h){return{r:l.r+(c.r-l.r)*h,g:l.g+(c.g-l.g)*h,b:l.b+(c.b-l.b)*h}}})(Yr||(Yr={})),(e=>{e.white={...Yr.white,a:1},e.transparent={...Yr.white,a:0},e.from0to1=function t(o){return{r:o[0],g:o[1],b:o[2],a:o[3]}},e.fromHexAndA=function i(o,a){return{...Yr.fromHex(o),a}},e.toRgb255a1=function n(o){return{r:Math.round(255*o.r),g:Math.round(255*o.g),b:Math.round(255*o.b),a:o.a}},e.equals=function r(o,a){return Yr.equals(o,a)&&o.a===a.a},e.lerp=function s(o,a,l){return{r:o.r+(a.r-o.r)*l,g:o.g+(a.g-o.g)*l,b:o.b+(a.b-o.b)*l,a:o.a+(a.a-o.a)*l}}})(Ho||(Ho={})),(e=>{e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}})(AD||(AD={})),(e=>{e.defaultData={mass:1,stiffness:80,damping:10,velocity:0}})(N5||(N5={})),(e=>{e.defaultData={control1:[.5,0],control2:[.5,1]}})(k5||(k5={})),(e=>{e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]})(Pc||(Pc={})),(e=>{e.all=["PerspectiveCamera","OrthographicCamera"],e.is=function t(i){return e.all.includes(i)}})(ih||(ih={})),(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset},e.getZoom=function t(i){return"PerspectiveCamera"===i.type?i.perspective.zoom:i.orthographic.zoom}})(Rp||(Rp={})),(e=>{e.defaultData=function t(n,r=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(n[0],n[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[n[0]+n[0]*r,0,0]},grid:{count:[2,2,2],size:n.map(s=>s*(1+r)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e.merge=function i(n,r){let s={...n};if(F5.forEach(o=>{Object.assign(s,{[o]:r[o]??n[o]})}),s.radial={...n.radial},r.radial){let o=n.radial,a=r.radial;B5.forEach(l=>{Object.assign(s.radial,{[l]:a[l]??o[l]})})}if(s.linear={...n.linear},r.linear){let o=n.linear,a=r.linear;V5.forEach(l=>{Object.assign(s.linear,{[l]:a[l]??o[l]})})}if(s.grid={...n.grid},r.grid){let o=n.grid,a=r.grid;z5.forEach(l=>{Object.assign(s.grid,{[l]:a[l]??o[l]})})}if(s.toObject={...n.toObject},r.toObject){let o=n.toObject,a=r.toObject;U5.forEach(l=>{Object.assign(s.toObject,{[l]:a[l]??o[l]})})}if(s.randomnessObject={...n.randomnessObject},r.randomnessObject){let o=n.randomnessObject,a=r.randomnessObject;j5.forEach(l=>{Object.assign(s.randomnessObject,{[l]:a[l]??o[l]})})}return s}})(Rc||(Rc={})),(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];e.toOps=function i(n,r){let s=[];void 0!==n.count&&s.push({type:0,path:r,props:{count:n.count}});for(let o of t){let a=n[o];a&&Object.keys(a).length>0&&s.push({type:0,path:[...r,o],props:a})}return s}})(DD||(DD={}));var TD,ID,Op,PD,RD,OD,H5,$b,G5,W5,F5=["count"],B5=["radius","start","end","position","scale","rotation"],V5=["position","scale","rotation"],z5=["count","size"],U5=["count","position","scale","rotation"],j5=["strength","scale","rotation","position","movement","seed","freqScale"];(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function t(i){return e.all.includes(i)}})(TD||(TD={})),(e=>{e.defaultData=function t(n){return function i(n){if("PointLight"===n)return{type:n,color:Ho.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===n)return{type:n,color:Ho.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===n)return{type:n,color:Ho.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(n)}})(ID||(ID={})),(e=>{e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}})(Op||(Op={})),(e=>{e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function t(i,n){return i.castShadow===n.castShadow&&i.receiveShadow===n.receiveShadow}})(PD||(PD={})),(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function t(i,n){return i.flatShading===n.flatShading&&i.side===n.side&&i.wireframe===n.wireframe}})(RD||(RD={})),(e=>{e.defaultData={...RD.defaultData,...PD.defaultData}})(OD||(OD={})),(e=>{e.getMaterialData=function t(i,n){let r=[];if("material"in i){let s="string"==typeof i.material?n.materials[i.material]??n.lib.materials[i.material]?.asset:i.material;s&&r.push(s)}else if("materials"in i)for(let s of i.materials){let o="string"==typeof s?n.materials[s]??n.lib.materials[s]?.asset:s;o&&r.push(o)}return r}})(H5||(H5={})),(e=>{e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7})($b||($b={})),(e=>{e.is=function t(i){return"texture"===i||"video"===i||"color"===i||"depth"===i||"normal"===i||"gradient"===i||"noise"===i||"fresnel"===i||"rainbow"===i||"toon"===i||"outline"===i||"transmission"===i||"matcap"===i||"displace"===i||"pattern"===i||"light"===i}})(G5||(G5={})),(e=>{e.is=function t(i){return"phong"===i||"toon"===i||"lambert"===i||"physical"===i}})(W5||(W5={}));var ms,br,Jb,ew,q5=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],QCe=["wrapping","image","video","name"];(e=>{e.patch=function t(s,o){let{texture:a,...l}=o;if(Object.assign(s,l),a){let c=s.texture;c&&Object.assign(c,a)}},e.defaultData=function i(s,o){return"light"===s&&o?function n(s){let o={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...o,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...o,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...o,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...o,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(o):function r(s){let o={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...o,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{...o,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:$b.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!1};case"color":return{...o,type:"color",color:Yr.fromHex(ho)};case"depth":return{...o,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...o,type:"normal",cnormal:[1,1,1]};case"gradient":return{...o,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...o,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Yr.fromHex(6710886),a:1},colorB:{...Yr.fromHex(6710886),a:1},colorC:{...Yr.fromHex(16777215),a:1},colorD:{...Yr.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...o,type:"fresnel",color:Ho.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...o,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...o,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Ho.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...o,type:"outline",outlineColor:Ho.fromHexAndA(0,1),contourColor:Ho.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...o,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{...o,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...o,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Yr.fromHex(0),a:1},colorB:{...Yr.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(s)}})(ms||(ms={})),(e=>{function o(c,h="layer1",u="layer2"){let d=new rt;return d.push({fi:0,data:ms.defaultData("light",c),id:h}),d.push({fi:1,data:ms.defaultData("color"),id:u}),{layers:d}}e.isMergable=function t(c){return!c.layers.some(h=>"texture"===h.data.type&&0!==h.data.projection||"depth"===h.data.type&&!h.data.isWorldSpace||"noise"===h.data.type||"displace"===h.data.type)},e.getHash=function i(c){let h="";return c.layers.forEach(u=>{Object.entries(u.data).forEach(([d,p])=>{h+=`${d}${p}`,Array.isArray(p)?p.forEach(f=>h+=`${f}`):"object"==typeof p?Object.values(p).forEach(f=>{h+="number"==typeof f?`${f.toFixed(4)}`:`${f}`}):h+=`${p}`})}),h},e.defaultEmptyData=function n(){return{layers:new rt}},e.defaultData=function r(c="layer1",h="layer2"){return o("phong",c,h)},e.withName=function s(c,h){return{...c,name:h}},e.defaultTwoLayerData=o,e.defaultTwoLayerTextureData=function a(c,h="phong",u="layer1",d="layer2"){let p=ms.defaultData("texture");Object.assign(p.texture,{image:c});let f=new rt;return f.push({fi:0,data:p,id:u}),f.push({fi:1,data:ms.defaultData("light",h),id:d}),{layers:f}},e.defaultTwoLayerVideoTextureData=function l(c,h="phong",u="layer1",d="layer2"){let p=ms.defaultData("video");Object.assign(p.texture,{video:c});let f=new rt;return f.push({fi:0,data:p,id:u}),f.push({fi:1,data:ms.defaultData("light",h),id:d}),{layers:f}}})(br||(br={})),(e=>{e.defaultData=function t(){return{points:new rt,roundness:0,shapeHoles:[],isClosed:!1}}})(Jb||(Jb={})),(e=>{e.defaultData=function t(){return{points:new rt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}})(ew||(ew={}));var LD,Y5={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(e=>{e.merge=function t(i,n){let r={...i};return Z5.forEach(s=>{Object.assign(r,{[s]:n[s]??i[s]})}),r}})(LD||(LD={}));var tw,ND,Lp,X5={shape:Y5,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},Z5=["depth","offset","angle","twist","startScale","endScale"];(e=>{e.is2DParametricMesh=function t(n){return"PolygonGeometry"===n||"RectangleGeometry"===n||"StarGeometry"===n||"TriangleGeometry"===n||"EllipseGeometry"===n},e.isParametricMesh=function i(n){return"PolygonGeometry"===n||"PolygonGeometry"===n||"RectangleGeometry"===n||"StarGeometry"===n||"TriangleGeometry"===n||"EllipseGeometry"===n||"PathGeometry"===n||"VectorGeometry"===n||"ConeGeometry"===n||"CubeGeometry"===n||"CylinderGeometry"===n||"DodecahedronGeometry"===n||"HelixGeometry"===n||"IcosahedronGeometry"===n||"LatheGeometry"===n||"PyramidGeometry"===n||"SphereGeometry"===n||"PlaneGeometry"===n||"BackdropGeometry"===n||"TorusGeometry"===n||"TorusKnotGeometry"===n||"BooleanGeometry"===n||"TextGeometry"===n}})(tw||(tw={})),(e=>{e.merge=function t(i,n){let r={...i};return Object.assign(r,n),"PathGeometry"===r.type&&"extrusion"in n&&n.extrusion&&(r.extrusion={...i.extrusion},Object.assign(r.extrusion,LD.merge(r.extrusion,n.extrusion))),r}})(ND||(ND={})),(e=>{e.defaultData=function t(i){if("RectangleGeometry"===i)return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("PathGeometry"===i)return{type:i,width:1,height:1,depth:1,path:ew.defaultData(),extrusion:X5};if("VectorGeometry"===i)return{width:1,height:1,type:i,subdivisions:12,shape:Jb.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===i)return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if("TextGeometry"===i)return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if("SphereGeometry"===i)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}})(Lp||(Lp={}));var kD,iw,FD,BD,VD,Np,zD,UD,K5,kp,Xr,jD,$5,Fp,ev,HD,nw,Oc,Bp,GD,nh,rw,rh,WD,qD,Vp,tv,zp,iv,sw,Us,YD,J5,eG,Up,Go,ow,aw,Q5=["width","height","depth"];function tG(e){e.layers.forEach(t=>{if("depth"===t.type&&void 0!==t.colorA){let i=t.colorA,n=t.colorB,r=[[i.r,i.g,i.b,i.a],[n.r,n.g,n.b,n.a]],s=[0,1];for(let a=2;a<10;a++)r.push(r[1]),s.push(1);let o={...Tl(Sn(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:r,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,o)}else if("depth"===t.type&&1===t.gradientType&&(t.near<0||t.far<0)){let i={...Sn(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Lc(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function Nc(e,t){e.scene.objects.traverse((i,n)=>{"materials"in n?n.materials.forEach((r,s)=>{void 0===r&&(n.materials[s]=br.defaultData(),r=n.materials[s]),"string"!=typeof r&&t(r)}):"material"in n?"string"!=typeof n.material&&(void 0===n.material&&(n.material=br.defaultData()),t(n.material)):"Mesh"===n.type&&(void 0===n.material&&(n.material=br.defaultData()),t(n.material)),"overrides"in n&&Object.values(n.overrides).forEach(r=>{r.material&&"string"!=typeof r.material&&t(r.material)})})}function iG(e){void 0===e.layers&&Object.assign(e,br.defaultTwoLayerData("lambert"))}function XD(e){!e.layers||e.layers.forEach(t=>{if("depth"===t.type&&10===t.colors.length){let i=[...t.colors];i.push(t.colors[9]);let n=[...t.steps];n.push(t.steps[9]);let r={...Sn(t),colors:i,steps:n};Object.assign(t,r)}})}function nG(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(n=>{"string"!=typeof n&&XD(n)}):"material"in i&&"string"!=typeof i.material&&XD(i.material)}),Object.values(e.shared.materials).forEach(t=>XD(t))}function rG(e){e.layers&&e.layers.forEach(t=>{"depth"===t.type&&void 0!==t.num&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function sG(e){e.layers&&e.layers.forEach(t=>{(function ZCe(e){return"displace"!==e.type})(t)&&void 0===t.isMask&&(t.isMask=!1),("texture"===t.type||"video"===t.type)&&void 0===t.blending&&(t.blending=0),("noise"===t.type||"displace"===t.type&&"noise"===t.displacementType)&&(void 0===t.voronoiStyle&&(t.voronoiStyle=0),void 0===t.highCut&&(t.highCut=1),void 0===t.lowCut&&(t.lowCut=0),void 0===t.smoothness&&(t.smoothness=.3),void 0===t.seed&&(t.seed=0),void 0===t.quality&&(t.quality=1))})}function oG(e){let t=e.layers.find(i=>"light"===i.type)?.data;if("basic"===t?.category){let i=ms.defaultData("light","phong"),n=t;Object.assign(n,i),n.visible=!1}}function aG(e){Lc(e,oG),Nc(e,oG)}function lG(e){e.layers.forEach(t=>{"light"===t.type&&"toon"!==t.category&&void 0===t.occlusion&&(t.occlusion=!0)})}function cG(e){e.layers&&e.layers.forEach(t=>{"light"===t.type&&void 0===t.bumpMapIntensity&&(t.bumpMapIntensity=5)})}function uG(e){e.layers&&e.layers.forEach(t=>{"light"===t.type&&void 0===t.alphaOverride&&(t.alphaOverride=1)})}(e=>{e.defaultData={enabled:!1,useBackgroundColor:!1,color:Yr.white,near:.1,far:2e3}})(kD||(kD={})),(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focalLength:2,focusDistance:2,bokehScale:2},noise:{...t,blendFunction:16}}})(iw||(iw={})),(e=>{e.defaultData={softShadowQuality:"low"}})(FD||(FD={})),(e=>{e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75}})(BD||(BD={})),(e=>{e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}}})(VD||(VD={})),(e=>{e.defaultData={usePhysics:!1,gravity:-10}})(Np||(Np={})),(e=>{e.defaultData={playCamera:Tp,gameControlObject:null}})(zD||(zD={})),(e=>{e.defaultData={backgroundColor:Ho.fromHexAndA(2960946,1),postprocessing:iw.defaultData,fog:kD.defaultData,globalPhysics:Np.defaultData,ambient:BD.defaultData,ao:VD.defaultData,shadow:FD.defaultData,publish:zD.defaultData}})(UD||(UD={})),(e=>{e.isComponentRelated=function t(n){return"Component"===n||"Instance"===n},e.isEmptyOrComponent=function i(n){return"Empty"===n||"Instance"===n}})(K5||(K5={})),(e=>{e.identity={...AD.identity,hiddenMatrix:Pp.identity},e.fromObject=function t(r){return{position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix}},e.merge=function i(r,s){return{position:s?.position||r.position,rotation:s?.rotation||r.rotation,scale:s?.scale||r.scale,hiddenMatrix:s?.hiddenMatrix||r.hiddenMatrix}},e.diff=function n(r,s){return function nCe(e){for(let t of Object.keys(e))void 0===e[t]&&delete e[t];return e}({position:th.isEqual(r.position,s.position)?void 0:s.position,rotation:th.isEqual(r.rotation,s.rotation)?void 0:s.rotation,scale:th.isEqual(r.scale,s.scale)?null:s.scale,hiddenMatrix:Pp.isEqual(r.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}})(kp||(kp={})),(e=>{e.defaultData={states:new rt,events:new rt,visible:!0,raycastLock:!1,physics:Op.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...kp.identity,cloner:null}})(Xr||(Xr={})),(e=>{e.defaultData={type:"Empty",...Xr.defaultData}})(jD||(jD={})),(e=>{e.defaultData={type:"Component",...Xr.defaultData}})($5||($5={})),(e=>{e.defaultData={type:"Mesh",...Xr.defaultData,...OD.defaultData}})(Fp||(Fp={})),(e=>{e.defaultData={...Xr.defaultData,...kp.identity,position:[0,0,Rp.DefaultTargetOffset],...Rp.defaultData}})(ev||(ev={})),(e=>{e.defaultData=function t(i){return{...Xr.defaultData,...ID.defaultData(i)}},e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(HD||(HD={})),(e=>{function t(n,r,s=0){for(;s<r.length;){let o=n?n[r[s]]:void 0;if(r.length===s+1)return o;if(!o)return;n=o.descendants,s+=1}}e.resolveWithDes=t,e.resolve=function i(n,r,s=0){let o=t(n,r,s);if(o){let a=Object.keys(o);if(1===a.length&&"descendants"===a[0])return}return o}})(nw||(nw={})),(e=>{function t(n,r){return{...Xr.defaultData,...r,component:n,overrides:new Vn,physics:void 0,events:void 0,type:"Instance"}}e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"],e.ofComponent=t,e.fromComponentData=function i(n){let r=kp.fromObject(n.data);return t(n.id,r)}})(Oc||(Oc={})),(e=>{e.defaultData={type:"Page",...Xr.defaultData,physics:{...Op.defaultData,fusedBody:!1},...UD.defaultData,camera:ev.defaultData}})(Bp||(Bp={})),(e=>{e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Pp.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:Op.defaultData,states:new rt,events:new rt,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...Rp.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Xr.defaultData,...Fp.defaultData,geometry:Lp.defaultData("RectangleGeometry"),material:br.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Xr.defaultData,...Fp.defaultData,geometry:Lp.defaultData("BooleanGeometry"),material:br.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Xr.defaultData,...Fp.defaultData,geometry:Lp.defaultData("TextGeometry"),material:br.defaultTwoLayerData("phong","layer1","layer2")}})(GD||(GD={})),(e=>{e.newEmpty=function t(s,o){let a={name:o};return"Mesh"===s.type?(a.geometry={},"material"in s&&(a.material={layers:new Vn}),"materials"in s&&(a.materials=s.materials.map(l=>({layers:new Vn})))):ih.is(s.type)&&(a.perspective={},a.orthographic={}),a},e.toOps=function n(s,o){let a,l=[],c={orthographic:0,perspective:0,geometry:0};function h(u,d){for(let[p,f]of Object.entries(d.layers)){let{texture:m,...g}=f;if(void 0!==m&&Object.keys(m).length>0){let v={path:[...u,"layers",p,"texture"],props:m,type:0};l.push(v)}if(Object.keys(g).length>0){let v={path:[...u,"layers",p],props:g,type:0};l.push(v)}}}for(let[u,d]of Object.entries(o))if("name"!==u)if("cloner"===u)l.push(...DD.toOps(d,["cloner"]));else if("pathSnapping"===u)l.push({path:[u],props:{slide:d.slide,offset:d.offset},type:0});else if("material"===u)h(["material"],d);else if("materials"===u)for(let[p,f]of Object.entries(d))h(["materials",p],f);else 0===c[u]?("geometry"===u&&void 0!==d.extrusion&&(l.push({path:[u,"extrusion"],props:d.extrusion,type:0}),d={...d},delete d.extrusion),Object.keys(d).length>0&&l.push({path:[u],props:d,type:0})):(void 0===a&&(a={path:[],props:{},type:0},l.push(a)),a.props[u]=d);return l},e.patch=function r(s,o){if(void 0===o)return s;let a={...s};if(Object.assign(a,kp.merge(a,o)),Object.assign(a,{pathSnapping:Object.assign({},a.pathSnapping,{slide:o.pathSnapping?.slide??a.pathSnapping?.slide??0,offset:o.pathSnapping?.offset??a.pathSnapping?.offset??0})}),ih.is(s.type)){a.orthographic={...a.orthographic},a.perspective={...a.perspective};let l=o;void 0!==l.orthographic?.zoom&&(a.orthographic.zoom=l.orthographic.zoom),void 0!==l.perspective?.zoom&&(a.perspective.zoom=l.perspective.zoom),void 0!==l.isUpVectorFlipped&&(a.isUpVectorFlipped=l.isUpVectorFlipped),void 0!==l.targetOffset&&(a.targetOffset=l.targetOffset)}else if("Mesh"===s.type)"geometry"in o&&Object.assign(a,{geometry:ND.merge(a.geometry,o.geometry)}),(o.material||o.materials)&&(a=function i(s,o){if(void 0===o)return s;let a={...s};return"material"in a&&"material"in o&&o.material&&(a.material=Kg(a.material,l=>{if("string"!=typeof l)for(let[c,h]of Object.entries(o.material.layers)){let u=l.layers.data(c);u&&ms.patch(u,h)}}).data),a.materials&&o.materials&&(a.materials=Kg(a.materials,l=>{for(let c=0;c<a.materials.length;c++){let h=o.materials[c];if("string"!=typeof h)for(let[u,d]of Object.entries(h.layers)){let p=l[c]?.layers?.data(u);p&&ms.patch(p,d)}}}).data),a}(a,o)),a.cloner&&"cloner"in o&&Object.assign(a,{cloner:Rc.merge(a.cloner,o.cloner)});else if("Empty"===s.type)a.cloner&&"cloner"in o&&Object.assign(a,{cloner:Rc.merge(a.cloner,o.cloner)});else if(TD.is(s.type)){let l=o;void 0!==l.intensity&&(a.intensity=l.intensity),void 0!==l.color&&(a.color="string"==typeof l.color?l.color:Yr.clone(l.color))}return a}})(nh||(nh={})),(e=>{e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0}})(rw||(rw={})),(e=>{e.defaultData={orbitControls:rw.defaultData,playPage:Jg,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let n=0,r=0;return i<5?r=-30:i<10&&(r=30),0===i||10===i||5===i?n=30:(4===i||11===i||9===i)&&(n=-30),[120,[n,r],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1}})(rh||(rh={})),(e=>{e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""}})(WD||(WD={})),(e=>{e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0}})(qD||(qD={})),(e=>{e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...WD.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:qD.defaultData}),e.generateSeed=()=>Math.round(1e5*Math.random())})(Vp||(Vp={})),(e=>{e.physicsEnabled=function t(n){return void 0!==n.find(r=>"Page"===r.data.type&&r.data.globalPhysics.usePhysics)},e.traverseModuleInstances=function i(n,r,s){n.scene.objects.traverseFrom(r,(o,a)=>{if("Instance"===a.type){let l=lw.getComponentData(n,a.component)?.data;l&&s(o,a,l.events)}else s(o,a,a.events)})}})(tv||(tv={})),(e=>{function t(r={withLight:!0,withSquare:!0}){let s=[],o=GD.defaultMeshObject;!0===r.withLight&&s.push({fi:-1,data:HD.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),!0===r.withSquare&&s.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]});let a=new ps;return a.push({fi:1,id:Jg,data:{...Bp.defaultData,name:"Scene 1"},children:s}),a}function i(r){return{...e.defaultData,objects:Il(r,ps.prototype)}}e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultData={objects:t(),publish:rh.defaultData,styles:Vp.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new ps,publish:rh.defaultData,styles:Vp.defaultData()}},e.emptyDataWithPage=function(r){return{objects:t(r),publish:rh.defaultData,styles:Vp.defaultData()}},e.withObjs=i,e.withObj=function n(r,s){return i([{id:r,data:s,children:[],fi:0}])}})(zp||(zp={})),(e=>{e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}}})(iv||(iv={})),(e=>{e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"}})(sw||(sw={})),(e=>{function t(o){return void 0!==o.textValue}function n(o){return"boolean"==typeof o}e.isTextValue=t,e.isNumber=function i(o){return"number"==typeof o},e.isBoolean=n,e.typeOfVariable=function r(o){return t(o)?"string":n(o)?"boolean":"number"},e.getDisplayedValue=function s(o){return e.isTextValue(o)?Array.isArray(o.textValue)?o.textValue.map(a=>a.toString().padStart(o.padding??2,"0")).join(o.deliminator??":")+(void 0!==o.suffix?" "+o.suffix:""):o.textValue.toString():e.isBoolean(o)?o?"True":"False":e.isNumber(o)?parseFloat(o.toFixed(3)).toString():o.toString()}})(Us||(Us={})),(e=>{e.all=["images","videos","colors","audios","fonts","materials","variables"]})(YD||(YD={})),(e=>{e.all=[...YD.all,"components"]})(J5||(J5={})),(e=>{e.defaultData=function t(){return{images:new Pt,videos:new Pt,colors:new Pt,audios:new Pt,fonts:new Pt,materials:new Pt,components:new Pt,variables:new Pt}}})(eG||(eG={})),(e=>{e.defaultData=function t(){return{images:new Pt,videos:new Pt,colors:new Pt,audios:new Pt,fonts:new Pt,materials:new Pt,components:new Pt,variables:new Pt}}})(Up||(Up={})),(e=>{e.defaultColors=function t(){return Il({"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}},Pt.prototype)},e.defaultImages=function i(o){let a={};return o?.withAITexture&&(a["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...sw.emptyImage,name:"AI generated image"}),Il(a,Pt.prototype)},e.emptyData=function n(){return{catelogs:new Pt,materials:new Pt,images:new Pt,videos:new Pt,colors:new Pt,audios:new Pt,fonts:new Pt,variables:new rt,lib:Up.defaultData()}},e.defaultVariables=function r(o){switch(o){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let a=[0,0,0];return{name:"Time",value:{textValue:a,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:a,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",o)}},e.getFormattedTimerTime=function s(o,a){if("HH:mm:ss"===a.format){let l=Math.floor(o/3600),c=Math.floor((o-3600*l)/60);return{textValue:[l,c,Math.round(o-3600*l-60*c)]}}if("mm:ss"===a.format){let l=Math.floor(o/60);return{textValue:[l,Math.round(o-60*l)]}}return"number"===a.format?Math.round(o):Math.round(1e3*o)/1e3}})(Go||(Go={})),(e=>{e.list=["idle","move","jump","run"]})(ow||(ow={})),(e=>{e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"],["run","\u21e7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new rt,move:new rt,jump:new rt,run:new rt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Ho.fromHexAndA(3728051,1)}}})(aw||(aw={}));var jp=180/Math.PI;function hG(e){e.rotation=e.rotation.slice(0,3).map(t=>t*jp)}function dG(e){hG(e),"Page"===e.type&&hG(e.camera),e.states?.forEach(i=>{null==i.rotation||(i.rotation=i.rotation.slice(0,3).map(n=>n*jp))});let t=e.geometry;t&&"SphereGeometry"===t.type&&(t.thetaLength=(t.thetaLength??180)*jp),t&&"TorusGeometry"===t.type&&(t.arc=t.arc*jp),t&&"PathGeometry"===t.type&&(t.extrusion.angle*=jp,t.extrusion.twist*=jp),"Mesh"===e.type&&"TextGeometry"===e.geometry.type&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(Sn(e.events))&&e.events?.forEach(i=>{("MouseDown"===i.type||"MouseUp"===i.type||"MousePress"===i.type||"KeyDown"===i.type||"KeyUp"===i.type||"KeyPress"===i.type||"Collision"===i.type||"Trigger"===i.type)&&(i.runMode=i.toggle?"Toggle":"Once")})}var lw,kc=107;function pG(e,t){t(e.data);for(let i of e.children)pG(i,t)}function FEe(e){let t=e.schema??104;t!==kc&&t<105&&(pG(e.asset,dG),e.schema=105)}function fG(e){let t=e.schema??0;if(t!==kc){console.warn("updating from ",t,"to ",kc),function OEe(e,t){if(t<1&&(Nc(e,tG),Lc(e,tG),e.schema=1),t<2&&(function KCe(e){Object.assign(e.scene.publish,{orbitControls:{...rw.defaultData,...Sn(e.scene.publish.orbitControls)}})}(e),e.schema=2),t<3&&(function JCe(e){function t(i){if(i.layers)for(let n of Object.values(i.layers))if(n)for(let[r,s]of Object.entries(n))if((q5.includes(r)||"boolean"==typeof s)&&delete n[r],"texture"===r)for(let[o,a]of Object.entries(s))(QCe.includes(o)||"boolean"==typeof a)&&delete s[o]}e.scene.objects.traverse((i,n)=>{n.states.forEach(r=>{let s=r;s.material?t(s.material):s.materials&&s.materials.forEach(o=>{t(o)})})})}(e),e.schema=3),t<4&&(function eEe(e){e.scene.publish.withBackground=!0}(e),e.schema=4),t<5&&(function tEe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(e),e.schema=5),t<6&&(function iEe(e){e.scene.objects.traverse((t,i)=>{let n=i.cloner;n&&(n.radial.scale=n.radial.scale.map(r=>r+1),n.linear.scale=n.linear.scale.map(r=>r+1))})}(e),e.schema=6),t<7&&(function nEe(e){e.scene.objects.traverse((t,i)=>{let n=i.geometry;n&&("DodecahedronGeometry"===n.type||"IcosahedronGeometry"===n.type)&&(n.detail=Math.round(n.detail))})}(e),e.schema=7),t<8&&(e.schema=8),t<9&&(nG(e),e.schema=9),t<10&&(function aEe(e){e.scene.objects.traverse((t,i)=>{"Mesh"===i.type&&("BooleanGeometry"===i.geometry.type||"SubdivGeometry"===i.geometry.type)&&(i.geometry.phongAngle=35)})}(e),e.schema=10),t<11&&(function lEe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{("DirectionalLight"===i.type||"SpotLight"===i.type)&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}(e),e.schema=11),t<12&&(nG(e),e.schema=12),t<13&&(function cEe(e){e.shared.audios=Il({},Pt.prototype)}(e),e.schema=13),t<14&&(function hEe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,n])=>{n.layers||Object.assign(t,{[i]:{name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]}})})}(e),e.schema=14),t<15&&(function dEe(e){Object.entries(Sn(e.shared.images)).filter(t=>!1===t[1].asset).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Sn(e.shared.audios)).filter(t=>!1===t[1].asset).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}(e),e.schema=15),t<16&&(function pEe(e){e.scene.publish.settings.web.preload=!1}(e),e.schema=16),t<17&&(Nc(e,rG),Lc(e,rG),e.schema=17),t<18&&(Nc(e,iG),Lc(e,iG),e.schema=18),t<19&&(function $Ce(e){Object.assign(e.scene.publish.settings,{video:{...rh.defaultData.settings.video,...Sn(e.scene.publish.settings.video)}})}(e),e.schema=19),t<20&&(function fEe(e){e.shared.fonts=Il({},Pt.prototype)}(e),function gEe(e){let t=[];e.scene.objects.traverse((i,n)=>{let r=n;if("TextFrame"===r.type){let s=br.defaultTwoLayerData("phong"),o="string"==typeof r.color?e.shared.colors[r.color]:r.color;s.layers[1].data.color={r:o.r,g:o.g,b:o.b},s.layers[1].data.alpha=r.alpha;let a=function mEe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}(r.font);void 0===e.shared.fonts[a]&&(e.shared.fonts[a]={name:a});let l={name:r.name,...Xr.defaultData,...Fp.defaultData,flatShading:!1,wireframe:!1,geometry:{...Lp.defaultData("TextGeometry"),width:r.width,height:r.height,font:a,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:1.40625*r.fontSize,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Sn(r.states),events:Sn(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix},c=Sn(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}(e),e.schema=20),t<21&&(function vEe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,n)=>{n.events.forEach(r=>{if(t[Number(r.type)])if(Object.assign(r,{type:t[Number(r.type)]}),"Audio"===r.type&&"audioEvent"in r&&(Object.assign(r,{playAudio:r.audioEvent}),delete r.audioEvent),"GameControl"===r.type)Object.assign(r,{gameActions:{idle:new rt,move:new rt,jump:new rt}});else{let s=new rt;Object.assign(r,{actions:s}),("MouseDown"===r.type||"MouseUp"===r.type||"KeyDown"===r.type||"KeyUp"===r.type)&&"url"in r&&s.push({fi:0,id:qe.generateUUID(),data:{type:"Link",url:r.url,delay:0}}),"targets"in r&&(r.targets.forEach((o,a,l)=>{let h={easing:o.easing,duration:o.duration};6===o.easing?Object.assign(h,Tl(o,"mass","stiffness","damping","velocity")):5===o.easing&&Object.assign(h,{control1:{...o.control1},control2:{...o.control2}});let d={state:o.state,repeat:o.repeat?-1:0,delay:o.delay,delayDirection:o.delayDirection,direction:o.cycle&&o.rewind?"pingpong-rewind":o.cycle?"pingpong":"normal",...h},p={allowSlerp:!0,type:"Transition",object:o.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new rt({fi:0,id:qe.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:qe.generateUUID(),data:d})};s.push({fi:l,id:a,data:p})}),delete r.targets)}})})}(e),function yEe(e){e.scene.objects.traverse((t,i)=>{function n(r,s){let o=new rt,a=[];if(i.events.forEach((l,c,h)=>{if("Audio"===l.type&&l.trigger===s){let u;a.push(c),"play"===l.interaction?u={...Tl(l,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in l?l.after:void 0,toggle:"after"in l?l.toggle:void 0,type:"Audio"}:("pause"===l.interaction||"stop"===l.interaction)&&(u={...Tl(l,"interaction","delay","object","playAudio"),type:"Audio"}),u&&o.push({fi:h,id:c,data:u})}}),a.forEach(l=>i.events.delete(l)),o.length){let l=i.events.find(c=>c.type===r)?.data;l?"actions"in l&&l.actions.insertBefore(null,o):i.events.insertBefore(null,[{id:qe.generateUUID(),data:{type:r,actions:o}}])}}n("Start","start"),n("MouseDown","mouseDown"),n("MouseUp","mouseUp"),n("KeyDown","keyDown"),n("KeyUp","keyUp")})}(e),e.schema=21),t<22&&(aG(e),e.schema=22),t<23&&(function _Ee(e){e.scene.objects.traverse((t,i)=>{"Mesh"===i.type&&"SubdivGeometry"===i.geometry.type&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}(e),e.schema=23),t<24&&(function bEe(e){e.scene.objects.traverse((t,i)=>{("Empty"===i.type||"Mesh"===i.type)&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}(e),e.schema=24),(t<25||void 0===e.shared.videos)&&(function uEe(e){e.shared.videos=Il({},Pt.prototype)}(e),t<25&&(e.schema=25)),t<26&&(function rEe(e){e.scene.objects.traverse((t,i)=>{let n=e.scene.objects.unproxy().parent(t);if(n){let r=Sn(e.scene.objects.data(n));r&&"Mesh"===r.type&&"BooleanGeometry"===r.geometry.type&&"Mesh"===i.type&&(i.visible=!0!==Sn(i).booleanExclude)}})}(e),e.schema=26),t<27&&(function sEe(e){e.scene.objects.traverse((t,i)=>{if("Mesh"===i.type){let n=i;"NonParametricGeometry"===i.geometry.type?void 0!==n.material&&delete n.material:void 0!==n.materials&&delete n.materials}})}(e),e.schema=27),t<28&&(aG(e),e.schema=28),t<29&&(function oEe(e){function t(n){Object.setPrototypeOf(n,Vn.prototype),n.texture&&Object.setPrototypeOf(n.texture,Vn.prototype)}function i(n){Object.setPrototypeOf(n,Vn.prototype);for(let r in n)t(n[r])}e.scene.objects.traverse((n,r)=>{r.states.forEach(s=>{let o=s;if(o.material){let a=Sn(o.material).layers;i(a),o.material.layers=a}if(o.materials)for(let a=0;a<o.materials.length;a++){let l=o.materials[a],c=Sn(l).layers;i(c),l.layers=c}})})}(e),e.schema=29),t<30&&(function wEe(e){e.scene.objects.traverse((t,i)=>{"Mesh"===i.type&&"NonParametricGeometry"===i.geometry.type&&!("material"in i)&&!("materials"in i)&&(i.material=br.defaultTwoLayerData("phong"))})}(e),e.schema=30),t<31&&(function xEe(e){void 0===e.scene.publish.orbitControls.autoZoom&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{("OrthographicCamera"===i.type||"PerspectiveCamera"===i.type)&&(void 0===i.orthographic.autoZoom&&(i.orthographic.autoZoom=!1),void 0===i.orthographic.autoZoomFrustumSize&&(i.orthographic.autoZoomFrustumSize=790))})}(e),e.schema=31),t<33&&(function SEe(e){e.scene.objects.traverse((t,i)=>{void 0===i.pathSnapping&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===i.pathSnapping.offset&&(i.pathSnapping.offset=0)})}(e),e.schema=33),t<34&&(function CEe(e){void 0===e.scene.publish.mouseEventTarget&&(e.scene.publish.mouseEventTarget="canvas"),void 0===e.scene.publish.settings.web.hint&&(e.scene.publish.settings.web.hint=!1)}(e),e.schema=34),t<35&&(function EEe(e){let{video:t}=e.scene.publish.settings;"gif"===t.format&&t.fps>48&&(t.fps=15)}(e),e.schema=35),t<36&&(function MEe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&(n.resetYPosition=Math.abs(n.resetYPosition-i.position[1]))})})}(e),e.schema=36),t<37&&(function AEe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,n)=>{n.collision=(!t||null!==n.physics)&&"visibility"})}(e),e.schema=37),t<38&&(Nc(e,sG),Lc(e,sG),e.schema=38),t<39&&(function DEe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&(n.navmesh=aw.defaultDataThirdPerson.navmesh)})})}(e),e.schema=39),t<40&&(function TEe(e){e.scene.styles||(e.scene.styles=Vp.defaultData())}(e),e.schema=40),t<41&&(function IEe(e){void 0===e.scene.environment.ambientLight.occlusion&&(e.scene.environment.ambientLight.occlusion=!1),void 0===e.scene.environment.ambientLight.aoFullRes&&(e.scene.environment.ambientLight.aoFullRes=!1),void 0===e.scene.environment.ambientLight.radius&&(e.scene.environment.ambientLight.radius=256),void 0===e.scene.environment.ambientLight.bias&&(e.scene.environment.ambientLight.bias=.5),void 0===e.scene.environment.ambientLight.aoColor&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Nc(e,lG),Lc(e,lG)}(e),e.schema=41),t<42&&(function PEe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&Object.assign(n.gameActions,{run:new rt})})})}(e),e.schema=42),t<43&&(function REe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(n=>{"GameControl"===n.type&&(n.keyAssignments=[...n.keyAssignments,["run","\u21e7"],["none","Ctrl"]])})})}(e),e.schema=43),t<99){Nc(e,cG),Lc(e,cG),null===e.scene.publish.playCamera&&(e.scene.publish.playCamera=Tp);let i=Sn(e.scene.objects),n=e.scene.objects;e.scene.publish.playPage=Jg,n.insertBefore(null,null,[{id:Jg,data:{...Bp.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Tl(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Tl(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...Np.defaultData,...Tl(e.scene.environment,"usePhysics","gravity")},camera:Sn(e.scene.ownerCamera)??Bp.defaultData.camera,name:"Scene"},children:[]}]);for(let o of i)o.id!==zp.TRASH_CAN_ID&&n.move(Jg,o.fi,o.id);let r=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((o,a)=>{"DirectionalLight"===a.type?(a.penumbraSize=e.shared.penumbraSize[Math.min(r,2)],r+=1):"SpotLight"===a.type&&(a.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),null==a.physics&&"Instance"!==a.type&&(a.physics={},Object.assign(a.physics,Op.defaultData)),null!=a.physics&&(a.physics.enabled=a.collision??"visibility",delete a.collision)}),e.schema=99}}(e,t),t<100&&(void 0===e.scene.publish.joystickSizeAndXYOffset&&(e.scene.publish.joystickSizeAndXYOffset=rh.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Nc(e,uG),Lc(e,uG),e.schema=101),t<102&&(function LEe(e){e.scene.objects.traverse((t,i)=>{let n=i.geometry;n&&"PathGeometry"===n.type&&(n.extrusion.capType="flat",n.extrusion.bevel=50,n.extrusion.bevelSides=6,"Custom"===n.extrusion.shape.type&&(n.extrusion.shape.shapeQuality="low"))})}(e),e.schema=102),t<104&&(e.shared.catelogs=new Pt,e.shared.lib=Up.defaultData(),e.schema=104),t<105&&(function NEe(e){e.shared.variables=Il({},Pt.prototype)}(e),e.scene.objects.traverse((i,n)=>{dG(n)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))FEe(i);t<106&&(function kEe(e){let t=Sn(e.shared.variables);e.shared.variables=Il(Object.entries(t??{}).map(([i,n],r)=>({fi:r,id:i,data:n})),rt.prototype)}(e),e.schema=106),t<107&&(e.shared.lib.variables=Up.defaultData().variables,e.schema=107)}}function sh(e,t=!1){let i=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),s={},o={},a=e[0].morphTargetsRelative,l=new Ze,c=0;for(let h=0;h<e.length;++h){let u=e[h],d=0;if(i!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in u.attributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[p]&&(s[p]=[]),s[p].push(u.attributes[p]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in u.morphAttributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[p]&&(o[p]=[]),o[p].push(u.morphAttributes[p])}if(t){let p;if(i)p=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;p=u.attributes.position.count}l.addGroup(c,p,h),c+=p}}if(i){let h=0,u=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let f=0;f<p.count;++f)u.push(p.getX(f)+h);h+=e[d].attributes.position.count}l.setIndex(u)}for(let h in s){let u=mG(s[h]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,u)}for(let h in o){let u=o[h][0].length;if(0===u)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let d=0;d<u;++d){let p=[];for(let m=0;m<o[h].length;++m)p.push(o[h][m][d]);let f=mG(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(f)}}return l}function mG(e){let t,i,n,r=0;for(let a=0;a<e.length;++a){let l=e[a];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=l.normalized),n!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=l.array.length}let s=new t(r),o=0;for(let a=0;a<e.length;++a)s.set(e[a].array,o),o+=e[a].array.length;return new st(s,i,n)}(e=>{e.defaultData={schema:kc,scene:zp.defaultData,frames:(new Pt).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",iv.defaultData),shared:{...Go.emptyData(),colors:Go.defaultColors()}},e.emptyDataForImports=function(r){let s=zp.emptyDataWithPage(r);return{schema:kc,scene:s,frames:(new Pt).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",iv.defaultData),shared:{...Go.emptyData(),colors:Go.defaultColors(),images:Go.defaultImages(r)}}},e.emptyData=function(){return{schema:kc,scene:zp.emptyDataWithPage(),frames:(new Pt).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",iv.defaultData),shared:Go.emptyData()}},e.collabHelper={...sD,updateSchema:r=>(r.schema??0)<kc?Kg(r,fG):(r.schema??0)-kc},e.updateSchemaDirectly=function t(r){let s=e.collabHelper.updateSchema(r);return"number"==typeof s?0===s?r:null:s.data},e.withoutLib=function i(r){return{...r,shared:{...r.shared,lib:Up.defaultData()}}},e.getComponentData=function n(r,s){let o=r.scene.objects.get(s);if(o&&"Component"===o.data.type)return o;{let a=r.shared.lib.components[s];if(a)return a.asset}}})(lw||(lw={}));var BEe=Math.pow(2,-24),cw=class{constructor(){}};function Ia(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function gG(e){let t=-1,i=-1/0;for(let n=0;n<3;n++){let r=e[n+3]-e[n];r>i&&(i=r,t=n)}return t}function vG(e,t){t.set(e)}function yG(e,t,i){let n,r;for(let s=0;s<3;s++){let o=s+3;n=e[s],r=t[s],i[s]=n<r?n:r,n=e[o],r=t[o],i[o]=n>r?n:r}}function uw(e,t,i){for(let n=0;n<3;n++){let r=t[e+2*n],s=t[e+2*n+1],o=r-s,a=r+s;o<i[n]&&(i[n]=o),a>i[n+3]&&(i[n+3]=a)}}function nv(e){let t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return 2*(t*i+i*n+n*t)}function ZD(e,t,i,n,r=null){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==r;for(let y=6*t,_=6*(t+i);y<_;y+=6){let b=e[y+0],w=e[y+1],C=b-w,x=b+w;C<s&&(s=C),x>l&&(l=x),v&&b<u&&(u=b),v&&b>f&&(f=b);let S=e[y+2],E=e[y+3],D=S-E,T=S+E;D<o&&(o=D),T>c&&(c=T),v&&S<d&&(d=S),v&&S>m&&(m=S);let I=e[y+4],P=e[y+5],R=I-P,L=I+P;R<a&&(a=R),L>h&&(h=L),v&&I<p&&(p=I),v&&I>g&&(g=I)}n[0]=s,n[1]=o,n[2]=a,n[3]=l,n[4]=c,n[5]=h,v&&(r[0]=u,r[1]=d,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}var HEe=(e,t)=>e.candidate-t.candidate,Fc=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),hw=new Float32Array(6);var Pa=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,s=e.length;r<s;r++){let o=e[r][t];i=o<i?o:i,n=o>n?o:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,s=t.length;r<s;r++){let a=e.dot(t[r]);i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}};Pa.prototype.setFromBox=function(){let e=new M;return function(t,i){let n=i.min,r=i.max,s=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=n.x*a+r.x*(1-a),e.y=n.y*l+r.y*(1-l),e.z=n.z*c+r.z*(1-c);let h=t.dot(e);s=Math.min(h,s),o=Math.max(h,o)}this.min=s,this.max=o}}(),new Pa;var ZEe=function(){let e=new M,t=new M,i=new M;return function(n,r,s){let a=e,c=t;i.subVectors(n.start,r.start),e.subVectors(n.end,n.start),t.subVectors(r.end,r.start);let m,g,h=i.dot(c),u=c.dot(a),d=c.dot(c),p=i.dot(a),f=a.dot(a)*d-u*u;m=0!==f?(h*u-p*d)/f:0,g=(h+m*u)/d,s.x=m,s.y=g}}(),QD=function(){let e=new z,t=new M,i=new M;return function(n,r,s,o){ZEe(n,r,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1)return n.at(a,s),void r.at(l,o);if(a>=0&&a<=1)return r.at(l<0?0:1,o),void n.closestPointToPoint(o,!0,s);if(l>=0&&l<=1)return n.at(a<0?0:1,s),void r.closestPointToPoint(s,!0,o);{let c,h;c=a<0?n.start:n.end,h=l<0?r.start:r.end;let u=t,d=i;return n.closestPointToPoint(h,!0,t),r.closestPointToPoint(c,!0,i),u.distanceToSquared(h)<=d.distanceToSquared(c)?(s.copy(u),void o.copy(h)):(s.copy(c),void o.copy(d))}}}(),QEe=function(){let e=new M,t=new M,i=new Fs,n=new oo;return function(r,s){let{radius:o,center:a}=r,{a:l,b:c,c:h}=s;if(n.start=l,n.end=c,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o||(n.start=l,n.end=h,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o)||(n.start=c,n.end=h,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o))return!0;let u=s.getPlane(i);if(Math.abs(u.distanceToPoint(a))<=o){let d=u.projectPoint(a,t);if(s.containsPoint(d))return!0}return!1}}();function Hp(e){return Math.abs(e)<1e-15}var Ol=class extends vr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new M),this.satBounds=new Array(4).fill().map(()=>new Pa),this.points=[this.a,this.b,this.c],this.sphere=new ds,this.plane=new Fs,this.needsUpdate=!0}intersectsSphere(e){return QEe(e,this)}update(){let e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,s=this.satBounds,o=r[0],a=s[0];this.getNormal(o),a.setFromPoints(o,n);let l=r[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,n);let h=r[2],u=s[2];h.subVectors(t,i),u.setFromPoints(h,n);let d=r[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}};Ol.prototype.closestPointToSegment=function(){let e=new M,t=new M,i=new oo;return function(n,r=null,s=null){let c,{start:o,end:a}=n,l=this.points,h=1/0;for(let u=0;u<3;u++){let d=(u+1)%3;i.start.copy(l[u]),i.end.copy(l[d]),QD(i,n,e,t),c=e.distanceToSquared(t),c<h&&(h=c,r&&r.copy(e),s&&s.copy(t))}return this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<h&&(h=c,r&&r.copy(e),s&&s.copy(o)),this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<h&&(h=c,r&&r.copy(e),s&&s.copy(a)),Math.sqrt(h)}}(),Ol.prototype.intersectsTriangle=function(){let e=new Ol,t=new Array(3),i=new Array(3),n=new Pa,r=new Pa,s=new M,o=new M,a=new M,l=new M,c=new oo,h=new oo,u=new oo;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let v=this.satBounds,y=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let w=0;w<4;w++){let C=v[w];if(n.setFromPoints(y[w],i),C.isSeparated(n))return!1}let _=d.satBounds,b=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let w=0;w<4;w++){let C=_[w];if(n.setFromPoints(b[w],t),C.isSeparated(n))return!1}for(let w=0;w<4;w++){let C=y[w];for(let x=0;x<4;x++)if(s.crossVectors(C,b[x]),n.setFromPoints(s,t),r.setFromPoints(s,i),n.isSeparated(r))return!1}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let v=this.points,y=!1,_=0;for(let P=0;P<3;P++){let R=v[P],L=v[(P+1)%3];c.start.copy(R),c.end.copy(L),c.delta(o);let j=y?h.start:h.end,F=Hp(g.distanceToPoint(R));if(Hp(g.normal.dot(o))&&F){h.copy(c),_=2;break}if((g.intersectLine(c,j)||F)&&!Hp(j.distanceTo(L))){if(_++,y)break;y=!0}}if(1===_&&d.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(2!==_)return!1;let b=d.points,w=!1,C=0;for(let P=0;P<3;P++){let R=b[P],L=b[(P+1)%3];c.start.copy(R),c.end.copy(L),c.delta(a);let j=w?u.start:u.end,F=Hp(m.distanceToPoint(R));if(Hp(m.normal.dot(a))&&F){u.copy(c),C=2;break}if((m.intersectLine(c,j)||F)&&!Hp(j.distanceTo(L))){if(C++,w)break;w=!0}}if(1===C&&this.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(2!==C)return!1;if(h.delta(o),u.delta(a),o.dot(a)<0){let P=u.start;u.start=u.end,u.end=P}let x=h.start.dot(o),S=h.end.dot(o),E=u.start.dot(o),D=u.end.dot(o);return(x===D||E===S||S<E!=x<D)&&(p&&(l.subVectors(h.start,u.start),l.dot(o)>0?p.start.copy(h.start):p.start.copy(u.start),l.subVectors(h.end,u.end),l.dot(o)<0?p.end.copy(h.end):p.end.copy(u.end)),!0)}}}(),Ol.prototype.distanceToPoint=function(){let e=new M;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Ol.prototype.distanceToTriangle=function(){let e=new M,t=new M,i=["a","b","c"],n=new oo,r=new oo;return function(s,o=null,a=null){let l=o||a?n:null;if(this.intersectsTriangle(s,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let u,d=i[h],p=s[d];this.closestPointToPoint(p,e),u=p.distanceToSquared(e),u<c&&(c=u,o&&o.copy(e),a&&a.copy(p));let f=this[d];s.closestPointToPoint(f,e),u=f.distanceToSquared(e),u<c&&(c=u,o&&o.copy(f),a&&a.copy(e))}for(let h=0;h<3;h++){n.set(this[i[h]],this[i[(h+1)%3]]);for(let p=0;p<3;p++){r.set(s[i[p]],s[i[(p+1)%3]]),QD(n,r,e,t);let g=e.distanceToSquared(t);g<c&&(c=g,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(c)}}();var Ra=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new M,this.max=new M,this.matrix=new ye,this.invMatrix=new ye,this.points=new Array(8).fill().map(()=>new M),this.satAxes=new Array(3).fill().map(()=>new M),this.satBounds=new Array(3).fill().map(()=>new Pa),this.alignedSatBounds=new Array(3).fill().map(()=>new Pa),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Ra.prototype.update=function(){let e=this.matrix,t=this.min,i=this.max,n=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){let d=n[1*l|2*c|4*h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=h?i.z:t.z,d.applyMatrix4(e)}let r=this.satBounds,s=this.satAxes,o=n[0];for(let l=0;l<3;l++){let c=s[l],h=r[l];c.subVectors(o,n[1<<l]),h.setFromPoints(c,n)}let a=this.alignedSatBounds;a[0].setFromPointsField(n,"x"),a[1].setFromPointsField(n,"y"),a[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Ra.prototype.intersectsBox=function(){let e=new Pa;return function(t){this.needsUpdate&&this.update();let i=t.min,n=t.max,r=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(e.min=i.x,e.max=n.x,o[0].isSeparated(e)||(e.min=i.y,e.max=n.y,o[1].isSeparated(e))||(e.min=i.z,e.max=n.z,o[2].isSeparated(e)))return!1;for(let a=0;a<3;a++){let c=r[a];if(e.setFromBox(s[a],t),c.isSeparated(e))return!1}return!0}}(),Ra.prototype.intersectsTriangle=function(){let e=new Ol,t=new Array(3),i=new Pa,n=new Pa,r=new M;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let o=this.satBounds,a=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let u=0;u<3;u++){let d=o[u];if(i.setFromPoints(a[u],t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,h=this.points;for(let u=0;u<3;u++){let d=l[u];if(i.setFromPoints(c[u],h),d.isSeparated(i))return!1}for(let u=0;u<3;u++){let d=a[u];for(let p=0;p<4;p++)if(r.crossVectors(d,c[p]),i.setFromPoints(r,t),n.setFromPoints(r,h),i.isSeparated(n))return!1}return!0}}(),Ra.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},Ra.prototype.distanceToPoint=function(){let e=new M;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Ra.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new oo),i=new Array(12).fill().map(()=>new oo),n=new M,r=new M;return function(s,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(a||l)&&(s.getCenter(r),this.closestPointToPoint(r,n),s.closestPointToPoint(n,r),a&&a.copy(n),l&&l.copy(r)),0;let c=o*o,h=s.min,u=s.max,d=this.points,p=1/0;for(let m=0;m<8;m++){let g=d[m];r.copy(g).clamp(h,u);let v=g.distanceToSquared(r);if(v<p&&(p=v,a&&a.copy(g),l&&l.copy(r),v<c))return Math.sqrt(v)}let f=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){let y=(m+1)%3,_=(m+2)%3;t[f].set(d[g<<y|v<<_],d[1<<m|g<<y|v<<_]);let S=e[m],E=e[y],D=e[_],T=i[f],I=T.start,P=T.end;I[S]=h[S],I[E]=g?h[E]:u[E],I[D]=v?h[D]:u[E],P[S]=u[S],P[E]=g?h[E]:u[E],P[D]=v?h[D]:u[E],f++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){r.x=m?u.x:h.x,r.y=g?u.y:h.y,r.z=v?u.z:h.z,this.closestPointToPoint(r,n);let y=r.distanceToSquared(n);if(y<p&&(p=y,a&&a.copy(n),l&&l.copy(r),y<c))return Math.sqrt(y)}for(let m=0;m<12;m++){let g=t[m];for(let v=0;v<12;v++){QD(g,i[v],n,r);let _=n.distanceToSquared(r);if(_<p&&(p=_,a&&a.copy(n),l&&l.copy(r),_<c))return Math.sqrt(_)}}return Math.sqrt(p)}}();var Gp=new M,Wp=new M,qp=new M,dw=new z,pw=new z,fw=new z,_G=new M,bG=new M,wG=new M,mw=new M;function xG(e,t,i,n,r){let s=3*n,o=e.index.getX(s),a=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:h,uv:u,uv1:d}=e.attributes,p=function JEe(e,t,i,n,r,s,o,a,l){Gp.fromBufferAttribute(t,s),Wp.fromBufferAttribute(t,o),qp.fromBufferAttribute(t,a);let c=function $Ee(e,t,i,n,r,s){let o;return o=s===qn?e.intersectTriangle(n,i,t,!0,r):e.intersectTriangle(t,i,n,s!==hs,r),null===o?null:{distance:e.origin.distanceTo(r),point:r.clone()}}(e,Gp,Wp,qp,mw,l);if(c){n&&(dw.fromBufferAttribute(n,s),pw.fromBufferAttribute(n,o),fw.fromBufferAttribute(n,a),c.uv=vr.getInterpolation(mw,Gp,Wp,qp,dw,pw,fw,new z)),r&&(dw.fromBufferAttribute(r,s),pw.fromBufferAttribute(r,o),fw.fromBufferAttribute(r,a),c.uv1=vr.getInterpolation(mw,Gp,Wp,qp,dw,pw,fw,new z)),i&&(_G.fromBufferAttribute(i,s),bG.fromBufferAttribute(i,o),wG.fromBufferAttribute(i,a),c.normal=vr.getInterpolation(mw,Gp,Wp,qp,_G,bG,wG,new M),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let h={a:s,b:o,c:a,normal:new M,materialIndex:0};vr.getNormal(Gp,Wp,qp,h.normal),c.face=h,c.faceIndex=s}return c}(i,c,h,u,d,o,a,l,t);return p?(p.faceIndex=n,r&&r.push(p),p):null}function Oa(e,t,i,n){let r=e.a,s=e.b,o=e.c,a=t,l=t+1,c=t+2;i&&(a=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),r.x=n.getX(a),r.y=n.getY(a),r.z=n.getZ(a),s.x=n.getX(l),s.y=n.getY(l),s.z=n.getZ(l),o.x=n.getX(c),o.y=n.getY(c),o.z=n.getZ(c)}function SG(e,t,i,n,r,s,o){let a=i.index,l=i.attributes.position;for(let c=e,h=t+e;c<h;c++)if(Oa(o,3*c,a,l),o.needsUpdate=!0,n(o,c,r,s))return!0;return!1}var CG=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Bc(e,t){return 65535===t[e+15]}function Yp(e,t){return t[e+6]}function rv(e,t){return t[e+14]}function sv(e){return e+8}function ov(e,t){return t[e+6]}var Xp=new ln,gw=new M,nMe=["x","y","z"];function KD(e,t,i,n,r){let s=2*e,o=Zp,a=Vc,l=zc;if(Bc(s,a))!function eMe(e,t,i,n,r,s){for(let o=n,a=n+r;o<a;o++)xG(e,t,i,o,s)}(t,i,n,Yp(e,l),rv(s,a),r);else{let c=sv(e);vw(c,o,n,gw)&&KD(c,t,i,n,r);let h=ov(e,l);vw(h,o,n,gw)&&KD(h,t,i,n,r)}}function $D(e,t,i,n){let r=2*e,s=Zp,o=Vc,a=zc;if(Bc(r,o))return function tMe(e,t,i,n,r){let s=1/0,o=null;for(let a=n,l=n+r;a<l;a++){let c=xG(e,t,i,a);c&&c.distance<s&&(o=c,s=c.distance)}return o}(t,i,n,Yp(e,a),rv(r,o));{let u,d,l=function iMe(e,t){return t[e+7]}(e,a),c=nMe[l],h=n.direction[c]>=0;h?(u=sv(e),d=ov(e,a)):(u=ov(e,a),d=sv(e));let p=vw(u,s,n,gw)?$D(u,t,i,n):null;if(p){let m=p.point[c];if(h?m<=s[d+l]:m>=s[d+l+3])return p}let f=vw(d,s,n,gw)?$D(d,t,i,n):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var rMe=function(){let e,t,i=[],n=new CG(()=>new ln);return function(...s){e=n.getPrimitive(),t=n.getPrimitive(),i.push(e,t);let o=r(...s);n.releasePrimitive(e),n.releasePrimitive(t),i.pop(),i.pop();let a=i.length;return a>0&&(t=i[a-1],e=i[a-2]),o};function r(s,o,a,l,c=null,h=0,u=0){function d(y){let _=2*y,b=Vc,w=zc;for(;!Bc(_,b);)_=2*(y=sv(y));return Yp(y,w)}function p(y){let _=2*y,b=Vc,w=zc;for(;!Bc(_,b);)_=2*(y=ov(y,w));return Yp(y,w)+rv(_,b)}let f=2*s,m=Zp,g=Vc,v=zc;if(Bc(f,g)){let y=Yp(s,v),_=rv(f,g);return Ia(s,m,e),l(y,_,!1,u,h+s,e)}{let C,x,S,E,y=sv(s),_=ov(s,v),b=y,w=_;if(c&&(S=e,E=t,Ia(b,m,S),Ia(w,m,E),C=c(S),x=c(E),x<C)){b=_,w=y;let j=C;C=x,x=j,S=E}S||(S=e,Ia(b,m,S));let I,T=a(S,Bc(2*b,g),C,u+1,h+b);if(2===T){let j=d(b);I=l(j,p(b)-j,!0,u+1,h+b,S)}else I=T&&r(b,o,a,l,c,h,u+1);if(I)return!0;E=t,Ia(w,m,E);let L,R=a(E,Bc(2*w,g),x,u+1,h+w);if(2===R){let j=d(w);L=l(j,p(w)-j,!0,u+1,h+w,E)}else L=R&&r(w,o,a,l,c,h,u+1);return!!L}}}(),sMe=function(){let e=new Ol,t=new Ol,i=new ye,n=new Ra,r=new Ra;return function s(o,a,l,c,h=null){let u=2*o,d=Zp,p=Vc,f=zc;if(null===h&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,c),h=n),!Bc(u,p)){let m=o+8,g=f[o+6];return Ia(m,d,Xp),!!(h.intersectsBox(Xp)&&s(m,a,l,c,h)||(Ia(g,d,Xp),h.intersectsBox(Xp)&&s(g,a,l,c,h)))}{let g=a.index,v=a.attributes.position,y=l.index,_=l.attributes.position,b=Yp(o,f),w=rv(u,p);if(i.copy(c).invert(),l.boundsTree)return Ia(o,d,r),r.matrix.copy(i),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:C=>r.intersectsBox(C),intersectsTriangle:C=>{C.a.applyMatrix4(c),C.b.applyMatrix4(c),C.c.applyMatrix4(c),C.needsUpdate=!0;for(let x=3*b,S=3*(w+b);x<S;x+=3)if(Oa(t,x,g,v),t.needsUpdate=!0,C.intersectsTriangle(t))return!0;return!1}});for(let C=3*b,x=w+3*b;C<x;C+=3){Oa(e,C,g,v),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let S=0,E=y.count;S<E;S+=3)if(Oa(t,S,y,_),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function vw(e,t,i,n){return Ia(e,t,Xp),i.intersectBox(Xp,n)}var yw,Zp,Vc,zc,JD=[];function av(e){yw&&JD.push(yw),yw=e,Zp=new Float32Array(e),Vc=new Uint16Array(e),zc=new Uint32Array(e)}function _w(){yw=null,Zp=null,Vc=null,zc=null,JD.length&&av(JD.pop())}var eT=Symbol("skip tree generation"),tT=new ln,iT=new ln,Qp=new ye,oh=new Ra,lv=new Ra,cv=new M,bw=new M,oMe=new M,aMe=new M,lMe=new M,EG=new ln,La=new CG(()=>new Ol),uv=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),uv.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};let s,n=e._roots,r=e.geometry.getIndex();return s=t.cloneBuffers?{roots:n.map(o=>o.slice()),index:r.array.slice()}:{roots:n,index:r.array},s}static deserialize(e,t,i={}){if("boolean"==typeof i)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),uv.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});i={setIndex:!0,...i};let{index:n,roots:r}=e,s=new uv(t,{...i,[eT]:!0});if(s._roots=r,i.setIndex){let o=t.getIndex();if(null===o){let a=new st(e.index,1,!1);t.setIndex(a)}else o.array!==n&&(o.array.set(n),o.needsUpdate=!0)}return s}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[eT]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[eT]||(this._roots=function XEe(e,t){let n,r,s,i=function YEe(e,t){function i(v){d&&d(v/p)}function n(v,y,_,b=null,w=0){if(!f&&w>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),_<=h||w>=l)return i(y+_),v.offset=y,v.count=_,v;let C=function GEe(e,t,i,n,r,s){let o=-1,a=0;if(0===s)o=gG(t),-1!==o&&(a=(t[o]+t[o+3])/2);else if(1===s)o=gG(e),-1!==o&&(a=function WEe(e,t,i,n){let r=0;for(let s=t,o=t+i;s<o;s++)r+=e[6*s+2*n];return r/i}(i,n,r,o));else if(2===s){let l=nv(e),c=1.25*r,h=6*n,u=6*(n+r);for(let d=0;d<3;d++){let p=t[d],f=(t[d+3]-p)/32;if(r<8){let m=[...Fc];m.length=r;let g=0;for(let y=h;y<u;y+=6,g++){let _=m[g];_.candidate=i[y+2*d],_.count=0;let{bounds:b,leftCacheBounds:w,rightCacheBounds:C}=_;for(let x=0;x<3;x++)C[x]=1/0,C[x+3]=-1/0,w[x]=1/0,w[x+3]=-1/0,b[x]=1/0,b[x+3]=-1/0;uw(y,i,b)}m.sort(HEe);let v=r;for(let y=0;y<v;y++){let _=m[y];for(;y+1<v&&m[y+1].candidate===_.candidate;)m.splice(y+1,1),v--}for(let y=h;y<u;y+=6){let _=i[y+2*d];for(let b=0;b<v;b++){let w=m[b];_>=w.candidate?uw(y,i,w.rightCacheBounds):(uw(y,i,w.leftCacheBounds),w.count++)}}for(let y=0;y<v;y++){let _=m[y],b=_.count,w=r-_.count,x=_.rightCacheBounds,S=0;0!==b&&(S=nv(_.leftCacheBounds)/l);let E=0;0!==w&&(E=nv(x)/l);let D=1+1.25*(S*b+E*w);D<c&&(o=d,c=D,a=_.candidate)}}else{for(let v=0;v<32;v++){let y=Fc[v];y.count=0,y.candidate=p+f+v*f;let _=y.bounds;for(let b=0;b<3;b++)_[b]=1/0,_[b+3]=-1/0}for(let v=h;v<u;v+=6){let y=~~((i[v+2*d]-p)/f);y>=32&&(y=31);let _=Fc[y];_.count++,uw(v,i,_.bounds)}let m=Fc[31];vG(m.bounds,m.rightCacheBounds);for(let v=30;v>=0;v--){let y=Fc[v];yG(y.bounds,Fc[v+1].rightCacheBounds,y.rightCacheBounds)}let g=0;for(let v=0;v<31;v++){let y=Fc[v],_=y.count,b=y.bounds,w=Fc[v+1].rightCacheBounds;0!==_&&(0===g?vG(b,hw):yG(b,hw,hw)),g+=_;let C=0,x=0;0!==g&&(C=nv(hw)/l);let S=r-g;0!==S&&(x=nv(w)/l);let E=1+1.25*(C*g+x*S);E<c&&(o=d,c=E,a=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}(v.boundingData,b,o,y,_,u);if(-1===C.axis)return i(y+_),v.offset=y,v.count=_,v;let x=function jEe(e,t,i,n,r){let s=i,o=i+n-1,a=r.pos,l=2*r.axis;for(;;){for(;s<=o&&t[6*s+l]<a;)s++;for(;s<=o&&t[6*o+l]>=a;)o--;if(!(s<o))return s;for(let c=0;c<3;c++){let h=e[3*s+c];e[3*s+c]=e[3*o+c],e[3*o+c]=h;let u=t[6*s+2*c+0];t[6*s+2*c+0]=t[6*o+2*c+0],t[6*o+2*c+0]=u;let d=t[6*s+2*c+1];t[6*s+2*c+1]=t[6*o+2*c+1],t[6*o+2*c+1]=d}s++,o--}}(a,o,y,_,C);if(x===y||x===y+_)i(y+_),v.offset=y,v.count=_;else{v.splitAxis=C.axis;let S=new cw,E=y,D=x-y;v.left=S,S.boundingData=new Float32Array(6),ZD(o,E,D,S.boundingData,s),n(S,E,D,s,w+1);let T=new cw,I=x,P=_-D;v.right=T,T.boundingData=new Float32Array(6),ZD(o,I,P,T.boundingData,s),n(T,I,P,s,w+1)}return v}!function VEe(e,t){if(!e.index){let r,i=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;r=i>65535?new Uint32Array(new n(4*i)):new Uint16Array(new n(2*i)),e.setIndex(new st(r,1));for(let s=0;s<i;s++)r[s]=s}}(e,t);let r=new Float32Array(6),s=new Float32Array(6),o=function qEe(e,t){let i=e.attributes.position,n=e.index.array,r=n.length/3,s=new Float32Array(6*r),o=i.normalized,a=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let h=["getX","getY","getZ"];for(let u=0;u<r;u++){let f,m,g,d=3*u,p=6*u;o?(f=n[d+0],m=n[d+1],g=n[d+2]):(f=n[d+0]*c+l,m=n[d+1]*c+l,g=n[d+2]*c+l);for(let v=0;v<3;v++){let y,_,b;o?(y=i[h[v]](f),_=i[h[v]](m),b=i[h[v]](g)):(y=a[f+v],_=a[m+v],b=a[g+v]);let w=y;_<w&&(w=_),b<w&&(w=b);let C=y;_>C&&(C=_),b>C&&(C=b);let x=(C-w)/2,S=2*v;s[p+S+0]=w+x,s[p+S+1]=x+(Math.abs(w)+x)*BEe,w<t[v]&&(t[v]=w),C>t[v+3]&&(t[v+3]=C)}}return s}(e,r),a=e.index.array,l=t.maxDepth,c=t.verbose,h=t.maxLeafTris,u=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,m=[],g=function zEe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let r of e.groups)i.add(r.start),i.add(r.start+r.count);let n=Array.from(i.values()).sort((r,s)=>r-s);for(let r=0;r<n.length-1;r++){let s=n[r];t.push({offset:s/3,count:(n[r+1]-s)/3})}return t}(e);if(1===g.length){let v=g[0],y=new cw;y.boundingData=r,function UEe(e,t,i,n){let r=1/0,s=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=6*t,u=6*(t+i);h<u;h+=6){let d=e[h+0];d<r&&(r=d),d>a&&(a=d);let p=e[h+2];p<s&&(s=p),p>l&&(l=p);let f=e[h+4];f<o&&(o=f),f>c&&(c=f)}n[0]=r,n[1]=s,n[2]=o,n[3]=a,n[4]=l,n[5]=c}(o,v.offset,v.count,s),n(y,v.offset,v.count,s),m.push(y)}else for(let v of g){let y=new cw;y.boundingData=new Float32Array(6),ZD(o,v.offset,v.count,y.boundingData,s),n(y,v.offset,v.count,s),m.push(y)}return m}(e,t),o=[],a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<i.length;h++){let u=i[h],p=new a(32*l(u));n=new Float32Array(p),r=new Uint32Array(p),s=new Uint16Array(p),c(0,u),o.push(p)}return o;function l(h){return h.count?1:1+l(h.left)+l(h.right)}function c(h,u){let d=h/4,p=h/2,f=!!u.count,m=u.boundingData;for(let g=0;g<6;g++)n[d+g]=m[g];if(f){let v=u.count;return r[d+6]=u.offset,s[p+14]=v,s[p+15]=65535,h+32}{let _,v=u.right,y=u.splitAxis;if(_=c(h+32,u.left),_/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=_/4,_=c(_,v),r[d+7]=y,_}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new ln))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let r,s,o,a,t=this.geometry,i=t.index.array,n=t.attributes.position,l=0,c=this._roots;for(let u=0,d=c.length;u<d;u++)r=c[u],s=new Uint32Array(r),o=new Uint16Array(r),a=new Float32Array(r),h(0,l),l+=r.byteLength;function h(u,d,p=!1){let f=2*u;if(65535===o[f+15]){let m=s[u+6],v=1/0,y=1/0,_=1/0,b=-1/0,w=-1/0,C=-1/0;for(let x=3*m,S=3*(m+o[f+14]);x<S;x++){let E=i[x],D=n.getX(E),T=n.getY(E),I=n.getZ(E);D<v&&(v=D),D>b&&(b=D),T<y&&(y=T),T>w&&(w=T),I<_&&(_=I),I>C&&(C=I)}return(a[u+0]!==v||a[u+1]!==y||a[u+2]!==_||a[u+3]!==b||a[u+4]!==w||a[u+5]!==C)&&(a[u+0]=v,a[u+1]=y,a[u+2]=_,a[u+3]=b,a[u+4]=w,a[u+5]=C,!0)}{let m=u+8,g=s[u+6],y=g+d,_=p,b=!1,w=!1;e?_||(b=e.has(m+d),w=e.has(y),_=!b&&!w):(b=!0,w=!0);let x=_||w,S=!1;(_||b)&&(S=h(m,d,_));let E=!1;x&&(E=h(g,d,_));let D=S||E;if(D)for(let T=0;T<3;T++){let I=m+T,P=g+T,R=a[I],L=a[I+3],j=a[P],F=a[P+3];a[u+T]=R<j?R:j,a[u+T+3]=L>F?L:F}return D}}}traverse(e,t=0){let i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);!function s(o,a=0){let l=2*o,c=65535===r[l+15];if(c){let h=n[o+6],u=r[l+14];e(a,c,new Float32Array(i,4*o,6),h,u)}else{let h=o+8,u=n[o+6],d=n[o+7];e(a,c,new Float32Array(i,4*o,6),d)||(s(h,a+1),s(u,a+1))}}(0)}raycast(e,t=No){let i=this._roots,n=this.geometry,r=[],s=t.isMaterial,o=Array.isArray(t),a=n.groups,l=s?t.side:t;for(let c=0,h=i.length;c<h;c++){let u=o?t[a[c].materialIndex].side:l,d=r.length;if(av(i[c]),KD(0,n,u,e,r),_w(),o){let p=a[c].materialIndex;for(let f=d,m=r.length;f<m;f++)r[f].face.materialIndex=p}}return r}raycastFirst(e,t=No){let i=this._roots,n=this.geometry,r=t.isMaterial,s=Array.isArray(t),o=null,a=n.groups,l=r?t.side:t;for(let c=0,h=i.length;c<h;c++){let u=s?t[a[c].materialIndex].side:l;av(i[c]);let d=$D(0,n,u,e);_w(),null!=d&&(null==o||d.distance<o.distance)&&(o=d,s&&(d.face.materialIndex=a[c].materialIndex))}return o}intersectsGeometry(e,t){let i=this.geometry,n=!1;for(let r of this._roots)if(av(r),n=sMe(0,i,e,t),_w(),n)break;return n}shapecast(e,t,i){let n=this.geometry;if(e instanceof Function){if(t){let u=t;t=(d,p,f,m)=>{let g=3*p;return u(d,g,g+1,g+2,f,m)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=La.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){let u=a;a=(d,p,f,m,g)=>!!u(d,p,f,m,g)||SG(d,p,n,l,f,m,r)}else a||(a=l?(u,d,p,f)=>SG(u,d,n,l,p,f,r):(u,d,p)=>p);let c=!1,h=0;for(let u of this._roots){if(av(u),c=rMe(0,n,o,a,s,h),_w(),c)break;h+=u.byteLength}return La.releasePrimitive(r),c}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i,s=this.geometry.index,o=this.geometry.attributes.position,a=e.geometry.index,l=e.geometry.attributes.position;Qp.copy(t).invert();let c=La.getPrimitive(),h=La.getPrimitive();if(r){let d=function(p,f,m,g,v,y,_,b){for(let w=m,C=m+g;w<C;w++){Oa(h,3*w,a,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let x=p,S=p+f;x<S;x++)if(Oa(c,3*x,s,o),c.needsUpdate=!0,r(c,h,x,w,v,y,_,b))return!0}return!1};if(n){let p=n;n=function(f,m,g,v,y,_,b,w){return!!p(f,m,g,v,y,_,b,w)||d(f,m,g,v,y,_,b,w)}}else n=d}e.getBoundingBox(iT),iT.applyMatrix4(t);let u=this.shapecast({intersectsBounds:d=>iT.intersectsBox(d),intersectsRange:(d,p,f,m,g,v)=>(tT.copy(v),tT.applyMatrix4(Qp),e.shapecast({intersectsBounds:y=>tT.intersectsBox(y),intersectsRange:(y,_,b,w,C)=>n(d,p,y,_,m,g,w,C)}))});return La.releasePrimitive(c),La.releasePrimitive(h),u}intersectsBox(e,t){return oh.set(e.min,e.max,t),oh.needsUpdate=!0,this.shapecast({intersectsBounds:i=>oh.intersectsBox(i),intersectsTriangle:i=>oh.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},r=0,s=1/0){e.boundingBox||e.computeBoundingBox(),oh.set(e.boundingBox.min,e.boundingBox.max,t),oh.needsUpdate=!0;let o=this.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,h=e.index,u=La.getPrimitive(),d=La.getPrimitive(),p=bw,f=oMe,m=null,g=null;n&&(m=aMe,g=lMe);let v=1/0,y=null,_=null;return Qp.copy(t).invert(),lv.matrix.copy(Qp),this.shapecast({boundsTraverseOrder:b=>oh.distanceToBox(b),intersectsBounds:(b,w,C)=>C<v&&C<s&&(w&&(lv.min.copy(b.min),lv.max.copy(b.max),lv.needsUpdate=!0),!0),intersectsRange:(b,w)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:C=>lv.distanceToBox(C),intersectsBounds:(C,x,S)=>S<v&&S<s,intersectsRange:(C,x)=>{for(let S=3*C,E=3*(C+x);S<E;S+=3){Oa(d,S,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let D=3*b,T=3*(b+w);D<T;D+=3){Oa(u,D,l,a),u.needsUpdate=!0;let I=u.distanceToTriangle(d,p,m);if(I<v&&(f.copy(p),g&&g.copy(m),v=I,y=D/3,_=S/3),I<r)return!0}}}});for(let x=0,S=h?h.count:c.count;x<S;x+=3){Oa(d,x,h,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let E=3*b,D=3*(b+w);E<D;E+=3){Oa(u,E,l,a),u.needsUpdate=!0;let T=u.distanceToTriangle(d,p,m);if(T<v&&(f.copy(p),g&&g.copy(m),v=T,y=E/3,_=x/3),T<r)return!0}}}}),La.releasePrimitive(u),La.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(Qp),f.applyMatrix4(Qp),n.distance=f.sub(n.point).length(),n.faceIndex=_),i)}closestPointToPoint(e,t={},i=0,n=1/0){let r=i*i,s=n*n,o=1/0,a=null;if(this.shapecast({boundsTraverseOrder:c=>(cv.copy(e).clamp(c.min,c.max),cv.distanceToSquared(e)),intersectsBounds:(c,h,u)=>u<o&&u<s,intersectsTriangle:(c,h)=>{c.closestPointToPoint(e,cv);let u=e.distanceToSquared(cv);return u<o&&(bw.copy(cv),o=u,a=h),u<r}}),o===1/0)return null;let l=Math.sqrt(o);return t.point?t.point.copy(bw):t.point=bw.clone(),t.distance=l,t.faceIndex=a,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Ia(0,new Float32Array(t),EG),e.union(EG)}),e}},hv=Wn(due()),cMe=.5*(Math.sqrt(3)-1),dv=(3-Math.sqrt(3))/6,Na=1/6,pv=(Math.sqrt(5),Math.sqrt(5),e=>0|Math.floor(e)),MG=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),nT=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function rT(e=Math.random){let t=AG(e),i=new Float64Array(t).map(r=>MG[r%12*2]),n=new Float64Array(t).map(r=>MG[r%12*2+1]);return function(r,s){let v,y,o=0,a=0,l=0,c=(r+s)*cMe,h=pv(r+c),u=pv(s+c),d=(h+u)*dv,m=r-(h-d),g=s-(u-d);m>g?(v=1,y=0):(v=0,y=1);let _=m-v+dv,b=g-y+dv,w=m-1+2*dv,C=g-1+2*dv,x=255&h,S=255&u,E=.5-m*m-g*g;if(E>=0){let I=x+t[S];E*=E,o=E*E*(i[I]*m+n[I]*g)}let D=.5-_*_-b*b;if(D>=0){let I=x+v+t[S+y];D*=D,a=D*D*(i[I]*_+n[I]*b)}let T=.5-w*w-C*C;if(T>=0){let I=x+1+t[S+1];T*=T,l=T*T*(i[I]*w+n[I]*C)}return 70*(o+a+l)}}function AG(e){let t=new Uint8Array(512);for(let i=0;i<256;i++)t[i]=i;for(let i=0;i<255;i++){let n=i+~~(e()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var fv,Wo=new vr,pMe=Wn(Wz()),fMe=new ye,mMe=new ye,gMe=new ye;(e=>{e.is=function t(i){return i&&i.__isSPEObject}})(fv||(fv={}));var zt,sT=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new ye,this.copyPreviousMatrix=!0,this.hiddenMatrix=new ye,this.matrixWorldRigid=new ye,this.shearScale=new ye,this.shearScaleInv=new ye}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof pi&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let n=this.parent;if(t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let r of this.children)r.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let n of this.children)fv.is(n)&&n.traverseObject(t,i+1)}traverseObject(t,i=0){if(!0!==t(this,i))for(let n of this.children)fv.is(n)&&n.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:n,v:r,q:s}=(0,pMe.SVD)(i),o=fMe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),a=mMe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),l=gMe.copy(a).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(o,l).copyPosition(this.matrixWorld),this.hasNonUniformScale=!s.every(c=>Math.abs(s[0]-c)<.01)}attach(t,i){this.updateWorldMatrix(!0,!1);let n=(new ye).copy(this.matrixWorld).invert();return null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),n.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof ye?t.hiddenMatrix.premultiply(n):t.applyMatrix4(n),t.updateWorldMatrix(!1,!1),this.add(t),void 0!==i&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,n,r,s,o){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},vMe=class extends(sT(pi)){},wr=class extends vMe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];i?.object!==t&&(i&&this.remove(i),i=new wr(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===this.object.dataPatched.cloner?.hideBase}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return(e=>"Mesh"===this.object.type)()}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},ah=new M,lh=new M,Kp=new ye,DG=[new M(-1,1,1),new M(-1,-1,1),new M(1,-1,1),new M(1,1,1),new M(-1,1,-1),new M(-1,-1,-1),new M(1,-1,-1),new M(1,1,-1)],_Me=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],bMe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],TG=(e,t,i)=>{e.updateEntityBoxSize(ah,lh),Kp.copy(t).multiply(e.matrixWorld),0===lh.x&&0===lh.y&&0===lh.z?i.push(new M(ah.x,ah.y,ah.z).applyMatrix4(Kp)):DG.forEach(n=>{i.push(n.clone().multiply(lh).add(ah).applyMatrix4(Kp))})},IG=class extends ln{constructor(){super(...arguments),this.matrix=new ye,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=(new ye).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let n=[];return!0===i?e.traverseEntity(r=>{if(r.visible||r.cloner&&r.data.visible){if(!("geometry"in r))return void n.push(new M);TG(r,t,n)}}):TG(e,t,n),this.setFromPoints(n)}getCenter(e){return(e=super.getCenter(e)).applyMatrix4(this.matrix),e}getPositionToCenter(e){return(e=super.getCenter(e)).applyMatrix4(Kp.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(lh).multiplyScalar(.5),this.getCenter(ah),Kp.copy(this.matrix).setPosition(ah),this.vertices=DG.map(e=>e.clone().multiply(lh).applyMatrix4(Kp))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=_Me.map(([e,t])=>new oo(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new M))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=bMe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},Uc={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},wMe=class extends Fj{constructor(){super()}getPoints(e=12){let i,t=[],n=this.getCurveLengths(),r=n[n.length-1]/n.length;for(let s=0,o=this.curves;s<o.length;s++){let a=o[s],c=Math.ceil(e*(0===s?n[s]:n[s]-n[s-1])/r),h=a.getPoints(c);for(let u=0;u<h.length;u++){let d=h[u];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},oT=.001;function aT(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=oT}function lT(e,t){let i=new M(...e.position),n=new M(...e.controlNext.position),r=new M(...t.controlPrevious.position),s=new M(...t.position);return aT(i,n,s)&&aT(i,r,s)}function PG(e){let t=e.points.map(h=>new M(...h.data.position)),i=[e.points[0]],n=new M(...i[0].data.position);for(let h=0;h<e.points.length-1;h++)aT(n,t[h],t[h+1])||(i.push(e.points[h]),n=t[h]);i.push(e.points[e.points.length-1]);let r=e.isClosed,s=i.length-(r?0:1),o=i.length,a=[];for(let h=0;h<o;h++){let u=i[h].data,d=new M(...u.position),p=new M(...u.controlPrevious.position),f=new M(...u.controlNext.position),m={position:d,baseRoundness:u.roundness,controlPrevious:p,controlNext:f};if(0===u.roundness||!e.isClosed&&(0===h||h===o-1)){a[h]={...m,removedLength:0};continue}let y=i[r&&0==h?o-1:h-1].data,_=i[r&&h==o-1?0:h+1].data,b=new M(...y.position),w=new M(..._.position),C=b.clone().sub(d).normalize(),x=w.clone().sub(d).normalize();Object.assign(m,{prevDir:C,nextDir:x});let S=lT(y,u),E=lT(u,_);if(S&&E){let D=C.clone().add(x).normalize(),T=D.clone().cross(C).length()/C.dot(D);a[h]={...m,tan:T,removedLength:u.roundness/T}}else a[h]={...m,removedLength:0}}for(let h=0;h<s;h++){let p=a[h],f=a[r&&h===o-1?0:h+1];if(0!==p.removedLength||0!==f.removedLength){let m=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,m/2),f.removedLength=Math.min(f.removedLength,m/2)}}let l=[];for(let h=0;h<s;h++){let d=r&&h===o-1?0:h+1,p=a[h],f=a[d],m=null;if(lT(i[h].data,i[d].data)){let g=p.position.clone(),v=f.position.clone();(0!==p.removedLength||0!==f.removedLength)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&v.add(f.prevDir.clone().setLength(f.removedLength))),g.distanceTo(v)>oT&&(m=new J_(g,g.clone().lerp(v,.3),v.clone().lerp(g,.3),v))}else p.position.distanceTo(f.position)>oT&&(m=new J_(p.position,p.controlNext,f.controlPrevious,f.position));l[2*h+1]=m}for(let h=0;h<o;h++){let u=a[h];if(0===u.removedLength){l[2*h]=null;continue}let d=u.position,p=u.prevDir.clone().multiplyScalar(u.removedLength).add(d),f=u.nextDir.clone().multiplyScalar(u.removedLength).add(d),m=u.tan*u.removedLength,g=u.prevDir.clone().add(u.nextDir).normalize(),v=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,_=g.clone().multiplyScalar(Math.sqrt(Math.pow(m,2)-Math.pow(y,2))).add(v),b=g.clone().multiplyScalar(-m).add(_),w=d.distanceTo(b)/d.distanceTo(v),C=u.prevDir.clone().multiplyScalar(w*d.distanceTo(p)).add(d),x=C.clone().lerp(b,2),S=p.clone().lerp(C,4/3),E=f.clone().lerp(x,4/3);l[2*h]=new J_(p,S,E,f)}let c=new wMe;return l.forEach(h=>{h&&c.add(h)}),c}(e=>{e.is=function t(i){return i&&i.__isEntity}})(zt||(zt={}));var Ll=e=>zt.is(e),xMe={type:"completeState",isfromEntity:!0},SMe=["x","y","z"],cT=new M,CMe=(new M).set(0,1,0),uT=e=>class extends(sT(e)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new IG,this._recursiveBBox=new IG,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(zt.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(zt.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let t=this;for(;"Instance"!==t.data.type;){let i=t.parent;if(!zt.is(i))return;t=i}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){"string"==typeof t&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,n=!1){if(0!==this.data.states.length||n){for(let r of this.data.states)nh.toOps(this.data,r.data).forEach(s=>{let o=rD.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(o,this.data,i)});if(null!==t){let r=this.data.states.data(t);r&&(this.dataPatched=nh.patch(this.data,r),nh.toOps(this.data,r).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}n&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Ll(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(n=>{n.uuid===t&&(i=n)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,n=i.indexOf(this)+1;if(zt.is(i[n]))return i[n];if(zt.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&zt.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&null!==i;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,n=this;for(;n!==t;){if(null===n)return-1;n=n.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Ll(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{zt.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(!0!==t(this,i))for(let n of this.children)Ll(n)&&n.isConcreteEntity&&n.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(!0!==t(this,i))for(let n of this.children)Ll(n)&&n.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Ll(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Ll(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(n=>{n.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*qe.RAD2DEG,this.rotation.y*qe.RAD2DEG,this.rotation.z*qe.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return KA(i,t)}getTransformValues(t,i,n){return i[t].map((r,s)=>n?.shared.getVariable(r,[this.uuid,t,SMe[s]])??r)}updateTransformState(t,i){let n=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),n=!0),t.rotation&&(cT.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(qe.DEG2RAD),this.rotation.setFromVector3(cT),n=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),n=!0),void 0!==t.hiddenMatrix&&(n=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??Pp.identity)),n&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(r=>{r.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&void 0!==t.hiddenMatrix&&this.updateWorldMatrix(!1,!0),n}onVariableUpdate(t=!1){t?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)}))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)zt.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{zt.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return KA(i,t)}updateByObjUpdateOp(t,i){void 0!==t&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,n,r){let s=this.data;this.data=i;let o=t,a=co(t.path,["states","*"]);if(null!==a){if(0===t.type){let[l]=a;if(this?.stateSelection===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(h=>void 0===h)){let h=this.data;if(void 0!==h){let u=Wr.zoom(h,t.path.slice(2));if(u)for(let d in t.props)void 0===t.props[d]&&d in u&&(c[d]=u[d])}}o={...t,props:c,path:t.path.slice(2)}}}}else if(0===t.type){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==l){if(void 0!==t.props.name&&l.name){let{name:h,...u}=l;l=u}if(void 0!==t.props.material&&"material"in l){let{material:h,...u}=l;l=u}let c=Wr.removeOverridden(t.path,t.props,l);o={...t,props:c}}}if(this.updateByPatchedOpBase(o,nh.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n),co(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&"descendants"===c[0];)l.push(c[1]),c.splice(0,2);if(void 0===l[l.length-1]){if(0===t.type)for(let h of Object.keys(t.props)){l[l.length-1]=h;let u=n.scene.findInstance([this.uuid,...l]);u&&(u.overrideData=t.props[h],u.updateState(Dc.apply(u.component.data,u.overrideData),n))}}else{let h=n.scene.findInstance([this.uuid,...l]);if(h){let u=Wr.zoom(h.component.data,c);if(0===(t={...t,path:c}).type){let d=t.props;if(u)for(let[p,f]of Object.entries(t.props))void 0===f&&(d===t.props&&(d={...t.props}),d[p]=u[p]);t={...t,props:d}}h.overrideData=nw.resolve(i.overrides,l),h.updateByOp(t,_r.applySimple(h.data,t),n,!1)}}}else if(this.instances.length>0){let l;if(0===t.path.length&&0===t.type){let c;for(let h of Oc.rootOverrideProps)h in t.props&&(void 0===c&&(c={}),c[h]=t.props[h]);c&&(l={...t,props:c})}else for(let c of Oc.rootOverrideProps)if(co(t.path,[c])){l=t;break}void 0!==l&&this.instances.forEach(c=>{if(c.isInstanceRoot){let h=Dc.filterOp(c.overrideData,l);h&&c.updateByOp(h,_r.applySimple(c.data,h),n,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let h=Dc.filterOp(c.overrideData,t);if(h){let u;u=s===c.data&&t===h?i:_r.applySimple(c.data,h),c.updateByOp(h,u,n,!0)}}})}}updateByPatchedOpBase(t,i,n){if(this.dataPatched=i,0===t.path.length&&0===t.type)void 0!==t.props.type&&!ih.is(t.props.type)&&Uc.changeEntityProptotype(this,i,n);else if(1===t.path.length&&"geometry"===t.path[0]&&0===t.type&&"type"in t.props){Uc.changeEntityProptotype(this,i,n);for(let r of this.children)zt.is(r)&&r.updateVisible(n.scene)}this.updateByPatchedOp(t,i,n)}updateByPatchedOp(t,i,n){if(0===t.path.length&&0===t.type&&this.updateState(t.props,n),null!==co(t.path,["pathSnapping"])&&this.updatePathSnapping(i.pathSnapping),null!==co(t.path,["cloner"])){let r=_r.drop(t,1);0===r.path.length&&0===r.type&&!0===r.props.disabled?this.setFromClonerState(null,n):this.cloner?this.cloner.updateState(i.cloner,n.scene):(this.setFromClonerState(i.cloner,n),this.expandCloner(n.scene)),this.updateVisible(n.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){let i=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,n=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,r=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,s=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(null===i)return;let o=t.find(i);if(!o||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let a=o.data;if(a.geometry.path.points.length<=1)return;let l=PG(a.geometry.path),c=(n+r)%1;n+r===1&&0===c&&(c=1);let h=l.getPointAt(c),u=this.parent?this.parent?.matrixWorld:new ye;o.updateMatrixWorld();let d=(new ye).multiplyMatrices(u.clone().invert(),o.matrixWorld);h.applyMatrix4(d);let p={position:h.toArray(),rotation:a.rotation};if("tangential"===s){let f=(new ye).extractRotation(o.matrixWorld),m=l.getTangentAt(c).applyMatrix4(f).add(h),g=(new ye).lookAt(h,m,CMe),v=cT.setFromEuler((new Yn).setFromRotationMatrix(g)).multiplyScalar(qe.RAD2DEG);p={...p,rotation:v.toArray()}}this.updateTransformState(p),this.traverseEntity(f=>{f._cameraType&&f.dispatchEvent(xMe)})}updateVisible(t){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||!0!==this.dataPatched.cloner?.hideBase),!t)return;let i=!1;this.traverseEntity(n=>{if("Splat"===n.data.type)return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){void 0!==t.name&&(this.name=t.name),void 0!==t.raycastLock&&(this.raycastLock=t.raycastLock),void 0!==t.visible&&(this.updateVisible(i?.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&void 0!==t.cloner&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof Uc.Cloner&&"toObject"===t.parameters.type)}setFromClonerState(t,i){this.disposed||(null===t||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new Uc.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}},RG=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);i.thetaLength=qe.clamp(i.thetaLength,0,360);let n=i.width/2,r=i.radiusTop??n,s=i.radiusBottom??n;return r===s?(r=n,s=n):r>s?(r=n,s=s*n/r):(r=r*n/s,s=n),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:r,radiusBottom:s})}}static build(e){let f,{width:t,depth:i,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l,radiusTop:c,radiusBottom:h,cornerRadius:u,cornerSegments:d,hollow:p}=e.parameters;return 0===l?(f=new Ze,f.setAttribute("position",new Fe([],3))):f=u||p?new LG(c,h,n,r,s,o,a,l*Math.PI/180,u,u,d,p):new lA(c,h,n,r,s,o,a,l*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function jc(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function OG(e){return new z(e.y,-e.x)}var LG=class extends Ze{constructor(e,t,i,n,r,s,o,a,l,c,h,u,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,s=void 0!==s&&s,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,s&&(l=0,c=0);let p=[],f=[],m=[],g=[],v=0,y=i/2,_=new M,b=new M;d&&0==e&&(e=l),d&&0==t&&(t=c);let w=new z(e,y),C=new z(t,-y),x=null,S=null,E=null,D=null,T=w.clone().sub(C),I=0,P=0,R=0;u>0&&(I=Math.min(e,t)*(1-u),P=e-I,R=t-I);let L=w.clone();L.x-=I;let j=Math.PI-T.angle(),F=T.angle(),N=Math.tan(F/2),q=Math.tan(j/2),W=N+q,V=u?W:N;if(l=Math.min(l,(e-P)/(u?W:q),T.length()/W),c=Math.min(c,(t-R)/V,T.length()/W),l>0){let K=l/N;x=w.clone().sub(new z(K,l)),u&&(E=x.clone(),E.x-=I-W*l),w.sub(T.clone().setLength(K))}if(c>0){let K=c/q;S=C.clone().sub(new z(K,-c)),C.add(T.clone().setLength(K)),u&&(D=S.clone(),D.x-=I-W*c,L.sub(T.clone().setLength(K)))}T=w.clone().sub(C);let Y=T.length()<.5,G=[];for(let K=0;K<=n;K++){let se=[],$=K/n,ge=$*a+o,ce=new z(Math.sin(ge),Math.cos(ge));if(D&&S?(X(se,$,ce,j,c,D,-1,!0),X(se,$,ce,F,c,S,-1,!1)):S?(H(se,ce,S.x,0,-1),X(se,$,ce,F,c,S,-1,!1)):s||H(se,ce,t,R,-1),jc(OG(T).normalize(),ce,_),!Y)for(let Oe=0;Oe<=r;Oe++){let Re=Oe/r;jc(T.clone().multiplyScalar(Re).add(C),ce,b),f.push(b.x,b.y,b.z),m.push(_.x,_.y,_.z),g.push($,.5+b.y/i),se.push(v++)}if(E&&x?(X(se,$,ce,j,l,x,1,!1),X(se,$,ce,F,l,E,1,!0)):x?(X(se,$,ce,j,l,x,1,!1),H(se,ce,x.x,0,1)):s||H(se,ce,e,P,1),u&&!Y){jc(OG(T).multiplyScalar(-1).normalize(),ce,_);for(let Re=0;Re<=r;Re++){let Ne=Re/r;jc(T.clone().multiplyScalar(-Ne).add(L),ce,b),f.push(b.x,b.y,b.z),m.push(_.x,_.y,_.z),g.push($,.5+b.y/i),se.push(v++)}}u&&!s&&se.push(se[0]),G.push(se)}for(let K=0;K<G.length-1;K++)for(let se=0;se<G[0].length-1;se++){if(s&&u&&se==r)continue;let ge=G[K+1][se],ce=G[K+1][se+1],ae=G[K][se+1],Oe=f[3*ce+0],Re=f[3*ce+2];p.push(G[K][se],ge,ae),(0!=Oe||0!=Re)&&p.push(ge,ce,ae)}function X(K,se,$,ge,ce,ae,Oe,Re){for(let Ne=0;Ne<h+1;Ne++){let Ue=Ne/h,De=Oe<0?Ue:1-Ue;Re&&(De-=1),De*=ge;let Ce=new z(Math.sin(De),Math.cos(De)*Oe);jc(Ce.clone().multiplyScalar(ce).add(ae),$,b),f.push(b.x,b.y,b.z),jc(Ce,$,_),m.push(_.x,_.y,_.z),g.push(se,.5+b.y/i),K.push(v++)}}function H(K,se,$,ge,ce){let ae=new M,Oe=new z,Re=[$,ge];ce<0&&Re.reverse();for(let Ne of Re)Oe.set(Ne,y*ce),jc(Oe,se,ae),f.push(ae.x,ae.y,ae.z),m.push(0,ce,0),g.push(.5,.5),K.push(v++)}function re(K,se,$){let ge=new z(Math.sin($),Math.cos($)),ce=new z(-Math.cos($),Math.sin($)),ae=new M,Oe=K<0?(Ue,De,Ce)=>p.push(Ue,De,Ce):(Ue,De,Ce)=>p.push(Ue,Ce,De);jc(new z((e+t+P+R)/4,0),ge,ae),f.push(ae.x,ae.y,ae.z),m.push(ce.x,0,ce.y),g.push(.5,.5);let Ne=v++;for(let Ue of se){let De=f.slice(3*Ue,3*Ue+3);f.push(...De),m.push(ce.x,0,ce.y);let Ce=g.slice(2*Ue,2*Ue+2);g.push(...Ce),v++}for(let Ue=Ne+1;Ue<v-1;Ue++)Oe(Ne,Ue,Ue+1);Oe(Ne,v-1,Ne+1)}a<2*Math.PI&&(re(-1,G[0],o),re(1,G[G.length-1],o+a)),this.setIndex(p),this.setAttribute("position",new Fe(f,3)),this.setAttribute("normal",new Fe(m,3)),this.setAttribute("uv",new Fe(g,2))}},hT=Math.PI/2,AMe=class extends Ze{constructor(e=1,t=1,i=1,n=1,r=1,s=1,o=0,a=4){super(),this.type="BoxGeometry";let l=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s),a=Math.floor(a),o=Math.min(o,e/2,t/2,i/2);let c=[],h=[],u=[],d=[],p=0,f=0;function m(y,_,b,w,C,x,S,E,D,T,I){let P=(x-2*o)/D,R=(S-2*o)/T,L=x/2-o,j=S/2-o,F=E/2,N=D+1,q=T+1,W=0,U=0,V=new M;for(let Y=0;Y<q;Y++){let G=Y*R-j;for(let X=0;X<N;X++)V[y]=(X*P-L)*w,V[_]=G*C,V[b]=F,h.push(V.x,V.y,V.z),V[y]=0,V[_]=0,V[b]=E>0?1:-1,u.push(V.x,V.y,V.z),d.push(X/D),d.push(1-Y/T),W+=1}for(let Y=0;Y<T;Y++)for(let G=0;G<D;G++){let H=p+G+N*(Y+1),re=p+(G+1)+N*(Y+1),K=p+(G+1)+N*Y;c.push(p+G+N*Y,H,K),c.push(H,re,K),U+=6}l.addGroup(f,U,I),f+=U,p+=W}function g(y,_,b,w,C,x,S,E,D,T,I){let P=(S-2*o)/T,R=S/2-o,L=E/2-o,j=D/2,F=T+1,N=0,q=0,W=new M,U=new M;for(let V=0;V<a+1;V++){let Y=V/a*hT,G=Math.sin(Y)*o,X=(1-Math.cos(Y))*o,H=Math.sin(Y),re=Math.cos(Y);W[_]=(L+G)*C,W[b]=(j-X)*x,U[y]=0,U[_]=H*Math.sign(W[_]),U[b]=re*Math.sign(W[b]);for(let K=0;K<F;K++)W[y]=(K*P-R)*w,h.push(W.x,W.y,W.z),u.push(U.x,U.y,U.z),d.push(K/T),d.push(0),N+=1}for(let V=0;V<a;V++)for(let Y=0;Y<T;Y++){let X=p+Y+F*(V+1),H=p+(Y+1)+F*(V+1),re=p+(Y+1)+F*V;c.push(p+Y+F*V,X,re),c.push(X,H,re),q+=6}l.addGroup(f,q,I),f+=q,p+=N}function v(y,_,b){let w=new M,C=new M(e/2,t/2,i/2);C.subScalar(o);let x=[],S=y*_*b>0?(D,T,I)=>c.push(D,T,I):(D,T,I)=>c.push(D,I,T);for(let D=0;D<=a;D++){let T=[],I=hT*(1-D/a),P=Math.cos(I),R=Math.sin(I),L=0;for(let j=0;j<=D;j++){let F=Math.cos(L),N=Math.sin(L);w.x=P*F,w.y=R,w.z=P*N;let q=C.clone().addScaledVector(w,o);h.push(y*q.x,_*q.y,b*q.z),u.push(y*w.x,_*w.y,b*w.z),d.push(0,0),T.push(p++),L+=hT/D}x.push(T)}let E=x.length-1;for(let D=0;D<E;D++){let T=x[D],I=x[D+1],P=T.length-1;S(T[0],I[1],I[0]);for(let R=1;R<=P;R++)S(T[R-1],T[R],I[R]),S(T[R],I[R+1],I[R])}}m("z","y","x",-1,-1,i,t,e,s,r,0),m("z","y","x",1,-1,i,t,-e,s,r,1),m("x","z","y",1,1,e,i,t,n,s,2),m("x","z","y",1,-1,e,i,-t,n,s,3),m("x","y","z",1,-1,e,t,i,n,r,4),m("x","y","z",-1,-1,e,t,-i,n,r,5),o>0&&(g("z","y","x",-1,-1,1,i,t,e,s,0),g("z","y","x",1,-1,-1,i,t,e,s,1),g("z","y","x",-1,1,-1,i,t,e,s,1),g("z","y","x",1,1,1,i,t,e,s,0),g("x","y","z",-1,-1,-1,e,t,i,n,0),g("x","y","z",1,-1,1,e,t,i,n,1),g("x","y","z",-1,1,1,e,t,i,n,0),g("x","y","z",1,1,-1,e,t,i,n,1),g("y","x","z",-1,-1,1,t,e,i,r,0),g("y","x","z",1,-1,-1,t,e,i,r,1),g("y","x","z",1,1,1,t,e,i,r,1),g("y","x","z",-1,1,-1,t,e,i,r,0),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(c),this.setAttribute("position",new Fe(h,3)),this.setAttribute("normal",new Fe(u,3)),this.setAttribute("uv",new Fe(d,2))}},dT=class extends Ze{constructor(e=[],t=[],i="",n=1,r=.2,s=4){super(),this.type="PolyhedronGeometryRound";let o=[],a=[],l=[];return function c(){0==(r=Math.min(.99999,r))&&(s=0);let u={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new M,p=d.clone(),f=new vr,m=r*n,g=n-m,v=s+1,y=new M,_=(F,N)=>y.subVectors(F,N).normalize(),b=(F,N)=>Array(F).fill(void 0).map(N),w=b(e.length/3,(F,N)=>(new M).fromArray(e,3*N).setLength(n)),C=[],x=1e6;for(let F=0;F<w.length;F++){let W,U,V,N=w[F],q=[],Y=1e10,G=-1;for(;-1!=(G=t.indexOf(F,G+1));){let K=G-G%3;W=t[K+(G+1)%3],U=t[K+(G+2)%3],V=N.distanceToSquared(w[W]),Y=Math.min(Y,V),q.push([W,U,V])}Y+=1e-6;let X=[],H=0,re=q.length;for(let K=0;K<re;K++){[W,U,V]=q[H];let se=1==C[W]?.includes(F);V<=Y&&X.push(W+ +se*x),H=q.findIndex($=>$[0]==U)}C.push(X)}let S=[];{let q,W,F=0,N=0,U=3==u;for(let V=0;V<=s;V++){q=V*(V+1)/2,W=(V+1)*(V+2)/2;for(let Y=0;Y<s-V;Y++)[F,N]=[q+Y+V+2,W+Y+V+3],S.push(q,W,...U?[N,q]:[F,W],N,F),[q,W]=[F,N];S.push(q,W,q+s+2)}}let E=d.clone(),D=d.clone(),T=d.clone(),I=d.clone(),P=d.clone(),R=[],L=b(w.length,()=>b(u,()=>d.clone()));for(let F=0;F<w.length;F++){d.copy(w[F]).normalize(),E.copy(d).multiplyScalar(g);let N=C[F];for(let X=0;X<N.length;X++)f.setFromPointsAndIndices(w,F,N[X]%x,N[(X+1)%u]%x),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(E,L[F][X]);let q=[],W=[],U=[],V=new M;0==s&&[...L[F]].reduce((X,H)=>X.add(H),V).multiplyScalar(1/u);for(let X=0;X<u;X++){let H=[],K=L[F][(X-1+u)%u],se=L[F][X];d.copy(K).sub(E),p.copy(se).sub(E);let $=E.angleTo(d),ge=d.angleTo(p),ce=Math.cos($)*m;0==s?D.copy(V):D.copy(E).setLength(g+ce),W.push(ce);let ae=[D,K,se];for(let Oe=0;Oe<2;Oe++){let Re=ae[Oe],Ne=ae[Oe+1];I.subVectors(Re,E),P.subVectors(Ne,E),T.crossVectors(I,P).normalize();for(let Ue=0;Ue<v;Ue++){let De=[$,ge][Oe]*Ue/v;d.copy(I).applyAxisAngle(T,De).add(E),q.push(d.clone()),Oe&&(_(d,E),H.push([0==Ue?Re:d.clone(),y.clone()]))}Oe&&(_(Ne,E),H.push([Ne,y.clone()]))}U.push(H)}R.push(U);let Y=2*v,G=2;for(let X=0;X<u;X++){let H=Y*X,re=Y*((X+1)%u),K=[q[H]];for(let $=1;$<v;$++){I=q[H+$],P=q[re+$],K.push(I);for(let ge=1,ce=$-G+1;ge<=ce;ge++)d.lerpVectors(I,P,ge/(ce+1)),d.sub(E).setLength(W[X]).add(E),K.push(d.clone());K.push(P)}for(let $=0;$<v;$++)K.push(q[$+v+H]);K.push(q[re+v]);let se=S.map($=>K[$]);o.push(...se.map($=>[$.x,$.y,$.z]).flat()),l.push(...se.map($=>(_($,E),[y.x,y.y,y.z])).flat())}}let j=[];for(let F=0;F<C.length;F++)for(let N=0;N<u;N++){let q=C[F][N];if(q<x){let W=C[q].findIndex(Y=>Y%x==F),U=R[F][N],V=R[q][W];for(let Y=0;Y<v;Y++){let X=V[v-Y],H=U[Y+1];[U[Y],X,H,H,X,V[v-(Y+1)]].forEach(K=>{o.push(K[0].x,K[0].y,K[0].z),l.push(K[1].x,K[1].y,K[1].z)})}j.push(U[0][0],V[v][0],U[v][0],V[0][0])}}for(;j.length;){let F,N,q,W;[F,N]=j.splice(0,2);let U=[F];for(;F!=N;)U.push(N),q=j.indexOf(N),W=q%2,N=j.splice(q-W,2)[1-W];y.subVectors(U[0],U[1]).cross(d.subVectors(U[0],U[2])).normalize();let V=y.dot(U[0])<0;V&&y.negate();for(let Y=1;Y<=U.length-2;Y++)[U[Y+ +V],U[Y+1-+V],U[0]].forEach(G=>{o.push(G.x,G.y,G.z),l.push(y.x,y.y,y.z)})}}(),function h(){let u=new M;for(let C=0;C<o.length;C+=3){u.x=o[C+0],u.y=o[C+1],u.z=o[C+2];let x=b(u)/2/Math.PI+.5,S=w(u)/Math.PI+.5;a.push(x,1-S)}let d=new M,p=new M,f=new M,m=new M,g=new z,v=new z,y=new z,_=(C,x,S,E)=>{E<0&&1===C.x&&(a[x]=C.x-1),0===S.x&&0===S.z&&(a[x]=E/2/Math.PI+.5)};for(let C=0,x=0;C<o.length;C+=9,x+=6){d.set(o[C+0],o[C+1],o[C+2]),p.set(o[C+3],o[C+4],o[C+5]),f.set(o[C+6],o[C+7],o[C+8]),g.set(a[x+0],a[x+1]),v.set(a[x+2],a[x+3]),y.set(a[x+4],a[x+5]),m.copy(d).add(p).add(f).divideScalar(3);let S=b(m);_(g,x+0,d,S),_(v,x+2,p,S),_(y,x+4,f,S)}for(let C=0;C<a.length;C+=6){let x=a[C+0],S=a[C+2],E=a[C+4],D=Math.max(x,S,E),T=Math.min(x,S,E);D>.9&&T<.1&&(x<.2&&(a[C+0]+=1),S<.2&&(a[C+2]+=1),E<.2&&(a[C+4]+=1))}function b(C){return Math.atan2(C.z,-C.x)}function w(C){return Math.atan2(-C.y,Math.sqrt(C.x*C.x+C.z*C.z))}}(),this.setAttribute("position",new Fe(o,3)),this.setAttribute("normal",new Fe(l,3)),void this.setAttribute("uv",new Fe(a,2))}static fromJSON(e){return new dT(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},NG=class extends dT{constructor(e=1,t=.2,i=4){let n=(1+Math.sqrt(5))/2,r=1/n,a="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,e,t,i),this.type=a}static fromJSON(e){return new NG(e.radius,e.corner,e.cornerSides)}},mv=1e-12,pT=class{constructor(e){this.position=new z,this.startPosition=new z,this.uuid=qe.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new pT(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},fT=class extends pT{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new fT(this.parent).copy(this)}},$p=class extends pT{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new fT(this),new fT(this))}static create(e,t){let i=new $p(e,new z(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,n=this.controls.length;i<n;i++){let r=this.controls[i];this.position.distanceTo(r.position)<=t?r.position.copy(this.position):r.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new $p(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let e=this.curveBefore?.getTangentAt(1),t=this.curveAfter?.getTangentAt(0);return[e,t]}computeNormals(e=new z,t=new z){let[i,n]=this.computeTangents();return i&&n&&(kG(i,e),kG(n,t)),[e,t]}computeTangent(e=new z){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new z){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function kG(e,t=new z){let i=e.length();return t.set(-e.y/i,e.x/i)}var Jp=new z,ww=new z,TMe=new z,IMe=new z,PMe=new z,RMe=new z,FG=new M,BG=new M;function OMe(e){let t=new z;t.addVectors(e.v0,Jp.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new z;return i.addVectors(e.v2,ww.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Vo(e.v0,t,i,e.v2)}function gv(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function LMe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function NMe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function VG(e,t,i){let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((r*r+n*n-s*s)/(2*r*n))}function kMe(e,t,i){return UG(e,t)&&UG(t,i)&&gT(e.position,t.position,i.position)}function gT(e,t,i){return 0===Jp.copy(t).sub(e).cross(ww.copy(i).sub(e))}function FMe(e,t,i,n,r){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),o=(e.y+t.y)/2,a=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return n.set(a+l,o+c),r.set(a-l,o-c),[n,r]}function BMe(e,t,i){return e.distanceTo(i)<t.distanceTo(i)?t:e}function VMe(e,t,i,n,r,s){let u,o=t.x-e.x,a=t.y-e.y,l=i.x-e.x,c=i.y-e.y,h=Math.sqrt((o+l)*(o+l)+(a+c)*(a+c));return VG(t,e,i)>Math.PI&&(h*=-1),u=gv(c,a)?(a+c)*(n/h-.5)*8/3/(o-l):(o+l)*(n/h-.5)*8/3/(c-a),r.set(t.x-u*a,t.y+u*o),s.set(i.x+u*c,i.y-u*l),[r,s]}function zG(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function UG(e,t){return gT(e.position,e.controls[1].position,t.position)&&gT(e.position,t.controls[0].position,t.position)}function jG(e,t=12,i=!1){let n=[];for(let r=0,s=e.length;r<s;r++){let o=e[r],a=0;if(i&&void 0!==o.roundedCurveCorner){let l=.5*ch(o.roundedCurveCorner,t);r>0&&(n[r-1]+=l),a+=l}void 0!==o.curveAfter&&(a+=ch(o.curveAfter,t)),n.push(a)}return e.length>0&&i&&void 0!==e[0].roundedCurveCorner&&(n[e.length-1]+=.5*ch(e[0].roundedCurveCorner,t)),n}function ch(e,t=12){return e&&e instanceof K_?2*t:e&&(e instanceof zo||e instanceof kj)?1:e&&e instanceof aA?t*e.points.length:t}var fi,Cn,vT=new z,GMe=new z,WMe=new z,qMe=new z,YMe=new z,XMe=new z,Qi=class extends tb{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Fs(new M(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=qe.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let n=new Qi;return n.isClosed=e.isClosed,n.points=e.points.map(r=>$p.create(r.id,r.data)),"number"==typeof e.roundness&&(n.roundness=e.roundness),n.shapeHoles=e.shapeHoles.map(r=>Qi.createFromState(r)),void 0!==t&&void 0!==i&&n.applySize(t,i),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(n=>n.uuid===e);if(i<0){let n=t;for(let r=0,s=this.shapeHoles.length;r<s;r++){let o=this.shapeHoles[r],a=o.points.length,l=o.getPointIndexById(e);if(!(l<0))return l+n;n+=a}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,n=this.shapeHoles.length;i<n;i++){let r=this.shapeHoles[i],s=e-t;if(s<=r.points.length-1)return r.points[s];t+=r.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,n=this.shapeHoles.length;i<n;i++){let r=this.shapeHoles[i],s=r.points.indexOf(e);if(s>=0)return t+s;t+=r.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=vT.set(e,t);for(let n=0,r=this.points.length;n<r;n++){let s=this.points[n];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let n=0,r=this.shapeHoles.length;n<r;n++)this.shapeHoles[n].applyScale(e,t);this._update()}createPoint(e,t=0,i=qe.generateUUID()){let n;n=e instanceof z?e:new z(e,t);let r=new $p(i,n);return r.roundness=this.roundness,r}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];if(n.uuid===e)return n}for(let t=0,i=this.shapeHoles.length;t<i;t++){let n=this.shapeHoles[t].getPointByUuid(e);if(n)return n}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);let n=i?this.roundedCurveDivisions:this.curveDivisions;return function UMe(e,t,i=12,n=!0){let s,r=BG.set(0,0,0),o=0,a=[];for(let l=0;l<t.length;l++){let c=t[l],h=Jp,u=ch(c,i);a.push(u);for(let d=0;d<=u;d++)if(c instanceof Vo||c instanceof Cc||c instanceof zo){if(c.getPoint(d/u,h),r.set(h.x,h.y,0),void 0!==s&&NMe(s,r))continue;void 0===s&&(s=FG),s.copy(r),e.setXYZ(o,r.x,r.y,r.z),o++}}n&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++)}(e,i?this.roundedCurves:this.curves,t,this.autoClose),n.reduce((r,s)=>r+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=jG(this.points,e,!1),this.roundedCurveDivisions=jG(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return 2*function jMe(e,t,i,n=12,r=!0){let s=BG.set(0,0,0),o=0,a=[];for(let l=0;l<t.length;l++){if(!1===i[l])continue;let c,h=t[l],u=Jp,d=ch(h,n);a.push(d);for(let p=0;p<=d;p++)if(h instanceof Vo||h instanceof Cc||h instanceof zo){if(h.getPoint(p/d,u),s.set(u.x,u.y,0),c?.equals(s))continue;void 0===c?c=FG:(e.setXYZ(o,c.x,c.y,c.z),o++,e.setXYZ(o,s.x,s.y,s.z),o++),c.copy(s)}}return r&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++),a}(e,this.curves,t,i,this.autoClose).reduce((n,r)=>n+r,0)}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function HMe(e,t,i=12,n=!0){let r,s=0;for(let o=0;o<t.length;o++){let a=t[o],l=ch(a,i),c=Jp;for(let h=0;h<=l;h++)if(a instanceof Vo||a instanceof Cc||a instanceof zo){if(a.getPoint(h/l,c),void 0!==r&&LMe(r,c,mv))continue;void 0===r&&(r=ww),r.copy(c),e.push(c.x,c.y),s++}}return gv(e[0],e[e.length-2],mv)&&gv(e[1],e[e.length-1],mv)&&(e.pop(),e.pop()),n&&s>1&&!(gv(e[s-1],e[1],mv)&&gv(e[s-2],e[0],mv))&&(e.push(e[0],e[1]),s++),e}(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let n=t?this.roundedCurveDivisions:this.curveDivisions,r=0;t&&void 0!==this.points[0].roundedCurveCorner&&(r=.5*ch(this.points[0].roundedCurveCorner,this.subdivision));let s=e-r;s<0&&(s+=n.reduce((o,a)=>o+a,0));for(let o=0,a=n.length;o<a;o++){let l=n[o];if(s<i+l)return[o,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let n=this.points[e],r=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,o=s[e];if(zG(n,r)){let l=n.position.distanceTo(r.position);return n.position.distanceTo(vT.set(i.x,i.y))/l}let a=0;for(let l=0;l<e;l++)a+=s[l];return(t-a)/o}dispose(){}_applyCurveForPoint(e,t){zG(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let n=i.clone();e.roundedCurveBefore=n,t.roundedCurveAfter=n,e.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let n=this.points[t];0===t?this.moveTo(n.position.x,n.position.y):this._applyCurveForPoint(n,this.points[t-1])}let e=this.getLastPoint();if(e?.curveAfter&&(e.curveAfter=void 0),this.isClosed&&this._applyCurveForPoint(this.points[0],this.points[this.points.length-1]),this.points.length>2){let t=0;for(let i=0,n=this.points.length;i<n;i++){let r=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],o=this.points[i+1]??this.points[0],a=r.roundness,l=s&&o&&kMe(s,r,o);if(!r.controlsMoved()&&a>0&&!l){let c=r.curveBefore,h=r.curveAfter;if(void 0===c||void 0===h)continue;let C,u=r.roundedCurveBefore,d=r.roundedCurveAfter,p=c.getLength(),f=h.getLength(),m=Math.min(a,.499*p),g=Math.min(a,.499*f),v=Math.min(m,g),y=1-v/p,_=v/f,b=c.getPointAt(y,vT),w=h.getPointAt(_,GMe);if(this._subSplitCurve(c,u,y,b,void 0),this._subSplitCurve(h,d,_,void 0,w),this.useCubicForRoundedCorners){let x=VG(b,r.position,w)/2,S=Math.tan(x)*b.distanceTo(r.position),[E,D]=FMe(b,w,S,WMe,qMe),T=BMe(E,D,r.position),[I,P]=VMe(T,b,w,S,YMe,XMe);C=new Vo(b.clone(),I.clone(),P.clone(),w.clone())}else C=new Cc(b.clone(),r.position.clone(),w.clone());r.roundedCurveCorner=C,this.roundedCurves.splice(i+t,0,C),t++}}}}_subSplitCurve(e,t,i,n,r){if(!(e instanceof zo)){let s=e,o=t,a=s.getUtoTmapping(i,0),l=function zMe(e,t,i,n,r=.5){let s=Jp.subVectors(t,e).multiplyScalar(r).add(e),o=ww.subVectors(i,t).multiplyScalar(r).add(t),a=TMe.subVectors(n,i).multiplyScalar(r).add(i),l=s,c=IMe.subVectors(o,s).multiplyScalar(r).add(s),h=PMe.subVectors(a,o).multiplyScalar(r).add(o),u=a,d=RMe.subVectors(h,c).multiplyScalar(r).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,h.x,h.y,u.x,u.y,n.x,n.y]}(s.v0,s.v1,s.v2,s.v3,a);return void 0!==n&&(o.v0.set(l[0],l[1]),o.v1.set(l[2],l[3]),o.v2.set(l[4],l[5]),o.v3.set(l[6],l[7])),void 0!==r&&(o.v0.set(l[6],l[7]),o.v1.set(l[8],l[9]),o.v2.set(l[10],l[11]),o.v3.set(l[12],l[13])),o}return void 0!==n&&t.v2.copy(n),void 0!==r&&t.v1.copy(r),t}clone(){let e=new Qi(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let i=0;i<t;i++){let n=7*i,r=e.points[n+0],s=e.points[n+1],o=e.points[n+2],a=e.points[n+3],l=e.points[n+4],c=e.points[n+5],h=e.points[n+6],u=new $p(qe.generateUUID(),new z(r,s));u.controls[0].position.set(o,a),u.controls[1].position.set(l,c),u.roundness=h,this.points.push(u)}return this.shapeHoles=e.shapeHoles?.length?e.shapeHoles.map(i=>{let n=new Qi;return n.fromJSON(i),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(r,s)=>{s instanceof Vo&&s.v3.equals(r.position)&&r.controls[0].position.copy(s.v2)};return this.points=(r=>{let o,a,s=[];for(o=0,a=r.length;o<a;o++)r[o]instanceof Cc&&(r[o]=OMe(r[o]));for(o=0,a=r.length;o<a;o++){let d,h=r[o],u=o>0?r[o-1]:null;h instanceof Vo?(d=this.createPoint(h.v0),d.controls[1].position.copy(h.v1)):h instanceof zo&&(d=this.createPoint(h.v1)),void 0!==d&&(null!==u&&i(d,u),s.push(d))}let l=r[r.length-1],c=!1;return l instanceof Vo?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof zo&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s})(e.curves),e instanceof tb&&(this.shapeHoles=e.holes.map(r=>{let s=new Qi;return s.fromShape(r),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.roundness&&(i.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){let i=this.getPointByUuid(e)?.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){let i=this.getPointByUuid(e)?.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},yT=2*Math.PI;function _T({x:e,y:t},i,n,r,s){return{x:e*i+r,y:t*n+s}}function ZMe(e,t){let i=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),n=Math.cos(e),r=Math.sin(e),s=Math.cos(e+t),o=Math.sin(e+t);return[{x:n-r*i,y:r+n*i},{x:s+o*i,y:o-s*i},{x:s,y:o}]}function HG(e,t,i,n){let r=e*n-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*n));return r*Math.acos(s)}function at(e,t){if(!e)throw t||"Assertion Failed!"}!function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"}(fi||(fi={})),function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(Cn||(Cn={}));var $e=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,n){at(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?r<s?i.t-t.t+r/(r+s)*(t.t-n.t):i.t-n.t+s/(r+s)*(n.t-t.t):0},e.edgeSign=function(t,i,n){at(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?(i.t-n.t)*r+(i.t-t.t)*s:0},e.transEval=function(t,i,n){at(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?r<s?i.s-t.s+r/(r+s)*(t.s-n.s):i.s-n.s+s/(r+s)*(n.s-t.s):0},e.transSign=function(t,i,n){at(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?(i.s-n.s)*r+(i.s-t.s)*s:0},e.vertCCW=function(t,i,n){return t.s*(i.t-n.t)+i.s*(n.t-t.t)+n.s*(t.t-i.t)>=0},e.interpolate=function(t,i,n,r){return(t=t<0?0:t)<=(n=n<0?0:n)?0===n?(i+r)/2:i+t/(t+n)*(r-i):r+n/(t+n)*(i-r)},e.intersect=function(t,i,n,r,s){var o,a,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(n,r)||(l=n,n=r,r=l),e.vertLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.vertLeq(n,i)?e.vertLeq(i,r)?((o=e.edgeEval(t,n,i))+(a=e.edgeEval(n,i,r))<0&&(o=-o,a=-a),s.s=e.interpolate(o,n.s,a,i.s)):((o=e.edgeSign(t,n,i))+(a=-e.edgeSign(t,r,i))<0&&(o=-o,a=-a),s.s=e.interpolate(o,n.s,a,r.s)):s.s=(n.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(n,r)||(l=n,n=r,r=l),e.transLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.transLeq(n,i)?e.transLeq(i,r)?((o=e.transEval(t,n,i))+(a=e.transEval(n,i,r))<0&&(o=-o,a=-a),s.t=e.interpolate(o,n.t,a,i.t)):((o=e.transSign(t,n,i))+(a=-e.transSign(t,r,i))<0&&(o=-o,a=-a),s.t=e.interpolate(o,n.t,a,r.t)):s.t=(n.t+i.t)/2},e}(),vv=function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},xw=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),ef=function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},GG=function(){function e(){var t=new ef,i=new vv,n=new xw(0),r=new xw(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,n.next=n,n.Sym=r,r.next=r,r.Sym=n,this.vHead=t,this.fHead=i,this.eHead=n,this.eHeadSym=r}return e.prototype.makeEdge_=function(t){var i=new xw(0),n=new xw(1);t.Sym.side<t.side&&(t=t.Sym);var r=t.Sym.next;return n.next=r,r.Sym.next=i,i.next=t,t.Sym.next=n,i.Sym=n,i.Onext=i,i.Lnext=n,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,n.Sym=i,n.Onext=n,n.Lnext=i,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,i},e.prototype.splice_=function(t,i){var n=t.Onext,r=i.Onext;n.Sym.Lnext=i,r.Sym.Lnext=t,t.Onext=r,i.Onext=n},e.prototype.makeVertex_=function(t,i,n){var r=t;at(r,"Vertex can't be null!");var s=n.prev;r.prev=s,s.next=r,r.next=n,n.prev=r,r.anEdge=i;var o=i;do{o.Org=r,o=o.Onext}while(o!==i)},e.prototype.makeFace_=function(t,i,n){var r=t;at(r,"Face can't be null");var s=n.prev;r.prev=s,s.next=r,r.next=n,n.prev=r,r.anEdge=i,r.trail=null,r.marked=!1,r.inside=n.inside;var o=i;do{o.Lface=r,o=o.Lnext}while(o!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,n=t.Sym.next;i.Sym.next=n,n.Sym.next=i},e.prototype.killVertex_=function(t,i){var n=t.anEdge,r=n;do{r.Org=i,r=r.Onext}while(r!==n);var s=t.prev,o=t.next;o.prev=s,s.next=o},e.prototype.killFace_=function(t,i){var n=t.anEdge,r=n;do{r.Lface=i,r=r.Lnext}while(r!==n);var s=t.prev,o=t.next;o.prev=s,s.next=o},e.prototype.makeEdge=function(){var t=new ef,i=new ef,n=new vv,r=this.makeEdge_(this.eHead);return this.makeVertex_(t,r,this.vHead),this.makeVertex_(i,r.Sym,this.vHead),this.makeFace_(n,r,this.fHead),r},e.prototype.splice=function(t,i){var n=!1,r=!1;if(t!==i){if(i.Org!==t.Org&&(r=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(n=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!r){var s=new ef;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!n){var o=new vv;this.makeFace_(o,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,n=!1;if(t.Lface!==t.Rface&&(n=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!n){var r=new vv;this.makeFace_(r,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),n=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var r=new ef;return this.makeVertex_(r,n,i.Org),i.Lface=n.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var n=this.addEdgeVertex(t).Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,n),t.Dst=n.Org,n.Dst.anEdge=n.Sym,n.Rface=t.Rface,n.winding=t.winding,n.Sym.winding=t.Sym.winding,n.idx=t.idx,n.Sym.idx=t.Sym.idx,n},e.prototype.connect=function(t,i){var n=!1,r=this.makeEdge_(t),s=r.Sym;if(i.Lface!==t.Lface&&(n=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(r,t.Lnext),this.splice_(s,i),r.Org=t.Dst,s.Org=i.Org,r.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!n){var o=new vv;this.makeFace_(o,r,t.Lface)}return r},e.prototype.zapFace=function(t){var n,r,s,o,a,i=t.anEdge;r=i.Lnext;do{r=(n=r).Lnext,n.Lface=null,null===n.Rface&&(n.Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),(s=n.Sym).Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(n))}while(n!=i);(a=t.next).prev=o=t.prev,o.next=a},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,n=0;do{n++,i=i.Lnext}while(i!==t.anEdge);return n},e.prototype.mergeConvexFaces=function(t){var i,n,r,s,o;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(o=(n=i.anEdge).Org;r=n.Lnext,(s=n.Sym)&&s.Lface&&s.Lface.inside&&this.countFaceVerts_(i)+this.countFaceVerts_(s.Lface)-2<=t&&$e.vertCCW(n.Lprev.Org,n.Org,s.Lnext.Lnext.Org)&&$e.vertCCW(s.Lprev.Org,s.Org,n.Lnext.Lnext.Org)&&(r=s.Lnext,this.delete(s),n=null,s=null),!n||n.Lnext.Org!==o;)n=r;return!0},e.prototype.check=function(){var r,s,o,a,l,c,t=this.fHead,i=this.vHead,n=this.eHead;for(s=t,s=t;(r=s.next)!==t;s=r){at(r.prev===s),l=r.anEdge;do{at(l.Sym!==l),at(l.Sym.Sym===l),at(l.Lnext.Onext.Sym===l),at(l.Onext.Sym.Lnext===l),at(l.Lface===r),l=l.Lnext}while(l!==r.anEdge)}for(at(r.prev===s&&null===r.anEdge),a=i,a=i;(o=a.next)!==i;a=o){at(o.prev===a),l=o.anEdge;do{at(l.Sym!==l),at(l.Sym.Sym===l),at(l.Lnext.Onext.Sym===l),at(l.Onext.Sym.Lnext===l),at(l.Org===o),l=l.Onext}while(l!==o.anEdge)}for(at(o.prev===a&&null===o.anEdge),c=n,c=n;(l=c.next)!==n;c=l)at(l.Sym.next===c.Sym),at(l.Sym!==l),at(l.Sym.Sym===l),at(null!==l.Org),at(null!==l.Dst),at(l.Lnext.Onext.Sym===l),at(l.Onext.Sym.Lnext===l);at(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&null===l.Org&&null===l.Dst&&null===l.Lface&&null===l.Rface)},e}(),WG=function e(){this.handle=null},qG=function e(){this.key=null,this.node=0},$Me=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var n=0;n<t+1;n++)this.nodes[n]=new WG,this.handles[n]=new qG;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var r,s,o,i=this.nodes,n=this.handles;for(r=i[t].handle;;){if((o=t<<1)<this.size&&this.leq(n[i[o+1].handle].key,n[i[o].handle].key)&&++o,at(o<=this.max),s=i[o].handle,o>this.size||this.leq(n[r].key,n[s].key)){i[t].handle=r,n[r].node=t;break}i[t].handle=s,n[s].node=t,t=o}},e.prototype.floatUp_=function(t){var r,s,o,i=this.nodes,n=this.handles;for(r=i[t].handle;;){if(s=i[o=t>>1].handle,0===o||this.leq(n[s].key,n[r].key)){i[t].handle=r,n[r].node=t;break}i[t].handle=s,n[s].node=t,t=o}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,n;if(2*(i=++this.size)>this.max){var r,s;for(this.max*=2,s=this.nodes.length,this.nodes.length=this.max+1,r=s;r<this.nodes.length;r++)this.nodes[r]=new WG;for(s=this.handles.length,this.handles.length=this.max+1,r=s;r<this.handles.length;r++)this.handles[r]=new qG}return 0===this.freeList?n=i:this.freeList=this.handles[n=this.freeList].node,this.nodes[i].handle=n,this.handles[n].node=i,this.handles[n].key=t,this.initialized&&this.floatUp_(i),n},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,n=t[1].handle,r=i[n].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[n].key=null,i[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),r},e.prototype.delete=function(t){var r,i=this.nodes,n=this.handles;at(t>=1&&t<=this.max&&null!==n[t].key),i[r=n[t].node].handle=i[this.size].handle,n[i[r].handle].node=r,--this.size,r<=this.size&&(r<=1||this.leq(n[i[r>>1].handle].key,n[i[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),n[t].key=null,n[t].node=this.freeList,this.freeList=t},e}(),bT=function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},YG=function e(){this.key=null,this.next=null,this.prev=null},JMe=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new YG,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do{i=i.next}while(null!==i.key&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do{t=t.prev}while(null!==t.key&&!this.leq(this.frame,t.key,i));var n=new YG;return n.key=i,n.next=t.next,t.next.prev=n,n.prev=t,t.next=n,n},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),eAe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,n){var r=t.event,s=i.eUp,o=n.eUp;return s.Dst===r?o.Dst===r?$e.vertLeq(s.Org,o.Org)?$e.edgeSign(o.Dst,s.Org,o.Org)<=0:$e.edgeSign(s.Dst,o.Org,s.Org)>=0:$e.edgeSign(o.Dst,r,o.Org)<=0:o.Dst===r?$e.edgeSign(s.Dst,r,s.Org)>=0:$e.edgeEval(s.Dst,r,s.Org)>=$e.edgeEval(o.Dst,r,o.Org)},e.deleteRegion=function(t,i){i.fixUpperEdge&&at(0===i.eUp.winding),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,n){at(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=n,n.activeRegion=i},e.topLeftRegion=function(t,i){var r,n=i.eUp.Org;do{i=e.regionAbove(i)}while(i.eUp.Org===n);if(i.fixUpperEdge){if(null===(r=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext)))return null;e.fixUpperEdge(t,i,r),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,n){var r=new bT;return r.eUp=n,r.nodeUp=t.dict.insertBefore(i.nodeUp,r),r.fixUpperEdge=!1,r.sentinel=!1,r.dirty=!1,n.activeRegion=r,r},e.isWindingInside=function(t,i){switch(t.windingRule){case fi.ODD:return 0!=(1&i);case fi.NONZERO:return 0!==i;case fi.POSITIVE:return i>0;case fi.NEGATIVE:return i<0;case fi.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var n=i.eUp,r=n.Lface;r.inside=i.inside,r.anEdge=n,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,n){for(var r,s=null,o=i,a=i.eUp;o!==n;){if(o.fixUpperEdge=!1,(r=(s=e.regionBelow(o)).eUp).Org!=a.Org){if(!s.fixUpperEdge){e.finishRegion(t,o);break}r=t.mesh.connect(a.Lprev,r.Sym),e.fixUpperEdge(t,s,r)}a.Onext!==r&&(t.mesh.splice(r.Oprev,r),t.mesh.splice(a,r)),e.finishRegion(t,o),a=s.eUp,o=s}return a},e.addRightEdges=function(t,i,n,r,s,o){var a,l,c,h,u=!0;c=n;do{at($e.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext}while(c!==r);for(null===s&&(s=e.regionBelow(i).eUp.Rprev),l=i,h=s;(c=(a=e.regionBelow(l)).eUp.Sym).Org===h.Org;)c.Onext!==h&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(h.Oprev,c)),a.windingNumber=l.windingNumber-c.winding,a.inside=e.isWindingInside(t,a.windingNumber),l.dirty=!0,!u&&e.checkForRightSplice(t,l)&&(e.addWinding(c,h),e.deleteRegion(t,l),t.mesh.delete(h)),u=!1,l=a,h=c;l.dirty=!0,at(l.windingNumber-c.winding===a.windingNumber),o&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,n){t.mesh.splice(i,n)},e.vertexWeights=function(t,i,n){var r=$e.vertL1dist(i,t),s=$e.vertL1dist(n,t),o=.5*s/(r+s),a=.5*r/(r+s);t.coords[0]+=o*i.coords[0]+a*n.coords[0],t.coords[1]+=o*i.coords[1]+a*n.coords[1],t.coords[2]+=o*i.coords[2]+a*n.coords[2]},e.getIntersectData=function(t,i,n,r,s,o){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,n,r),e.vertexWeights(i,s,o)},e.checkForRightSplice=function(t,i){var n=e.regionBelow(i),r=i.eUp,s=n.eUp;if($e.vertLeq(r.Org,s.Org)){if($e.edgeSign(s.Dst,r.Org,s.Org)>0)return!1;$e.vertEq(r.Org,s.Org)?r.Org!==s.Org&&(t.pq.delete(r.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,r)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(r,s.Oprev),i.dirty=n.dirty=!0)}else{if($e.edgeSign(r.Dst,s.Org,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),t.mesh.splice(s.Oprev,r)}return!0},e.checkForLeftSplice=function(t,i){var o,n=e.regionBelow(i),r=i.eUp,s=n.eUp;if(at(!$e.vertEq(r.Dst,s.Dst)),$e.vertLeq(r.Dst,s.Dst)){if($e.edgeSign(r.Dst,s.Dst,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,o=t.mesh.splitEdge(r),t.mesh.splice(s.Sym,o),o.Lface.inside=i.inside}else{if($e.edgeSign(s.Dst,r.Dst,s.Org)>0)return!1;i.dirty=n.dirty=!0,o=t.mesh.splitEdge(s),t.mesh.splice(r.Lnext,s.Sym),o.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var p,f,n=e.regionBelow(i),r=i.eUp,s=n.eUp,o=r.Org,a=s.Org,l=r.Dst,c=s.Dst,d=new ef;if(at(!$e.vertEq(c,l)),at($e.edgeSign(l,t.event,o)<=0),at($e.edgeSign(c,t.event,a)>=0),at(o!==t.event&&a!==t.event),at(!i.fixUpperEdge&&!n.fixUpperEdge),o===a||Math.min(o.t,l.t)>Math.max(a.t,c.t))return!1;if($e.vertLeq(o,a)){if($e.edgeSign(c,o,a)>0)return!1}else if($e.edgeSign(l,a,o)<0)return!1;return e.debugEvent(t),$e.intersect(l,o,c,a,d),at(Math.min(o.t,l.t)<=d.t),at(d.t<=Math.max(a.t,c.t)),at(Math.min(c.s,l.s)<=d.s),at(d.s<=Math.max(a.s,o.s)),$e.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=$e.vertLeq(o,a)?o:a,$e.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),$e.vertEq(d,o)||$e.vertEq(d,a)?(e.checkForRightSplice(t,i),!1):!$e.vertEq(l,t.event)&&$e.edgeSign(l,t.event,d)>=0||!$e.vertEq(c,t.event)&&$e.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(r.Sym),t.mesh.splice(s.Sym,r),i=e.topLeftRegion(t,i),r=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),n),e.addRightEdges(t,i,r.Oprev,r,r,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(r.Lnext,s.Oprev),n=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,n.eUp=s.Oprev,s=e.finishLeftRegions(t,n,null),e.addRightEdges(t,i,s.Onext,r.Rprev,f,!0),!0):($e.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),r.Org.s=t.event.s,r.Org.t=t.event.t),$e.edgeSign(c,t.event,d)<=0&&(i.dirty=n.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(r.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,r),r.Org.s=d.s,r.Org.t=d.t,r.Org.pqHandle=t.pq.insert(r.Org),e.getIntersectData(t,r.Org,o,l,a,c),e.regionAbove(i).dirty=i.dirty=n.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r,s,n=e.regionBelow(i);;){for(;n.dirty;)i=n,n=e.regionBelow(n);if(!i.dirty&&(n=i,null===(i=e.regionAbove(i))||!i.dirty))return;if(i.dirty=!1,(r=i.eUp).Dst!==(s=n.eUp).Dst&&e.checkForLeftSplice(t,i)&&(n.fixUpperEdge?(e.deleteRegion(t,n),t.mesh.delete(s),s=(n=e.regionBelow(i)).eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(r),r=(i=e.regionAbove(n)).eUp)),r.Org!==s.Org)if(r.Dst===s.Dst||i.fixUpperEdge||n.fixUpperEdge||r.Dst!==t.event&&s.Dst!==t.event)e.checkForRightSplice(t,i);else if(e.checkForIntersect(t,i))return;r.Org===s.Org&&r.Dst===s.Dst&&(e.addWinding(s,r),e.deleteRegion(t,i),t.mesh.delete(r),i=e.regionAbove(n))}},e.connectRightVertex=function(t,i,n){var r,s=n.Onext,o=e.regionBelow(i),a=i.eUp,l=o.eUp,c=!1;a.Dst!==l.Dst&&e.checkForIntersect(t,i),$e.vertEq(a.Org,t.event)&&(t.mesh.splice(s.Oprev,a),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),o),c=!0),$e.vertEq(l.Org,t.event)&&(t.mesh.splice(n,l.Oprev),n=e.finishLeftRegions(t,o,null),c=!0),c?e.addRightEdges(t,i,n.Onext,s,s,!0):(r=$e.vertLeq(l.Org,a.Org)?l.Oprev:a,r=t.mesh.connect(n.Lprev,r),e.addRightEdges(t,i,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i))},e.connectLeftDegenerate=function(t,i,n){var r,s,o,a,l;return $e.vertEq((r=i.eUp).Org,n)?(at(!1),void e.spliceMergeVertices(t,r,n.anEdge)):$e.vertEq(r.Dst,n)?(at(!1),i=e.topRightRegion(i),s=a=(o=(l=e.regionBelow(i)).eUp.Sym).Onext,l.fixUpperEdge&&(at(s!==o),e.deleteRegion(t,l),t.mesh.delete(o),o=s.Oprev),t.mesh.splice(n.anEdge,o),$e.edgeGoesLeft(s)||(s=null),void e.addRightEdges(t,i,o.Onext,a,s,!0)):(t.mesh.splitEdge(r.Sym),i.fixUpperEdge&&(t.mesh.delete(r.Onext),i.fixUpperEdge=!1),t.mesh.splice(n.anEdge,r),void e.sweepEvent(t,n))},e.connectLeftVertex=function(t,i){var n,r,s,o,a,l,c=new bT;if(c.eUp=i.anEdge.Sym,n=t.dict.search(c).key,r=e.regionBelow(n)){if(a=r.eUp,0===$e.edgeSign((o=n.eUp).Dst,i,o.Org))return void e.connectLeftDegenerate(t,n,i);s=$e.vertLeq(a.Dst,o.Dst)?n:r,n.inside||s.fixUpperEdge?(l=s===n?t.mesh.connect(i.anEdge.Sym,o.Lnext):t.mesh.connect(a.Dnext,i.anEdge).Sym,s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,n,l)),e.sweepEvent(t,i)):e.addRightEdges(t,n,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var n=i.anEdge;null===n.activeRegion;)if((n=n.Onext)===i.anEdge)return void e.connectLeftVertex(t,i);var r=e.topLeftRegion(t,n.activeRegion);at(null!==r);var s=e.regionBelow(r),o=s.eUp,a=e.finishLeftRegions(t,s,null);a.Onext===o?e.connectRightVertex(t,r,a):e.addRightEdges(t,r,a.Onext,o,o,!0)},e.addSentinel=function(t,i,n,r){var s=new bT,o=t.mesh.makeEdge();o.Org.s=n,o.Org.t=r,o.Dst.s=i,o.Dst.t=r,t.event=o.Dst,s.eUp=o,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new JMe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],n=t.bmax[1]-t.bmin[1],r=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmax[1]+n;e.addSentinel(t,r,s,t.bmin[1]-n),e.addSentinel(t,r,s,a)},e.doneEdgeDict=function(t){for(var i,n=0;null!==(i=t.dict.min().key);)i.sentinel||(at(i.fixUpperEdge),at(1==++n)),at(0===i.windingNumber),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,n,r,s=t.mesh.eHead;for(i=s.next;i!==s;i=n)n=i.next,r=i.Lnext,$e.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,r,i),t.mesh.delete(i),r=(i=r).Lnext),r.Lnext===i&&(r!==i&&((r===n||r===n.Sym)&&(n=n.next),t.mesh.delete(r)),(i===n||i===n.Sym)&&(n=n.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,n,r,s=0;for(n=(r=t.mesh.vHead).next;n!==r;n=n.next)s++;for(i=t.pq=new $Me(s+=8,$e.vertLeq),n=(r=t.mesh.vHead).next;n!==r;n=n.next)n.pqHandle=i.insert(n);return n===r&&(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var n,r,s;for(n=i.fHead.next;n!==i.fHead;n=r)r=n.next,at((s=n.anEdge).Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){var n,r;if(void 0===i&&(i=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(n=t.pq.extractMin());){for(;null!==(r=t.pq.min())&&$e.vertEq(r,n);)r=t.pq.extractMin(),e.spliceMergeVertices(t,n.anEdge,r.anEdge);e.sweepEvent(t,n)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(i&&t.mesh.check(),!0)},e}(),tAe=function(){function e(){this.mesh=new GG,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=fi.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,n,r,s,o,a,l=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],m=this.mesh.vHead;i=m.next;for(var g=0;g<3;++g)c[g]=s=i.coords[g],f[g]=i,l[g]=s,p[g]=i;for(i=m.next;i!==m;i=i.next)for(var v=0;v<3;++v)(s=i.coords[v])<c[v]&&(c[v]=s,f[v]=i),s>l[v]&&(l[v]=s,p[v]=i);var y=0;if(l[1]-c[1]>l[0]-c[0]&&(y=1),l[2]-c[2]>l[y]-c[y]&&(y=2),c[y]>=l[y])return t[0]=0,t[1]=0,void(t[2]=1);for(a=0,h[0]=(n=f[y]).coords[0]-(r=p[y]).coords[0],h[1]=n.coords[1]-r.coords[1],h[2]=n.coords[2]-r.coords[2],i=m.next;i!==m;i=i.next)u[0]=i.coords[0]-r.coords[0],u[1]=i.coords[1]-r.coords[1],u[2]=i.coords[2]-r.coords[2],d[0]=h[1]*u[2]-h[2]*u[1],d[1]=h[2]*u[0]-h[0]*u[2],d[2]=h[0]*u[1]-h[1]*u[0],(o=d[0]*d[0]+d[1]*d[1]+d[2]*d[2])>a&&(a=o,t[0]=d[0],t[1]=d[1],t[2]=d[2]);a<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(h)]=1)},e.prototype.checkOrientation_=function(){for(var i,r,t=this.mesh.fHead,n=this.mesh.vHead,s=0,o=t.next;o!==t;o=o.next)if(!((r=o.anEdge).winding<=0))do{s+=(r.Org.s-r.Dst.s)*(r.Org.t+r.Dst.t),r=r.Lnext}while(r!==o.anEdge);if(s<0){for(i=n.next;i!==n;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var n,r,t=this.mesh.vHead,i=[0,0,0],s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),n=this.sUnit,r=this.tUnit;var o=this.longAxis_(i);n[o]=0,n[(o+1)%3]=1,n[(o+2)%3]=0,r[o]=0,r[(o+1)%3]=0,r[(o+2)%3]=i[o]>0?1:-1;for(var a=t.next;a!==t;a=a.next)a.s=this.dot_(a.coords,n),a.t=this.dot_(a.coords,r);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var n,r;if((n=i.anEdge).Lnext===n||n.Lnext.Lnext===n)throw"Mono region invalid";for(;$e.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;$e.vertLeq(n.Org,n.Dst);n=n.Lnext);for(r=n.Lprev;n.Lnext!==r;)if($e.vertLeq(n.Dst,r.Org)){for(;r.Lnext!==n&&($e.edgeGoesLeft(r.Lnext)||$e.edgeSign(r.Org,r.Dst,r.Lnext.Dst)<=0);)r=t.connect(r.Lnext,r).Sym;r=r.Lprev}else{for(;r.Lnext!==n&&($e.edgeGoesRight(n.Lprev)||$e.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);)n=t.connect(n,n.Lprev).Sym;n=n.Lnext}if(r.Lnext===n)throw"Mono region invalid";for(;r.Lnext.Lnext!==n;)r=t.connect(r.Lnext,r).Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)if(i=n.next,n.inside&&!this.tessellateMonoRegion_(t,n))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,n=t.fHead.next;n!==t.fHead;n=i)i=n.next,n.inside||t.zapFace(n)},e.prototype.setWindingNumber_=function(t,i,n){for(var r,s=t.eHead.next;s!==t.eHead;s=r)r=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:n?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return t.Rface&&t.Rface.inside?t.Rface.n:-1},e.prototype.outputPolymesh_=function(t,i,n,r){var s,l,o=0,a=0;n>3&&t.mergeConvexFaces(n);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.n=-1,h.inside){s=h.anEdge,l=0;do{-1===(c=s.Org).n&&(c.n=a,a++),l++,s=s.Lnext}while(s!==h.anEdge);if(l>n)throw"Face vertex greater that support polygon";h.n=o,++o}for(this.elementCount=o,i===Cn.CONNECTED_POLYGONS&&(o*=2),this.elements=[],this.elements.length=o*n,this.vertexCount=a,this.vertices=[],this.vertices.length=a*r,this.vertexIndices=[],this.vertexIndices.length=a,c=t.vHead.next;c!==t.vHead;c=c.next)if(-1!==c.n){var u=c.n*r;this.vertices[u+0]=c.coords[0],this.vertices[u+1]=c.coords[1],r>2&&(this.vertices[u+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}var d=0;for(h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){s=h.anEdge,l=0;do{this.elements[d++]=(c=s.Org).n,l++,s=s.Lnext}while(s!==h.anEdge);for(var p=l;p<n;++p)this.elements[d++]=-1;if(i===Cn.CONNECTED_POLYGONS){s=h.anEdge;do{this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext}while(s!==h.anEdge);for(var f=l;f<n;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var n,r,s=0,o=0;this.vertexCount=0,this.elementCount=0;for(var a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){r=n=a.anEdge;do{this.vertexCount++,n=n.Lnext}while(n!==r);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,h=0;for(s=0,a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){o=0,r=n=a.anEdge;do{this.vertices[l++]=n.Org.coords[0],this.vertices[l++]=n.Org.coords[1],i>2&&(this.vertices[l++]=n.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(n):n.Org.idx,o++,n=n.Lnext}while(n!==r);this.elements[h++]=s,this.elements[h++]=o,s+=o}},e.prototype.addContour=function(t,i){null===this.mesh&&(this.mesh=new GG),t<2&&(t=2),t>3&&(t=3);for(var n=null,r=0;r<i.length;r+=t)null===n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=i[r+0],n.Org.coords[1]=i[r+1],n.Org.coords[2]=t>2?i[r+2]:0,n.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(n),n.winding=1,n.Sym.winding=-1},e.prototype.tesselate=function(t,i,n,r,s,o){if(void 0===t&&(t=fi.ODD),void 0===i&&(i=Cn.POLYGONS),void 0===o&&(o=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,r<2&&(r=2),r>3&&(r=3),!this.mesh)return!1;this.projectPolygon_(),eAe.computeInterior(this,o);var a=this.mesh;return i===Cn.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),o&&a.check(),i===Cn.BOUNDARY_CONTOURS?this.outputContours_(a,r):this.outputPolymesh_(a,i,n,r),!0},e}();function Hc(e){var t=e.windingRule,i=void 0===t?fi.ODD:t,n=e.elementType,r=void 0===n?Cn.POLYGONS:n,s=e.polySize,o=void 0===s?3:s,a=e.vertexSize,l=void 0===a?2:a,c=e.normal,h=void 0===c?[0,0,1]:c,u=e.contours,d=void 0===u?[]:u,p=e.strict,f=void 0===p||p,m=e.debug,g=void 0!==m&&m;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new tAe;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(i,r,o,l,h,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}var wT=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`),this.buffer=new ArrayBuffer(e*wT.eSize);let n=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.normals=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.uvs=new Float32Array(this.buffer,r*n,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${e}`);let n=new ArrayBuffer(e*wT.eSize),r=Float32Array.BYTES_PER_ELEMENT,s=0,o=new Float32Array(n,s*r,3*e);s+=3*e;let a=new Float32Array(n,s*r,3*e);s+=3*e;let l=new Float32Array(n,s*r,2*e);t?(o.set(this.positions.subarray(0,3*this.size)),a.set(this.normals.subarray(0,3*this.size)),l.set(this.uvs.subarray(0,2*this.size))):(o.set(this.positions),a.set(this.normals),l.set(this.uvs)),this.buffer=n,this.positions=o,this.normals=a,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let n=this.capacity;for(;t>n;)n*=2;this.realloc(n)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},XG=wT;XG.eSize=8*Float32Array.BYTES_PER_ELEMENT;var iAe=Wn(fue()),xT={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},ZG={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},QG={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},ST=(e,t)=>([i,n])=>(n<i&&(n+=t),(e>=i?e:e+t)<=n),CT=class extends Ze{constructor(e,t,i=0,n=12,r=3,s=fi.ODD,o=!1){super(),this.forPathBevel=o,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=n,this._bevelSegmentsInput=r;let u,d,p,a=this._shape.extractShapePointsToFlatArray([],n),l=this._shape.shapeHoles.map(E=>{let D=E.extractShapePointsToFlatArray([],n),T=[];for(let I=D.length-1;I>=1;I-=2)T.push(D[I-1],D[I-0]);return T}),c=[],h=[];for(let E=0;E<a.length;E+=2)h.push([a[E],a[E+1]]);c.push(h);for(let E=0;E<l.length;E++){let D=l[E],T=[];for(let I=0;I<D.length;I+=2)T.push([D[I],D[I+1]]);c.push(T)}u=e.isText?.1*(new p4).setFromPoints(e.points.map(E=>E.position)).getSize(new z).length():0===c[0].length?i:(0,iAe.default)(c).distance,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,u,t/2),this._bevelSegments=Math.floor(r));try{d=Hc({windingRule:s,elementType:Cn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[a]})}catch{d=xT}try{p=Hc({windingRule:fi.ODD,elementType:Cn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=ZG}if(!d)throw new Error("error generating geometry");let f=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let E=0;E<p.elements.length;E++)d.elements.push(p.elements[E]+(E%2==0?d.vertexCount:0));for(let E=0;E<p.vertexIndices.length;E++)d.vertexIndices.push(p.vertexIndices[E]+d.vertexCount);for(let E=0;E<p.vertices.length;E++)d.vertices.push(p.vertices[E])}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let E=0,D=d.vertexCount;E<D;E++){let T=2*E,I=d.vertices[T+0],P=d.vertices[T+1];I<m&&(m=I),I>g&&(g=I),P<v&&(v=P),P>y&&(y=P)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new XG(this._computeBufferEstimatedSize(d));let _=[],b=[];for(let E=d.elementCount-1;E>=0;E--){let D=E>=f,T=2*E,I=d.elements[T+0],P=d.elements[T+1],R=I+P,L={start:I,count:P,normals:[],continuous:[],concave:[]},j=I,F=R-1,N=I+1,q=this._shape.roundedCurves.length;do{let G=j-I,re=d.vertices[2*j+0],K=d.vertices[2*j+1],se=d.vertices[2*N+0],$=d.vertices[2*N+1],ge=re-d.vertices[2*F+0],ce=K-d.vertices[2*F+1],ae=Math.sqrt(ge*ge+ce*ce);ge/=ae,ce/=ae;let Oe=re-se,Re=K-$,Ne=Math.sqrt(Oe*Oe+Re*Re);Oe/=Ne,Re/=Ne,L.normals[2*G+0]=-Re,L.normals[2*G+1]=Oe,L.concave[G]=ge*Re-ce*Oe>0;let Ue=d.vertexIndices[j];if(Array.isArray(Ue))L.continuous[G]=!1;else{let[De,Ce]=this._shape.getCurveIndexFromVertexId(Ue-1,!0);if(Ce>0&&Ce<1)L.continuous[G]=!0;else{let Qe=1===Ce?De+1:De-1;Qe=(Qe+q)%q;let mt=1===Ce?0:1,B=this._shape.roundedCurves[De].getTangent(Ce),O=this._shape.roundedCurves[Qe].getTangent(mt);L.continuous[G]=B.dot(O)>.95}}D&&(L.normals[2*G+0]*=-1,L.normals[2*G+1]*=-1),[F,j,N]=[j,N,N+1],N>=R&&(N-=P)}while(N!==I+1);let W=[];W.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(2*I,2*R),vertexCount:P,vertexIndices:new Array(P).fill(!0).map((G,X)=>[X,X]),elements:[0,P],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(2*I,2*R)});let U=0;for(let G=1;G<=this._bevelSegments;G++){let X=G/this._bevelSegments*Math.PI/2,H=(1-Math.cos(X))*this._bevel,re=[],K=[],se=[],$=[],ge=0;for(let ae=0;ae<P;ae++){let Oe=2*ae,Re=(ae-1+P)%P*2,Ne=d.vertices[2*L.start+Oe+0],Ue=d.vertices[2*L.start+Oe+1],De=-L.normals[Re+0]*H,Ce=-L.normals[Re+1]*H,Qe=-L.normals[Oe+0]*H,mt=-L.normals[Oe+1]*H;if(L.concave[ae]||!L.concave[ae]&&D){let B=Math.atan2(Ce,De),O=Math.atan2(mt,Qe);O>B&&(O-=2*Math.PI);let te=O-B;if(L.continuous[ae]||D){let xe=B+te/2,fe=Math.cos(xe)*H,Ee=Math.sin(xe)*H;re[2*ge+0]=Ne+fe*(D?-1:1),re[2*ge+1]=Ue+Ee*(D?-1:1),$[ge]=ae,ge++}else{let xe=Math.max(1,Math.floor(n/4*Math.abs(te)/Math.PI));for(let fe=0;fe<=xe;fe++){let Ee=B+te*(fe/xe),Ye=Math.cos(Ee)*H,Be=Math.sin(Ee)*H;re[2*ge+0]=Ne+Ye,re[2*ge+1]=Ue+Be,$[ge]=ae,ge++}}}else re[2*ge+0]=Ne+De,re[2*ge+1]=Ue+Ce,$[ge]=ae,K[ae]=ge,ge++,re[2*ge+0]=Ne,re[2*ge+1]=Ue,$[ge]=ae,ge++,re[2*ge+0]=Ne+Qe,re[2*ge+1]=Ue+mt,$[ge]=ae,se[ae]=ge,ge++}let ce=Hc({windingRule:fi.POSITIVE,elementType:Cn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[re],edgeCreateCallback:ae=>{let Oe=ae.Org.idx,Re=$[Oe],Ne=$[(Oe+1)%$.length];ae.idx=[Re,Ne],ae.Sym.idx=[Ne,Re]},vertexIdCallback:ae=>{let Oe=ae.Lprev.idx;return[Oe?Oe[1]:0,ae.idx?ae.idx[0]:0]}});if(!ce)throw console.log("Error"),new Error(`error generating bevel geometry for ${G}'th loop`);if(!ce.vertexCount){let ae=(G-1)/this._bevelSegments*Math.PI/2;U=(1-Math.sin(ae))*this._bevel;break}for(let ae=0;ae<ce.vertexIndices.length;ae++){let[Oe,Re]=ce.vertexIndices[ae];if(Oe===Re)continue;let Ne=Re;Re<Oe&&(Ne+=P);for(let Ue=Oe;Ue<Ne;Ue++){let De=Ue%P,Ce=(Ue+1)%P;if(!L.continuous[De]||!L.continuous[Ce]){ce.vertexIndices[ae]=[Oe,De],ce.vertexIndices.splice(ae+1,0,[Ce,Re]),ce.vertices.splice(2*(ae+1),0,ce.vertices[2*ae],ce.vertices[2*ae+1]);break}}}W.push({bevelI:G,angle:X,size:H,boundary:ce,reverseMap:$,insetPoints:re})}let V=(G,X,H)=>{let re=0,K=G.boundary.vertexIndices.length;for(;re<K&&H(G.boundary.vertexIndices[X]);)X=(X+1)%K,re++;return re},Y=_.length;for(let G=1;G<W.length;G++){let X=W[G-1],H=W[G],re=X.boundary.vertexIndices.length,K=H.boundary.vertexIndices.length;if(!re||!K)break;let se=L.concave.length,$=0,ge=ST($,P);for(;!X.boundary.vertexIndices.filter(ge).length||!H.boundary.vertexIndices.filter(ge).length;)$++,ge=ST($,P);let ce=X.boundary.vertexIndices.findIndex(ge),ae=H.boundary.vertexIndices.findIndex(ge);do{ce=(ce+1)%re}while(ge(X.boundary.vertexIndices[ce]));do{ae=(ae+1)%K}while(ge(H.boundary.vertexIndices[ae]));$=($+1)%P;let Qe,mt,Oe=$,Re=0,De=this._buildBevelVert(L,X,(ce-1+re)%re,void 0,Re),Ce=this._buildBevelVert(L,H,(ae-1+K)%K,void 0,Re),B=!1;do{Re=($||se)/se,ge=ST($,P);let O=V(X,ce,ge),te=V(H,ae,ge),xe=B;if(B=!1,O&&!te){for(let fe=0;fe<O;fe++)Qe=this._buildBevelVert(L,X,(ce+fe)%re,fe/(O-1),Re),_.push(De.topN,Qe.topP,Ce.topN),!1===o&&_.push(Qe.bottomP,De.bottomN,Ce.bottomN),De=Qe;B=!0}else if(!O&&te)for(let fe=0;fe<te;fe++)mt=this._buildBevelVert(L,H,(ae+fe)%K,fe/(te-1),Re),_.push(Ce.topN,De.topP,mt.topP),!1===o&&_.push(De.bottomP,Ce.bottomN,mt.bottomP),Ce=mt;else if(O&&te)if(Qe=this._buildBevelVert(L,X,ce,0,Re),mt=this._buildBevelVert(L,H,ae,0,Re),xe?(_.push(De.topN,mt.topP,Ce.topN),_.push(De.topN,Qe.topP,mt.topP),!1===o&&(_.push(mt.bottomP,De.bottomN,Ce.bottomN),_.push(mt.bottomP,Qe.bottomP,De.bottomN))):(_.push(Ce.topN,De.topN,Qe.topP),_.push(Ce.topN,Qe.topP,mt.topP),!1===o&&(_.push(Qe.bottomP,De.bottomN,Ce.bottomN),_.push(Qe.bottomP,Ce.bottomN,mt.bottomP))),De=Qe,Ce=mt,O===te)for(let fe=1;fe<O;fe++)Qe=this._buildBevelVert(L,X,(ce+fe)%re,fe/(O-1),Re),mt=this._buildBevelVert(L,H,(ae+fe)%K,fe/(te-1),Re),_.push(De.topN,Qe.topP,Ce.topN),_.push(Ce.topN,Qe.topP,mt.topP),!1===o&&(_.push(Qe.bottomP,De.bottomN,Ce.bottomN),_.push(Qe.bottomP,Ce.bottomN,mt.bottomP)),De=Qe,Ce=mt;else if(O>te){let fe=O/te,Ee=0;for(let Ye=1;Ye<O;Ye++)Qe=this._buildBevelVert(L,X,(ce+Ye)%re,Ye/(O-1),Re),_.push(De.topN,Qe.topP,Ce.topN),!1===o&&_.push(Qe.bottomP,De.bottomN,Ce.bottomN),De=Qe,Ye>(Ee+1)*fe&&(Ee++,mt=this._buildBevelVert(L,H,(ae+Ee)%K,Ee/(te-1),Re),_.push(Ce.topN,Qe.topP,mt.topP),!1===o&&_.push(Qe.bottomP,Ce.bottomN,mt.bottomP),Ce=mt)}else{let fe=te/O,Ee=0;for(let Ye=1;Ye<te;Ye++)mt=this._buildBevelVert(L,H,(ae+Ye)%K,Ye/(te-1),Re),_.push(Ce.topN,Qe.topP,mt.topP),!1===o&&_.push(Qe.bottomP,Ce.bottomN,mt.bottomP),Ce=mt,Ye>(Ee+1)*fe&&(Ee++,Qe=this._buildBevelVert(L,X,(ce+Ee)%re,Ee/(O-1),Re),_.push(De.topN,Qe.topP,Ce.topN),!1===o&&_.push(Qe.bottomP,De.bottomN,Ce.bottomN),De=Qe)}ce=(ce+O)%re,ae=(ae+te)%K,$=($+1)%se}while($!==Oe)}if(!1===o&&this._depth>2*this._bevel&&this._buildWall(W,L,_),D){let G=[];for(let X=_.length-1;X>=Y+2;X-=3)G.push(_[X-0],_[X-1],_[X-2]);_.splice(Y,_.length-Y,...G)}if(D){let G=[];for(let X=W[W.length-1].boundary.vertices.length-1;X>=1;X-=2)G.push(W[W.length-1].boundary.vertices[X-1],W[W.length-1].boundary.vertices[X-0]);b.push(G)}if(!D){let X,G=W[W.length-1];try{X=Hc({windingRule:W.length>1?fi.POSITIVE:fi.ODD,elementType:Cn.POLYGONS,vertexSize:2,strict:!0,contours:[G.insetPoints,...b]})}catch{X=QG}if(!X)throw new Error("Error generating geometry for surface");0===l.length&&this._bevel<u&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let H=0;H<3*X.elementCount;H+=3){let re=this._buildSurfaceVert(X,X.elements[H+0],U),K=this._buildSurfaceVert(X,X.elements[H+1],U),se=this._buildSurfaceVert(X,X.elements[H+2],U);_.push(re.top,K.top,se.top),!1===o&&_.push(se.bottom,K.bottom,re.bottom)}}this.vertexCache={}}this._buffer.shrink();let w=new st(Uint32Array.from(_),1),C=new st(this._buffer.positions,3),x=new st(this._buffer.normals,3),S=new st(this._buffer.uvs,2);C.needsUpdate=!0,x.needsUpdate=!0,S.needsUpdate=!0,w.needsUpdate=!0,this.setAttribute("position",C),this.setAttribute("normal",x),this.setAttribute("uv",S),this.setIndex(w)}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let o=this._buildBevelVert(t,n,r),a=this._buildBevelVert(t,n,(r+1)%s);i.push(a.topP,o.topN,o.bottomN),i.push(a.topP,o.bottomN,a.bottomP)}}_buildSurfaceVert(e,t,i){let n=t.toString();if(n in this.vertexCache)return this.vertexCache[n];let r=e.vertices[2*t+0],s=e.vertices[2*t+1],o=(r-this._minX)/this._width,a=(s-this._minY)/this._height;this.forPathBevel&&(a=1);let l=this._buffer.get(this.forPathBevel?1:2),c=3*l,h=2*l,u={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=r,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[h+0]=o,this._buffer.uvs[h+1]=a,!1===this.forPathBevel&&(this._buffer.positions[c+3]=r,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[h+2]=o,this._buffer.uvs[h+3]=a),this.vertexCache[n]=u,u}_buildBevelVert(e,t,i,n=1,r){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&0!==r&&1!==r&&(!r||r===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let l,c,h,u,[o,a]=t.boundary.vertexIndices[i];o!==a?(c=o,l=a,u=!1,h=e.continuous[c]&&e.continuous[l]):(l=o,c=(l-1+e.count)%e.count,u=e.concave[l]&&t.bevelI>0,h=e.continuous[l]||u);let d=Math.cos(t.angle),p=Math.sin(t.angle),f=2*i,m=2*l,g=2*c,v=t.boundary.vertices[f+0],y=t.boundary.vertices[f+1],_=(1-p)*this._bevel,b=(v-this._minX)/this._width,w=(y-this._minY)/this._height;this.forPathBevel&&(void 0!==r&&(b=r),w=1);let C=e.normals[m+0],x=e.normals[m+1],S=e.normals[g+0],E=e.normals[g+1];if(u){C+=(S-C)*(1-n),x+=(E-x)*(1-n);let j=Math.sqrt(C*C+x*x);C/=j,x/=j}let D=this._buffer.get(this.forPathBevel?h?1:2:h?2:4),T=3*D,I=2*D,P={i,fi:l,topP:D+0,topN:D+0,bottomP:D+1,bottomN:D+1,pathBevelUCoord:r};return this._buffer.positions[T+0]=v,this._buffer.positions[T+1]=y,this._buffer.positions[T+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[T+0]=C*d,this._buffer.normals[T+1]=x*d,this._buffer.normals[T+2]=p,this._buffer.uvs[I+0]=b,this._buffer.uvs[I+1]=w,!1===this.forPathBevel&&(this._buffer.positions[T+3]=v,this._buffer.positions[T+4]=y,this._buffer.positions[T+5]=_,this._buffer.normals[T+3]=C*d,this._buffer.normals[T+4]=x*d,this._buffer.normals[T+5]=-p,this._buffer.uvs[I+2]=w,this._buffer.uvs[I+3]=b),h||(this.forPathBevel?(D+=1,T+=3,I+=2):(D+=2,T+=6,I+=4),P.topP=D+0,P.bottomP=D+1,this._buffer.positions[T+0]=v,this._buffer.positions[T+1]=y,this._buffer.positions[T+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[T+0]=S*d,this._buffer.normals[T+1]=E*d,this._buffer.normals[T+2]=p,this._buffer.uvs[I+0]=b,this._buffer.uvs[I+1]=w,!1===this.forPathBevel&&(this._buffer.positions[T+3]=v,this._buffer.positions[T+4]=y,this._buffer.positions[T+5]=_,this._buffer.normals[T+3]=S*d,this._buffer.normals[T+4]=E*d,this._buffer.normals[T+5]=-p,this._buffer.uvs[I+2]=w,this._buffer.uvs[I+3]=b)),this.vertexCache[s]=P,P}clone(){let e=new CT(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Db(this.userData),e}},KG=class extends Ze{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=fi.ODD,this.elementType=Cn.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:fi.ODD,elementType:Cn.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let s,l,c,n=this._shape.extractShapePointsToFlatArray([],this._curveSegments),r=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),o=!0,a=!0;for(let d=0,p=n.length/2;d<p;d++){let f=2*d,m=n[f+0],g=n[f+1];if(void 0!==l&&m!==l&&(o=!1),void 0!==c&&g!==c&&(a=!1),l=m,c=g,!o&&!a)break}if(!o&&!a)try{s=Hc({contours:[n,...r],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=xT}let h=s?.vertexCount??1,u=s?.elementCount??1;if(this._positionAttribute=new st(new Float32Array(3*h),3),this._normalAttribute=new st(new Float32Array(3*h),3),this._uvAttribute=new st(new Float32Array(2*h),2),this._indexAttribute=new st(new Uint32Array(3*u),1),s){let d=1/0,p=-1/0,f=1/0,m=-1/0;for(let y=0,_=h;y<_;y++){let b=2*y,w=s.vertices[b+0],C=s.vertices[b+1];w<d&&(d=w),w>p&&(p=w),C<f&&(f=C),C>m&&(m=C)}let g=p-d,v=m-f;for(let y=0,_=h;y<_;y++){let b=2*y,w=s.vertices[b+0],C=s.vertices[b+1],x=(w-d)/g,S=(C-f)/v;this._positionAttribute.setXYZ(y,w,C,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,x,S)}for(let y=0,_=u;y<_;y++){let b=3*y,C=s.elements[b+1],x=s.elements[b+2];this._indexAttribute.setX(b+0,s.elements[b+0]),this._indexAttribute.setX(b+1,C),this._indexAttribute.setX(b+2,x)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*(s?.elementCount??1))}clone(){let e=new KG(this._shape,this._curveSegments);return e.userData=Db(this.userData),e}},$G=class extends CT{constructor(e,t,i=0,n=12,r=3,s=fi.ODD){super(e,t,i,n,r,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let o=this._buildBevelVert(t,n,r),a=this._buildBevelVert(t,n,(r+1)%s);i.push(a.topP,o.topN,o.bottomN),i.push(a.topP,o.bottomN,a.bottomP)}}clone(){let e=new $G(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Db(this.userData),e}},uh=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:fi.ODD},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),o=e.shape??t?.shape,a=o?.roundness??i.roundness;void 0!==o&&(o instanceof Qi?(o.width!==n||o.height!==r)&&o.applySize(n,r):o=new Qi(n,r).fromJSON(o),void 0!==e.parameters?.roundness&&e.parameters?.roundness>0&&o.update());let l=o??new Qi(n,r);return{parameters:Object.assign(i,{width:n,height:r,depth:s,roundness:a}),shape:l}}static build(e){let a,{depth:t,extrudeBevelSize:i,extrudeBevelSegments:n,subdivisions:r,roundness:s,windingRule:o}=e.parameters;return e.shape.roundness=s,a=t<=0?new KG(e.shape,r,{windingRule:o}):new $G(e.shape,t,i,r,n,o),Object.assign(a,{userData:{...e,type:"VectorGeometry"}})}},JG=2*Math.PI,ET=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=qe.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof Qi?e.shape:new Qi,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let p,{width:t,height:i,spikes:n,angle:r,innerRadius:s,depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}=e.parameters,c=e.shape,d=function nAe(e,t,i,n,r,s){if(n>=JG)return r>30||r%4==0?(function sAe(e,t,i,n=0,r=0,s=0){let o=.5522847498,a=t*o,l=i*o;e.addPoint(Sw(r-t,s,r-t,s-l,r-t,s+l)),e.addPoint(Sw(r,s+i,r-a,s+i,r+a,s+i)),e.addPoint(Sw(r+t,s,r+t,s+l,r+t,s-l)),e.addPoint(Sw(r,s-i,r+a,s-i,r-a,s-i)),n>0&&i6(e,t,i,n)}(e,t,i,s),Math.round(r/4)):e6(e,n,r,t,i,s);let o={x:0,y:i},a=(n=Math.max(n,.001))+.5*Math.PI,l={x:Math.cos(a)*t,y:Math.sin(a)*i},c=function KMe({px:e,py:t,cx:i,cy:n,rx:r,ry:s,largeArcFlag:o,sweepFlag:a}){let l=[];if(0===r||0===s)return[];let c=(e-i)/2,h=(t-n)/2;if(0===c&&0===h)return[];r=Math.abs(r),s=Math.abs(s);let u=Math.pow(c,2)/Math.pow(r,2)+Math.pow(h,2)/Math.pow(s,2);u>1&&(r*=Math.sqrt(u),s*=Math.sqrt(u));let d=function QMe(e,t,i,n,r,s,o,a,l,c){let h=Math.pow(r,2),u=Math.pow(s,2),d=Math.pow(o,2),p=Math.pow(a,2),f=h*u-h*p-u*d;f<0&&(f=0),f/=h*p+u*d,f=Math.sqrt(f)*(l===c?-1:1);let m=f*r/s*a,g=f*-s/r*o,v=m+(e+i)/2,y=g+(t+n)/2,_=(o-m)/r,b=(a-g)/s,w=(-o-m)/r,C=(-a-g)/s,x=HG(1,0,_,b),S=HG(_,b,w,C);return!c&&S>0&&(S-=yT),c&&S<0&&(S+=yT),{centerx:v,centery:y,ang1:x,ang2:S}}(e,t,i,n,r,s,c,h,o,a),{ang1:p,ang2:f}=d,{centerx:m,centery:g}=d,v=Math.abs(f)/(yT/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);f/=y;for(let _=0;_<y;_++)l.push(ZMe(p,f)),p+=f;return l.map(_=>{let{x:b,y:w}=_T(_[0],r,s,m,g),{x:C,y:x}=_T(_[1],r,s,m,g),{x:S,y:E}=_T(_[2],r,s,m,g);return{x1:b,y1:w,x2:C,y2:x,x:S,y:E}})}({px:o.x,py:o.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:n>Math.PI,sweepFlag:!0});return r>30||r%c.length==0?function rAe(e,t,i,n,r,s,o,a){let l=Math.round(r/n.length);e.addPoint(tf(t,i));for(let c=0,h=n.length;c<h;c++){let u=n[c],d=e.points[c],p=tf(u.x,u.y);d.controls[1].position.set(u.x1,u.y1),p.controls[0].position.set(u.x2,u.y2),e.addPoint(p)}return a>0?t6(e,s,o,a):e.addPoint(tf(0,0)),l}(e,o.x,o.y,c,r,t,i,s):e6(e,n,r,t,i,s)}(c,.5*t,.5*i,r*Math.PI/180,n,s);return c.isClosed=!0,c.update(),0===r?(p=new Ze,p.setAttribute("position",new Fe([],3))):p=uh.create({shape:c,parameters:{subdivisions:d,depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function e6(e,t,i,n,r,s){let o=-t/i;for(let a=0;a<=i;a++){let l=o*a,c=Math.sin(l)*n,h=Math.cos(l)*r;e.addPoint(tf(c,h))}return t<JG?s>0?t6(e,n,r,s):e.addPoint(tf(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&i6(e,n,r,s)),1}function tf(e,t){return new $p(qe.generateUUID(),new z(e,t))}function Sw(e,t,i,n,r,s){let o=tf(e,t);return o.controls[0].position.set(i,n),o.controls[1].position.set(r,s),o}function t6(e,t,i,n){n6(e,t,i,n).forEach(r=>e.addPoint(r))}function i6(e,t,i,n){let r=n6(e,t,i,n),s=new Qi;r.forEach(o=>s.addPoint(o)),s.isClosed=!0,e.shapeHoles.push(s)}function n6(e,t,i,n){let r=n*t/100,s=r*(Math.abs(i)/Math.abs(t)),o=new z(r/t,s/i),a=e.points.map(l=>{let c=l.clone();return c.uuid=qe.generateUUID(),c}).reverse();return a.forEach(l=>{l.position.multiply(o);let c=l.controls[0].position.clone().multiply(o),h=l.controls[1].position.clone().multiply(o);l.controls[0].position.copy(h),l.controls[1].position.copy(c)}),a}var MT=new ep([0,0,0],1),r6=class extends Ze{constructor(e=!0,t=1,i=1,n=1,r=1,s=1,o=1,a=1,l=1,c=1,h=1,u=1){if(super(),0===s)return;let d=e&&1===s;d&&(u=0),h>100&&(h=100),0===h&&(u=0);let y,_,b,w,C,x,S,E,p=()=>new M,f=new M,m=p(),g=p(),v=p(),D=p(),T=p(),I=p(),P=p(),R=p(),L=p(),j=p(),F=p(),N=i-2*a+.001,q=N/s,W=Math.ceil(o*s),U=W+1,V=N/W,Y=-N/2,G=c+1,X=2*Math.PI/c,H=Math.PI/2/u,K=Math.min((1-h/100)*a,a-.01),se=a-K,$=0,ce=2*u+2,ae=G*ce/2,Oe=ae+G*U,Re=Math.max(0,G*(U+ce)),[Ne,Ue,De]=[3,3,2].map(He=>Array(Re*He).fill(0)),Ce=[],Qe=r-a;function mt(He,Xe){let Ge=Math.PI/2;x=Xe*V,E=2*Math.PI*(x%q)/q+Ge,x+=Y,S=Math.sin(E)*Qe,C=Math.cos(E)*Qe,e?He.set(C,S,x):He.set(C,x,S)}mt(f,-1e-10),mt(m,0),D.copy(f),mt(f,1);let B=f.distanceTo(m),O=d?0:se+K,te=B*W+2*O,xe=K,fe=te-O;for(let He=0;He<=W;He++){mt(g,He),F.subVectors(g,D).normalize(),D.copy(g),L.copy(g).setComponent(+e+1,0).normalize(),j.crossVectors(F,L).normalize();let Xe=0===He,Ge=He===W,ut=Xe?3*Math.PI/2:H,nt=Xe?xe:fe,Xt=Xe?G:Oe,ki=Xe?0:Re-G,Dn=F.clone().multiplyScalar(Xe?-se:se).add(g),Q=F.clone().multiplyScalar(Xe?-1:1).normalize();for(let le=0;le<G;le++){let Se=le*X;if(T.addVectors(f.copy(L).multiplyScalar(a*Math.cos(Se)),m.copy(j).multiplyScalar(a*Math.sin(Se))),I.copy(T).normalize(),Xe||Ge){d||($=ki+le,[0,1,2].forEach(Ie=>{Ne[3*$+Ie]=Dn.getComponent(Ie),Ue[3*$+Ie]=Q.getComponent(Ie)}),De[2*$]=+Ge,De[2*$+1]=le/c),m.copy(I).multiplyScalar(K),v.addVectors(g,m);for(let Ie=0;Ie<u;Ie++){let ct=Ie*H+ut;P.addVectors(f.copy(F).multiplyScalar(se*Math.sin(ct)),m.copy(I).multiplyScalar(se*Math.cos(ct))),R.copy(P).normalize(),m.addVectors(v,P),P.normalize(),$=Xt+Ie*G+le,[0,1,2].forEach(Gi=>{Ne[3*$+Gi]=m.getComponent(Gi),Ue[3*$+Gi]=R.getComponent(Gi)});let Jt=+Xe+Math.sin(ct);De[2*$]=(nt+se*Jt)/te,De[2*$+1]=le/c}}m.addVectors(g,T),$=ae+He*G+le,[0,1,2].forEach(Ie=>{Ne[3*$+Ie]=m.getComponent(Ie),Ue[3*$+Ie]=I.getComponent(Ie)}),De[2*$]=(O+He*B)/te,De[2*$+1]=le/c}}let Ee=U+2*u+2,[Be,me]=[+d,Ee-1];for(let He=Be;He<=me-1;He++){let Xe=d&&He===me-1;for(let Ge=0;Ge<G-1;Ge++)y=He*G+Ge,_=y+1,b=(Xe?Ge:y)+G,w=(Xe?Ge+1:_)+G,0===He?Ce.push(_,w,b):He===Ee-2?Ce.push(y,_,b):Ce.push(y,_,b,_,w,b)}this.setIndex(Ce),this.setAttribute("position",new Fe(Ne,3)),this.setAttribute("normal",new Fe(Ue,3)),this.setAttribute("uv",new Fe(De,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let r,s,o,a,e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,n=Array.from(this.getIndex().array),l=6*(t-1)*e.radialSegments,c=t,h=c===t;for(let u=0;u<e.radialSegments;u++)r=c*i+u,s=r+1,o=(h?u:r)+i,a=(h?u+1:s)+i,n[l++]=r,n[l++]=s,n[l++]=o,n[l++]=s,n[l++]=a,n[l++]=o;return n.length=l,MT.array=n,MT.count=n.length,MT}},s6=class extends dT{constructor(e=1,t=.2,i=4){let n=(1+Math.sqrt(5))/2,o="IcosahedronGeometry";super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o,e,t,i),this.type=o}static fromJSON(e){return new s6(e.radius,e.corner,e.cornerSides)}},ka=new ye,AT=new pi,Cw=new M,Ew=class extends sr{constructor(){super(),this.uuid=qe.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=(new an).getNormalMatrix(e);for(let i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i];r.normal.applyMatrix3(t).normalize();for(let s=0,o=r.vertexNormals.length;s<o;s++)r.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return ka.makeRotationX(e),this.applyMatrix4(ka),this}rotateY(e){return ka.makeRotationY(e),this.applyMatrix4(ka),this}rotateZ(e){return ka.makeRotationZ(e),this.applyMatrix4(ka),this}translate(e,t,i){return ka.makeTranslation(e,t,i),this.applyMatrix4(ka),this}scale(e,t,i){return ka.makeScale(e,t,i),this.applyMatrix4(ka),this}lookAt(e){return AT.lookAt(e),AT.updateMatrix(),this.applyMatrix4(AT.matrix),this}fromBufferGeometry(e){let t=this,i=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=n.position,s=n.normal,o=n.color,a=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let u=0;u<r.count;u++)t.vertices.push((new M).fromBufferAttribute(r,u)),void 0!==o&&t.colors.push((new Je).fromBufferAttribute(o,u));function c(u,d,p,f){let m=void 0===o?[]:[t.colors[u].clone(),t.colors[d].clone(),t.colors[p].clone()],g=void 0===s?[]:[(new M).fromBufferAttribute(s,u),(new M).fromBufferAttribute(s,d),(new M).fromBufferAttribute(s,p)],v=new DT(u,d,p,g,m,f);t.faces.push(v),void 0!==a&&t.faceVertexUvs[0].push([(new z).fromBufferAttribute(a,u),(new z).fromBufferAttribute(a,d),(new z).fromBufferAttribute(a,p)]),void 0!==l&&t.faceVertexUvs[1].push([(new z).fromBufferAttribute(l,u),(new z).fromBufferAttribute(l,d),(new z).fromBufferAttribute(l,p)])}let h=e.groups;if(h.length>0)for(let u=0;u<h.length;u++){let d=h[u],p=d.start;for(let m=p,g=p+d.count;m<g;m+=3)void 0!==i?c(i.getX(m),i.getX(m+1),i.getX(m+2),d.materialIndex):c(m,m+1,m+2,d.materialIndex)}else if(void 0!==i)for(let u=0;u<i.count;u+=3)c(i.getX(u),i.getX(u+1),i.getX(u+2));else for(let u=0;u<r.count;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Cw).negate(),this.translate(Cw.x,Cw.y,Cw.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new ye;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){let e=new M,t=new M;for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i],s=this.vertices[r.a],o=this.vertices[r.b];e.subVectors(this.vertices[r.c],o),t.subVectors(s,o),e.cross(t),e.normalize(),r.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,n=this.vertices.length;i<n;i++)t[i]=new M;if(e){let i=new M,n=new M;for(let r=0,s=this.faces.length;r<s;r++){let o=this.faces[r],a=this.vertices[o.a],l=this.vertices[o.b];i.subVectors(this.vertices[o.c],l),n.subVectors(a,l),i.cross(n),t[o.a].add(i),t[o.b].add(i),t[o.c].add(i)}}else{this.computeFaceNormals();for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let i=0,n=this.vertices.length;i<n;i++)t[i].normalize();for(let i=0,n=this.faces.length;i<n;i++){let r=this.faces[i],s=r.vertexNormals;3===s.length?(s[0].copy(t[r.a]),s[1].copy(t[r.b]),s[2].copy(t[r.c])):(s[0]=t[r.a].clone(),s[1]=t[r.b].clone(),s[2]=t[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],n=i.vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let n=this.faces[t];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(let r=0,s=n.vertexNormals.length;r<s;r++)n.__originalVertexNormals[r]?n.__originalVertexNormals[r].copy(n.vertexNormals[r]):n.__originalVertexNormals[r]=n.vertexNormals[r].clone()}let e=new Ew;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let r=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let o=0,a=this.faces.length;o<a;o++){let l=new M,c={a:new M,b:new M,c:new M};r.push(l),s.push(c)}}let n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let r=0,s=this.faces.length;r<s;r++){let o=this.faces[r],l=n.vertexNormals[r];n.faceNormals[r].copy(o.normal),l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let n=this.faces[t];n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ln),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ds),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let n,r=this.vertices.length,s=this.vertices,o=e.vertices,a=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(n=(new an).getNormalMatrix(t));for(let u=0,d=o.length;u<d;u++){let p=o[u].clone();void 0!==t&&p.applyMatrix4(t),s.push(p)}for(let u=0,d=h.length;u<d;u++)c.push(h[u].clone());for(let u=0,d=l.length;u<d;u++){let f,m,p=l[u],g=p.vertexNormals,v=p.vertexColors,y=new DT(p.a+r,p.b+r,p.c+r);y.normal.copy(p.normal),void 0!==n&&y.normal.applyMatrix3(n).normalize();for(let _=0,b=g.length;_<b;_++)f=g[_].clone(),void 0!==n&&f.applyMatrix3(n).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let _=0,b=v.length;_<b;_++)m=v[_],y.vertexColors.push(m.clone());y.materialIndex=p.materialIndex+i,a.push(y)}for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,_=g.length;y<_;y++)v.push(g[y].clone());this.faceVertexUvs[u].push(v)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(e=4){let t={},i=[],n=[],r=Math.pow(10,e);for(let a=0,l=this.vertices.length;a<l;a++){let c=this.vertices[a],h=Math.round(c.x*r)+"_"+Math.round(c.y*r)+"_"+Math.round(c.z*r);void 0===t[h]?(t[h]=a,i.push(this.vertices[a]),n[a]=i.length-1):n[a]=n[t[h]]}let s=[];for(let a=0,l=this.faces.length;a<l;a++){let c=this.faces[a];c.a=n[c.a],c.b=n[c.b],c.c=n[c.c];let h=[c.a,c.b,c.c];for(let u=0;u<3;u++)if(h[u]===h[(u+1)%3]){s.push(a);break}}for(let a=s.length-1;a>=0;a--){let l=s[a];this.faces.splice(l,1);for(let c=0,h=this.faceVertexUvs.length;c<h;c++)this.faceVertexUvs[c].splice(l,1)}let o=this.vertices.length-i.length;return this.vertices=i,o}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let n=e[t];this.vertices.push(new M(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;e.sort(function i(a,l){return a.materialIndex-l.materialIndex});let s,o,n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];n&&n.length===t&&(s=[]),r&&r.length===t&&(o=[]);for(let a=0;a<t;a++){let l=e[a]._id;s&&s.push(n[l]),o&&o.push(r[l])}s&&(this.faceVertexUvs[0]=s),o&&(this.faceVertexUvs[1]=o)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){let p=this.parameters;for(let f in p)void 0!==p[f]&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],n=[],r={},s=[],o={},a=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],m=!0,g=!1,v=void 0!==this.faceVertexUvs[0][p],y=f.normal.length()>0,_=f.vertexNormals.length>0,b=1!==f.color.r||1!==f.color.g||1!==f.color.b,w=f.vertexColors.length>0,C=0;if(C=c(C,0,0),C=c(C,1,m),C=c(C,2,g),C=c(C,3,v),C=c(C,4,y),C=c(C,5,_),C=c(C,6,b),C=c(C,7,w),i.push(C),i.push(f.a,f.b,f.c),i.push(f.materialIndex),v){let x=this.faceVertexUvs[0][p];i.push(d(x[0]),d(x[1]),d(x[2]))}if(y&&i.push(h(f.normal)),_){let x=f.vertexNormals;i.push(h(x[0]),h(x[1]),h(x[2]))}if(b&&i.push(u(f.color)),w){let x=f.vertexColors;i.push(u(x[0]),u(x[1]),u(x[2]))}}function c(p,f,m){return m?p|1<<f:p&~(1<<f)}function h(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return void 0!==r[f]||(r[f]=n.length/3,n.push(p.x,p.y,p.z)),r[f]}function u(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return void 0!==o[f]||(o[f]=s.length,s.push(p.getHex())),o[f]}function d(p){let f=p.x.toString()+p.y.toString();return void 0!==l[f]||(l[f]=a.length/2,a.push(p.x,p.y)),l[f]}return e.data={},e.data.vertices=t,e.data.normals=n,s.length>0&&(e.data.colors=s),a.length>0&&(e.data.uvs=[a]),e.data.faces=i,e}clone(){return(new Ew).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let u=0,d=t.length;u<d;u++)this.vertices.push(t[u].clone());let i=e.colors;for(let u=0,d=i.length;u<d;u++)this.colors.push(i[u].clone());let n=e.faces;for(let u=0,d=n.length;u<d;u++)this.faces.push(n[u].clone());for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,_=g.length;y<_;y++)v.push(g[y].clone());this.faceVertexUvs[u].push(v)}}let r=e.morphTargets;for(let u=0,d=r.length;u<d;u++){let p={};if(p.name=r[u].name,void 0!==r[u].vertices){p.vertices=[];for(let f=0,m=r[u].vertices.length;f<m;f++)p.vertices.push(r[u].vertices[f].clone())}if(void 0!==r[u].normals){p.normals=[];for(let f=0,m=r[u].normals.length;f<m;f++)p.normals.push(r[u].normals[f].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let u=0,d=s.length;u<d;u++){let p={};if(void 0!==s[u].vertexNormals){p.vertexNormals=[];for(let f=0,m=s[u].vertexNormals.length;f<m;f++){let g=s[u].vertexNormals[f],v={};v.a=g.a.clone(),v.b=g.b.clone(),v.c=g.c.clone(),p.vertexNormals.push(v)}}if(void 0!==s[u].faceNormals){p.faceNormals=[];for(let f=0,m=s[u].faceNormals.length;f<m;f++)p.faceNormals.push(s[u].faceNormals[f].clone())}this.morphNormals.push(p)}let o=e.skinWeights;for(let u=0,d=o.length;u<d;u++)this.skinWeights.push(o[u].clone());let a=e.skinIndices;for(let u=0,d=a.length;u<d;u++)this.skinIndices.push(a[u].clone());let l=e.lineDistances;for(let u=0,d=l.length;u<d;u++)this.lineDistances.push(l[u]);let c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());let h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=(new cAe).fromGeometry(this),t=new Ze,i=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",Mw.call(new st(i,3),e.vertices)),e.normals.length>0){let n=new Float32Array(3*e.normals.length);t.setAttribute("normal",Mw.call(new st(n,3),e.normals))}if(e.colors.length>0){let n=new Float32Array(3*e.colors.length);t.setAttribute("color",o6.call(new st(n,3),e.colors))}if(e.uvs.length>0){let n=new Float32Array(2*e.uvs.length);t.setAttribute("uv",a6.call(new st(n,2),e.uvs))}if(e.uvs2.length>0){let n=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",a6.call(new st(n,2),e.uvs2))}t.groups=e.groups;for(let n in e.morphTargets){let r=[],s=e.morphTargets[n];for(let o=0,a=s.length;o<a;o++){let l=s[o],c=new Fe(3*l.data.length,3);c.name=l.name,r.push(Mw.call(c,l.data))}t.morphAttributes[n]=r}if(e.skinIndices.length>0){let n=new Fe(4*e.skinIndices.length,4);t.setAttribute("skinIndex",l6.call(n,e.skinIndices))}if(e.skinWeights.length>0){let n=new Fe(4*e.skinWeights.length,4);t.setAttribute("skinWeight",l6.call(n,e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Ze,i=e.geometry;if(e.isPoints||e.isLine){let n=new Fe(3*i.vertices.length,3),r=new Fe(3*i.colors.length,3);if(t.setAttribute("position",Mw.call(n,i.vertices)),t.setAttribute("color",o6.call(r,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new Fe(i.lineDistances.length,1);t.setAttribute("lineDistance",uAe.call(s,i.lineDistances))}null!==i.boundingSphere&&(t.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};Ew.prototype.isGeometry=!0;var cAe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let i,n,r,t=[],s=e.faces;for(n=0;n<s.length;n++){let o=s[n];o.materialIndex!==r&&(r=o.materialIndex,void 0!==i&&(i.count=3*n-i.start,t.push(i)),i={start:3*n,materialIndex:r})}void 0!==i&&(i.count=3*n-i.start,t.push(i)),this.groups=t}fromGeometry(e){let l,t=e.faces,i=e.vertices,n=e.faceVertexUvs,r=n[0]&&n[0].length>0,s=n[1]&&n[1].length>0,o=e.morphTargets,a=o.length;if(a>0){l=[];for(let g=0;g<a;g++)l[g]={name:o[g].name,data:[]};this.morphTargets.position=l}let u,c=e.morphNormals,h=c.length;if(h>0){u=[];for(let g=0;g<h;g++)u[g]={name:c[g].name,data:[]};this.morphTargets.normal=u}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,m=p.length===i.length;i.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let v=t[g];this.vertices.push(i[v.a],i[v.b],i[v.c]);let y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{let b=v.normal;this.normals.push(b,b,b)}let _=v.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{let b=v.color;this.colors.push(b,b,b)}if(!0===r){let b=n[0][g];void 0!==b?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new z,new z,new z))}if(!0===s){let b=n[1][g];void 0!==b?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new z,new z,new z))}for(let b=0;b<a;b++){let w=o[b].vertices;l[b].data.push(w[v.a],w[v.b],w[v.c])}for(let b=0;b<h;b++){let w=c[b].vertexNormals[g];u[b].data.push(w.a,w.b,w.c)}f&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),m&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}},DT=class{constructor(e,t,i,n,r,s=0){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new M,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new Je,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function uAe(e){return this.array.set(e),this}function o6(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new Je),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function a6(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new z),t[i++]=s.x,t[i++]=s.y}return this}function Mw(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new M),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function l6(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new St),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var hAe=["a","b","c"];function dAe(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function TT(e,t,i){let n=Math.min(e,t),r=Math.max(e,t);return i.get(n+"_"+r)}function IT(e,t,i,n,r,s){let c,o=Math.min(e,t),a=Math.max(e,t),l=o+"_"+a;n.has(l)?c=n.get(l):(c={a:i[o],b:i[a],newEdge:null,faces:[]},n.set(l,c)),c.faces.push(r),s[e].edges.push(c),s[t].edges.push(c)}function Aw(e,t,i,n,r){e.push(new DT(t,i,n,void 0,void 0,r))}function nf(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function Dw(e,t,i,n){e.push([t.clone(),i.clone(),n.clone()])}var zn=new M,c6=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Qi?e.shape:new Qi,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:n,cornerRadius:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:a}=e.parameters,l=e.shape,c=.5*t,h=.5*i,p=2*Math.PI/n;for(let m=0;m<n;m++){let g=p*m,v=0+Math.sin(g)*c,y=0+Math.cos(g)*h;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let m=0,g=l.points.length;m<g;m++)l.points[m].roundness=r;l.roundness=r,l.update();let f=uh.create({shape:l,parameters:{roundness:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:a}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}};function yv(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function PT(e,t,i,n,r,s){let o=t.clone().sub(e),a=i.clone().sub(e),l=o.angleTo(a);if(o.normalize(),a.normalize(),n===r){let c=o.add(a).normalize();s.copy(e).addScaledVector(c,n/Math.sin(l/2))}else{let c=o.angleTo(a);s.copy(e),s.addScaledVector(o,r/Math.sin(c)),s.addScaledVector(a,n/Math.sin(c))}}function vAe(e,t,i){let n=e.clone().sub(t),r=i.clone().sub(t);return n.projectOnVector(r),n.add(t)}var yAe=class extends Ze{constructor(e=.5,t=1,i=4,n=1,r=!1,s=0,o=4){super(),i=Math.floor(Math.max(3,i)),n=Math.floor(n),o=Math.floor(o);let T,a=[],l=[],c=[],h=[],u=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),m=2*Math.PI/i,g=(i-2)*Math.PI/i,v=Math.PI-g,y=new M(0,-d,0),_=new M(0,d,0),b=new z(e,-d),w=new z(f,-d),C=new z(0,_.y).sub(w),x=new z(0,_.y).sub(b),S=new z(C.y,-C.x).normalize(),E=new z(x.y,-x.x).normalize(),D=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-C.angle())/2)-1e-8;s=Math.min(s,D);{let N=new M(S.x,S.y,0),q=new M(Math.cos(m)*N.x,N.y,Math.sin(m)*N.x);T=N.angleTo(q)}let I=s/Math.tan((Math.PI-C.angle())/2),P=s/Math.tan((Math.PI-T)/2),R=new M;if(!r){l.push(y.x,y.y,y.z),c.push(0,-1,0),h.push(0,0);let N=u++,q=[],W=b.clone(),U=I/Math.cos(Math.PI/i);W.x-=U;for(let V=0;V<i;V++){let Y=V/i*Math.PI*2+p;yv(W,new z(Math.sin(Y),Math.cos(Y)),R),l.push(R.x,R.y,R.z),c.push(0,-1,0),h.push(0,0),q.push(u++)}for(let V=0;V<q.length;V++)a.push(q[V],N,q[(V+1)%q.length])}let L=[];{let N=new M,q=new M,W=new M,U=new M,V=new M,Y=new M;for(let G=0;G<i;G++){let X=G/i*Math.PI*2+p,H=(G+.5)/i*Math.PI*2+p,re=(G+1)/i*Math.PI*2+p,K=new z(Math.sin(X),Math.cos(X)),se=new z(Math.sin(H),Math.cos(H)),$=new z(Math.sin(re),Math.cos(re));yv(b,K,q),yv(b,$,W),yv(S,se,N),PT(_,q,W,P,P,U),l.push(U.x,U.y,U.z),PT(q,_,W,P,I,V),l.push(V.x,V.y,V.z),PT(W,q,_,I,P,Y),l.push(Y.x,Y.y,Y.z),c.push(N.x,N.y,N.z),c.push(N.x,N.y,N.z),c.push(N.x,N.y,N.z),h.push(0,0),h.push(0,0),h.push(0,0);let ge=u++,ce=u++,ae=u++;if(a.push(ge,ce,ae),s>0){{let Ne=q.clone().add(W).multiplyScalar(.5),Ue=_.clone().sub(Ne).normalize(),De=y.clone().sub(Ne).normalize().add(Ue).normalize().multiplyScalar(-1);j(Ne,Y.clone().sub(V),De,C.angle())}let Oe,Re;{let Ne=new M;yv(E,$,Ne);let Ue=Y.clone().add(U).multiplyScalar(.5);Ue=vAe(Ue,W,_);let De=Y.clone().sub(U);[Oe,Re]=j(Ue,De,Ne,T,U.y)}{let Ne=Oe,Ue=Ne.clone().setY(0).normalize(),De=new M(0,-1,0),Ce=Ue.clone().cross(De);F(Ne,Ue,De,Ce)}L.concat(Re);{let Ne=C.angle(),Ue=Math.PI-Ne,De=_.clone();De.y-=s/Math.sin(Ne-Math.PI/2);let Ce=new M,Qe=[];for(let B=0;B<o;B++){let O=[],te=Math.PI/2-Ue*B/o,xe=Math.cos(te),fe=Math.sin(te),Ee=H;for(let Ye=0;Ye<=B;Ye++){let Be=Math.cos(Ee),me=Math.sin(Ee);N.x=xe*me,N.y=fe,N.z=xe*Be,Ce.copy(De).addScaledVector(N,s),l.push(Ce.x,Ce.y,Ce.z),c.push(N.x,N.y,N.z),h.push(0,0),O.push(u++),Ee+=2*Math.PI/B/i}Qe.push(O)}Re.reverse(),Qe.push(Re);let mt=Qe.length-1;for(let B=0;B<mt;B++){let O=Qe[B],te=Qe[B+1],xe=O.length-1;a.push(te[1],O[0],te[0]);for(let fe=1;fe<=xe;fe++)a.push(O[fe],O[fe-1],te[fe]),a.push(te[fe+1],O[fe],te[fe])}}}}}function j(N,q,W,U,V){let Y=-U/2,G=(Math.PI-U)/2,X=q.clone().normalize().cross(W);N.addScaledVector(W,-s/Math.sin(G));let H=new M,re=new M,se=u,$=[];for(let ge=0;ge<=o;ge++){let ce=Y+ge/o*U;re.set(0,0,0),re.addScaledVector(X,Math.sin(ce)),re.addScaledVector(W,Math.cos(ce));for(let ae=0;ae<=1;ae++){let Oe=ae/1-.5;if(H.copy(N),H.addScaledVector(q,Oe),H.addScaledVector(re,s),null!=V){let Re=Math.max(0,H.y-V);H.addScaledVector(q,-Re/q.y)}l.push(H.x,H.y,H.z),c.push(re.x,re.y,re.z),h.push(0,0),0===ae&&$.push(u),u++}}for(let ge=0;ge<o;ge++)for(let ce=0;ce<1;ce++){let ae=se+ce+2*ge,Oe=ae+2,Re=Oe+1,Ne=ae+1;a.push(ae,Oe,Ne),a.push(Oe,Re,Ne)}return[N.clone().addScaledVector(q,.5),$]}function F(N,q,W,U){let V=Math.PI/2,Y=x.angle()-V,G=[],X=new M,H=new M;for(let K=0;K<=o;K++){let se=[],$=K/o;for(let ge=0;ge<=K;ge++){let ce=((K?ge/K:0)-.5)*v,ae=Math.cos(ce),Oe=Math.sin(ce),Ne=(V+Math.atan(Math.tan(Y)*ae))*$,Ue=Math.cos(Ne),De=Math.sin(Ne);X.set(0,0,0),X.addScaledVector(q,De*ae),X.addScaledVector(W,Ue),X.addScaledVector(U,De*Oe),H.copy(N).addScaledVector(X,s),l.push(H.x,H.y,H.z),c.push(X.x,X.y,X.z),h.push(0,0),se.push(u++)}G.push(se)}let re=G.length-1;for(let K=0;K<re;K++){let se=G[K],$=G[K+1],ge=se.length-1;a.push(se[0],$[1],$[0]);for(let ce=1;ce<=ge;ce++)a.push(se[ce-1],se[ce],$[ce]),a.push(se[ce],$[ce+1],$[ce])}}this.setIndex(a),this.setAttribute("position",new Fe(l,3)),this.setAttribute("normal",new Fe(c,3)),this.setAttribute("uv",new Fe(h,2))}},u6=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),n=Object.assign(t?.ui??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Qi?e.shape:new Qi,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:n}}static build(e){let t=e.shape,{width:i,height:n,cornerRadius:r,cornerType:s,depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}=e.parameters,c={x:.5*i,y:.5*n},h={x:-c.x,y:-c.y},u={x:c.x,y:c.y};function d(b,w,C){return w>i&&C>n?Math.min(b*i/w,b*n/C):w>i?b*i/w:C>n?b*n/C:b}let p=[];p[0]=0===r[0]?0:d(r[0],r[0]+r[3],r[0]+r[1]),p[1]=0===r[1]?0:d(r[1],r[1]+r[2],r[1]+r[0]),p[2]=0===r[2]?0:d(r[2],r[2]+r[1],r[2]+r[3]),p[3]=0===r[3]?0:d(r[3],r[3]+r[0],r[3]+r[2]);let f=h.x,m=u.x,g=u.y,v=h.y;t.addPoint(t.createPoint(f,g)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(f,v)),t.isClosed=!0;let y=!0;for(let b=0,w=t.points.length;b<w;b++)t.points[b].roundness=p[b],b>0&&p[b]!==p[b-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=1!==s,t.update();let _=uh.create({shape:t,parameters:{depth:o,extrudeBevelSize:a,extrudeBevelSegments:l}});return Object.assign(_,{userData:{...e,type:"RectangleGeometry"}})}},xAe=class extends Ze{constructor(e=1,t=1,i=1,n=90,r=10,s=24){super(),this.type="BackdropGeometry";let o=[],a=[],l=[],c=.001;0==r&&(s=1),s=Math.max(1,Math.floor(s)),r=Math.min(r,100),n=Math.min(180-c,n),n*=Math.PI/180;let h=[],u=Math.PI/2,d=(re=0,K=0,se=0)=>new M(re,K,se),p=d(),f=d(),[m,g,v]=[t/2,e/2,i/2],y=-g,_=+g,[b,w,C]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],x=(re,K=!1)=>Math.sin(re-Math.PI/(+K+1)),S=(re,K=!1)=>Math.cos(re-Math.PI/(+K+1));C.y=Math.sin(n)*t-m;let E=Math.cos(n)*t-v,D=b.z-c;n<=u?(C.z=Math.min(E,D),C.z==D&&(C.y-=(E-D)/Math.tan(u-n))):w.z=Math.min(w.z-E-v,b.z-c),p.subVectors(b,w),f.subVectors(C,w);let T=Math.min(p.length(),f.length())*r/100,I=T*Math.tan(n/2),P=T/Math.cos(n/2),R=p.clone().normalize().add(f.normalize()).setLength(P).add(w);p.set(0,x(n,!0),S(n,!0)),h.push([C,p.clone()]);let L=(Math.PI-n)/s;for(let re=0;re<=s;re++){let K=u+n+re*L;p.set(0,Math.sin(K)*I,Math.cos(K)*I),p.add(R),f.set(0,x(K),S(K)),h.push([p.clone(),f.clone()])}h.push([b,d(0,1,0)]);let j=Math.sin(L/2)*I*2,F=h.length-1,N=h[0][0].distanceTo(h[1][0]),W=N+j*s+h[F-1][0].distanceTo(h[F][0]);h[0].push(1);for(let re=0;re<=s;re++)h[re+1].push(1-(N+re*j)/W);h[F].push(0);let G,X,H,[U,V,Y]=h[0];for(let re=1;re<h.length;re++)[G,X,H]=h[re],o.push(y,U.y,U.z,y,G.y,G.z,_,U.y,U.z,_,U.y,U.z,y,G.y,G.z,_,G.y,G.z),a.push(0,V.y,V.z,0,X.y,X.z,0,V.y,V.z,0,V.y,V.z,0,X.y,X.z,0,X.y,X.z),l.push(0,Y,0,H,1,Y,1,Y,0,H,1,H),[U,V,Y]=[G,X,H];this.setAttribute("position",new Fe(o,3)),this.setAttribute("normal",new Fe(a,3)),this.setAttribute("uv",new Fe(l,2))}},h6=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Qi?e.shape:new Qi,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:n,spikes:r,cornerRadius:s,angle:o,depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h=e.shape,u=.5*t,d=.5*i,m=o*Math.PI/360/r,g=Math.PI/2*3*-1,v=u*n/100,y=d*n/100;if(3===r&&50===n){m=2*Math.PI/r;for(let b=0;b<r;b++){let w=m*b,C=0+Math.sin(w)*u,x=0+Math.cos(w)*d;h.addPoint(h.createPoint(C,x))}}else for(let b=0;b<r;b++){let w=0+Math.cos(g)*u,C=0+Math.sin(g)*d;h.addPoint(h.createPoint(w,C)),g+=m,w=0+Math.cos(g)*v,C=0+Math.sin(g)*y,h.addPoint(h.createPoint(w,C)),g+=m}h.isClosed=!0;for(let b=0,w=h.points.length;b<w;b++)h.points[b].roundness=s;h.roundness=s,h.update();let _=uh.create({shape:h,parameters:{roundness:s,depth:a,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(_,{userData:{...e,type:"StarGeometry"}})}},oe=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+oe.version}static addUnaryOp(e){return oe.max_unop_len=Math.max(e.length,oe.max_unop_len),oe.unary_ops[e]=1,oe}static addBinaryOp(e,t,i){return oe.max_binop_len=Math.max(e.length,oe.max_binop_len),oe.binary_ops[e]=t,i?oe.right_associative.add(e):oe.right_associative.delete(e),oe}static addIdentifierChar(e){return oe.additional_identifier_chars.add(e),oe}static addLiteral(e,t){return oe.literals[e]=t,oe}static removeUnaryOp(e){return delete oe.unary_ops[e],e.length===oe.max_unop_len&&(oe.max_unop_len=oe.getMaxKeyLen(oe.unary_ops)),oe}static removeAllUnaryOps(){return oe.unary_ops={},oe.max_unop_len=0,oe}static removeIdentifierChar(e){return oe.additional_identifier_chars.delete(e),oe}static removeBinaryOp(e){return delete oe.binary_ops[e],e.length===oe.max_binop_len&&(oe.max_binop_len=oe.getMaxKeyLen(oe.binary_ops)),oe.right_associative.delete(e),oe}static removeAllBinaryOps(){return oe.binary_ops={},oe.max_binop_len=0,oe}static removeLiteral(e){return delete oe.literals[e],oe}static removeAllLiterals(){return oe.literals={},oe}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new oe(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return oe.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!oe.binary_ops[String.fromCharCode(e)]||oe.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return oe.isIdentifierStart(e)||oe.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(oe.hooks[e]){let i={context:this,node:t};return oe.hooks.run(e,i),i.node}return t}searchHook(e){if(oe.hooks[e]){let t={context:this};return oe.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===oe.SPACE_CODE||e===oe.TAB_CODE||e===oe.LF_CODE||e===oe.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions();return this.runHook("after-all",1===e.length?e[0]:{type:oe.COMPOUND,body:e})}gobbleExpressions(e){let i,n,t=[];for(;this.index<this.expr.length;)if(i=this.code,i===oe.SEMCOL_CODE||i===oe.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())t.push(n);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,oe.max_binop_len),t=e.length;for(;t>0;){if(oe.binary_ops.hasOwnProperty(e)&&(!oe.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!oe.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,n,r,s,o,a,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(r={value:t,prec:oe.binaryPrecedence(t),right_a:oe.right_associative.has(t)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+t),n=[s,r,o];t=this.gobbleBinaryOp();){if(i=oe.binaryPrecedence(t),0===i){this.index-=t.length;break}r={value:t,prec:i,right_a:oe.right_associative.has(t)},l=t;let c=h=>r.right_a&&h.right_a?i>h.prec:i<=h.prec;for(;n.length>2&&c(n[n.length-2]);)o=n.pop(),t=n.pop().value,s=n.pop(),e={type:oe.BINARY_EXP,operator:t,left:s,right:o},n.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),n.push(r,e)}for(a=n.length-1,e=n[a];a>1;)e={type:oe.BINARY_EXP,operator:n[a-1].value,left:n[a-2],right:e},a-=2;return e}gobbleToken(){let e,t,i,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(e=this.code,oe.isDecimalDigit(e)||e===oe.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===oe.SQUOTE_CODE||e===oe.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(e===oe.OBRACK_CODE)n=this.gobbleArray();else{for(t=this.expr.substr(this.index,oe.max_unop_len),i=t.length;i>0;){if(oe.unary_ops.hasOwnProperty(t)&&(!oe.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!oe.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let r=this.gobbleToken();return r||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:oe.UNARY_EXP,operator:t,argument:r,prefix:!0})}t=t.substr(0,--i)}oe.isIdentifierStart(e)?(n=this.gobbleIdentifier(),oe.literals.hasOwnProperty(n.name)?n={type:oe.LITERAL,value:oe.literals[n.name],raw:n.name}:n.name===oe.this_str&&(n={type:oe.THIS_EXP})):e===oe.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===oe.PERIOD_CODE||t===oe.OBRACK_CODE||t===oe.OPAREN_CODE||t===oe.QUMARK_CODE;){let i;if(t===oe.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==oe.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===oe.OBRACK_CODE?(e={type:oe.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==oe.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===oe.OPAREN_CODE?e={type:oe.CALL_EXP,arguments:this.gobbleArguments(oe.CPAREN_CODE),callee:e}:(t===oe.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:oe.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let t,i,e="";for(;oe.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===oe.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);oe.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,"e"===t||"E"===t){for(e+=this.expr.charAt(this.index++),t=this.char,("+"===t||"-"===t)&&(e+=this.expr.charAt(this.index++));oe.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);oe.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,oe.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===oe.PERIOD_CODE||1===e.length&&e.charCodeAt(0)===oe.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:oe.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let r=this.expr.charAt(this.index++);if(r===i){n=!0;break}if("\\"===r)switch(r=this.expr.charAt(this.index++),r){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=r}else e+=r}return n||this.throwError('Unclosed quote after "'+e+'"'),{type:oe.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(oe.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,oe.isIdentifierPart(e));)this.index++;return{type:oe.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===e){i=!0,this.index++,e===oe.CPAREN_CODE&&n&&n>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}if(r===oe.COMMA_CODE){if(this.index++,n++,n!==t.length)if(e===oe.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===oe.CBRACK_CODE)for(let s=t.length;s<n;s++)t.push(null)}else if(t.length!==n&&0!==n)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===oe.COMPOUND)&&this.throwError("Expected comma"),t.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(oe.CPAREN_CODE);if(this.code===oe.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:oe.SEQUENCE_EXP,expressions:e};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:oe.ARRAY_EXP,elements:this.gobbleArguments(oe.CBRACK_CODE)}}},PAe=new class{add(e,t,i){if("string"!=typeof arguments[0])for(let n in arguments[0])this.add(n,arguments[0][n],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(n){this[n]=this[n]||[],t&&this[n][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}};Object.assign(oe,{hooks:PAe,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if("object"!=typeof t||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}}(oe),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),oe.max_unop_len=oe.getMaxKeyLen(oe.unary_ops),oe.max_binop_len=oe.getMaxKeyLen(oe.binary_ops);var rf=e=>new oe(e).parse();Object.getOwnPropertyNames(oe).forEach(e=>{void 0===rf[e]&&"prototype"!==e&&(rf[e]=oe[e])}),rf.Jsep=oe;var LAe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,n=this.gobbleExpression();if(n||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),t.node={type:"ConditionalExpression",test:i,consequent:n,alternate:r},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};rf.plugins.register(LAe);var NAe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],kAe=["0","1","2","3","4","5","6","7","8","9","."],FAe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function BAe(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}function d6(e,t,i="number"){let r,s,n="";for(let o=0;o<e.length;o++){let a=e[o];if("id"in a){if(o>0&&"id"in e[o-1])return void console.error("Two variables in a row",e);let c=t.getVariable(a.id),h=Us.getDisplayedValue(c);"number"===i&&Us.isTextValue(c)&&Array.isArray(c.textValue)&&1===c.textValue.length?h=parseFloat(h).toString():"boolean"===i&&Us.isBoolean(c)?h=c?"true":"false":"boolean"===i&&Us.isTextValue(c)&&!Array.isArray(c.textValue)&&(h='"'+h+'"'),n+=h}else"string"!==i?"and"!==a.name?"or"!==a.name?"True"!==a.name?"False"!==a.name?"boolean"!==i||BAe(a.name)||kAe.includes(a.name)||NAe.includes(a.name)||FAe.includes(a.name.replace(/\($/g,""))?n+=a.name:n+='"'+a.name+'"':n+="false":n+="true":n+="||":n+="&&":('"'!==a.name&&"+"!==a.name&&(n+=a.name),"+"===a.name&&"\\"===n[n.length-1]&&(n=n.slice(0,-1)+a.name))}if("string"===i)return n;if(0===e.length){if("number"===i)return 0;if("boolean"===i)return!1}try{r=rf(n)}catch(o){return void console.error(n,o)}try{s=Yt(r)}catch(o){console.error(n,r,o)}return s}function Yt(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(Yt(e.left)===Yt(e.right));case"!=":return+(Yt(e.left)!==Yt(e.right));case">":return+(Yt(e.left)>Yt(e.right));case">=":return+(Yt(e.left)>=Yt(e.right));case"<":return+(Yt(e.left)<Yt(e.right));case"<=":return+(Yt(e.left)<=Yt(e.right));case"+":return Yt(e.left)+Yt(e.right);case"-":return Yt(e.left)-Yt(e.right);case"*":return Yt(e.left)*Yt(e.right);case"/":return Yt(e.left)/Yt(e.right);case"%":return Yt(e.left)%Yt(e.right);case"&&":return Yt(e.left)&&Yt(e.right);case"||":return Yt(e.left)||Yt(e.right);case"^":return Math.pow(Yt(e.left),Yt(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-Yt(e.argument);case"!":return+!Yt(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if("Identifier"===e.callee.type){if("random"===e.callee.name){let t=0,i=1;if(e.arguments.length>=1)try{t=Yt(e.arguments[0])}catch(n){console.warn(n)}if(e.arguments.length>=2)try{i=Yt(e.arguments[1])}catch(n){console.warn(n)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(Yt))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}rf.addBinaryOp("^",11,!0);var VAe=new ye,zAe=new ye,HAe=class extends Ze{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===e.depth&&function DAe(e,t){let i=2*Math.PI;return(e%i+i)%i==(t%i+i)%i}(e.twist,0)&&e.startScale===e.endScale)}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:n}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),n=Math.max(0,Math.min(n,1));let r=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(n*r),o=this.inputs.path.isClosed?Math.ceil((i+n)*r):Math.ceil(Math.min(1,i+n)*r),a=Math.min(Math.max(2,o-s+1),r+2),l=[],c=[];for(let F=0;F<a;F++){let N=this.inputs.path.isClosed?(F+s)%e.length:Math.min(F+s,e.length-1);l.push(e[N].clone()),c.push(t[N].clone())}let h=(F,N,q)=>{l[F]=l[F].clone().lerp(l[N],q),c[F]=function UAe(e,t,i){let n=[new M,new M,new M],r=[new M,new M,new M];return e.extractBasis(n[0],n[1],n[2]),t.extractBasis(r[0],r[1],r[2]),n.forEach((s,o)=>{let a=r[o],l=qe.lerp(s.length(),a.length(),i);s.lerp(a,i).setLength(l)}),(new ye).makeBasis(n[0],n[1],n[2])}(c[F],c[N],q)},u=0,d=n*r%1;(!this.inputs.path.isClosed||i<=1)&&(d||0===n)&&(u=d,h(0,1,u));let p=0,f=(n+i)*r%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&n+i<1)&&f&&(p=f,h(l.length-1,l.length-2,1-p)),0===i){let F=l.length-1;l[F].copy(l[0]),c[F].copy(c[0])}this._applyPathModifiers(c,u,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(y="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let x,{regions:_,infos:b,vertices:w}=this._computeShapePoints(y),C=0;"round"===v&&(x=new CT(this.inputs.shapeData,2*m,m,y,g,void 0,!0),C=x.getAttribute("position").count);let S=0,E=0;b.sort((F,N)=>F.start-N.start),b.forEach(F=>{F.verticesStart=S,F.verticesCount=F.continuous.reduce((N,q,W)=>N+(0!==W&&q?1:2),0),E+=F.verticesCount,S=E});let T,D=E*a,I=0;if(this._isOpenEnded()&&"flat"===v){try{T=Hc({windingRule:fi.ODD,elementType:Cn.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:_})}catch{T=QG}I=T.vertexCount}let P=D+2*I+2*C,R=D+2*I,L={positions:new Float32Array(3*P),normals:new Float32Array(3*P),uvs:new Float32Array(2*P)},j=[];if(b.forEach(F=>{this._extrudeRegion(F,w,c,l,L,j,this._isGeometryClosed()&&!this._isOpenEnded())}),T&&(this._closeEnd(T,D,j,L,c[0],l[0],!1),this._closeEnd(T,D+I,j,L,c[c.length-1],l[l.length-1],!0)),x){L.positions.set(x.getAttribute("position").array,3*R),L.normals.set(x.getAttribute("normal").array,3*R),L.uvs.set(x.getAttribute("uv").array,2*R);let F=j.length;j.push(...x.getIndex().array.map(W=>W+R)),R+=C,L.positions.set(x.getAttribute("position").array,3*R),L.normals.set(x.getAttribute("normal").array,3*R),L.uvs.set(x.getAttribute("uv").array,2*R);let N=j.length;j.push(...x.getIndex().array.map(W=>W+R)),this.setAttribute("position",new st(L.positions,3)),this.setAttribute("normal",new st(L.normals,3)),this.setAttribute("uv",new st(L.uvs,2)),this.setIndex(j);let q=VAe;q.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(q,R,P),q.copy(c[0]).setPosition(l[0]).multiply(zAe.makeScale(1,1,-1)),this.applyMatrix4OnRange(q,R-C,R),this.reverseIndicesOnRange(F,N)}else this.setAttribute("position",new st(L.positions,3)),this.setAttribute("normal",new st(L.normals,3)),this.setAttribute("uv",new st(L.uvs,2)),this.setIndex(j)}_extractPathPoints(){let e=PG(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,n=this.inputs.path.isClosed,r=new M,s=new M,o=new M,a=new M,l=new M(0,1,0);for(let f=0;f<i;f++){let g,v,m=e[f];g=0===f?n?e[e.length-2]:m.clone().multiplyScalar(2).sub(e[1]):e[f-1],v=f===i-1?n?e[1]:m.clone().multiplyScalar(2).sub(e[f-1]):e[f+1];let y=m.clone().sub(g).normalize(),_=v.clone().sub(m).normalize(),b=y.clone().add(_).normalize();o.copy(b),0===f&&(b.equals(l)||b.clone().negate().equals(l))&&l.set(0,0,1);let w=l.clone().cross(b).normalize(),C=b.clone().cross(w).normalize();l.copy(C),a.copy(w),0===f&&(r.copy(C),s.copy(b));let x=(new ye).makeBasis(w,C,b);t.push(x)}let c=n?s:o,h=n?r:new M(0,1,0),u=c.clone().cross(a).normalize(),d=Math.acos(h.dot(u));if(isNaN(d))return t;let p=h.clone().cross(u);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let m=(new ye).makeRotationZ(d*f/t.length);t[f].multiply(m)}return t}_applyPathModifiers(e,t,i){let n=e.length,{angle:r,twist:s,startScale:o,endScale:a}=this.inputs.parameters.extrusion,l=new ye,c=new ye;return e.forEach((h,u)=>{let d=0===u?0:u===n-1?1:(u-t)/(n-(0===i?0:1)-(t+(1-i)));l.makeRotationZ(qe.lerp(r,r+s,d)*qe.DEG2RAD);let p=qe.lerp(o,a,d);c.makeScale(p,p,p),h.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=fi.ODD){let s,o,i=this.inputs.shapeData,n=i.extractShapePointsToFlatArray([],e),r=i.shapeHoles.map(p=>{let f=p.extractShapePointsToFlatArray([],e),m=[];for(let g=f.length-1;g>=1;g-=2)m.push(f[g-1],f[g-0]);return m});try{s=Hc({windingRule:t,elementType:Cn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[n]})}catch{s=xT}try{o=Hc({windingRule:fi.ODD,elementType:Cn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...r]})}catch{o=ZG}if(!s)throw new Error("error generating geometry");let a=s.elementCount;if(o){s.elementCount+=o.elementCount;for(let p=0;p<o.elements.length;p++)s.elements.push(o.elements[p]+(p%2==0?s.vertexCount:0));for(let p=0;p<o.vertexIndices.length;p++)s.vertexIndices.push(o.vertexIndices[p]+s.vertexCount);for(let p=0;p<o.vertices.length;p++)s.vertices.push(o.vertices[p])}let l=1/0,c=-1/0,h=1/0,u=-1/0;for(let p=0,f=s.vertexCount;p<f;p++){let m=2*p,g=s.vertices[m+0],v=s.vertices[m+1];g<l&&(l=g),g>c&&(c=g),v<h&&(h=v),v>u&&(u=v)}let d=[];for(let p=s.elementCount-1;p>=0;p--){let f=p>=a,m=2*p,g=s.elements[m+0],v=s.elements[m+1],y=g+v,_={start:g,count:v,normals:[],isHole:f,continuous:[],verticesStart:0,verticesCount:0};d.push(_);let b=g,w=y-1,C=g+1,x=i.roundedCurves.length;do{let S=b-g,T=s.vertices[2*b+0],I=s.vertices[2*b+1],P=s.vertices[2*C+0],R=s.vertices[2*C+1],L=T-s.vertices[2*w+0],j=I-s.vertices[2*w+1],F=Math.sqrt(L*L+j*j);L/=F,j/=F;let N=T-P,q=I-R,W=Math.sqrt(N*N+q*q);N/=W,q/=W,_.normals[2*S+0]=-q,_.normals[2*S+1]=N;let U=s.vertexIndices[b];if(Array.isArray(U))_.continuous[S]=!1;else{let[V,Y]=i.getCurveIndexFromVertexId(U-1,!0);if(Y>0&&Y<1)_.continuous[S]=!0;else{let G=1===Y?V+1:V-1;G=(G+x)%x;let X=1===Y?0:1,H=i.roundedCurves[V].getTangent(Y),re=i.roundedCurves[G].getTangent(X);_.continuous[S]=H.dot(re)>.95}}f&&(_.normals[2*S+0]*=-1,_.normals[2*S+1]*=-1),[w,b,C]=[b,C,C+1],C>=y&&(C-=v)}while(C!==g+1)}return{regions:[n,...r],infos:d,vertices:s.vertices}}_insertVertex(e,t,i,n,r){let s=2*t,o=3*t;e.positions[o+0]=i.x,e.positions[o+1]=i.y,e.positions[o+2]=i.z,e.normals[o+0]=n.x,e.normals[o+1]=n.y,e.normals[o+2]=n.z,e.uvs[s+0]=r.x,e.uvs[s+1]=r.y}_extrudeRegion(e,t,i,n,r,s,o){let a=new M,l=new M,c=new M,h=new M,u=new z;i.forEach((p,f)=>{let m=n[f],g=e.verticesStart*i.length+e.verticesCount*f;for(let v=0;v<e.count;v++){let y=2*(e.start+v);if(a.set(t[y+0],t[y+1],0),c.copy(a).applyMatrix4(p).add(m),e.continuous[v])h.set(e.normals[2*v+0],e.normals[2*v+1],0);else{let _=0===v?2*(e.start+e.count-1):y-2;l.set(t[_+0],t[_+1],0),h.copy(a).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(p).normalize(),u.set(0===v?1:v/e.count,f/(i.length-1)),this._insertVertex(r,g,c,h,u),g++,!e.continuous[v]||0===v){if(0===v)h.set(e.normals[2*v+0],e.normals[2*v+1],0),u.set(0,f/(i.length-1));else{let _=v===e.count-1?2*e.start:y+2;l.set(t[_+0],t[_+1],0),h.copy(l).sub(a),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(p).normalize(),this._insertVertex(r,g,c,h,u),g++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,m=e.verticesStart*i.length+e.verticesCount*(p+1),g=0;for(let v=0;v<e.count;v++){(!e.continuous[v]||0===v)&&g++;let y=v===e.count-1?0:g+1,_=f+g,b=f+y,w=m+y,C=m+g;e.isHole?s.push(_,w,b,_,C,w):s.push(_,b,w,_,w,C),g++}}}_closeEnd(e,t,i,n,r,s,o){let a=e.vertexCount,l=new M(0,0,o?-1:1).applyMatrix4(r),c=new M,h=new z;for(let d=0;d<a;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(r).add(s),this._insertVertex(n,t+d,c,l,h)}let u=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d;i.push(u[p+0]+t,u[p+(o?1:2)]+t,u[p+(o?2:1)]+t)}}applyMatrix4OnRange(e,t,i){let s,o,a,l,n=e.elements,r=(new an).getNormalMatrix(e).elements,c=this.attributes.position,h=this.attributes.normal;if(!c||!h)return;let u=c.array,d=h.array,p=c.itemSize;for(let f=t*p,m=i*p;f<m;f+=p)s=u[f+0],o=u[f+1],a=u[f+2],l=1/(n[3]*s+n[7]*o+n[11]*a+n[15]),u[f+0]=(n[0]*s+n[4]*o+n[8]*a+n[12])*l,u[f+1]=(n[1]*s+n[5]*o+n[9]*a+n[13])*l,u[f+2]=(n[2]*s+n[6]*o+n[10]*a+n[14])*l,s=d[f+0],o=d[f+1],a=d[f+2],d[f+0]=r[0]*s+r[3]*o+r[6]*a,d[f+1]=r[1]*s+r[4]*o+r[7]*a,d[f+2]=r[2]*s+r[5]*o+r[8]*a;c.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let n=e;n<t;n+=3){let r=i.getX(n),s=i.getX(n+1),o=i.getX(n+2);i.setXYZ(n,o,s,r)}i.needsUpdate=!0}}};function p6(){let e=new Ze;return e.setAttribute("position",new st(new Float32Array([]),3)),e.setIndex(new st(new Uint16Array([]),1)),e}var m6,Tw,GAe=p6().attributes,f6=class extends Ze{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,GAe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i?.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t?.requestRender()})}updateFont(e,t){var i=this;return(0,sn.Z)(function*(){let n=t.getFont(e);n&&(i.font=n,yield n.loadingPromise)})()}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!t?.isLoaded)return void console.warn("Cannot update text because its font is not loaded");let{width:i,height:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:o,text:a,textTransform:l}=e,c=Us.getDisplayedValue(a),u=function YAe(e,t,i){let n=[""],r="";for(let s of i)r+=s," "===s||"\n"===s?(n[n.length-1]+=r,r="","\n"===s&&n.push("")):t.getTextWidth(n[n.length-1]+r,e)>e.width&&(n[n.length-1].length&&n.push(""),t.getTextWidth(n[n.length-1]+r,e)>e.width&&(1===r.length?(n[n.length-1]+=r,r=""):(n[n.length-1]+=r.slice(0,-1),r=r[r.length-1],n.push(""))));return n[n.length-1]+=r,n}(e,t,2===l?c.toUpperCase():3===l?c.toLowerCase():c),{shapes:d,charWidths:p,charCoords:f}=t.generateShapes(u,e),m=.5*("number"==typeof i?i:1),g=.5*("number"==typeof n?n:1),v=d.map(b=>(new Qi).fromShape(b,!0));this.vectorShapes=v;let y=v.map(b=>uh.create({shape:b,parameters:{depth:r,extrudeBevelSegments:o,extrudeBevelSize:s,windingRule:r<=0?fi.NONZERO:fi.ODD,subdivisions:this.isLowResolution&&r>0?1:12}})),_=y.length?sh(y):p6();_.translate(-m,g,0),this.dispose(),this.wrappedText=u,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(_.attributes).forEach(([b,w])=>{this.setAttribute(b,w)}),this.setIndex(_.index),this.computeBoundingSphere()}clone(){let e=Il(new Ze,f6.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}setText(e){var t=this;return(0,sn.Z)(function*(){t.font&&(yield t.font.loadingPromise),yield t.update({...t.userData.parameters,text:e})})()}get text(){return this.userData.parameters.text??""}},RT=new Promise(e=>{m6=e}),g6=!1;function XAe(){if(!g6)return Tw||(Tw=function e(){return t.apply(this,arguments)}(),Tw);function t(){return(t=(0,sn.Z)(function*(){let n=In.e(41).then(In.bind(In,41)),[r,s]=yield Promise.all([n,fetch("https://unpkg.com/@splinetool/modelling-wasm@0.9.507/build/process.wasm").then(l=>l.arrayBuffer())]),o=r.default,a=yield o({wasmBinary:s});m6(a),g6=!0})).apply(this,arguments)}}function Iw(e,t,i,n){let r,s,o;"PathGeometry"===e.type?(s=JSON.parse(JSON.stringify(e)),o=[[],["extrusion"]]):(s={...e},o=[[]]);for(let c of o){let h=s;for(let u of c)h=h[u];for(r in h){let u=h[r];XCe(u)&&(h[r]=t.getVariable(u,[n.uuid,"geometry",...c,r]))}}let l,a={parameters:s,type:s.type};if("PathGeometry"===s.type)a.path=s.path;else if("VectorGeometry"===s.type){let c=Qi.createFromState(s.shape,s.width,s.height);a.shape=c}else if("NonParametricGeometry"===s.type)s.data.groups&&s.data.groups?.forEach(c=>c.materialIndex=Math.max(c.materialIndex??0,0)),a.geometry=(new a4).parse(s);else{if("SubdivGeometry"===s.type){let c=new Zr(s,i);return c.data=e,c}if("TextGeometry"===s.type)return new f6(s,t)}try{l=E6(a)}catch(c){console.error(c)}if(!l){let c=Qi.createFromState(Jb.defaultData(),100,100);a.shape=c,l=E6(a)}return l}var ZAe=new ye;function OT(e,t,i,n){let a,l,c,r=e.position.array,s=e.normal.array,o=ZAe.makeScale(t,i,n).invert().elements;for(var h=0,u=r.length;h<u;h+=3)r[h]*=t,r[h+1]*=i,r[h+2]*=n,a=s[h],l=s[h+1],c=s[h+2],s[h]=o[0]*a+o[4]*l+o[8]*c,s[h+1]=o[1]*a+o[5]*l+o[9]*c,s[h+2]=o[2]*a+o[6]*l+o[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var tt,Pw=new ln,sf=new M;RT.then(e=>{tt=e});var v6=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),y6=new Uint32Array([0,1,2,3]),_6=new Uint8Array([4]),Zr=class extends Ze{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let n=th.div(t,this.data.scaleBaked);this.subdividedGeometry&&OT(this.subdividedGeometry.attributes,...n),this.originalGeometry&&OT(this.originalGeometry.attributes,...n),this.data=e;let r=this.userData.parameters;this.userData.parameters={width:r.width*n[0],height:r.height*n[1],depth:r.depth*n[2]},this.originalGeometry.boundingSphere.center.multiply(sf.fromArray(n));let s=sf.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=Zr.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new wa(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0,Object.assign(this,this.subdividedGeometry??this.originalGeometry),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(Zr.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new ds,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let i=e.boundingSphere.center;Pw.setFromBufferAttribute(e.attributes.position),Pw.getCenter(i),e.boundingSphere.radius=i.distanceTo(Pw.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Pw.getSize(sf);let n={width:sf.x,height:sf.y,depth:sf.z};return this.userData.parameters=n,n}static build(e,t,i,n){let r,s,o,a=e?.phongAngle??35;!1===i&&(a=-1),t&&(tt.free_bvh(t),tt.free_subdivision_surface(t));try{r=Zr.allocate(e,n)}catch(l){console.error(l,e),r=Zr.allocate({positionWASM:v6,indexWASM:y6,verticesPerFaceWASM:_6},n)}if(tt.set_destination_refinement_level(r,0),s=Zr.buildLevel(r,!0,a),e.subdivisions>0)try{tt.set_destination_refinement_level(r,e.subdivisions),o=Zr.buildLevel(r,!1,a)}catch{try{tt.set_destination_refinement_level(r,e.subdivisions-1),o=Zr.buildLevel(r,!1,a)}catch{o=null}}else o=null;return{subdivPointer:r,originalGeometry:s,subdividedGeometry:o}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);let r,s,o,a,l,c,n=void 0!==e.shape||void 0!==e.path?t.geometry:Iw(e,i,!1);if(r="TorusGeometry"===e.type&&e.arc===2*Math.PI?n.getClosedTorusIndicesForBooleanOrSubdiv():n.getIndex(),({positions:s,triIndices:l}=Rw(n.getAttribute("position"),r)),"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){let h=e.radialSegments*e.heightSegments*3*2;c=[h,h+3*e.radialSegments]}return({indices:o,verticesPerFace:a}=w6(s,l,n,c)),{positions:s,indices:o,verticesPerFace:a}}static allocate(e,t){let i,n,r,s=[],o=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,n=e.indexWASM,r=e.verticesPerFaceWASM):(i=v6,n=y6,r=_6);let y,a=i.length,l=n.length,c=r.length,h=i.length+s.length+o.length,u=n.length+r.length,d=h*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,p=h*Float32Array.BYTES_PER_ELEMENT,m=(Uint32Array,tt._malloc(d)),g=new Float32Array(tt.HEAPF32.buffer,m,h),v=new Uint32Array(tt.HEAPU32.buffer,m+p,u);g.set(i,0),g.set(s,i.length),g.set(o,i.length+s.length),v.set(n,0),v.set(r,n.length),e?.scaleBaked?.some(b=>1!==b)&&(y=(new ye).makeScale(...e.scaleBaked)),t&&(y?y.premultiply(t):y=t);let _=y?tt.alloc_subdivision_surface2(m,a,m+p,l,m+p+n.length*Uint32Array.BYTES_PER_ELEMENT,c,y.elements):tt.alloc_subdivision_surface(m,a,m+p,l,m+p+n.length*Uint32Array.BYTES_PER_ELEMENT,c);return tt._free(m),_}static buildLevel(e,t,i,n,r){let s=r?tt.get_mesh_data2(e,t?tt.Level.CONTROL:tt.Level.REFINED,i,r.elements):tt.get_mesh_data(e,t?tt.Level.CONTROL:tt.Level.REFINED,i),a=tt.HEAPU32.subarray(s>>2,8+(s>>2)),l=a.subarray(4,8),c=0,h=tt.HEAPU32[a[c]>>2],u=tt.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=tt.HEAPU32[a[c]>>2],p=tt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=tt.HEAPU32[a[c]>>2],m=tt.HEAPU32.subarray(f>>2,(f>>2)+l[c]);c++;let g=tt.HEAPU32[a[c]>>2],v=tt.HEAPU32.subarray(g>>2,(g>>2)+l[c]);if(c++,void 0===n){let y=new Ze;if(y.setIndex(new ep(v,1)),y.setAttribute("position",new Fe(u,3)),y.setAttribute("normal",new Fe(p,3)),t){y.setAttribute("faceMap",new ep(m,1));let _=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new st(_,4))}return tt.free_mesh_data(s),y.userData.type="SubdivGeometry",y}n.getAttribute("position").copyArray(u),n.getAttribute("normal").copyArray(p),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,tt.free_mesh_data(s)}static freeSubdivPointer(e){tt.free_bvh(e),tt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let n=tt.get_wireframe_data_for_base_level(e),s=tt.HEAPU32.subarray(n>>2,4+(n>>2)),o=s.subarray(2,4),a=0,l=tt.HEAPU32[s[a]>>2],c=tt.HEAPF32.subarray(l>>2,(l>>2)+o[a]);a++;let h=tt.HEAPU32[s[a]>>2],u=tt.HEAPU32.subarray(h>>2,(h>>2)+o[a]);if(void 0===t){let d=new Ze;d.setAttribute("position",new Fe(c,3));let p=new Float32Array(c.length);for(let f=0,m=c.length;f<m;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new st(p,3)),d.setIndex(new ep(u,1)),tt.free_wireframe_data_for_base_level(n),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,tt.free_wireframe_data_for_base_level(n)}static updateCollabMesh(e,t,i){let n=0===t;n||tt.set_destination_refinement_level(e,t);let r=i?tt.get_topological_data2(e,n?tt.Level.CONTROL:tt.Level.REFINED,i.elements):tt.get_topological_data(e,n?tt.Level.CONTROL:tt.Level.REFINED),o=tt.HEAPU32.subarray(r>>2,6+(r>>2)),a=o.subarray(3,6),l=0,c=tt.HEAPU32[o[l]>>2],h=new Float32Array(tt.HEAPF32.subarray(c>>2,(c>>2)+a[l]));l++;let u=tt.HEAPU32[o[l]>>2],d=new Uint32Array(tt.HEAPU32.subarray(u>>2,(u>>2)+a[l]));l++;let p=tt.HEAPU32[o[l]>>2],f=new Uint8Array(tt.HEAPU32.subarray(p>>2,(p>>2)+a[l]));return tt.free_topological_data(r),{positions:h,indices:d,verticesPerFace:f}}},b6=["getX","getY","getZ"];function Rw(e,t){let i={},n=t?t.count:e.count,r=0,s=[],o=[];for(let c=0;c<n;c++){let h=t?t.getX(c):c,u="";for(let d=0;d<3;d++)u+=~~(1e4*e[b6[d]](h))+",";if(u in i)s.push(i[u]);else{for(let d=0;d<3;d++)o.push(e[b6[d]](h));i[u]=r,s.push(r),r++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:o,triIndices:l}}var Ow=new M,LT=new M,NT=new M,kT=new M;function w6(e,t,i,n){let r=[],s=[];if(void 0!==i.userData.shape&&0===i.userData.parameters.depth&&0===i.userData.shape.shapeHoles.length){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if("EllipseGeometry"===i.userData.type&&c<=24&&c%4==0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,f)=>Math.floor(f/2)%d==0)}let h=0;for(let d=0;d<l.length;d+=2)h+=(l[d]-l[(0===d?l.length:d)-2])*(l[d+1]+l[(0===d?l.length:d)-1]);e.length=0;let u=0;if(h<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),r.push(u++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),r.push(u++);return s.push(u),{indices:r,verticesPerFace:s}}let o=new Float32Array([i.userData.parameters.depth])[0],a=0;for(;a<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[3*t[a]+2]===o||0===e[3*t[a]+2])&&l++,(e[3*t[a+1]+2]===o||0===e[3*t[a+1]+2])&&l++,(e[3*t[a+2]+2]===o||0===e[3*t[a+2]+2])&&l++,3===l)break}if(t[a+1]===t[a+3]&&t[a+2]===t[a+5]||t[a+0]===t[a+3]&&t[a+2]===t[a+4]){Ow.set(e[3*t[a]],e[3*t[a]+1],e[3*t[a]+2]),LT.set(e[3*t[a+1]],e[3*t[a+1]+1],e[3*t[a+1]+2]),NT.set(e[3*t[a+4]],e[3*t[a+4]+1],e[3*t[a+4]+2]),kT.set(e[3*t[a+5]],e[3*t[a+5]+1],e[3*t[a+5]+2]),LT.sub(Ow).normalize(),NT.sub(Ow).normalize(),kT.sub(Ow).normalize();let l=LT.cross(NT).dot(kT);Math.abs(l)>.005||n&&n.some((c,h)=>h%2!=1&&a>=n[h]&&a<n[h+1])?(r.push(t[a],t[a+1],t[a+2]),s.push(3),a+=3):(r.push(t[a],t[a+1],t[a+4],t[a+5]),s.push(4),a+=6)}else r.push(t[a],t[a+1],t[a+2]),s.push(3),a+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],h=0;for(let u=0,d=0;u<e.length;u+=3,d++)0===e[u+2]&&(l.push(d),h++),e[u+2]===o&&c.push(d);if(0===i.userData.parameters.extrudeBevelSize){let u=c[0];c[0]=c[1],c[1]=u}l.reverse(),r.push(...l,...c),s.push(h,h)}return{indices:r,verticesPerFace:s}}var Nl={};((e,t)=>{for(var i in t)y_(e,i,{get:t[i],enumerable:!0})})(Nl,{calcBoolean:()=>eDe,calcBooleanTopological:()=>JAe,freeMeshSet:()=>rDe,getMeshSet:()=>tDe,hasOpenEdges:()=>iDe,transformMeshSet:()=>nDe});var x6,Lw,Ot,af,QAe=new Promise(e=>{x6=e});function KAe(){if(Lw)return Lw;function t(){return(t=(0,sn.Z)(function*(){let n=In.e(552).then(In.bind(In,552)),[r,s]=yield Promise.all([n,fetch("https://unpkg.com/@splinetool/boolean-wasm@0.9.507/build/boolean.wasm").then(l=>l.arrayBuffer())]),o=r.default,a=yield o({wasmBinary:s});x6(a)})).apply(this,arguments)}return Lw=function e(){return t.apply(this,arguments)}(),Lw}function S6(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,n=t*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(e[0])?i:n,s=Ot._malloc(r);return(Number.isInteger(e[0])?new Uint32Array(Ot.HEAPU32.buffer,s,t):new Float32Array(Ot.HEAPF32.buffer,s,t)).set(e,0),s}function C6(e){switch(e){case 0:return Ot.OP.UNION;case 1:return Ot.OP.INTERSECTION;case 2:return Ot.OP.A_MINUS_B;case 3:return Ot.OP.B_MINUS_A;case 4:return Ot.OP.SYMMETRIC_DIFFERENCE;case 5:return Ot.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function JAe(e,t){void 0===af&&(af=Ot.init_csg());let i=S6(e),n=Ot.csg_calc_topological(af,i,e.length,C6(t));Ot._free(i);let s=Ot.HEAPU32.subarray(n>>2,6+(n>>2)),o=s.subarray(3,6),a=0,l=Ot.HEAPU32[s[a]>>2],c=new Float32Array(Ot.HEAPF32.subarray(l>>2,(l>>2)+o[a]));a++;let h=Ot.HEAPU32[s[a]>>2],u=new Uint32Array(Ot.HEAPU32.subarray(h>>2,(h>>2)+o[a]));a++;let d=Ot.HEAPU32[s[a]>>2],p=new Uint8Array(Ot.HEAPU32.subarray(d>>2,(d>>2)+o[a]));return Ot.free_mesh_data(n),{positions:c,indices:u,verticesPerFace:p}}function eDe(e,t,i,n){void 0===af&&(af=Ot.init_csg());let r=S6(e),s=Ot.csg_calc(af,r,e.length,n,C6(t));Ot._free(r);let a=Ot.HEAPU32.subarray(s>>2,5+(s>>2)),l=a.subarray(2,5),c=0,h=Ot.HEAPU32[a[c]>>2],u=Ot.HEAPF32.subarray(h>>2,(h>>2)+l[c]);c++;let d=Ot.HEAPU32[a[c]>>2],p=Ot.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=l[c];i.setAttribute("position",new Fe(u,3)),i.setAttribute("normal",new Fe(p,3));let m=Ot.HEAPF32.subarray(5+(s>>2),5+(s>>2)+6);return null===i.boundingSphere&&(i.boundingSphere=new ds),i.boundingSphere.radius=-1,i.userData.parameters={width:2*m[3],height:2*m[4],depth:2*m[5]},Ot.free_mesh_data(s),f}function tDe(e,t,i){if(void 0===Ot)return-1;let n,r,s;if(t&&void 0!==e.userData.positions){let g=e.userData;s=g.verticesPerFace.length,n=g.positions,r=Array(g.verticesPerFace.reduce((v,y)=>v+y,0)+s);for(let v=0,y=0,_=0;v<g.verticesPerFace.length;v++){r[_++]=g.verticesPerFace[v];for(let b=0;b<g.verticesPerFace[v];b++)r[_++]=g.indices[y++]}}else({positions:n,faceIndices:r,nFaces:s}=function $Ae(e,t,i){let n,r;r="TorusGeometry"===e.userData.parameters.type&&e.userData.parameters.arc===2*Math.PI?e.getClosedTorusIndicesForBooleanOrSubdiv():e.getIndex();let a,{positions:s,triIndices:o}=Rw(e.getAttribute("position"),r);if(t&&i){let{indices:l,verticesPerFace:c}=w6(s,o,e);a=c.length,n=[];for(let h=0,u=0;h<a;h++){n.push(c[h]);for(let d=0;d<c[h];d++)n.push(l[u++])}}else{let l=o.length;n=Array(l+l/3),a=0;for(let c=0,h=0;h<n.length;)n[h++]=3,a++,n[h++]=o[c++],n[h++]=o[c++],n[h++]=o[c++]}return{positions:s,faceIndices:n,nFaces:a}}(e,t,i));let o=n.length,a=r.length,l=n.length,c=r.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,p=(Uint32Array,Ot._malloc(h)),f=new Float32Array(Ot.HEAPF32.buffer,p,l),m=new Uint32Array(Ot.HEAPU32.buffer,p+u,c);return f.set(n,0),m.set(r,0),Ot.get_csg_mesh(p,o,p+u,a,s)}function iDe(e){return Ot.has_open_edges(e)}function nDe(e,t){Ot.transform_csg_mesh(e,t.elements)}function rDe(e){Ot.free_csg_mesh(e)}QAe.then(e=>Ot=e);var sDe={ConeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=qe.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let d,{width:t,depth:i,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:h,cornerSegments:u}=e.parameters;return 0===l?(d=new Ze,d.setAttribute("position",new Fe([],3))):d=c>0||h>0||l<360?new LG(0,t/2,n,r,s,o,a,l*Math.PI/180,c,h,u,0,!0):new Vj(t/2,n,r,s,o),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},CubeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let c,{width:t,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:o,cornerRadius:a,cornerSegments:l}=e.parameters;return c=0==a?new wa(t,i,n,r,s,o):new AMe(t,i,n,r,s,o,a,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},CylinderGeometry:RG,DodecahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:s,cornerSides:o}=e.parameters,a=0===r&&0!==s?new NG(.5*t,s,o):new zj(.5*t,r);return a.scale(1,i/t,n/t),Object.assign(a,{userData:{...e,type:"DodecahedronGeometry"}})}},EllipseGeometry:ET,HelixGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??n),s=Math.abs(i.depth??n),o=Math.abs(Math.min(n,s))/2;return{parameters:Object.assign(i,{width:n,height:r,depth:s,radius:o,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:n,radius:r,revolutions:s,segments:o,pathRadius:a,pathType:l,pathSegments:c,cornerRadius:h,cornerSegments:u}=e.parameters,d=new r6(!1,t,i,n,r,s,o,a,l,c,h,u);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},IcosahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:s,cornerSides:o}=e.parameters,a=0===r&&0!==s?new s6(.5*t,s,o):new Xj(.5*t,r);return a.scale(1,i/t,n/t),Object.assign(a,{userData:{...e,type:"IcosahedronGeometry"}})}},LatheGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){(e.parameters?.points??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},t?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:n}=e.parameters,r=new tb;r.moveTo(t[0].x,t[0].y),r.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new Bj(r.extractPoints(n).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},NonParametricGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let n,i=e.geometry??t?.geometry??(new Ze).copy(new wa(100,100,100));void 0===t?(i.computeBoundingBox(),i.boundingBox.getSize(zn),n={width:zn.x,height:zn.y,depth:zn.z,subdivisions:0}):n=t.parameters;let r={...n,...e.parameters};return{parameters:{width:Math.abs(r.width),height:Math.abs(r.height),depth:Math.abs(r.depth),subdivisions:Math.abs(r.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:n,subdivisions:r}=e.parameters,s=e.geometry??(new Ze).copy(new wa(100,100,100)),o=s.userData.parameters;void 0===o?(s.computeBoundingBox(),s.boundingBox.getSize(zn)):zn.set(o.width,o.height,o.depth),(t!==zn.x||i!==zn.y||n!==zn.z)&&s.scale(0===zn.x?1:t/zn.x,0===zn.y?1:i/zn.y,0===zn.z?1:n/zn.z);let a=s.originalGeometry;try{r>0?(void 0===a||o?.subdivisions!==r)&&(void 0===a&&(a=s),s=new class{constructor(e=1){this.subdivisions=e}modify(e){(e=e instanceof Ze?(new Ew).fromBufferGeometry(e):e.clone()).mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let i,n,r,s,o,t=new M,a=e.vertices,l=e.faces,c=e.faceVertexUvs[0],h=void 0!==c&&c.length>0,u=[],d=new Map;!function pAe(e,t,i,n){let r,s,o;for(r=0,s=e.length;r<s;r++)i[r]={edges:[]};for(r=0,s=t.length;r<s;r++)o=t[r],IT(o.a,o.b,e,n,o,i),IT(o.b,o.c,e,n,o,i),IT(o.c,o.a,e,n,o,i)}(a,l,u,d);let f,m,g,v,y,_,b,p=[];for(let re of Array.from(d.keys())){for(m=d.get(re),g=new M,y=3/8,_=1/8,b=m.faces.length,2!=b&&(y=.5,_=0),g.addVectors(m.a,m.b).multiplyScalar(y),t.set(0,0,0),s=0;s<b;s++){for(v=m.faces[s],o=0;o<3&&(f=a[dAe(v,hAe[o])],f===m.a||f===m.b);o++);f&&t.add(f)}t.multiplyScalar(_),g.add(t),m.newEdge=p.length,p.push(g)}let w,C,x,S,E,D,T,I=[];for(n=0,r=a.length;n<r;n++){for(D=a[n],E=u[n].edges,i=E.length,3==i?w=3/16:i>3&&(w=3/(8*i)),C=1-i*Number(w),x=w,i<=2&&2==i&&(C=3/4,x=1/8),T=D.clone().multiplyScalar(C),t.set(0,0,0),s=0;s<i;s++)S=E[s],f=S.a!==D?S.a:S.b,t.add(f);t.multiplyScalar(Number(x)),T.add(t),I.push(T)}let L,j,F,W,U,V,Y,P=I.concat(p),R=I.length,N=[],q=[],G=new z,X=new z,H=new z;for(n=0,r=l.length;n<r;n++)v=l[n],L=Number(TT(v.a,v.b,d).newEdge)+R,j=Number(TT(v.b,v.c,d).newEdge)+R,F=Number(TT(v.c,v.a,d).newEdge)+R,Aw(N,L,j,F,v.materialIndex),Aw(N,v.a,L,F,v.materialIndex),Aw(N,v.b,j,L,v.materialIndex),Aw(N,v.c,F,j,v.materialIndex),h&&(W=c[n],U=W[0],V=W[1],Y=W[2],G.set(nf(U.x,V.x),nf(U.y,V.y)),X.set(nf(V.x,Y.x),nf(V.y,Y.y)),H.set(nf(U.x,Y.x),nf(U.y,Y.y)),Dw(q,G,X,H),Dw(q,U,G,H),Dw(q,V,X,G),Dw(q,Y,H,X));e.vertices=P,e.faces=N,h&&(e.faceVertexUvs[0]=q)}}(r).modify(a).toBufferGeometry()):(void 0!==a&&(s=a),a=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals())}catch{void 0!==a&&(s=a),a=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals()}return void 0!==a&&Object.assign(s,{originalGeometry:a}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new a4(i).load(e,n=>{let r=this.normalizeInputs({geometry:n});n.boundingBox.getSize(zn);let s=100/zn.x;Object.assign(r.parameters,{width:100,height:zn.y*s,depth:zn.z*s}),t(this.build(r))})}},PolygonGeometry:c6,PyramidGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,heightSegments:s,openEnded:o,cornerRadius:a,cornerSegments:l}=e.parameters,c=new yAe(.5*t,i,r,s,o,a,l);return c.scale(1,1,n/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}},RectangleGeometry:u6,SphereGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=qe.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let h,{width:t=100,height:i=t,depth:n=t,widthSegments:r=64,heightSegments:s=64,phiStart:o,phiLength:a,thetaStart:l,thetaLength:c}=e.parameters;return 0===c?(h=new Ze,h.setAttribute("position",new Fe([],3))):h=new dA(.5*t,r,s,o,a,l,c*qe.DEG2RAD),h.scale(1,i/t,n/t),Object.assign(h,{userData:{...e,type:"SphereGeometry"}})}},PlaneGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:n=8,heightSegments:r=8}=e.parameters,s=new G_(t,i,n,r);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},BackdropGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,angle:r,cornerRadius:s,cornerSegments:o}=e.parameters,a=new xAe(t,i,n,r,s,o);return Object.assign(a,{userData:{...e,type:"BackdropGeometry"}})}},StarGeometry:h6,TextFrameGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,n=new G_(t,i);return Object.assign(n,{userData:{...e,type:"TextFrameGeometry"}})}},TorusGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.round(Math.abs(i.depth??.25*i.width));return{parameters:Object.assign(i,{width:n,height:r,depth:s})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,tubularSegments:s,arc:o,cornerRadius:a,cornerSegments:l}=e.parameters,c=function EAe(e,t,i,n,r,s,o,a,l,c,h){[t,i]=[i,t],o=t/2;let u=qe.clamp(r/360,0,1);if(0===u){let d=new Ze;return d.setAttribute("position",new Fe([],3)),d}return 1===u&&(c=0),new r6(!0,e,t,i,n,u,s,o,a,l,c,h)}(t,i,n,.5*t,o,s,0,0,r,a,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}},TorusKnotGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??.125*i.width})}}static build(e){let{width:t,tube:i,tubularSegments:n,radialSegments:r,p:s,q:o}=e.parameters,a=.5*t;a!==i&&(a-=i);let l=new Zj(a,i,n,r,s,o);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},TriangleGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Qi?e.shape:new Qi,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:o,isRect:a}=e.parameters,l=e.shape,c=.5*t,h=.5*i;a?(l.addPoint(l.createPoint(-c,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=n;l.roundness=n,l.update();let u=uh.create({shape:l,parameters:{roundness:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:o}});return Object.assign(u,{userData:{...e,type:"TriangleGeometry"}})}},PathGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),o=t?.shapeData??ET.create({parameters:Y5}).userData.shape;return{path:e.path??ew.defaultData(),parameters:Object.assign(i,{width:n,height:r,depth:s,extrusion:{...X5,...i.extrusion}}),shapeData:o}}static build(e){if(e.path.points.length>=2){let t=new HAe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}return Object.assign(new Ze,{userData:{...e,type:"PathGeometry"}})}},VectorGeometry:uh},E6=e=>sDe[e.type].create(e);function lf(e){return null!==e&&"booleanOp"in e}var M6=class extends(uT(jr)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new ye}updateVisible(e){super.updateVisible(e),this.visible=!lf(this.parent)&&this.visible,lf(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(Nl.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),lf(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof M6&&(e.freeBooleanPointer(),lf(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&lf(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),lf(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},Nw=new ln;function FT(e,t=0,i=e.count,n,r){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0;for(let u=t;u<i;u++){let d=e.getX(u),p=e.getY(u),f=e.getZ(u);d<s&&(s=d),p<o&&(o=p),f<a&&(a=f),d>l&&(l=d),p>c&&(c=p),f>h&&(h=f)}Nw.min.set(s,o,a),Nw.max.set(l,c,h),Nw.getCenter(n),Nw.getSize(r).multiplyScalar(.5)}var oDe=new Ze,aDe=new Eg,gs=class extends M6{constructor(e,t){super(oDe,aDe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?FT(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},A6=class{constructor(e){this.name=(e=e??{}).name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},Gc=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=qe.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return this.analyze(e,i=i??{}),this.flow(e,t,i)}flow(e,t,i){e.addFlow((i=i??{}).slot,i.cache,i.context);let n={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),n}build(e,t,i){t=t??this.getType(e,t);let n=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,n,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,n,r,s){return""}generate(e,t,i,n,r){return""}parse(e,t,i,n){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let n=e.getTypeLength(i);(n>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=n,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}getHash(){let t,i,e="{";for(t in this)i=this[t],i instanceof Gc&&(e+='"'+t+'":'+i.getHash()+",");if(this.hashProperties)for(let n=0;n<this.hashProperties.length;n++)t=this.hashProperties[n],i=this[t],e+='"'+t+'":"'+String(i)+'",';return e+='"id":"'+this.uuid+'"}',e}},vs=new class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){this.keywords[e]={callback:t,cache:i=void 0===i||i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return void 0!==this.nodes[e]}containsKeyword(e){return void 0!==this.keywords[e]}},mi=class extends Gc{constructor(e,t){super(e),this.scope="",this.shared=void 0===(t=t??{}).shared||t.shared,this.unique=void 0!==t.unique&&t.unique}build(e,t,i,n){if(t=t??this.getType(e),this.getShared(e,t)){let r=this.getUnique(e,t);r&&void 0===this.uuid&&(this.uuid=qe.generateUUID()),i=e.getUUID(i??this.getUUID(),!r);let s=e.getNodeData(i),o=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(r)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,o)||e.context.ignoreCache||1===s.deps))return super.build(e,t,i);i=this.getUUID(!1);let a=this.getTemp(e,i);if(a)return e.format(a,o,t);{a=super.generate(e,t,i,s.output,n);let l=this.generate(e,o,i);return e.addNodeCode(a+" = "+l+";"),e.format(a,o,t)}}return super.build(e,t,i)}getShared(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,n,r){return this.getShared(e,t)||console.error("TempNode is not shared"),e.getTempVar(i=i??this.uuid,n??this.getType(e),r,this.getLabel()).name}},ys=class extends mi{constructor(e,t){(t=t??{}).shared=void 0!==t.shared&&t.shared,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,n,r,s){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let o=e.getNodeData(i);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,i,n,r,s):e.isShader("vertex")?(o.vertex||(o.vertex=e.createVertexUniform(n,this,r,s,this.getLabel())),e.format(o.vertex.name,n,t)):(o.fragment||(o.fragment=e.createFragmentUniform(n,this,r,s,this.getLabel())),e.format(o.fragment.name,n,t))}},or=class extends ys{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof z?e:new z(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,n,r,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",n,t)}},po=class extends ys{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof M?e:new M(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,n,r,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,t)}},_s=class extends Je{constructor(e,t,i,n){super(e,t,i),this.isColorA=!0,this.a=n}setRGBA(e,t,i,n){super.setRGB(e,t,i),this.a=n}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,t="srgb"){let i;if("transparent"===e)return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let n,r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="rgba"===r?parseFloat(n[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="hsla"===r?parseFloat(n[4]):1,super.setStyle(e,t)}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},kl=class extends ys{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof _s?e:new _s(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,n,r,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,t)}},cDe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,D6=/[a-z_0-9]+/gi,Te=class extends mi{constructor(e,t,i,n,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===r,this.isInterface=!1,this.parse(e,t,i,n)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,n,r){let s,o=0,a=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=D6.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let h=l[c],u=h[0],d=!this.isMethod||!this.getInputByName(u),p=u;if(this.keywords[u]||this.useKeywords&&d&&vs.containsKeyword(u)){let f=this.keywords[u];if(!f){let m=vs.getKeywordData(u);m.cache&&(f=e.keywords[u]),f=f||vs.getKeyword(u,e),m.cache&&(e.keywords[u]=f)}p=f.build(e)}u!==p&&"."!==a[h.index+o-1]&&(a=a.substring(0,h.index+o)+p+a.substring(h.index+u.length+o),o+=p.length-u.length),void 0===this.getIncludeByName(p)&&vs.contains(p)&&e.include(vs.get(p))}return"source"===t?a:this.isMethod?(this.isInterface||e.include(this,void 0,a),this.name):e.format("( "+a+" )",this.getType(e),t)}parse(e,t,i,n){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=n??{},this.isMethod){let r=cDe.exec(this.src);if(this.inputs=[],r&&4==r.length){this.type=r[1],this.name=r[2];let s=r[3].match(D6);if(s){let o=0;for(;o<s.length;){let l,a=s[o++];"in"===a||"out"===a||"inout"===a?l=s[o++]:(l=a,a="");let c=s[o++];this.inputs.push({name:c,type:l,qualifier:a})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},uDe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,T6=class extends mi{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||T6.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,n,r){this.src=e||"";let s,o,a="",l=uDe.exec(e);this.useDefine=r??"#"===this.src.charAt(0),l&&l.length>1?(o=l[1],s=l[2],a=l[3]):(s=this.src,o="f"),this.name=s,this.type=o,this.value=a}build(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,n,r){return e.format(this.name,this.getType(e),t)}},gi=T6;gi.PI="PI",gi.PI2="PI2",gi.RECIPROCAL_PI="RECIPROCAL_PI",gi.RECIPROCAL_PI2="RECIPROCAL_PI2",gi.LOG2="LOG2",gi.EPSILON="EPSILON";var hDe=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),dDe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),I6=class extends mi{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,n,r){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=hDe.exec(e);if(t){let n,i=t[2];for(;n=dDe.exec(i);)this.inputs.push({type:n[1],name:n[2]});this.name=t[1]}else this.name="";this.type=this.name}},BT=class extends mi{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(n,this.getType(e),t)}};vs.addKeyword("uv",function(){return new BT}),vs.addKeyword("uv2",function(){return new BT(1)});var cf=class extends mi{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??cf.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case _a:return["Linear"];case xt:return["sRGB"];default:return[]}}generate(e,t){let i=this.input.build(e,"v4"),n=this.getType(e),r=cf.Nodes[this.method],s=e.include(r);if(s===cf.LINEAR_TO_LINEAR)return e.format(i,n,t);if(2===r.inputs?.length){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",n,t)}return e.format(s+"( "+i+" )",n,t)}fromEncoding(e){let t=cf.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=cf.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Fa=cf;Fa.Nodes={LinearToLinear:new Te(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new Te(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new Te(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},Fa.LINEAR_TO_LINEAR="LinearToLinear",Fa.SRGB_TO_LINEAR="sRGBToLinear",Fa.LINEAR_TO_SRGB="LinearTosRGB";var Ni=class extends Te{constructor(e="",t,i,n,r){super(e,r,n,i,t),this.nodeType="Expression"}},Fl=class extends ys{constructor(e=new kn,t,i,n){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new BT,this.bias=i,this.project=void 0!==n&&n}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if("sampler2D"===t)return this.getTexture(e,t);let s,o,i=this.getTexture(e,t),n=this.uv.build(e,this.project?"v4":"v2"),r=this.bias?this.bias.build(e,"f"):void 0;void 0===r&&e.context.bias&&(r=e.context.bias.setTexture(this).build(e,"f")),s=this.project?"texture2DProj":r?"tex2DBias":"tex2D",o=r?s+"( "+i+", "+n+", "+r+" )":s+"( "+i+", "+n+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new Fa(new Ni("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(e,l),e.removeContext(),e.format(o,l,t)}},Ve=class extends ys{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,n,r,s){return e.format(this.value+(this.value%1?"":".0"),n,t)}},P6=class extends mi{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,n,r){n=this.getType(e);let s=this.value,o=s.build(e,t)+"( ",a=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l];a.push((this.inputs[l]||this.inputs[c.name]).build(e,e.getTypeByFormat(c.type)))}o+=a.join(", ")+" )"}return e.format(o,n,t)}},R6=class extends mi{constructor(e,t,i=R6.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let n=this.a.build(e,i),r=this.b.build(e,i);return e.format("( "+n+" "+this.op+" "+r+" )",i,t)}},bs=R6;bs.ADD="+",bs.SUB="-",bs.MUL="*",bs.DIV="/";var vi=class extends mi{constructor(e,t=vi.ABS,i,n){super(),this.nodeType="Math",this.a=e,"string"!=typeof t?this.b=t:n=t,"string"!=typeof i?this.c=i:n=i,this.method=n,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case vi.MIX:case vi.CLAMP:case vi.REFRACT:case vi.SMOOTHSTEP:case vi.FACEFORWARD:return 3;case vi.MIN:case vi.MAX:case vi.MOD:case vi.STEP:case vi.REFLECT:case vi.DISTANCE:case vi.DOT:case vi.CROSS:case vi.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>n?this.a.getType(e):i>n?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case vi.LENGTH:case vi.DISTANCE:case vi.DOT:return"f";case vi.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,n,r,s=this.a?e.getTypeLength(this.a.getType(e)):0,o=this.b?e.getTypeLength(this.b.getType(e)):0,a=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case vi.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case vi.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case vi.CROSS:i=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case vi.STEP:i=this.a.build(e,1===s?"f":l),n=this.b.build(e,l);break;case vi.MIN:case vi.MAX:case vi.MOD:i=this.a.build(e,l),n=this.b.build(e,1===o?"f":l);break;case vi.REFRACT:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,"f");break;case vi.MIX:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,1===a?"f":l);break;default:i=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(r=this.c.build(e,l))}let h=[];h.push(i),n&&h.push(n),r&&h.push(r);let u=this.getNumInputs(e);if(h.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${h.length}.`);return e.format(this.method+"( "+h.join(", ")+" )",c,t)}},yt=vi;yt.RAD="radians",yt.DEG="degrees",yt.EXP="exp",yt.EXP2="exp2",yt.LOG="log",yt.LOG2="log2",yt.SQRT="sqrt",yt.INV_SQRT="inversesqrt",yt.FLOOR="floor",yt.CEIL="ceil",yt.NORMALIZE="normalize",yt.FRACT="fract",yt.SATURATE="saturate",yt.SIN="sin",yt.COS="cos",yt.TAN="tan",yt.ASIN="asin",yt.ACOS="acos",yt.ARCTAN="atan",yt.ABS="abs",yt.SIGN="sign",yt.LENGTH="length",yt.NEGATE="negate",yt.INVERT="invert",yt.MIN="min",yt.MAX="max",yt.MOD="mod",yt.STEP="step",yt.REFLECT="reflect",yt.DISTANCE="distance",yt.DOT="dot",yt.CROSS="cross",yt.POW="pow",yt.MIX="mix",yt.CLAMP="clamp",yt.REFRACT="refract",yt.SMOOTHSTEP="smoothstep",yt.FACEFORWARD="faceforward";var _v=class extends mi{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,n){let r=new P6(_v.Nodes.bilinearCubeUV,[t,i,n]);this.colorSpaceTL=this.colorSpaceTL??new Fa(new Ni("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Fa(new Ni("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Fa(new Ni("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Fa(new Ni("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new Ni(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Ni(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Ni(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Ni(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let o=new Ni("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return o.keywords.cubeUV_TL=this.colorSpaceTLExp,o.keywords.cubeUV_TR=this.colorSpaceTRExp,o.keywords.cubeUV_BL=this.colorSpaceBLExp,o.keywords.cubeUV_BR=this.colorSpaceBRExp,o.keywords.cubeUV=r,o}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=new P6(_v.Nodes.roughnessToMip,[this.bias||e.context.roughness]),s=new yt(r,_v.Nodes.m0,_v.Nodes.cubeUV_maxMipLevel,yt.CLAMP),o=new yt(s,yt.FLOOR),a=new yt(s,yt.FRACT),l=this.bilinearCubeUV(e,this.value,i,o),c=this.bilinearCubeUV(e,this.value,i,new bs(o,new Ve(1).setReadonly(!0),bs.ADD)),h=new yt(l,c,a,yt.MIX);return e.format(h.build(e),"v4",t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},VT=_v;VT.Nodes=function(){let e=new I6("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new gi("float cubeUV_maxMipLevel 8.0",!0),i=new gi("float cubeUV_minMipLevel 4.0",!0),n=new gi("float cubeUV_maxTileSize 256.0",!0),r=new gi("float cubeUV_minTileSize 16.0",!0),s=new Te("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");s.useKeywords=!1;let o=new Te("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");o.useKeywords=!1;let a=new Te("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,s,o,t,i,n,r]);a.useKeywords=!1;let l=new gi("float r0 1.0",!0),c=new gi("float v0 0.339",!0),h=new gi("float m0 -2.0",!0),u=new gi("float r1 0.8",!0),d=new gi("float v1 0.276",!0),p=new gi("float m1 -1.0",!0),f=new gi("float r4 0.4",!0),m=new gi("float v4 0.046",!0),g=new gi("float m4 2.0",!0),v=new gi("float r5 0.305",!0),y=new gi("float v5 0.016",!0),_=new gi("float m5 3.0",!0),b=new gi("float r6 0.21",!0),w=new gi("float v6 0.0038",!0),C=new gi("float m6 4.0",!0);return{bilinearCubeUV:a,roughnessToMip:new Te("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,c,h,u,d,p,f,m,g,v,y,_,b,w,C]),m0:h,cubeUV_maxMipLevel:t}}();var uf=class extends mi{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??uf.VIEW}getShared(){return this.scope===uf.WORLD}build(e,t,i,n){let r=e.context[this.scope+"Normal"];return r?r.build(e,t,i,n):super.build(e,t,i)}generate(e,t,i,n,r){let s;switch(this.scope){case uf.VIEW:s=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case uf.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case uf.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal")}return e.format(s,this.getType(e),t)}},ws=uf;ws.LOCAL="local",ws.WORLD="world",ws.VIEW="view",ws.NORMAL="normal",vs.addKeyword("viewNormal",function(){return new ws(ws.VIEW)}),vs.addKeyword("localNormal",function(){return new ws(ws.NORMAL)}),vs.addKeyword("worldNormal",function(){return new ws(ws.WORLD)});var Bl=class extends mi{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Bl.LOCAL}getType(){return this.scope===Bl.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case Bl.LOCAL:case Bl.WORLD:return!1}return!0}generate(e,t,i,n,r){let s;switch(this.scope){case Bl.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case Bl.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case Bl.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Bl.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(s,this.getType(),t)}},qo=Bl;qo.LOCAL="local",qo.WORLD="world",qo.VIEW="view",qo.PROJECTION="projection",vs.addKeyword("position",function(){return new qo}),vs.addKeyword("worldPosition",function(){return new qo(qo.WORLD)}),vs.addKeyword("viewPosition",function(){return new qo(qo.VIEW)});var Ba=class extends mi{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Ba.CUBE}getUnique(e){return!e.context.viewNormal}getType(){return this.scope===Ba.SPHERE?"v2":this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let n;switch(this.scope){case Ba.VECTOR:{let r=new ws(ws.VIEW),s=e.context.roughness,o=r.build(e,"v3"),a=new qo(qo.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${a} ), ${o} )`;l&&(c=`normalize( mix( ${c}, ${o}, ${l} * ${l} ) )`);let h=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${h};`),n="reflectVec"):n=h;break}case Ba.CUBE:{let r=new Ba(Ba.VECTOR).build(e,"v3"),s="vec3( -"+r+".x, "+r+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),n="reflectCubeVec"):n=s;break}case Ba.SPHERE:{let r="normalize( ( viewMatrix * vec4( "+new Ba(Ba.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${r};`),n="reflectSphereVec"):n=r;break}}return e.format(n,this.getType(),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},hf=Ba;hf.CUBE="cube",hf.SPHERE="sphere",hf.VECTOR="vector";var pDe=class extends mi{constructor(e=new Fl,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new VT(this.value,t??new hf(hf.VECTOR),i),this.irradianceNode=new VT(this.value,new ws(ws.WORLD),new Ve(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},fDe=class extends ys{constructor(e=new GM,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new hf,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){if("samplerCube"===t)return this.getTexture(e,t);let s,i=this.getTexture(e,t),n=this.uv?.build(e,"v3"),r=this.bias?this.bias.build(e,"f"):void 0;void 0===r&&e.context.bias&&(r=e.context.bias.setTexture(this).build(e,"f")),s=r?"texCubeBias( "+i+", "+n+", "+r+" )":"texCube( "+i+", "+n+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},a=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Fa(new Ni("",a)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,a),e.removeContext(),e.format(s,a,t)}},O6=["x","y","z","w"],_De=["float","vec2","vec3","vec4"],bDe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},wDe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Ki=class extends ys{constructor(e=0,t,i,n){super("c"),this.nodeType="Color",this.value=e instanceof _s?e:new _s(e||0,t,i,n)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,n,r,s){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let o=e.getNodeData(i),a=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return a?this.generateReadonly(e,t,i,n,r,s):e.isShader("vertex")?(o.vertex||(o.vertex=e.createVertexUniform(n,this,r,s,this.getLabel())),e.format(o.vertex.name,n,t)):(o.fragment||(o.fragment=e.createFragmentUniform(n,this,r,s,this.getLabel())),e.format(o.fragment.name,n,t))}generateReadonly(e,t,i,n,r,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,t)}},xi=class extends ys{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,n,r,s){return e.format(this.value.toString(),n,t)}},Qr=class extends ys{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,n){return e.format(this.value?"true":"false",n,t)}},hh=class extends ys{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:"number"==typeof t?new Array(e).fill(t):new Array(e).fill(0)}},zT=class extends ys{},SDe=class extends zT{constructor(e){super("v3"),this.image=e,this._value=new M}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},UT=class extends zT{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},L6=class extends ys{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new an}generateReadonly(e,t,i,n,r,s){return e.format("mat3("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Va=class extends ys{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new ye}generateReadonly(e,t,i,n,r,s){return e.format("mat4("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function N6(e,t,i){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0)}var CDe=class extends L6{constructor(e,t){super(new an),this.repeat=e,this.offset=t,N6(this.value,e,t)}updateMatrix(){N6(this.value,this.repeat,this.offset)}},dh=class extends ys{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof St?new Array(e).fill(t):new Array(e).fill(new St(0))}},k6=class extends mi{constructor(e,t,i,n){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=n}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},F6=class extends mi{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(F6.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.color.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},jT=F6;jT.Nodes={customColor:new Te("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var B6=class extends mi{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(B6.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.cnormal.build(e,"v3")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},V6=B6;V6.Nodes={customNormal:new Te("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var bv=class extends mi{constructor(e,t,i,n,r,s,o,a,l,c,h,u){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=n,this.axis=r,this.side=s,this.size=o,this.blending=a,this.mat=l,this.isMask=u,this.alpha=c,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let n,i=`g${this.uuid.toString().replace(/-/g,"")}`;switch(this.projection.value){case 3:n=e.include(bv.Nodes.cylindrical);break;case 2:n=e.include(bv.Nodes.spherical);break;case 1:let a=new Te(`\n\t\tvec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.${["zy","xz","xy"][this.axis.value]})) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, ${["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value]}));`}\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}`);n=e.include(a);break;case 4:n=e.include(bv.Nodes.triplanar);break;default:n=e.include(bv.Nodes.uv)}e.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(e,"t")),r.push(this.textureSize.build(e,"v2")),r.push(this.crop.build(e,"f")),r.push(this.mat.build(e,"mat3")),r.push(this.size.build(e,"v2")),r.push(this.blending.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),4===this.projection.value){let s=`${i}_writeUvs`,o=s+"0",a=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),r.push(o),r.push(a),r.push(l),r.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),r.push(s)}return e.format(n+"("+r.join(",")+")",this.getType(e),t)}},HT=bv;HT.Nodes={cylindrical:new Te("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new Te("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new Te("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new Te("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var wv=class extends mi{constructor(e,t,i,n,r,s,o,a,l,c,h,u){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=n,this.isVector=r,this.isWorldSpace=s,this.origin=o,this.direction=a,this.colors=l,this.steps=c,this.isMask=u,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,n=new Te(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ${i}_IS_VECTOR\n                   #ifdef ${i}_LINEAR\n                       #ifdef ${i}_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ${i}_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ${i}_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}`,[wv.Nodes.vectorLinearWorldSpaceDepth,wv.Nodes.vectorLinearObjectSpaceDepth,wv.Nodes.vectorSphericalObjectSpaceDepth,wv.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),0===this.gradientType.value&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let r=e.include(n),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),t)}return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},z6=wv;z6.Nodes={vectorLinearWorldSpaceDepth:new Te("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new Te("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new Te("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new Te("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var EDe=class extends mi{constructor(e,t,i,n,r,s,o,a){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=n,this.factor=r,this.isMask=a,this.alpha=s,this.mode=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new Te("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),n=e.include(i),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(n+"("+r.join(",")+")",this.getType(e),t)}return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},U6=class extends mi{constructor(e,t,i,n,r,s,o,a,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=n,this.offset=r,this.morph=s,this.angle=o,this.isMask=l,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(U6.Nodes.gradient),n=[];return n.push(this.gradientType.build(e,"i")),n.push(this.smooth.build(e,"b")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.offset.build(e,"v2")),n.push(this.morph.build(e,"v2")),n.push(this.angle.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},j6=U6;j6.Nodes={gradient:new Te("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var H6=class extends mi{constructor(e,t,i,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=n,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(H6.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let n=[];return n.push(this.texture.generate(e,"t")),n.push("normal"),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},G6=H6;G6.Nodes={matcap:new Te("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var GT=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(GT||{}),xs=function(){let e=new Te("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new Te("float simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new gi("float F3 0.3333333"),t.keywords.G3=new gi("float G3 0.1666667");let i=new Te("float simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}",[t]),n=new Te("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),r=new Te("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),s=new Te("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[n,r]),o=new Te("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),a=new Te("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),l=new Te("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[a]),c=new Te("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[l]);c.keywords.NUM_OCTAVES=new gi("int NUM_OCTAVES 5");let h=new Te("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),u=new Te("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[n,r,h]),d=new Te("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),p=new Te("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),f=new Te("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),m=new Te("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),g=new Te("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),v=new Te("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplex:t,simplexFractal:i,simplexAshima:s,fbm:c,perlin:u,voronoi:new Te('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\tfloat id = hashwithoutsine13(vec3(p + mb) + seed);\n\n\t\t\t// Second pass for edge distance  \n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[d,p,f,m,g,v])}}(),W6=class extends mi{constructor(e,t,i,n,r,s,o,a,l,c,h,u,d,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=n,this.fB=r,this.distortion=s,this.colorA=o,this.colorB=a,this.colorC=l,this.colorD=c,this.noiseType=u,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,n,r){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=Object.values(GT)[this.noiseType.value],a=new Te(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t${"voronoi"==s?`\n\t\tfloat v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t`:`\n\t\tvec3 q = vec3(${s}(st),\n\t\t\t\t\t   ${s}(st + vec3(1.0)),\n\t\t\t\t\t   ${s}(st + vec3(1.0)));\n\t\tvec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ${s}(st * q));\n\t\tfloat f = ${s}(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t`}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}`,[xs.simplex,xs.simplexFractal,xs.simplexAshima,xs.fbm,xs.perlin,xs.voronoi]),l=e.include(a),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};W6.numOctaves=5;var q6=class extends mi{constructor(e,t,i,n,r,s,o,a,l,c,h,u,d,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=n,this.contourThreshold=r,this.outlineThreshold=s,this.contourFrequency=o,this.outlineSmoothing=a,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=u,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let n=this.outlineWidth.build(e,"f"),r=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),o=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(n,"uniform float"),e.addVertexParsVariable(r,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(o,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`\n                vID = randomColor.r;\n                vec2 ${i}_offset = vec2(0.0);\n                if (${s}) {\n                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${r} * (${n} / 2.0) * ${i}_clipPosition.w * 2.0 * ${o};\n                    ${i}_clipPosition.xy += ${i}_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ${i}_clipPosition;\n                }\n            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=e.include(q6.Nodes.outline),r=[];return r.push(this.outlineColor.build(e,"c")),r.push(this.contourColor.build(e,"c")),r.push(this.outlineWidth.build(e,"f")),r.push(this.contourWidth.build(e,"f")),r.push(this.contourThreshold.build(e,"f")),r.push(this.outlineThreshold.build(e,"f")),r.push(this.contourFrequency.build(e,"f")),r.push(this.outlineSmoothing.build(e,"f")),r.push(this.contourDirection.build(e,"v3")),r.push(this.positionalLines.build(e,"b")),r.push(this.resolution.build(e,"v2")),r.push(this.normalMap.getTexture(e,"t")),r.push(this.depthMap.getTexture(e,"t")),r.push(this.pixelRatio.build(e,"f")),r.push(this.compensation.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),this.firstTime=!this.firstTime,e.format(n+"("+r.join(",")+")",this.getType(e),t)}return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},Y6=q6;Y6.Nodes=function(){let e=new Te("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new Te("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[e])}}();var Vl=class extends mi{constructor(e,t,i,n,r,s,o,a,l,c,h,u,d,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=n,this.offset=r,this.colorA=s,this.colorB=o,this.frequency=a,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=u,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i;switch(e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave"}let n=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Te("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),s=new Te("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),o="";if(4===this.projection.value)o=`\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ${2===this.style.value?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d1 = ${2===this.style.value?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d2 = ${2===this.style.value?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t`;else{let h=2===this.style.value?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u="";u=0===this.axis.value?"float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?"float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":"float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);";let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:case 3:default:break;case 2:d=`\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t${u}\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t`}o=`\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t${d}\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ${h};\n\t\t\t\t`}let a=new Te(`vec3 ${n}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t${o}\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}`,[s,r,Vl.DrawFunctions.circle,Vl.DrawFunctions.ring,Vl.DrawFunctions.polygon,Vl.DrawFunctions.cross,Vl.DrawFunctions.diamond,Vl.DrawFunctions.checkerboard,Vl.DrawFunctions.line,Vl.DrawFunctions.wave]),l=e.include(a),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},X6=Vl;X6.DrawFunctions=function(){let e=new Te("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),t=new Te("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[e]);return{tileAndCenter:t,circle:new Te("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[t]),ring:new Te("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[t]),polygon:new Te("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[t]),cross:new Te("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[t]),diamond:new Te("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[t]),checkerboard:new Te("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new Te("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[t]),wave:new Te("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var Z6=class extends mi{constructor(e,t,i,n,r,s,o,a){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=n,this.noiseScale=r,this.offset=s,this.isMask=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Z6.Nodes.rainbow),n=[];return n.push(this.filmThickness.build(e,"f")),n.push(this.movement.build(e,"f")),n.push(this.wavelengths.build(e,"v3")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.offset.build(e,"v3")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Q6=Z6;Q6.Nodes=function(){let e=new Te("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n                 vec3 st = position / noiseScale;\n\t\t\t\t vec3 q = vec3(simplex3d(st),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)));\n\n\t\t\t\t vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st * q));\n\n                 float noise = simplex3d(st + r);\n\n                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);\n             }",[xs.simplex]);return{rainbow:new Te("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n             }",[e])}}();var K6=class extends mi{constructor(e,t,i,n,r,s,o,a,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=n,this.isWorldSpace=r,this.noiseStrength=s,this.noiseScale=o,this.shadowColor=a,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(K6.Nodes.toon),n=[];return n.push(this.positioning.build(e,"i")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.source.build(e,"v3")),n.push(this.isWorldSpace.build(e,"b")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.shadowColor.build(e,"v4")),n.push(this.offset.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},$6=K6;$6.Nodes=function(){let e=new Te("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),t=new Te("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),i=new Te("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[t]),n=new Te("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),r=new Te('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[n]);return{toon:new Te('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplex3d(st),\n\t\t\t\t\t// \tsimplex3d(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplex3d(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[xs.simplex,e,i,r])}}();var MDe={textureBicubic:new Te("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")},J6=class extends mi{constructor(e,t,i,n,r,s,o,a){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=n,this.transmissionSamplerMap=r,this.transmissionDepthMap=s,this.aspectRatio=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,it.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(J6.Nodes.transmission),n=[];return n.push(this.thickness.build(e,"f")),n.push(this.ior.build(e,"f")),n.push(this.roughness.build(e,"f")),n.push(this.transmissionSamplerSize.build(e,"v2")),n.push(this.transmissionSamplerMap.getTexture(e,"t")),n.push(this.transmissionDepthMap.getTexture(e,"t")),n.push(this.aspectRatio.build(e,"v2")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},eW=J6;eW.Nodes=function(){let e=new Te("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),t=new Te("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),i=new Te("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),n=new Te('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[MDe.textureBicubic,i,e]),r=new Te("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[n,t]);return{transmission:new Te("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[r])}}();var WT=(e=>(e.NOISE="noise",e.MAP="map",e))(WT||{}),tW=class extends mi{constructor(e,t,i,n,r,s,o,a,l,c,h){super("v3"),this.displacementTypeIndex=new xi(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,"map"===Object.values(WT)[this.displacementTypeIndex.value]&&(this.mat=new L6(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=n,this.smoothness=r,this.seed=s,this.highCut=o,this.lowCut=a,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,n=[];switch(n.push("displaced_position"),n.push("displaced_normal"),Object.values(WT)[this.displacementTypeIndex.value]){case"map":i=e.include(tW.Nodes.map),n.push(this.movementOrTexture.getTexture(e,"t")),n.push("uv"),n.push(this.cropOrOffset.build(e,"f")),this.mat&&n.push(this.mat.build(e,"mat3"));break;case"noise":{let r=Object.values(GT)[this.noiseFunctionIndex.value],s=new Te("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),a=new Te(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t${"voronoi"==r?`\n\t\t\t\t\tfloat v = ${r}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t`:`\n\t\t\t\t\treturn p + n * ${r}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t`}\n\t\t\t\t\t\t}`,[xs.simplex,xs.simplexFractal,xs.simplexAshima,xs.fbm,xs.perlin,xs.voronoi]),l=new Te("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[a,s]);i=e.include(l),n.push(this.scale.build(e,"f")),n.push(this.cropOrOffset.build(e,"v3")),n.push(this.movementOrTexture.build(e,"f")),n.push(this.voronoiStyle.build(e,"i")),n.push(this.smoothness.build(e,"f")),n.push(this.seed.build(e,"f")),n.push(this.highCut.build(e,"f")),n.push(this.lowCut.build(e,"f")),n.push(this.quality.build(e,"i"));break}}return n.push(this.intensity.build(e,"f")),n.push("displaced_normal"),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},iW=tW;iW.Nodes=function(){let e=new Te("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new Te("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new Te("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var it={normalRenderTarget:new Fl,normalRenderTargetDepth:new Fl,transmissionRenderTarget:new Fl,aspectRatio:new or,transmissionSize:new or(2048,2048),transmissionRenderTargetDepth:new Fl,aoRenderTarget:new Fl,aoEnabled:new Qr,pixelRatioNode:new Ve(1),resolution:new or,penumbraSize:new hh(5,.5),frameIndex:new xi(0),transmissionLod:new xi(2)};for(let e of Object.values(it))e.isRenderGlobal=!0;var qT,nW=class extends Gc{constructor(){super("basic"),this.nodeType="Basic",this.color=new Ki(ho),this.shadingAlpha=new Ve(1),this.shadingBlend=new xi(0),this.previousModelViewMatrix=new Va,this.previouseProjectionMatrix=new Va}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({resolution:it.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rp.merge([Ae.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{void 0===this.color&&(this.color=new Ki(ho)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(e,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==n,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let o=["#include <normal_fragment_begin>",i.code];n&&o.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),s?o.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):o.push(`vec3 finalColor = ${i.result};`);let a="1.0";this.mask&&(this.mask.analyze(e),a=`luminance(${this.mask.flow(e,"v3").result})`),o.push(n?`gl_FragColor = vec4( finalColor, accumAlpha * ${n.result} * ${a} );`:"gl_FragColor = vec4("+i.result+", 1.0 );"),r&&o.push(`gl_FragColor.a *= ${r.result};`),o.push("#include <fog_fragment>","#include <dithering_fragment>"),t=o.join("\n")}return t}},DDe=class extends Gc{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Ki(ho),this.emissive=new Ki(0),this.emissiveIntensity=new Ve(1),this.previousModelViewMatrix=new Va,this.previouseProjectionMatrix=new Va,this.shadingAlpha=new Ve(1),this.shadingBlend=new xi(0),this.occlusion=new Qr(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({resolution:it.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rp.merge([Ae.fog,Ae.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),n.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:it.penumbraSize}),e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({aoMap:it.aoRenderTarget}),e.mergeUniform({aoEnabled:it.aoEnabled}),void 0===this.color&&(this.color=new Ki(ho)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.emissive.flow(e,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),o=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];u.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),n&&u.push(n.code,"reflectedLight.directDiffuse += "+n.result+" * "+r.result+";"),u.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${d}, ${a.result} );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u.push(c?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join("\n")}return t}},df={dHdxy:new Te("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),perturbNormalArb:new Te("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }")},TDe=class extends Gc{constructor(){super("phong"),this.nodeType="Phong",this.color=new Ki(ho),this.specular=new Ki(1118481),this.shininess=new Ve(30),this.previousModelViewMatrix=new Va,this.previouseProjectionMatrix=new Va,this.shadingAlpha=new Ve(1),this.shadingBlend=new xi(0),this.occlusion=new Qr(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({resolution:it.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rp.merge([Ae.fog,Ae.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:it.penumbraSize}),e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({aoMap:it.aoRenderTarget}),e.mergeUniform({aoEnabled:it.aoEnabled}),void 0===this.color&&(this.color=new Ki(ho)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){e.include(df.dHdxy),e.include(df.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";g=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${p.result}, uv0, ${m});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${p.result}, uv1, ${m});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${p.result}, uv2, ${m});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${m});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${f.result};\n\t\t\t\t\t${g}\n\t\t\t\t\t`)}u.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",r.code,"\tvec3 specular = "+r.result+";",s.code,"\tfloat shininess = max( 0.0001, "+s.result+" );","\tfloat specularStrength = 1.0;"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${d}, ${a.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u.push(c?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join("\n")}return t}},IDe=class extends Gc{constructor(){super("standard"),this.nodeType="Standard",this.color=new Ki(ho),this.roughness=new Ve(.3),this.metalness=new Ve(0),this.reflectivity=new Ve(.5),this.previousModelViewMatrix=new Va,this.previouseProjectionMatrix=new Va,this.shadingAlpha=new Ve(1),this.shadingBlend=new xi(0),this.occlusion=new Qr(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({resolution:it.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rp.merge([Ae.fog,Ae.lights])),Ae.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:it.penumbraSize}),e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({aoMap:it.aoRenderTarget}),e.mergeUniform({aoEnabled:it.aoEnabled});let i={gamma:!0};void 0===this.color&&(this.color=new Ki(ho)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let n=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),o=this.metalness.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==h,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let p=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(df.dHdxy),e.include(df.perturbNormalArb);let m=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";y=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${m.result}, uv0, ${v});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${m.result}, uv1, ${v});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${m.result}, uv2, ${v});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${v});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${g.result};\n\t\t\t\t\t${y}\n\t\t\t\t\t`)}if(p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",o.code,"\tfloat metalnessFactor = "+o.result+";"),this.roughnessMap){let m=this.roughnessMap.texture.flow(e,"t"),g=this.roughnessMap.flow(e,"v3"),v="";v=4===this.roughnessMap.projection.value?`\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(${m.result}, uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(${m.result}, uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(${m.result}, uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ${s.result};\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(${m.result},  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ${s.result};\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${g.result};\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t${v}\n\t\t\t\t`)}else p.push(s.code,"\tfloat roughnessFactor = "+s.result+";");h&&p.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${f} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${f}, ${l.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),p.push(h?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&p.push(`gl_FragColor.a *= ${u.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join("\n")}return t}},PDe=class extends Gc{constructor(){super("toon"),this.nodeType="Toon",this.color=new Ki(ho),this.specular=new Ki(1118481),this.shininess=new Ve(30),this.previousModelViewMatrix=new Va,this.previouseProjectionMatrix=new Va,this.shadingAlpha=new Ve(1),this.shadingBlend=new xi(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({resolution:it.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(rp.merge([Ae.fog,Ae.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:it.penumbraSize}),e.mergeUniform({frameIndex:it.frameIndex}),e.mergeUniform({aoMap:it.aoRenderTarget}),e.mergeUniform({aoEnabled:it.aoEnabled}),void 0===this.color&&(this.color=new Ki(ho)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),r=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),a=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){e.include(df.dHdxy),e.include(df.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),f=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",m="";m=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${d.result}, uv0, ${f});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${d.result}, uv1, ${f});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${d.result}, uv2, ${f});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${f});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${p.result};\n\t\t\t\t\t${m}\n\t\t\t\t\t`)}h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"\tvec3 specular = "+n.result+";",r.code,"\tfloat shininess = max( 0.0001, "+r.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${u} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${u}, ${o.result} );\n\t\t\t\t}\n\t\t\t\t`),a&&h.push(a.code,`outgoingLight = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`),h.push(l?`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`:"gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push(`gl_FragColor.a *= ${c.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},RDe=class{constructor(e=1e4){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){return this.cache.get(e)?.data}load(e){let t=Date.now(),i=this.cache.get(e);return void 0===i?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},ODe=class extends RDe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},NDe=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){}},kDe=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return void 0===t&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},rW=class extends NDe{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isVideo="video"===e.type,this.updateSrc(e.data)}updateSrc(e){var t=this;return(0,sn.Z)(function*(){if(typeof document>"u")return;t.disposeTextures(),t.loaded=!1;let i=()=>{t.loaded=!0;let r=[1e3,1001,1002];for(let s of r){let o=t[s];o&&(o.image=t.img,o.needsUpdate=!0)}t.shared.requestRender()};if(t.isVideo){if(t.img=document.createElement("video"),t.img.preload="auto",t.img.playsInline=!0,t.img.currentTime=.01,"string"!=typeof e){var n=new FileReader;let r;n.readAsDataURL(new Blob([e],{type:"video/mp4"})),yield new Promise(s=>{n.onloadend=o=>{r=o.target?.result,s(null)}}),t.img.src=r}else t.img.src=e;t.img.onloadeddata=()=>{i()}}else t.img=new Image,t.img.src=function LDe(e){return"string"==typeof e?e:(qT||(qT=new ODe),qT.load(e))}(e),t.img.onload=i})()}getTexture(e){let t=this[e];if(t)return t;{let i;return i=this.isVideo?new Rge(this.img,void 0,e,e):new kn(this.img,void 0,e,e),this.loaded&&(i.needsUpdate=!0),this[e]=i,i}}disposeTextures(){this[1e3]?.dispose(),this[1e3]=void 0,this[1001]?.dispose(),this[1001]=void 0,this[1002]?.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},ph=class extends rW{};var BDe={year:0,month:1,day:2,hour:3,minute:4,second:5},YT={};function sW(e,t,i,n,r,s,o){var a=new Date(0);return a.setUTCFullYear(e,t,i),a.setUTCHours(n,r,s,o),a}var oW=36e5,jDe=6e4,XT={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function aW(e,t,i){var n,r,s;if(!e||(n=XT.timezoneZ.exec(e)))return 0;if(n=XT.timezoneHH.exec(e))return lW(s=parseInt(n[1],10))?-s*oW:NaN;if(n=XT.timezoneHHMM.exec(e)){s=parseInt(n[1],10);var o=parseInt(n[2],10);return lW(s,o)?(r=Math.abs(s)*oW+o*jDe,s>0?-r:r):NaN}if(function WDe(e){if(cW[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),cW[e]=!0,!0}catch{return!1}}(e)){t=new Date(t||Date.now());var a=i?t:function HDe(e){return sW(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}(t),l=ZT(a,e),c=i?l:function GDe(e,t,i){var r=e.getTime()-t,s=ZT(new Date(r),i);if(t===s)return t;r-=s-t;var o=ZT(new Date(r),i);return s===o?s:Math.max(s,o)}(t,l,e);return-c}return NaN}function ZT(e,t){var i=function FDe(e,t){var i=function UDe(e){if(!YT[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z"));YT[e]="06/25/2014, 00:00:00"===t||"\u200e06\u200e/\u200e25\u200e/\u200e2014\u200e \u200e00\u200e:\u200e00\u200e:\u200e00"===t?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return YT[e]}(t);return i.formatToParts?function VDe(e,t){try{for(var i=e.formatToParts(t),n=[],r=0;r<i.length;r++){var s=BDe[i[r].type];s>=0&&(n[s]=parseInt(i[r].value,10))}return n}catch(o){if(o instanceof RangeError)return[NaN];throw o}}(i,e):function zDe(e,t){var i=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[n[3],n[1],n[2],n[4],n[5],n[6]]}(i,e)}(e,t),n=sW(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),r=e.getTime(),s=r%1e3;return n-(r-(s>=0?s:1e3+s))}function lW(e,t){return-23<=e&&e<=23&&(null==t||0<=t&&t<=59)}var cW={},qDe=Wn(mue(),1),uW=Wn(gue(),1),QT=36e5,hW=6e4,ZDe=2,Kr={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function dW(e,t,i){t=t||0,i=i||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var s=7*t+i+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+s),n}var tTe=[31,28,31,30,31,30,31,31,30,31,30,31],iTe=[31,29,31,30,31,30,31,31,30,31,30,31];function pW(e){return e%400==0||e%4==0&&e%100!=0}function fW(e,t,i){if(t<0||t>11)return!1;if(null!=i){if(i<1)return!1;var n=pW(e);if(n&&i>iTe[t]||!n&&i>tTe[t])return!1}return!0}function mW(e,t,i){return!(t<0||t>52||null!=i&&(i<0||i>6))}function KT(e,t,i){return!(null!=e&&(e<0||e>=25)||null!=t&&(t<0||t>=60)||null!=i&&(i<0||i>=60))}function $r(e,t){return t.color(e)}function gW(e=new Date,t){let i=t.format,n=e.getSeconds(),r=e;t&&null!==t.timeZone&&(r=function rTe(e,t,i){var n=function QDe(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===e)return new Date(NaN);var i=t||{},n=null==i.additionalDigits?ZDe:(0,qDe.default)(i.additionalDigits);if(2!==n&&1!==n&&0!==n)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e))return new Date(e.getTime());if("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))return new Date(e);if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var r=function KDe(e){var n,t={},i=Kr.dateTimePattern.exec(e);if(i?(t.date=i[1],n=i[3]):(i=Kr.datePattern.exec(e))?(t.date=i[1],n=i[2]):(t.date=null,n=e),n){var r=Kr.timeZone.exec(n);r?(t.time=n.replace(r[1],""),t.timeZone=r[1].trim()):t.time=n}return t}(e),s=function $De(e,t){var r,i=Kr.YYY[t],n=Kr.YYYYY[t];if(r=Kr.YYYY.exec(e)||n.exec(e)){var s=r[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(r=Kr.YY.exec(e)||i.exec(e)){var o=r[1];return{year:100*parseInt(o,10),restDateString:e.slice(o.length)}}return{year:null}}(r.date,n),l=function JDe(e,t){if(null===t)return null;var i,n,r,s;if(0===e.length)return(n=new Date(0)).setUTCFullYear(t),n;if(i=Kr.MM.exec(e))return n=new Date(0),fW(t,r=parseInt(i[1],10)-1)?(n.setUTCFullYear(t,r),n):new Date(NaN);if(i=Kr.DDD.exec(e)){n=new Date(0);var o=parseInt(i[1],10);return function nTe(e,t){if(t<1)return!1;var i=pW(e);return!(i&&t>366||!i&&t>365)}(t,o)?(n.setUTCFullYear(t,0,o),n):new Date(NaN)}if(i=Kr.MMDD.exec(e)){n=new Date(0),r=parseInt(i[1],10)-1;var a=parseInt(i[2],10);return fW(t,r,a)?(n.setUTCFullYear(t,r,a),n):new Date(NaN)}if(i=Kr.Www.exec(e))return mW(0,s=parseInt(i[1],10)-1)?dW(t,s):new Date(NaN);if(i=Kr.WwwD.exec(e)){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return mW(0,s,l)?dW(t,s,l):new Date(NaN)}return null}(s.restDateString,s.year);if(isNaN(l))return new Date(NaN);if(l){var u,c=l.getTime(),h=0;if(r.time&&(h=function eTe(e){var t,i,n;if(t=Kr.HH.exec(e))return KT(i=parseFloat(t[1].replace(",",".")))?i%24*QT:NaN;if(t=Kr.HHMM.exec(e))return KT(i=parseInt(t[1],10),n=parseFloat(t[2].replace(",",".")))?i%24*QT+n*hW:NaN;if(t=Kr.HHMMSS.exec(e)){i=parseInt(t[1],10),n=parseInt(t[2],10);var r=parseFloat(t[3].replace(",","."));return KT(i,n,r)?i%24*QT+n*hW+1e3*r:NaN}return null}(r.time),isNaN(h)))return new Date(NaN);if(r.timeZone||i.timeZone){if(u=aW(r.timeZone||i.timeZone,new Date(c+h)),isNaN(u))return new Date(NaN)}else u=(0,uW.default)(new Date(c+h)),u=(0,uW.default)(new Date(c+h+u));return new Date(c+h+u)}return new Date(NaN)}(e,i),r=aW(t,n,!0),s=new Date(n.getTime()-r),o=new Date(0);return o.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),o.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),o}(new Date,t.timeZone));let a,s=r.getHours(),o=r.getMinutes();"12ampm"===t.format12h24h&&(a=s>=12?"PM":"AM");let c,h,l=s;switch("24"!==t.format12h24h&&(l=s%12,0===l&&(l=12)),i){case"HH:mm:ss":c=[l,o,n];break;case"HH:mm":c=[l,o];break;case"HH":c=[l],a=void 0;break;case"mm":c=[o],a=void 0;break;case"ss":c=[n],a=void 0;break;case"year":h=r.getFullYear();break;case"month":h=r.getMonth()+1;break;case"dayOfYear":h=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":h=r.getDate();break;case"secondOfDay":h=60*s*60+60*o+n;break;default:console.error("Unknown time format",i),h=0}return void 0!==c?{textValue:c,suffix:a}:h}function oTe(e){return{type:e.type}}function Yo(e,t){let{alpha:i,mode:n,isMask:r}=e,s="string"==typeof i?(Number(t.getVariable(i))??100)/100:i;return{...oTe(e),alpha:s,mode:n,isMask:r}}var kw=class extends _s{},vW={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},yW={depth:["colors"]};function yTe(e,t,i){if("isMask"===t)return!0;let n=vW[e.type],r=yW[e.type];if(void 0!==r){let s=e.color;if(r.includes(t)){let o=s[t]?.value?.length;if(void 0!==o&&o!==i.length)return!0}}return void 0!==n&&n.includes(t)}function _W(e,t,i){let n=i.uniforms[`f${i.id}_texture`];if(!n)return!1;let s=e;if("image"in s){let a=t.image(s.image),l=n;l.image instanceof ph||l.image.deref(),l.image=a}if("video"in s){let a=t.video(s.video),l=n;l.image instanceof ph||l.image.deref(),l.image=a}if("wrapping"in s&&(n.wrap=s.wrapping),"repeat"in s||"offset"in s){let a=i.uniforms[`f${i.id}_mat`];"repeat"in s&&(a.repeat=s.repeat),"offset"in s&&(a.offset=s.offset),a.updateMatrix()}return!1}var fh=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable("number"==typeof e?100*e:e,i)??100)/100))??1,mh=class{constructor(e,t,i,n,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in n)this.uniforms[`f${this.id}_${s}`]=n[s];for(let s in i)wW(s,this,i,r)}get type(){return this.data.type}static create(e,t,i,n){if("light"===i.type)return zl.createLigherLayer(e,t,i,n);if("texture"===i.type||"video"===i.type){let r="texture"===i.type?n.image(i.texture.image):n.video(i.texture.video),s=new UT(r,i.texture.wrapping),o=new SDe(r),a=new CDe(i.texture.repeat,i.texture.offset),l=new Ve(i.crop?1:0),c=new xi(i.projection??0),h=new xi(["x","y","z"].indexOf(i.axis)??0),u=new xi(i.side??0),d=new or(i.size?new z(i.size[0],i.size[1]):new z(100,100)),p=new Ve(i.blending??0),f=new Ve(fh(i.alpha,n)),m=new xi(i.mode??0),g=new Qr(i.isMask??!1),v=new HT(s,o,l,c,h,u,d,p,a,f,m,g),y=new Ni(v.calpha,"f");return new $i(e,t,i,{texture:s,textureSize:o,crop:l,projection:c,axis:h,side:u,size:d,blending:p,mat:a,alpha:f,mode:m,isMask:g},v,m,y,g,n)}if("matcap"===i.type){let r=n.image(i.texture.image),s=new UT(r,i.texture.wrapping),o=new Ve(fh(i.alpha,n)),a=new xi(i.mode??0),l=new Qr(i.isMask??!1),c=new G6(s,o,a,l),h=new Ni(c.calpha,"f");return new $i(e,t,i,{texture:s,alpha:o,mode:a,isMask:l},c,a,h,l,n)}if("displace"===i.type){if("noise"===i.displacementType){let r=new po(new M(...i.offset)),s=new Ve(i.scale??10),o=new Ve(i.intensity??8),a=new Ve(i.movement??1),l=new xi(i.noiseType??0),c=new xi(i.voronoiStyle??0),h=new Ve(i.smoothness??.5),u=new Ve(i.seed??0),d=new Ve(i.highCut??1),p=new Ve(i.lowCut??0),f=new xi(i.quality??1),m=new iW(o,a,r,c,h,u,d,p,f,s,l);return new bW(e,t,i,{offset:r,scale:s,intensity:o,movement:a,noiseType:l,voronoiStyle:c,smoothness:h,seed:u,highCut:d,lowCut:p,quality:f},m,n)}throw new Error}return function xTe(e,t,i,n){let r=function sTe(e,t){switch(e.type){case"fresnel":return function lTe(e,t){let{bias:i,scale:n,intensity:r,factor:s,color:o}=e;return{...Yo(e,t),color:$r(o,t),bias:i,scale:n,intensity:r,factor:s}}(e,t);case"gradient":return function cTe(e,t){let{gradientType:i,smooth:n,colors:r,steps:s,angle:o,offset:a,morph:l}=e;return{...Yo(e,t),gradientType:i,smooth:n,colors:r.map(c=>new St(c[0],c[1],c[2],c[3])),num:r.length,steps:s,offset:new z(...a),morph:new z(...l),angle:o}}(e,t);case"depth":return function uTe(e,t){let{gradientType:i,near:n,far:r,isVector:s,isWorldSpace:o,origin:a,direction:l,colors:c,steps:h,smooth:u}=e;return{...Yo(e,t),gradientType:i,near:n,far:r,isVector:s,isWorldSpace:o,origin:new M(...a),direction:l?new M(...l):new M(1,0,0),colors:c.map(d=>void 0!==d?new St(d[0],d[1],d[2],d[3]):new St(0,0,0,0)),steps:h.slice(0,c.length),smooth:u}}(e,t);case"normal":return function hTe(e,t){let{cnormal:i}=e;return{...Yo(e,t),cnormal:new M(i[0],i[1],i[2])}}(e,t);case"noise":return function dTe(e,t){return{...Yo(e,t),scale:e.scale,move:e.move,fA:new z(...e.fA),fB:new z(...e.fB),size:new M(...e.size),distortion:new z(...e.distortion),colorA:$r(e.colorA,t),colorB:$r(e.colorB,t),colorC:$r(e.colorC,t),colorD:$r(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}(e,t);case"rainbow":return function pTe(e,t){return{...Yo(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new M(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new M(...e.offset)}}(e,t);case"toon":return function fTe(e,t){return{...Yo(e,t),positioning:e.positioning,colors:e.colors.map(i=>new St(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new M(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:$r(e.shadowColor,t),offset:new M(...e.offset)}}(e,t);case"outline":return function mTe(e,t){return{...Yo(e,t),outlineColor:$r(e.outlineColor,t),contourColor:$r(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new M(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}(e,t);case"transmission":return function gTe(e,t){return{...Yo(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}(e,t);case"color":return function aTe(e,t){return{...Yo(e,t),color:$r(e.color,t)}}(e,t);case"pattern":return function vTe(e,t){return{...Yo(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new z(...e.offset),colorA:$r(e.colorA,t),colorB:$r(e.colorB,t),frequency:new z(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new z(...e.vertical),horizontal:new z(...e.horizontal),sides:e.sides}}(e,t)}}(i,n);return function wTe(e,t,i,n,r){switch(e.type){case"color":{let s=new Ki(n.color??ho),o=fo(n),a=new jT(s,o.alpha),l=new Ni(a.calpha,"f");return new $i(t,i,e,{color:s,...o},a,o.mode,l,o.isMask,r)}case"fresnel":{let s=new Ki(n.color??16777215),o=new Ve(n.bias??.1),a=new Ve(n.scale??1),l=new Ve(n.intensity??2),c=new Ve(n.factor??1),h=fo(n),u=new EDe(s,o,a,l,c,h.alpha,h.mode,h.isMask),d=new Ni(u.calpha,"f");return new $i(t,i,e,{color:s,bias:o,scale:a,intensity:l,factor:c,...h},u,h.mode,d,h.isMask,r)}case"rainbow":{let s=new Ve(n.filmThickness??30),o=new Ve(n.movement??0),a=new po(n.wavelengths??new M(0,0,0)),l=new Ve(n.noiseStrength??0),c=new Ve(n.noiseScale??1),h=new po(n.offset??new M(0,0,0)),u=fo(n),d=new Q6(s,o,a,l,c,h,u.alpha,u.isMask),p=new Ni(d.calpha,"f");return new $i(t,i,e,{filmThickness:s,movement:o,wavelengths:a,noiseStrength:l,noiseScale:c,offset:h,...u},d,u.mode,p,u.isMask,r)}case"transmission":{let s=new Ve(n.thickness??10),o=new Ve(n.ior??1.5),a=new Ve(n.roughness??.5),l=it.transmissionSize,c=it.transmissionRenderTarget,h=it.transmissionRenderTargetDepth,u=window.innerWidth,d=window.innerHeight,p=u>=d?new or(d/u,1):new or(1,u/d),f=fo(n),m=new eW(s,o,a,l,c,h,p,f.alpha),g=new Ni(m.calpha,"f");return new $i(t,i,e,{thickness:s,ior:o,roughness:a,aspectRatio:p,...f},m,f.mode,g,f.isMask,r)}case"toon":{let o,a,s=new xi(n.positioning??0);n.colors?o=new dh(n.colors.length,n.colors):(o=new dh(10,new St(0,0,0,1)),o.value[1]=new St(1,1,1,1)),n.steps?a=new hh(n.steps.length,n.steps):(a=new hh(10,1),a.value[0]=0);let l=new po(n.source??new M(0,0,0)),c=new Qr(n.isWorldSpace??!0),h=new Ve(n.noiseStrength??0),u=new Ve(n.noiseScale??1),d=new kl(n.shadowColor),p=new po(n.offset??new M(0,0,0)),f=fo(n),m=new $6(s,o,a,l,c,h,u,d,p,f.alpha),g=new Ni(m.calpha,"f");return new $i(t,i,e,{positioning:s,colors:o,steps:a,source:l,isWorldSpace:c,noiseStrength:h,noiseScale:u,shadowColor:d,offset:p,...f},m,f.mode,g,f.isMask,r)}case"outline":{let s=new Ki(n.outlineColor??16777215),o=new Ki(n.contourColor??16777215),a=new Ve(n.outlineWidth??.1),l=new Ve(n.contourWidth??.1),c=new Ve(n.outlineThreshold??.1),h=new Ve(n.contourThreshold??.1),u=new Ve(n.outlineSmoothing??.1),d=new Ve(n.contourFrequency??.1),p=new po(n.contourDirection??new M(0,1,0)),f=new Qr(n.positionalLines??!1),m=new Qr(n.compensation??!0),g=it.normalRenderTarget,v=it.normalRenderTargetDepth,y=it.pixelRatioNode,_=it.resolution,b=fo(n),w=new Y6(s,o,a,l,c,h,u,d,p,f,m,_,g,v,y,b.alpha),C=new Ni(w.calpha,"f");return new $i(t,i,e,{outlineColor:s,contourColor:o,outlineWidth:a,contourWidth:l,outlineThreshold:c,contourThreshold:h,outlineSmoothing:u,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:m,...b},w,b.mode,C,b.isMask,r)}case"depth":{let p,f,s=new xi(n.gradientType??0),o=new Qr(n.smooth??!1),a=new Ve(n.near??50),l=new Ve(n.far??200),c=new Ve(n.isVector??1),h=new Ve(n.isWorldSpace??0),u=new po(n.origin??new M),d=new po(n.direction??new M);n.colors?p=new dh(n.colors.length,n.colors):(p=new dh(2,new St(0,0,0,1)),p.value[1]=new St(1,1,1,1)),n.steps?f=new hh(n.steps.length,n.steps):(f=new hh(2,1),f.value[0]=0);let m=fo(n),g=new z6(s,o,a,l,c,h,u,d,p,f,m.alpha,m.isMask),v=new Ni(g.calpha,"f");return new $i(t,i,e,{gradientType:s,smooth:o,near:a,far:l,isVector:c,isWorldSpace:h,origin:u,direction:d,colors:p,steps:f,...m},g,m.mode,v,m.isMask,r)}case"noise":{let s=new Ve(n.scale??1),o=new po(n.size??new M(100,100,100)),a=new Ve(n.move??1),l=new or(n.fA??new z(1.7,9.2)),c=new or(n.fB??new z(8.3,2.8)),h=new or(n.distortion??new z(1,1)),u=new kl(n.colorA),d=new kl(n.colorB),p=new kl(n.colorC),f=new kl(n.colorD),m=new xi(n.noiseType??0),g=new xi(n.voronoiStyle??0),v=new Ve(n.highCut??1),y=new Ve(n.lowCut??0),_=new Ve(n.smoothness??.5),b=new Ve(n.seed??.5),w=new xi(n.quality??1),C=fo(n),x=new W6(s,o,a,l,c,h,u,d,p,f,C.alpha,m,C.isMask,g,v,y,_,b,w),S=new Ni(x.calpha,"f");return new $i(t,i,e,{scale:s,size:o,move:a,fA:l,fB:c,distortion:h,colorA:u,colorB:d,colorC:p,colorD:f,noiseType:m,...C,voronoiStyle:g,highCut:v,lowCut:y,smoothness:_,seed:b,quality:w},x,C.mode,S,C.isMask,r)}case"normal":{let s=new po(n.cnormal??new M(1,1,1)),o=fo(n),a=new V6(s,o.alpha),l=new Ni(a.calpha,"f");return new $i(t,i,e,{cnormal:s,...o},a,o.mode,l,o.isMask,r)}case"gradient":{let a,l,s=new xi(n.gradientType??0),o=new Qr(n.smooth??!1);n.colors?a=new dh(n.colors.length,n.colors):(a=new dh(10,new St(0,0,0,1)),a.value[1]=new St(1,1,1,1)),n.steps?l=new hh(n.steps.length,n.steps):(l=new hh(10,1),l.value[0]=0);let c=new or(n.offset??new z(0,0)),h=new or(n.morph??new z(0,0)),u=new Ve(n.angle??0),d=fo(n),p=new j6(s,o,a,l,c,h,u,d.alpha,d.isMask),f=new Ni(p.calpha,"f");return new $i(t,i,e,{gradientType:s,smooth:o,colors:a,steps:l,offset:c,morph:h,angle:u,...d},p,d.mode,f,d.isMask,r)}case"pattern":{let s=new xi(n.style??0),o=new xi(n.projection??0),a=new xi(["x","y","z"].indexOf(n.axis)??0),l=new Ve(n.blending??0),c=new or(n.offset??new z(0,0)),h=new kl(n.colorA),u=new kl(n.colorB),d=new or(n.frequency??new z(10,10)),p=new Ve(n.size??.5),f=new Ve(n.variation??0),m=new Ve(n.smoothness??.5),g=new Ve(n.zigzag??0),v=new Ve(n.rotation??0),y=new or(n.vertical??new z(0,1)),_=new or(n.horizontal??new z(0,1)),b=new xi(n.sides??6),w=fo(n),C=new X6(s,o,a,l,c,h,u,d,p,f,m,g,v,y,_,b,w.alpha,w.isMask),x=new Ni(C.calpha,"f");return new $i(t,i,e,{style:s,projection:o,axis:a,blending:l,offset:c,colorA:h,colorB:u,frequency:d,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:_,sides:b,...w},C,w.mode,x,w.isMask,r)}default:{let s=new Ki(1,0,0,1),o=fo(n),a=new jT(s,o.alpha),l=new Ni(a.calpha,"f");return new $i(t,i,e,{color:s,...o},a,o.mode,l,o.isMask,r)}}}(i,e,t,r,n)}(e,t,i,n)}updateByOp(e,t,i){let n=e;if(void 0===n.path[0]){if(0===n.type)return"type"in n.props||"category"in n.props||"visible"in n.props?(i.scene.markNeedsUpdateRendererDirty(),!0):function _Te(e,t,i,n){let r=!1;for(let[s,o]of Object.entries(e)){if("bumpMap"===s||"roughnessMap"===s){r=!0;continue}if(!s||void 0===o)continue;if(wW(s,i,n,t)){"visible"===s&&"light"===i.type&&(r=!0);continue}i.visible=n.visible;let a=i.uniforms[`f${i.id}_${s}`];if(a&&!(a instanceof zT))switch(r=r||yTe(i,s,o),a.constructor){case Ki:if("string"==typeof o){let l=t.getColor(o);l&&(a.value=l);break}{let l=o;a.value instanceof kw?a.value=new _s(l.r,l.g,l.b,l.a):a.setRGBA(l);break}case kl:if("string"==typeof o){let l=t.getColor(o);l&&(a.value=l);break}{let l=o;a.value instanceof kw?a.value=new _s(l.r,l.g,l.b,l.a):a.value.setRGBA(l.r,l.g,l.b,l.a);break}case or:{let l=o;a.value.setX(l[0]),a.value.setY(l[1]);break}case po:{let l=o;a.value.setX(l[0]),a.value.setY(l[1]),a.value.setZ(l[2]);break}case Fl:_W(o,t,i);break;case dh:a.value=o.map(l=>new St(...l));break;default:a.value=o}}return r}(n.props,i.shared,this,t)}else if("texture"===n.path[0])return!("texture"in t)&&!("video"in t)||_W(n.props,i.shared,this);return!1}dispose(){if(function bTe(e){let t=e instanceof mh?e.type:e;return"texture"===t||"video"===t||"displace_map"===t||"matcap"===t}(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;e.image instanceof ph||e.image.deref()}}hasValueByKey(e){return void 0!==this.uniforms[e]}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&void 0!==t&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},$i=class extends mh{constructor(e,t,i,n,r,s,o,a,l){super(e,t,i,n,l),this.params=n,this.color=r,this.mode=s,this.alpha=o,this.isMask=a}},bW=class extends mh{constructor(e,t,i,n,r,s){super(e,t,i,n,s),this.position=r}},zl=class extends mh{constructor(e,t,i,n,r,s){super(e,t,i,r,s),this.node=n}static createLigherLayer(e,t,i,n){let r,c,s=new Ve(fh(i.alpha,n)),o=new xi(i.mode),a=new Ve(i.bumpMapIntensity),l=new Ve(fh(i.alphaOverride,n));if(i.visible)if("lambert"===i.category){r=new DDe;let h=new Ki(n.color(i.emissive)??0),u=new Qr(i.occlusion??!0);c={emissive:h,occlusion:u},r.emissive=h,r.occlusion=u}else if("toon"===i.category){r=new PDe;let h=new Ve(i.shininess??30),u=new Ki(n.color(i.specular)??1118481);c={shininess:h,specular:u},r.shininess=h,r.specular=u}else if("physical"===i.category){r=new IDe;let h=new Ve(i.roughness??.3),u=new Ve(i.metalness??0),d=new Ve(i.reflectivity??.5),p=new Qr(i.occlusion??!0);c={roughness:h,metalness:u,reflectivity:d,occlusion:p},r.roughness=h,r.metalness=u,r.reflectivity=d,r.occlusion=p}else{r=new TDe;let h=new Ve(i.shininess??30),u=new Ki(void 0!==i.specular?n.color(i.specular)??1118481:1118481),d=new Qr(i.occlusion??!0);c={shininess:h,specular:u,occlusion:d},r.shininess=h,r.specular=u,r.occlusion=d}else r=new nW,c={};return r.alpha=new Ve(1),r.shadingAlpha=s,r.shadingBlend=o,r.bumpMapIntensity=a,r.alphaOverride=l,c.alpha=r.shadingAlpha,c.mode=r.shadingBlend,c.bumpMapIntensity=r.bumpMapIntensity,c.alphaOverride=r.alphaOverride,new zl(e,t,i,r,c,n)}get category(){return this.node.category}};function fo(e){return{alpha:new Ve(e.alpha??1),mode:new xi(e.mode??0),isMask:new Qr(e.isMask??!1)}}function wW(e,t,i,n){if("displace"===i.type&&("intensity"===e||"visible"===e)){let r=t.uniforms[`f${t.id}_intensity`];return r?(r.value=i.intensity*(i.visible?1:0),r):void 0}if("displace"!==i.type&&("alpha"===e||"visible"===e)){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=fh(i.alpha,n)*(i.visible?1:0),"outline"===i.type&&"visible"===e){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return r}}function pf(e,t){let i=0,n=e.layers.find(r=>"light"===r.data.type);if(n){let r=n.data,s=Number(t.getVariable(r.alphaOverride));if(("string"==typeof r.alphaOverride?s/100:r.alphaOverride)<1)return!0}for(let r of e.layers){if("displace"!==r.data.type&&r.data.isMask)return!0;if("displace"!==r.data.type&&"alpha"in r.data&&"light"!==r.data.type&&"fresnel"!==r.data.type&&"texture"!==r.data.type&&"matcap"!==r.data.type&&"rainbow"!==r.data.type&&"outline"!==r.data.type&&"pattern"!==r.data.type){let s=r.data.visible?r.data.alpha:0;if("string"==typeof s&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),1===s&&"depth"===r.data.type||"gradient"===r.data.type){for(let o of r.data.colors)if(o[3]<1){s=o[3];break}}else if(1===s&&"noise"===r.data.type){let o=t.color(r.data.colorA).a,a=t.color(r.data.colorB).a,l=t.color(r.data.colorC).a,c=t.color(r.data.colorD).a,h=Math.min(o,Math.min(a,Math.min(l,c)));h<1&&(s=h)}i+=(1-i)*s}}return i<1}var Wc=class extends bi{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},STe=class extends Wc{constructor(e,t,i,n){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=n}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},$T=class extends Wc{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,i){let n=i?6:(e?3:0)+t;if(0===n)return this;void 0===this.flavors&&(this.flavors=[]),n-=1;let r=this.flavors[n];return void 0===r&&(r=new STe(e,t,i,this),this.flavors[n]=r,r.flatShading=e,r.side=t,r.updateAfterBuild()),r}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(e,t){this.data!==e&&this.reset0(e,t)}reset0(e,t){this.data=e;let i=e.layers??br.defaultTwoLayerData("phong").layers;try{this.layers=i.map(n=>mh.create(this.layerIdGen++,n.id,n.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=pf(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if("alphaOverride"===e[0])this.transparent=pf(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if("layer"===e[0]){let n=e[1],r=e[2];if(n&&r){let s=this.layers.find(o=>o.uuid===n);s?.hasValue(r)&&("alpha"===r?(this.transparent=pf(this.data,i.shared),s.setValue(r,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(r,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>"light"===i.data.type);t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&"string"==typeof i.data.alpha&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(t=>t instanceof zl),void 0===this.lightLayer&&(this.lightLayer=new zl(0,"",{...ms.defaultData("light","phong"),visible:!1},new nW,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}applyTextureMaps(){let e=this.layers.find(r=>r instanceof zl);if(!e)return;let t=e.data,i=t.bumpMap,n=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let r=0;r<this.layers.length;++r){let s=this.layers[r];s instanceof $i&&s.color instanceof HT&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===n&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(void 0!==t?this.data=t:t=this.data,this.transparent=pf(t,i.shared),"layers"===e.path[0]){this.data=t;let n=i.shared,r=e.path[1];if(void 0===r){if(this.layers.reverse(),4===e.type){let s=mh.create(this.layerIdGen++,e.id,e.data,i.shared);this.layers.splice(e.localIndex,0,s),i.scene.markNeedsUpdateRendererDirty()}else if(5===e.type)this.layers.splice(e.localIndex,1)[0].dispose(),i.scene.markNeedsUpdateRendererDirty();else if(6===e.type){let s=this.layers.findIndex(a=>a.uuid===e.id),o=this.layers[s];this.layers.splice(s,1),this.layers.splice(e.localIndex,0,o),i.scene.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate(i.shared)}else{0===e.type&&void 0!==e.props.occlusion&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(o=>o.uuid===r);if(s){let a,o=t.layers.data(r);if(0===e.type&&("alpha"in e.props||"alphaOverride"in e.props)&&(a="alpha"in e.props?{...e.props,alpha:fh(e.props.alpha,n,["material",this.uuid,"layer",r,"alpha"])}:{...e.props,alphaOverride:fh(e.props.alphaOverride,n,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...a?{props:a}:{},path:e.path.slice(2)},o,i)){let l=mh.create(this.layerIdGen++,r,o,n);this.layers.splice(this.layers.findIndex(c=>c.uuid===r),1,l),this.onUpdate(i.shared)}}}}else this.reset(t,i)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof $i?t.color.mask=void 0:t instanceof zl&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof $i&&t.isMask.value&&t.data.visible&&e>0){let n=this.layers[e-1];n instanceof zl?n.node.mask=new bs(t.color,t.alpha,bs.MUL):n instanceof $i&&(n.isMask.value||(n.color.mask=new bs(t.color,t.alpha,bs.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof $i),t=this.layers.findIndex(i=>i instanceof zl);if(-1!==e&&e<t){let i=this.layers[e].color;for(let n=e+1;n<t;++n){let r=this.layers[n];if(r instanceof $i){if(r.isMask.value)continue;i=new k6(i,r.color,r.alpha,r.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new Ni("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof zl);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let n=this.layers[i];if(n instanceof $i){if(n.isMask.value)continue;e=new k6(e,n.color,n.alpha,n.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof bW);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new bs(t,e[i].position,bs.ADD),t=new bs(t,new Ve(.5).setReadonly(!0),bs.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(e,t){let i=(n,r,s)=>Math.min(Math.max(n,r),s);for(let n of this.layers)if("displace"===n.type){let r=i(n.uniforms[`f${n.id}_intensity`].value,e,t);n.uniforms[`f${n.id}_intensity`].value=r}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if("light"===t.type)e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let r=[...(vW[t.type]??[]).map(a=>t[a]),...(yW[t.type]??[]).map(a=>t[a]?.length??0)],o=`"${t.type}-${t.visible}-${"isMask"in t&&t.isMask}"`;e+=r.length?`[${o}, "${r.join('","')}"],`:o}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let n=this.getIncludes(t,i);if(!n)return"";let r="";n=n.sort(e);for(let s=0;s<n.length;s++)n[s].src&&(r+=n[s].src+"\n");return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let n=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+n+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+n+";"),this.addVertexFinalCode("vUv"+n+" = uv"+n+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){void 0===this.fragmentParsVariables[e]&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){void 0===this.vertexParsVariables[e]&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+"\n"}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+"\n"}clearNodeCode(e){let t=this.nodeCode[e=e??this.shader];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+"\n"}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+"\n"}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return-1!==this.caches.indexOf(e)}isSlot(e){return-1!==this.slots.indexOf(e)}define(e,t){this.defines[e]=void 0===t?1:t}require(e){this.requires[e]=!0}isDefined(e){return void 0!==this.defines[e]}getVar(e,t,i,n="varying",r="V",s=""){let o=this.getVars(n),a=o[e];return a||(a={name:i||"node"+r+o.length+(s?"_"+s:""),type:t},o.push(a),o[e]=a),a}getTempVar(e,t,i,n){return this.getVar(e,t,i,this.shader,"T",n)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}getVarListCode(e,t){t=t??"";let i="";for(let n=0,r=e.length;n<r;++n){let s=e[n],a=s.name,l=s.size,c=this.getFormatByType(s.type);if(void 0===c)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+a+`[${l}];\n`:i+=t+" "+c+" "+a+";\n"}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof Gc?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,n,r,s){if(t.includes("[]")){let o=this.inputs.arrayUniforms,l=new A6({type:t,size:i.size,name:n||"nodeUA"+o.list.length+(s?"_"+s:""),node:i,needsUpdate:r});return o.list.push(l),o[e].push(l),o[e][l.name]=l,this.uniforms[l.name]=l,l}{let o=this.inputs.uniforms,l=new A6({type:t,name:n||"nodeU"+o.list.length+(s?"_"+s:""),node:i,needsUpdate:r});return o.list.push(l),o[e].push(l),o[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,n,r){return this.createUniform("vertex",e,t,i,n,r)}createFragmentUniform(e,t,i,n,r){return this.createUniform("fragment",e,t,i,n,r)}include(e,t,i){let n;if(e="string"==typeof e?vs.get(e):e,!1===this.context.include)return e.name;e instanceof Te?n=this.includes.functions:e instanceof gi?n=this.includes.consts:e instanceof I6&&(n=this.includes.structs);let r=n[this.shader]=n[this.shader]||[];if(e){let s=r[e.name];if(s||(s=r[e.name]={node:e,deps:[]},r.push(s),s.src=e.build(this,"source")),e instanceof Te&&t&&r[t.name]&&-1===r[t.name].deps.indexOf(e)&&(r[t.name].deps.push(e),e.includes?.length)){let o=0;do{this.include(e.includes[o++],t)}while(o<e.includes.length)}return i&&(s.src=i),e.name}throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return _De[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return 1===e?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i?.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(void 0!==i){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Fu:case Bu:return new fDe(i);case vg:return new pDe(new Fl(i));default:return new Fl(i)}else{if(i.isVector2)return new or(i);if(i.isVector3)return new po(i);if(i.isVector4)return new kl(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return bDe[e]||e}getFormatByType(e){return wDe[e]||e}getUUID(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return O6[e]}getIndexByElement(e){return O6.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=_a,t===_a&&this.context.gamma&&(t=xt),t}};e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof $i){let t=e.params.texture;if(t instanceof UT&&!t.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(Wc.prototype,{properties:{get:function(){return this.fragment.properties}}});var JT=class extends $T{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},CTe=Wn(vue()),xW=new Map;function ETe(e){if("string"==typeof e)return e;let t=xW.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},xW.set(e,t)),t.url}var SW,Fw,xv=class{constructor({src:e,volume:t,delay:i,loop:n}){let r;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},r="string"==typeof e?{src:e}:{src:ETe(e),format:"wav"},this.sound=new CTe.Howl(r),this.sound.on("end",this.onEnd),this.src=e,void 0!==t&&(this.volume=t),void 0!==i&&(this.delay=i),void 0!==n&&(this.loop=n)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},CW=new Promise(e=>{SW=e}),EW=!1;function ATe(){if(!EW)return Fw||(Fw=function e(){return t.apply(this,arguments)}(),Fw);function t(){return(t=(0,sn.Z)(function*(){let i=yield In.e(640).then(In.bind(In,640));SW(i),EW=!0})).apply(this,arguments)}}function eI(){return eI=(0,sn.Z)(function*(e){return yield(yield fetch(e)).arrayBuffer()}),eI.apply(this,arguments)}var ITe=new class{load(e,t,i=(()=>{})){return(0,sn.Z)(function*(){let{load:n}=yield CW;n(e,(r,s)=>{r||!s?i(r??"Something went wrong"):t(s)})})()}parse(e){return(0,sn.Z)(function*(){let{parse:t,Bidi:i}=yield CW;try{let n=t(e),r=new i;return r.registerModifier("glyphIndex",null,o=>n.charToGlyphIndex(o.char)),r.applyFeatures(n,n.defaultRenderOptions.features),{font:n,bidi:r}}catch(n){console.error(n)}})()}};function MW(e){return tI.apply(this,arguments)}function tI(){return tI=(0,sn.Z)(function*(e){let t,i,n=!1;if(e.url?(t=yield function TTe(e){return eI.apply(this,arguments)}(e.url),i=e.url,n=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t){let r=yield ITe.parse(t);if(r)return{font:r.font,url:i,intercepted:n,arr:t,bidi:r.bidi}}}),tI.apply(this,arguments)}function PTe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var LTe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let n=this.objects.get(e);return void 0===n?(n=this.createObject(e,t,i),this.objects.set(e,n)):n.isShared=!0,n}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&!0!==i.isShared)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){t===this.objects.get(e)&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},AW=class extends LTe{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let n=Iw(e,t,this.flatShading,i);return n.computeBoundingSphere(),n}},NTe={markNeedsUpdateRendererDirty:()=>{}},kTe=class extends kDe{constructor(e){super(),this.shared=e}create(e){return new rW(e,this.shared)}},iI=class{constructor(e,t={}){if(this.data=e,this.geometryCache=new AW(!0),this.geometryCache2=new AW(!1),this.imageHolderCache=new kTe(this),this.thisContext={scene:NTe,shared:this},this.deletedMaterial=new JT(br.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new ph(sw.emptyImage,this),this.deletedVideo=new ph($b.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.variables={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[i,n]of Object.entries(t.images))this.addImage(i,n);if(t.videos)for(let[i,n]of Object.entries(t.videos))this.addVideo(i,n);if(t.audios)for(let[i,n]of Object.entries(t.audios))this.addAudio(i,n);this.reset(e)}setRequestRender(e){this._requestRender=e}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.resetLib(e.lib);for(let{id:i,data:n}of e.variables)this.addVariableHolder(i,n),t&&this.updateVariableHolder(i,n);for(let[i,n]of Object.entries(e.images))this.addImage(i,n);for(let[i,n]of Object.entries(e.videos))this.addVideo(i,n);for(let[i,n]of Object.entries(e.colors))this.addColor(i,n);for(let[i,n]of Object.entries(e.materials))this.addMaterial(i,n);for(let[i,n]of Object.entries(e.audios))this.addAudio(i,n);for(let[i,n]of Object.entries(e.fonts))this.addFont(i,n)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new JT(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return"string"==typeof e?this.getMaterialOrDeletedPlaceholder(e):null==e?(console.error("material is undefined or null"),this.deletedMaterial):new $T(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new ph(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return"string"==typeof e?this.getImage(e):this.imageHolderCache.load(e)}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new ph(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return"string"==typeof e?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.colors[e].setRGBA(t.r,t.g,t.b,"a"in t?t.a:1),!0):(this.colors[e]=new kw(t.r,t.g,t.b,"a"in t?t.a:1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if("string"!=typeof e)return new _s(e.r,e.g,e.b,"a"in e?e.a:1);{let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new _s(0,0,0,0))}return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof xv)return t;{let i=new xv({src:t.data});return this.audios[e]=i,i}}deleteAudio(e){let t=this.audios[e];t&&(t instanceof xv&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=MW(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=MW(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let n=this._bidi;n.getTextGlyphs(t);let r=n.tokenizer.tokens,s=[],o=0,a=i.length===r.length;for(let l=0;l<i.length;l++){let c=i[l].index,h=String.fromCharCode(i[l].unicode),u=r[o];if(PTe(c,u)||a)s.push({char:h,index:c,replacements:[u.state.glyphIndex],replacementChars:[u.char]}),o++;else{let d=u.char,p="",f=[u.state.glyphIndex],m=[],g=!1;for(;!g;)o++,p=t.charAt(o),d+=p,f.push(e.charToGlyphIndex(p)),m=e.stringToGlyphs(d),1===m.length&&m[0].index===c&&(g=!0),o>t.length&&(g=!0);s.push({char:h,index:c,replacements:f,replacementChars:Array.from(d)}),o++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let m,i=this.font,n=t.fontSize/this.unitsPerEm,r=t.fontSize*t.lineHeight,s=e.map(v=>this.getTextWidth(v,t)),o=t.width,a=this.getCharWidth("\n",t),l=1===t.horizontalAlign?a:0,c=this.computeSpaceWidthForLine(e,0,t),h=this.getLineInitialOffsetX(s[0],o,t.horizontalAlign,e[0],a),u=this.getLineInitialOffsetY(r,e.length,t.height,n,t.verticalAlign),d=[],p=e.map(v=>[]),f=e.map(v=>[]);for(let v=0;v<e.length;v++){let y=e[v],_={features:{liga:!0}},b=[];try{b=i.stringToGlyphs(y,_)}catch(C){console.warn(C)}h=this.getLineInitialOffsetX(s[v],o,t.horizontalAlign,y,a);let w=[];try{w=this.reverseLigaturesTable(i,y,b)}catch(C){console.warn(C)}c=this.computeSpaceWidthForLine(e,v,t);for(let C=0;C<b.length;C++){let x=b[C],S=0===x.index?"\n":x.unicode?String.fromCharCode(x.unicode):void 0,E=w[C],D=0,T=0;0===C&&2===t.horizontalAlign&&void 0!==x.leftSideBearing&&(T=-x.leftSideBearing*n),m&&(D=i.getKerningValue(x,m)*n),h+=T+D;let I=0;if("\n"===S)I=l;else if(" "===S)I=c;else{let P=this.createPath(x,n,h,u,t);P&&(I=P.offsetX-(D+T),d.push(P.path))}if(1===E.replacements.length)f[v].push([h,u]),p[v].push(I);else{let P=E.replacements.map(F=>(i.glyphs.get(F).advanceWidth??0)*n),R=P.reduce((F,N)=>F+N,0),L=P.map(F=>F/R),j=h;for(let F=0;F<L.length;F++){let N=I*L[F];f[v].push([j,u]),p[v].push(N),j+=N}}h+=I,m=x}u-=r}let g=[];for(let v=0,y=d.length;v<y;v++)g.push(...d[v].toShapes());return{shapes:g,charWidths:p,lineWidths:s,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(e,t,i,n,r){return(3===i||2===i)&&n.indexOf("\n")>=0&&(e-=r),3===i?.5*t-.5*e:2===i?t-e:0}getLineInitialOffsetY(e,t,i,n,r){let s=t*e,o=Math.abs(this.ascender-this.descender)*n,l=-this.ascender*n-(e-o)/2;return 3===r?-(i-s-l):2===r?-(.5*i-.5*s-l):l}createPath(e,t,i,n,r){let s=e.getPath(i,-n,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");let o=new class{constructor(){this.type="ShapePath",this.color=new Je,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new eb,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath?.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath?.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,s){return this.currentPath?.bezierCurveTo(e,t,i,n,r,s),this}splineThru(e){return this.currentPath?.splineThru(e),this}toShapes(){let t={loc:0,t:0};function i(p,f,m,g){let v=p.x,y=f.x,_=m.x,b=g.x,w=p.y,C=f.y,x=m.y,S=g.y,E=(b-_)*(w-x)-(S-x)*(v-_),T=(S-x)*(y-v)-(b-_)*(C-w),I=E/T,P=((y-v)*(w-x)-(C-w)*(v-_))/T;if(0===T&&0!==E||I<=0||I>=1||P<0||P>1)return null;if(0===E&&0===T){for(let R=0;R<2;R++){if(n(0===R?m:g,p,f),0===t.loc){let L=0===R?m:g;return{x:L.x,y:L.y,t:t.t}}if(2===t.loc)return{x:+(v+t.t*(y-v)).toPrecision(10),y:+(w+t.t*(C-w)).toPrecision(10),t:t.t}}return null}for(let j=0;j<2;j++)if(n(0===j?m:g,p,f),0===t.loc){let F=0===j?m:g;return{x:F.x,y:F.y,t:t.t}}return{x:+(v+I*(y-v)).toPrecision(10),y:+(w+I*(C-w)).toPrecision(10),t:I}}function n(p,f,m){let w,g=m.x-f.x,v=m.y-f.y,y=p.x-f.x,_=p.y-f.y,b=g*_-y*v;return p.x===f.x&&p.y===f.y?(t.loc=0,void(t.t=0)):p.x===m.x&&p.y===m.y?(t.loc=1,void(t.t=1)):void(b<-Number.EPSILON?t.loc=3:b>Number.EPSILON?t.loc=4:g*y<0||v*_<0?t.loc=5:Math.sqrt(g*g+v*v)<Math.sqrt(y*y+_*_)?t.loc=6:(w=0!==g?y/g:_/v,t.loc=2,t.t=w))}let a=0,l=999999999,c=-999999999,h=[];this.subPaths.forEach(p=>{let f=p.getPoints(),m=-999999999,g=999999999,v=-999999999,y=999999999;for(let _=0;_<f.length;_++){let b=f[_];b.y>m&&(m=b.y),b.y<g&&(g=b.y),b.x>v&&(v=b.x),b.x<y&&(y=b.x)}c<=v&&(c=v+1),l>=y&&(l=y-1),f.length&&h.push({curves:p.curves,points:f,isCW:Wj.isClockWise(f),identifier:a++,boundingBox:new p4(new z(y,g),new z(v,m))})});let u=h.map(p=>function o(p,f,m,g,v){(null==v||""===v)&&(v="nonzero");let y=new z;p.boundingBox.getCenter(y);let b=function s(p,f,m){let g=new z;f.getCenter(g);let v=[];return m.forEach(y=>{y.boundingBox.containsPoint(g)&&function r(p,f){let m=[],g=[];for(let v=1;v<p.length;v++){let y=p[v-1],_=p[v];for(let b=1;b<f.length;b++){let x=i(y,_,f[b-1],f[b]);null!==x&&void 0===m.find(S=>S.t<=x.t+Number.EPSILON&&S.t>=x.t-Number.EPSILON)&&(m.push(x),g.push(new z(x.x,x.y)))}}return g}(p,y.points).forEach(_=>{v.push({identifier:y.identifier,isCW:y.isCW,point:_})})}),v.sort((y,_)=>y.point.x-_.point.x),v}([new z(m,y.y),new z(g,y.y)],p.boundingBox,f);b.sort((D,T)=>D.point.x-T.point.x);let w=[],C=[];b.forEach(D=>{D.identifier===p.identifier?w.push(D):C.push(D)});let x=w[0].point.x,S=[],E=0;for(;E<C.length&&C[E].point.x<x;)S.length>0&&S[S.length-1]===C[E].identifier?S.pop():S.push(C[E].identifier),E++;if(S.push(p.identifier),"evenodd"===v)return{identifier:p.identifier,isHole:S.length%2==0,for:S[S.length-2]};if("nonzero"===v){let D=!0,T=null,I=null;for(let P=0;P<S.length;P++){let R=S[P];f[R]&&(D?(I=f[R].isCW,D=!1,T=R):I!==f[R].isCW&&(I=f[R].isCW,D=!0))}return{identifier:p.identifier,isHole:D,for:T}}console.warn('fill-rule: "'+v+'" is currently not implemented.')}(p,h,l,c,this.userData?.style.fillRule)),d=[];return h.forEach(p=>{let f=u[p.identifier];if(f&&!f.isHole){let m=new tb;m.curves=p.curves,u.filter(g=>g?.isHole&&g.for===p.identifier).forEach(g=>{if(g){let v=h[g.identifier],y=new eb;y.curves=v.curves,m.holes.push(y)}}),d.push(m)}}),d}},a=(e.advanceWidth??1)*t;if(e)for(let l of s.commands){let c=o.currentPath?.currentPoint;if(!c||"Z"===l.type||c.x!==l.x||-c.y!==l.y)switch(l.type){case"M":o.moveTo(l.x,-l.y);break;case"L":o.lineTo(l.x,-l.y);break;case"Q":o.quadraticCurveTo(l.x1,-l.y1,l.x,-l.y);break;case"C":o.bezierCurveTo(l.x1,-l.y1,l.x2,-l.y2,l.x,-l.y)}}return o.subPaths.forEach(l=>{let c=function OTe(e){if(e.length){let t=e[0];if(t instanceof zo)return t.v1;if(t instanceof Vo||t instanceof Cc)return t.v0}}(l.curves);void 0!==c&&l.currentPoint.distanceTo(c)>0&&l.lineTo(c.x,c.y)}),{offsetX:a+r.fontSize*r.letterSpacing,path:o}}getCharWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}getTextWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}computeSpaceWidthForLine(e,t,i){let n=this.getCharWidth(" ",i),r=e[t];if(r){let s=this.countSpaces(r.trimEnd());if(4===i.horizontalAlign&&t<e.length-1&&s)return(i.width-(this.getTextWidth(r,i)-s*n))/s}return n}countSpaces(e){return(e.match(/ /g)||[]).length}}(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof xv&&e.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){return void 0===this.variables[e]?(this.variables[e]={value:t.value,locations:[]},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0):(this.variables[e].value=t.value,!1)}resetDynamicVariablePlayState(){for(let e in this.variables)void 0!==this.variables[e].dynamicVariablePlayState&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(void 0===this.variables[e])return!1;this.variables[e].value=t;let i=t;for(;"string"==typeof i;)i=this.variables[i].value;let n=this.entityOpContext.scene;for(let r=this.variables[e].locations.length-1;r>=0;r--){let s=this.variables[e].locations[r];if("material"===s[0]){let o=s[1],a=i,l={scene:n,shared:this},c=s.slice(2);n.traverseMaterial(u=>{let d=u.root??u;d.uuid===o&&d.onVariableUpdate(c,a,l)});let h=this.materials[o];h&&h.onVariableUpdate(c,a,l)}else{let o=n.find(s[0]);if(void 0===o){this.variables[e].locations.splice(r,1);continue}if("geometry"!==s[1]){for(let a=1;a<s.length-1;a++)o=o[s[a]];o[s[s.length-1]]="rotation"===s[1]?i*qe.DEG2RAD:i}if(o=n.find(s[0]),zt.is(o))if("position"===s[1]||"rotation"===s[1]||"scale"===s[1])o.onVariableUpdate();else if("geometry"===s[1]){let a=o;o.component&&(a=o.component);let l=a.dataPatched;a.chooseGeoemtryCache(this).forceDelete(l.geometry),a.createGeometryDelayed(this.entityOpContext),a.onVariableUpdate(!0),a.instances.forEach(c=>{let h=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(h.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0)})}}}return!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){if(Array.isArray(e)){if("mouse"===e[0])return this.mouseProperty?.[e[1]]??0;if("raycast"===e[0])return this.raycastProperty?.[e[1]]??0;let i=this.entityOpContext.scene.find(e[0]);if("width"===e[1]||"height"===e[1]||"depth"===e[1])return i.geometry.userData.parameters[e[1]];for(let n=1;n<e.length;n++)i=i[e[n]];return"rotation"===e[1]&&(i*=qe.RAD2DEG),i}for(let i in this.variables){if(void 0===t)break;let n=this.variables[i],r=n.locations?.findIndex(s=>Wr.equal(s,t));void 0!==r&&-1!==r&&n.locations.splice(r,1)}if("string"==typeof e){let i=e,n=e;do{if(n=i,void 0===this.variables[i])break;i=this.variables[i].value}while("string"==typeof i);return t&&void 0!==this.variables[n]&&this.variables[n].locations.push(t),i}return e}getVariables(){return this.variables}getDynamicVariablePlayState(e){return this.variables[e]?.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){return this.variables[e]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){"images"===e.path[0]?1===e.path.length&&1===e.type?this.addImage(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?1===e.path.length&&1===e.type?this.addVideo(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?1===e.path.length&&1===e.type?this.addAudio(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"colors"===e.path[0]?1===e.path.length&&1===e.type?this.addColor(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteMaterial(e.id):"fonts"===e.path[0]?1===e.path.length&&1===e.type?this.addFont(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?1===e.path.length&&1===e.type?this.addVariableHolder(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVariable(e.id):"components"===e.path[0]&&t.updateByLibOp(e,this)}updateByOp(e,t,i){this.data=t,"images"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addImage(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addVideo(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):1===e.path.length&&1===e.type?this.addAudio(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"colors"===e.path[0]?2===e.path.length&&0===e.type?this.updateColor(e.path[1],e.props):1===e.path.length&&1===e.type?this.addColor(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data):1===e.path.length&&2===e.type?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(_r.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i}):"fonts"===e.path[0]?2===e.path.length&&0===e.type?this.updateFont(e.path[1],e,i):1===e.path.length&&1===e.type?this.addFont(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?2===e.path.length&&0===e.type&&"value"in e.props?this.updateVariable(e.path[1],e.props.value):1===e.path.length&&4===e.type?this.addVariableHolder(e.id,e.data):1===e.path.length&&5===e.type&&this.deleteVariable(e.id):"lib"===e.path[0]&&this.updateLibByOp(_r.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let n=this.getFont(e),r={...this.data.fonts[e],url:t.props.url};n.update(r),n.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}},ff=(new iI(Go.emptyData()),class extends gs{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),null!==function OCe(e,t){let i=[];if(t.length!==e.length)return null;for(var n=0;n<e.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(let[n,r]of Object.entries(e.props)){let s=i.shared.material(r);this.material[Number(n)]=s}else if(co(e.path,["material"])&&this.material instanceof Wc)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(_r.drop(e,1),t.material,i);else if(co(e.path,["materials","*"])&&Array.isArray(this.material)){let n=e.path[1];if("materials"in t&&n<this.material.length){let r=t.materials[n];"string"!=typeof r&&this.material[n].updateByOp(_r.drop(e,2),r,i)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(e,t){super.updateState(e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if("NonParametricGeometry"!==e.geometry?.type&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),t.scene.markNeedsUpdateRendererDirty()),"NonParametricGeometry"===e.geometry?.type&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map(n=>t.shared.material(n).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side)if(Array.isArray(this.material))for(let n=0;n<this.material.length;n++)this.material[n]=this.material[n].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&VH(this.material).forEach(e=>{e instanceof Wc&&(e instanceof JT||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}}),DW=new M,TW=new St,IW=new St,FTe=new M,PW=new ye,Jr=class extends ff{constructor(e,t,i){super(e,t),this.data=t,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.isSkinnedMesh=!0,this.bindMode=t.bindMode,this.bindMatrix=(new ye).fromArray(t.bindMatrix),this.bindMatrixInverse=new ye)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Ze&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof iI){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return tw.is2DParametricMesh(e.type)&&0===e.depth}get is2DType(){return tw.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),co(e.path,["geometry"])&&this.updateByPatchedOpGeometry(_r.drop(e,1),t.geometry,i)}removeInteractionGeometry(){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if("NonParametricGeometry"===i||"SubdivGeometry"===i){let r,s,o,n=e;if(void 0===this.localGeometry){let l={...this.data.geometry,...n};this.localGeometry=Iw(l,t,this.data.flatShading,this)}n.scaleBaked?[r,s,o]=n.scaleBaked:({width:r,height:s,depth:o}=n);let a=this.localGeometry.userData;void 0!==a.sxPrev&&OT(this.localGeometry.attributes,r/a.sxPrev,s/a.syPrev,o/a.szPrev),a.sxPrev=r,a.syPrev=s,a.szPrev=o}else{let n={...this.data.geometry,...e};this.localGeometry?.dispose(),this.localGeometry=Iw(n,t,this.data.flatShading,this)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){let n=!1;0===e.type&&0===e.path.length&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof Zr&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(n=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),n||(i.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*i.depth):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new St,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){t.fromBufferAttribute(i,n);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(void 0===i)return;let n=this.geometry;TW.fromBufferAttribute(n.attributes.skinIndex,e),IW.fromBufferAttribute(n.attributes.skinWeight,e),DW.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let s=IW.getComponent(r);if(0!==s){let o=TW.getComponent(r);PW.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),t.addScaledVector(FTe.copy(DW).applyMatrix4(PW),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function nI(e){if(Array.isArray(e.material)){for(let t of e.material)if(0===t.getLayersOfType("outline").length)return}else if(!(e.material instanceof Wc)||0===e.material.getLayersOfType("outline").length)return;e instanceof Jr&&e.is2DAndNoDepth?function VTe(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=new M;for(let r=0;r<t.length;r+=3)n.set(t[r],t[r+1],t[r+2]).normalize(),i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z;e.geometry.setAttribute("extrudeNormal",new Fe(i,3))}(e):function BTe(e){if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,n=i.position.array,r=i.normal.array,s=new Float32Array(n.length);for(let o=0;o<n.length;o+=3){let a=`${n[o]}_${n[o+1]}_${n[o+2]}`,l=new M(r[o],r[o+1],r[o+2]);t.has(a)?t.get(a)?.normals.push(l):t.set(a,{normals:[l],result:new M})}t.forEach((o,a)=>{for(let l of o.normals)o.result.add(l);o.result.divideScalar(o.normals.length)});for(let o=0;o<n.length;o+=3){let a=`${n[o]}_${n[o+1]}_${n[o+2]}`,l=t.get(a)?.result;l&&(s[o]=l.x,s[o+1]=l.y,s[o+2]=l.z)}e.geometry.setAttribute("extrudeNormal",new Fe(s,3))}(e)}function rI(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=parseInt(e.uuid.replace(/\D/g,"")),r=[qe.seededRandom(n),qe.seededRandom(n+1e4),qe.seededRandom(n+2e4)];for(let s=0;s<t.length;s++)i[s]=r[s%3];e.geometry.setAttribute("randomColor",new st(i,3))}RT.then(e=>{});var za=new ln,Sv=new M;function UTe(e){let t=!1;return e.scene.objects.traverse((i,n)=>{"Mesh"===n.type&&"SubdivGeometry"===n.geometry.type&&(t=!0)}),t}var Cv=class extends Jr{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new ye,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){if(!0===this.skipReactionUpdate)return;let t=this.localGeometry?.uuid,{originalGeometry:i,subdividedGeometry:n,subdivPointer:r}=Zr.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=r,void 0!==i&&(this.originalGeometry?.dispose(),this.originalGeometry=i),void 0!==n&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=n??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,nI(this),rI(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),void 0!==e.flatShading){let i=this.material;this.material=i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){Zr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&Zr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=Zr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Zr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,gs.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new ds,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let i=e.boundingSphere.center;za.setFromBufferAttribute(e.attributes.position),za.getCenter(i),e.boundingSphere.radius=i.distanceTo(za.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),za.getSize(Sv),this.hasNonUniformScale&&Sv.divide(this.scale);let n={width:Sv.x,height:Sv.y,depth:Sv.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(e){let t=this.originalGeometry;za.min.set(e[0],e[2],e[4]),za.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(za.min.applyMatrix4(this.shearScaleInv),za.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new ds);let i=t.boundingSphere.center;za.getCenter(i),t.boundingSphere.radius=i.distanceTo(za.max)}freeSubdivPointer(){this.subdivPointer&&(Zr.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},HTe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},GTe={polygon_center:0,edge:1,vertex:2},Bw=(e,t)=>(i,n)=>t&&0!==i&&0!==e?e*n/100:0,Ct=(e,t)=>{let i=Math.abs(t),n=-1*i;return(e- -1)*(i-n)/2+n},qTe=new M,Vw=new M,YTe=new M,XTe=new M;function mf(e,t){let i=YTe.fromArray(e),n=XTe.fromArray(t);Vw.copy(n).sub(i);let r=Vw.length();return Vw.normalize().multiplyScalar(.5*r),qTe.copy(i).add(Vw).toArray()}var mo=new vr,zw=new M,Uw=new M,gh=new M,sI=e=>.5*(1-Math.cos(e*Math.PI)),OW=new M,LW=new ye,NW=new Zd;function kW(e){let t=!1;return e.scene.objects.traverse((i,n)=>{"Mesh"===n.type&&"TextGeometry"===n.geometry.type&&(t=!0)}),t}var Ua,BW,VW,zW,FW=class extends Jr{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let e=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign)??0}get fontScale(){return this.font?this.dataPatched.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!isNaN(e.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&(LW.copy(i).invert(),NW.copy(e.ray).applyMatrix4(LW),NW.intersectBox(this.singleBBox,OW))){let n=OW.applyMatrix4(i),r=e.ray.origin.distanceTo(n);t.push({distance:r,point:n.clone(),object:this})}}},es=1e-4,UW=new M,jW=new M;RT.then(e=>{BW=[(Ua=e).get_face_center,Ua.get_edge_midpoint,Ua.get_vertex_position],VW=[Ua.get_face_normal,Ua.get_edge_normal,Ua.get_vertex_normal],zW=[Ua.face_count,Ua.edge_count,Ua.vertex_count]});var tIe=new ye,iIe=new ye,qc=new M,vh=new M,Ev=new M,oI=new M,nIe=new M,rIe=new M,Ul=new class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(null==this.perlin){this.perlin=new Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let c,h,p,f,m,n=Math.floor(e),r=Math.floor(t),s=Math.floor(i),o=e-n,a=t-r,l=i-s,u=0,d=.5;for(let g=0;g<4;g++){let v=n+(r<<4)+(s<<8);c=sI(o),h=sI(a),p=this.perlin[4095&v],p+=c*(this.perlin[v+1&4095]-p),f=this.perlin[v+16&4095],f+=c*(this.perlin[v+16+1&4095]-f),p+=h*(f-p),v+=256,f=this.perlin[4095&v],f+=c*(this.perlin[v+1&4095]-f),m=this.perlin[v+16&4095],m+=c*(this.perlin[v+16+1&4095]-m),f+=h*(m-f),p+=sI(l)*(f-p),u+=p*d,d*=.5,n<<=1,o*=2,r<<=1,a*=2,s<<=1,l*=2,o>=1&&(n++,o--),a>=1&&(r++,a--),l>=1&&(s++,l--)}return u}noiseSeed(e){let t=(()=>{let i,n;return{setSeed(r){n=i=(r??4294967296*Math.random())>>>0},getSeed:()=>i,rand:()=>(n=(1664525*n+1013904223)%4294967296,n/4294967296)}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},Xo=class extends(sT(pi)){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(null===this.parent)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof wr&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof wr&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(t=void 0!==e?e:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type&&!this.parameters.toObject.object&&(t=0),"toObject"===this.parameters.type&&this.objectForSample){for(let n=0,r=this.children.length;n<r;++n)this.remove(this.children[0]);let i=this.children;if(i.length===t)return;if(i.length<t)for(let n=0,r=t-i.length;n<r;++n){let s=new wr(this.object);s.expand(),this.add(s)}else for(let n=0,r=i.length-t;n<r;++n)this.remove(i[n])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,n=t-this.children.length;i<n;++i){let r=new wr(this.object);r.expand(),this.add(r)}else for(let i=0,n=this.children.length-t;i<n;++i)this.remove(this.children[0])}}_updateRadial(e){let o,t=e.radial,i=t.start*qe.DEG2RAD,r=i-t.end*qe.DEG2RAD,s=new Yn(t.rotation[0],t.rotation[1],t.rotation[2]);switch(t.axis){case"z":o=new M(0,0,1);break;case"y":o=new M(0,1,0);break;default:o=new M(1,0,0)}let a=e.randomnessObject??Rc.defaultData([1,1,1]).randomnessObject,l="perlin"===a.noiseType;Ul.noiseSeed(a.seed);let c=rT((0,hv.default)(a.seed)),h=Bw(a.strength,this.parameters.randomness);for(let[u,d]of this.children.entries()){let p=u*(a.freqScale/10)+a.movement,f=l?Ul.noise(p):c(p,p),m=u+1;d.scale.x=t.scale[0]+h(m,Ct(f,a.scale[0]))||es,d.scale.y=t.scale[1]+h(m,Ct(f,a.scale[1]))||es,d.scale.z=t.scale[2]+h(m,Ct(f,a.scale[2]))||es,d.position.setScalar(0);let g=r/e.count*u-i;switch(t.axis){case"x":d.rotation.set(0,g,0);break;case"y":d.rotation.set(0,0,g);break;case"z":d.rotation.set(g,0,0)}d.translateOnAxis(o,t.radius),d.position.x+=t.position[0]+h(m,Ct(f,a.position[0])),d.position.y+=t.position[1]+h(m,Ct(f,a.position[1])),d.position.z+=t.position[2]+h(m,Ct(f,a.position[2]));let v=h(m,Ct(f,a.rotation[0])),y=h(m,Ct(f,a.rotation[1])),_=h(m,Ct(f,a.rotation[2]));!0===t.alignment?(d.rotation.x+=s.x+v,d.rotation.y+=s.y+y,d.rotation.z+=s.z+_):d.rotation.set(s.x+v,s.y+y,s.z+_)}}_updateLinear(e){if("linear"!==e.type)throw new Error;let t=e.linear,i=new Yn(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??Rc.defaultData([1,1,1]).randomnessObject,r="perlin"===n.noiseType;Ul.noiseSeed(n.seed);let s=rT((0,hv.default)(n.seed)),o=Bw(n.strength,this.parameters.randomness);for(let[a,l]of this.children.entries()){let c=a*(n.freqScale/10)+n.movement,h=r?Ul.noise(c):s(c,c),u=a+1,d=o(u,Ct(h,n.rotation[0])),p=o(u,Ct(h,n.rotation[1])),f=o(u,Ct(h,n.rotation[2]));l.scale.x=1+(t.scale[0]-1)*a+o(u,Ct(h,n.scale[0]))||es,l.scale.y=1+(t.scale[1]-1)*a+o(u,Ct(h,n.scale[1]))||es,l.scale.z=1+(t.scale[2]-1)*a+o(u,Ct(h,n.scale[2]))||es,l.rotation.x=i.x*a+d,l.rotation.y=i.y*a+p,l.rotation.z=i.z*a+f,l.position.x=t.position[0]*a+o(u,Ct(h,n.position[0])),l.position.y=t.position[1]*a+o(u,Ct(h,n.position[1])),l.position.z=t.position[2]*a+o(u,Ct(h,n.position[2]))}}_updateGrid(e){let t=0,i=e.grid,n=e.randomnessObject??Rc.defaultData([1,1,1]).randomnessObject,r=Bw(n.strength,this.parameters.randomness),s="perlin"===n.noiseType;Ul.noiseSeed(n.seed);let o=function hMe(e=Math.random){let t=AG(e),i=new Float64Array(t).map(s=>nT[s%12*3]),n=new Float64Array(t).map(s=>nT[s%12*3+1]),r=new Float64Array(t).map(s=>nT[s%12*3+2]);return function(s,o,a){let l,c,h,u,x,S,E,D,T,I,d=.3333333333333333*(s+o+a),p=pv(s+d),f=pv(o+d),m=pv(a+d),g=(p+f+m)*Na,b=s-(p-g),w=o-(f-g),C=a-(m-g);b>=w?w>=C?(x=1,S=0,E=0,D=1,T=1,I=0):b>=C?(x=1,S=0,E=0,D=1,T=0,I=1):(x=0,S=0,E=1,D=1,T=0,I=1):w<C?(x=0,S=0,E=1,D=0,T=1,I=1):b<C?(x=0,S=1,E=0,D=0,T=1,I=1):(x=0,S=1,E=0,D=1,T=1,I=0);let P=b-x+Na,R=w-S+Na,L=C-E+Na,j=b-D+2*Na,F=w-T+2*Na,N=C-I+2*Na,q=b-1+.5,W=w-1+.5,U=C-1+.5,V=255&p,Y=255&f,G=255&m,X=.6-b*b-w*w-C*C;if(X<0)l=0;else{let se=V+t[Y+t[G]];X*=X,l=X*X*(i[se]*b+n[se]*w+r[se]*C)}let H=.6-P*P-R*R-L*L;if(H<0)c=0;else{let se=V+x+t[Y+S+t[G+E]];H*=H,c=H*H*(i[se]*P+n[se]*R+r[se]*L)}let re=.6-j*j-F*F-N*N;if(re<0)h=0;else{let se=V+D+t[Y+T+t[G+I]];re*=re,h=re*re*(i[se]*j+n[se]*F+r[se]*N)}let K=.6-q*q-W*W-U*U;if(K<0)u=0;else{let se=V+1+t[Y+1+t[G+1]];K*=K,u=K*K*(i[se]*q+n[se]*W+r[se]*U)}return 32*(l+c+h+u)}}((0,hv.default)(n.seed));if(!0===i.useCenter){let a={x:i.count[0]%2==0?2:1,y:i.count[1]%2==0?2:1,z:i.count[2]%2==0?2:1},l=new M(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let c=0;c<i.count[0];c++)for(let h=0;h<i.count[1];h++)for(let u=0;u<i.count[2];u++){let d=[(c+1)*(n.freqScale/10)+n.movement,(h+1)*(n.freqScale/10)+n.movement,(u+1)*(n.freqScale/10)+n.movement],p=s?Ul.noise(...d):o(...d),f=this.children[t++];f.scale.x=1+r(t,Ct(p,n.scale[0]))||es,f.scale.y=1+r(t,Ct(p,n.scale[1]))||es,f.scale.z=1+r(t,Ct(p,n.scale[2]))||es;let m=r(t,Ct(p,n.rotation[0])),g=r(t,Ct(p,n.rotation[1])),v=r(t,Ct(p,n.rotation[2]));f.rotation.set(m,g,v),f.position.x=i.size[0]*c-l.x+r(t,Ct(p,n.position[0])),f.position.y=i.size[1]*h-l.y+r(t,Ct(p,n.position[1])),f.position.z=i.size[2]*u-l.z+r(t,Ct(p,n.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let l=0;l<i.count[1];l++)for(let c=0;c<i.count[2];c++){let h=[(a+1)*(n.freqScale/10)+n.movement,(l+1)*(n.freqScale/10)+n.movement,(c+1)*(n.freqScale/10)+n.movement],u=s?Ul.noise(...h):o(...h),d=this.children[t++];d.scale.x=1+r(t,Ct(u,n.scale[0]))||es,d.scale.y=1+r(t,Ct(u,n.scale[1]))||es,d.scale.z=1+r(t,Ct(u,n.scale[2]))||es;let p=r(t,Ct(u,n.rotation[0])),f=r(t,Ct(u,n.rotation[1])),m=r(t,Ct(u,n.rotation[2]));d.rotation.set(p,f,m),d.position.x=i.size[0]*a+r(t,Ct(u,n.position[0])),d.position.y=-i.size[1]*l+r(t,Ct(u,n.position[1])),d.position.z=-i.size[2]*c+r(t,Ct(u,n.position[2]))}}_updateToObject(e){if("toObject"!==e.type)throw new Error;let{toObject:t}=e,i=new Yn(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??Rc.defaultData([1,1,1]).randomnessObject,r="perlin"===n.noiseType;Ul.noiseSeed(n.seed);let s=rT((0,hv.default)(n.seed)),o=Bw(n.strength,this.parameters.randomness);if(!t.object){for(let[,m]of this.children.entries())m.position.set(0,0,0),m.scale.setScalar(1),m.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof FW){if(!this.objectForSample.font?.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);let a=this.getSubdivData(),l=[],c=m=>{let g=m.length;return[m.map(b=>b[0]).reduce((b,w)=>b+w,0)/g,m.map(b=>b[1]).reduce((b,w)=>b+w,0)/g,m.map(b=>b[2]).reduce((b,w)=>b+w,0)/g]},h=m=>Math.round(1e6*m)/1e6;a.forEach(m=>{let g=a.filter(v=>h(m.pos[0])===h(v.pos[0])&&h(m.pos[1])===h(v.pos[1])&&h(m.pos[2])===h(v.pos[2]));l.push(g.length>1?{pos:m.pos,norm:c(g.map(v=>v.norm))}:m)});let u=function WTe(e){let t=[],i={};for(var n=0,r=e.length;n<r;n++){var s=JSON.stringify(e[n].pos.map(o=>Math.round(1e4*o)/1e4));i[s]||(t.push(e[n]),i[s]=!0)}return t}(l);if(u.length>0){let m=Math.round(u.length*t.count/100);this._updateCount(m)}else{let m=this.objectForSample.geometry.getAttribute("position");if(!m||isNaN(m.count)||0===m.count)return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`)}this.objectForSample.updateMatrixWorld();let d=new class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let r=1;Wo.a.fromBufferAttribute(e,n),Wo.b.fromBufferAttribute(e,n+1),Wo.c.fromBufferAttribute(e,n+2),r*=Wo.getArea(),t[n/3]=r}this.distribution=new Float32Array(e.count/3);let i=0;for(let n=0;n<t.length;n++)i+=t[n],this.distribution[n]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*i);return this.sampleFace(n,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let s=Math.ceil((i+n)/2);if(0===s||t[s-1]<=e&&t[s]>e){r=s;break}e<t[s]?n=s-1:i=s+1}return r}sampleFace(e,t,i){let n=this.randomFunction(),r=this.randomFunction();return n+r>1&&(n=1-n,r=1-r),Wo.a.fromBufferAttribute(this.positionAttribute,3*e),Wo.b.fromBufferAttribute(this.positionAttribute,3*e+1),Wo.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(Wo.a,n).addScaledVector(Wo.b,r).addScaledVector(Wo.c,1-(n+r)),Wo.getNormal(i),this}}(this.objectForSample).build(),p=HTe[t.axis],f=this.children;d.setRandomGenerator((0,hv.default)(this.object.uuid+t.seed));for(let[m,g]of f.entries()){let v=m*(n.freqScale/10)+n.movement,y=r?Ul.noise(v):s(v,v),_=m+1,b=o(_,Ct(y,n.rotation[0])),w=o(_,Ct(y,n.rotation[1])),C=o(_,Ct(y,n.rotation[2]));"random"===t.spreadType?d.sample(Ev,oI):(u.length&&(Ev.fromArray(u[m].pos),oI.fromArray(u[m].norm)),this.objectForSample instanceof Cv&&Ev.applyMatrix4(tIe.copy(this.objectForSample.matrixWorld).invert())),Ev.applyMatrix4(this.object.hiddenMatrix.clone().invert()),g.position.copy(Ev),qc.fromArray(p);let x="normal"===t.align?oI:this.object.getWorldDirection(rIe),S=vh.fromArray(t.position);vh.x+=vh.x+o(_,Ct(y,n.position[0])),vh.y+=vh.y+o(_,Ct(y,n.position[1])),vh.z+=vh.z+o(_,Ct(y,n.position[2]));let E=Math.acos(x.dot(qc)),D=nIe.crossVectors(qc,x).normalize(),T=iIe.makeRotationAxis(D,E),I=x.clone().cross(this.object.up).normalize(),P=I.clone().cross(x).normalize(),R=(new ye).makeBasis(I,x,P),L=new M(qc.y,qc.z,qc.x).normalize(),j=L.clone().cross(qc).normalize(),F=(new ye).makeBasis(L,qc,j).invert(),N=(new ye).multiplyMatrices(R,F);g.rotation.setFromRotationMatrix(N),S.applyMatrix4(T),g.position.add(S),g.rotation.x=g.rotation.x+i.x+b,g.rotation.y=g.rotation.y+i.y+w,g.rotation.z=g.rotation.z+i.z+C,g.scale.setScalar(1),g.scale.x=g.scale.x+t.scale[0]+o(_,Ct(y,n.scale[0]))||es,g.scale.y=g.scale.y+t.scale[1]+o(_,Ct(y,n.scale[1]))||es,g.scale.z=g.scale.z+t.scale[2]+o(_,Ct(y,n.scale[2]))||es,g.scale.multiply(this.object.scale),g.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if("random"===e)return[];if(this.objectForSample instanceof Cv){let t=this.objectForSample,i=GTe[e],r=BW[i],s=VW[i],o=[],a=(0,zW[i])(t.subdivPointerNew);for(let l=0;l<=a-1;l++){let c=r(t.subdivPointerNew,l),h=s(t.subdivPointerNew,l);UW.fromArray(c).applyMatrix4(t.matrixWorld),jW.fromArray(h),o.push({pos:UW.toArray(),norm:jW.toArray()})}return o}return(this.objectForSample.geometry.index?function ZTe(e){let t=[];for(let i=0;i<=e.index.count;i++)if(zw.fromArray(e.index.array,3*i),mo.setFromAttributeAndIndices(e.attributes.position,zw.x,zw.y,zw.z),mo.getNormal(Uw),mo.getMidpoint(gh),!(isNaN(gh.x)||isNaN(gh.y)||isNaN(gh.z))){let{a:n,b:r,c:s}=mo,o=n.toArray(),a=r.toArray(),l=s.toArray(),c=n.distanceTo(r),h=r.distanceTo(s),u=s.distanceTo(n),d=mf(o,a),p=mf(a,l),f=mf(l,o),m=[c,h,u],g=Math.max(...m),v=m.filter(b=>Math.round(b)===Math.round(g)).length>1,y=[],_=mo.getMidpoint(gh).toArray();g===c&&!v&&(y=[p,f,f],_=d),g===h&&!v&&(y=[d,f,f],_=p),g===u&&!v&&(y=[d,p,p],_=f),v&&(y=[d,p,f]),t.push({vertices:[o,a,l],faceCenters:y,midpoint:_,norm:mo.getNormal(Uw).toArray()})}return t}(this.objectForSample.geometry):function QTe(e){let t=[],{position:i}=e.attributes;for(let n=0;n<i.count;n++){mo.setFromAttributeAndIndices(i,3*n,3*n+1,3*n+2),mo.getNormal(Uw),mo.getMidpoint(gh);let r=mo.a.toArray(),s=mo.b.toArray(),o=mo.c.toArray();t.push({vertices:[r,s,o],faceCenters:[mf(r,s),mf(s,o),mf(o,r)],midpoint:gh.toArray(),norm:Uw.toArray()})}return t}(this.objectForSample.geometry)).map((t,i)=>"polygon_center"===e?{pos:t.midpoint,norm:t.norm}:"vertex"===e?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:"edge"===e?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){if(this.parameters=Db(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let i=t.find(this.parameters.toObject.object);this.objectForSample=i instanceof gs?i:void 0,this.matrix=new ye,this.hiddenMatrix=new ye,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,i&&i.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Mv=e=>{var t;return(t=class extends e{}).geometryHelper=new wa(30,30,30),t},jw=new Zd,aI=new ds,HW=new ye,Av=(e,t,i,n,r=!1)=>{let s=t,o=e.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),aI.copy(s.boundingSphere),aI.applyMatrix4(o),!1===i.ray.intersectsSphere(aI)||(HW.copy(o).invert(),jw.copy(i.ray).applyMatrix4(HW),null!==s.boundingBox&&!1===jw.intersectsBox(s.boundingBox)))return;let a,l,c,h,f,m,u=s.index,d=s.attributes.position,p=s.drawRange;if(!1===r){for(f=Math.max(0,p.start),m=Math.min(u.count,p.start+p.count);f<m;f+=3)if(l=u.getX(f),c=u.getX(f+1),h=u.getX(f+2),a=g(e,i,jw,d,l,c,h),a)return a.faceIndex=Math.floor(f/3),void n.push(a)}else{let v=s.attributes.position,y=new M,_=new M,b=new M,w=new M,C=2,x=1/((e.scale.x+e.scale.y+e.scale.z)/3),S=x*x;for(let T=Math.max(0,p.start),I=Math.min(v.count,p.start+p.count)-1;T<I;T+=C){if(y.fromBufferAttribute(v,T),_.fromBufferAttribute(v,T+1),jw.distanceSqToSegment(y,_,w,b)>S)continue;w.applyMatrix4(e.matrixWorld);let P=i.ray.origin.distanceTo(w);P<i.near||P>i.far||n.push({distance:P,point:b.clone().applyMatrix4(e.matrixWorld),object:e})}}function g(v,y,_,b,w,C,x){let S=new M,E=new M,D=new M,T=new M,I=new M;if(S.fromBufferAttribute(b,w),E.fromBufferAttribute(b,C),D.fromBufferAttribute(b,x),null===_.intersectTriangle(S,E,D,!1,T))return null;I.copy(T),I.applyMatrix4(v.matrixWorld);let P=y.ray.origin.distanceTo(I);return P<y.near||P>y.far?null:{faceIndex:1,distance:P,point:I.clone(),object:v}}},Hw=new M,go=new sp,sIe=class extends Pg{constructor(e){let t=new Ze,i=new Sc({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},o=new Je(15711266),a=new Je(15711266),l=new Je(2857471);function c(u,d,p){h(u,p),h(d,p)}function h(u,d){n.push(0,0,0),r.push(d.r,d.g,d.b),void 0===s[u]&&(s[u]=[]),s[u].push(n.length/3-1)}c("n1","n2",o),c("n2","n4",o),c("n4","n3",o),c("n3","n1",o),c("f1","f2",o),c("f2","f4",o),c("f4","f3",o),c("f3","f1",o),c("n1","f1",o),c("n2","f2",o),c("n3","f3",o),c("n4","f4",o),c("p","n1",a),c("p","n2",a),c("p","n3",a),c("p","n4",a),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),t.setAttribute("position",new Fe(n,3)),t.setAttribute("color",new Fe(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;go.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let s=.8;Zo("n1",t,e,go,-1,-1,s),Zo("n2",t,e,go,1,-1,s),Zo("n3",t,e,go,-1,1,s),Zo("n4",t,e,go,1,1,s);let o=s;Zo("f1",t,e,go,-1,-1,o),Zo("f2",t,e,go,1,-1,o),Zo("f3",t,e,go,-1,1,o),Zo("f4",t,e,go,1,1,o),Zo("u1",t,e,go,.35,1.1,.8),Zo("u2",t,e,go,-.35,1.1,.8),Zo("u3",t,e,go,0,1.55,.8),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Zo(e,t,i,n,r,s,o){Hw.set(r,s,o).unproject(n);let a=t[e];if(void 0!==a){let l=i.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],Hw.x,Hw.y,Hw.z)}}var lI,oIe=class extends(Mv(sIe)){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Av(this.object,this.geometry,e,t,!0)}};(e=>{e.is=t=>"objectHelper"in t})(lI||(lI={}));var Dv=(e,t)=>class extends(uT(e)){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,n){this.objectHelper.raycast(i,n)}showGizmos(){for(let i in this.gizmos){let n=this.gizmos[i];n instanceof pb&&(n.visible=!0)}}updateEntityBoxSize(i,n){this.objectHelper.visible&&this.geometryHelper instanceof wa?(i.setScalar(0),n.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,n)}hideGizmos(){for(let i in this.gizmos){let n=this.gizmos[i];n instanceof pb&&(n.visible=!1)}}},gf=new M,cI=new M,uI=new ft,hI=new M,Tv=new M,dI=new M,xr=class extends(Dv(sp,oIe)){constructor(e="",t={...ev.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=Rp.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new ye,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,n=this.height;this.orthoCamera=new YM(-.5*i,.5*i,.5*n,-.5*n,-5e4,1e4),this.perspCamera=new yr(45,i/n,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){"number"==typeof e&&(e=new M(e,t,i)),super.lookAt(e),this.getWorldPosition(gf),this.targetOffset=gf.distanceTo(e)}getTarget(e=new M){return this.getWorldDirection(cI),this.getWorldPosition(gf),cI.multiplyScalar(this.targetOffset),e.copy(gf).add(cI),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(gf),gf.distanceTo(e)}updateUp(){this.getWorldQuaternion(uI),hI.set(0,0,1).applyQuaternion(uI),Tv.copy(pi.DEFAULT_UP),this.isUpVectorFlipped&&Tv.negate(),Tv.applyQuaternion(uI),dI.copy(pi.DEFAULT_UP).projectOnPlane(hI),this.angleOffsetFromUp=dI.angleTo(Tv),this.angleOffsetFromUp*=dI.cross(Tv).dot(hI)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new M),i=e.getWorldDirection(new M).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new M).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new M;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let n=e>t?this.aspect:1,r=e>t?1:this.aspect;this.left=-395*n,this.right=395*n,this.top=1/r*395,this.bottom=1/r*-395}else this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,n,r,s){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,i,n,r,s):this.orthoCamera.setViewOffset(e,t,i,n,r,s)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return KA(t,e)}updateCameraSubtype(e,t){let i="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(i,t.zoom),void 0!==t.near&&this.setNear(i,t.near),void 0!==t.fov&&"PerspectiveCamera"===i&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},vf=new ye,aIe=new ye,Ww=new ye,GW=new M,WW=new M;function qW(e){let t=!1;return e.scene.objects.traverse((i,n)=>{"BooleanGeometry"===n.geometry?.type&&(t=!0)}),t}var pI,yf=class extends ff{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Ze,this.onAfterRender=(n,r,s,o,a,l)=>{super.onAfterRender(n,r,s,o,a,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){if(-1!==this.booleanMeshSetAddress&&!e)return;for(let n=0;n<this.children.length;n++){let r=this.children[n];r instanceof yf&&!0===r.dataPatched.visible&&r.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let r=this.children[n];if(r instanceof gs&&!0===r.dataPatched.visible&&r.geometry.attributes.position?.count>0&&r.geometry.drawRange.count>0){if(vf.multiplyMatrices(r.hiddenMatrix,r.matrix),-1===r.booleanMeshSetAddress){if((r.geometry.index??r.geometry.getAttribute("position")).count/3<15e5&&(r.booleanMeshSetAddress=Nl.getMeshSet(r.geometry,!0===e,t)),-1===r.booleanMeshSetAddress)return;Nl.transformMeshSet(r.booleanMeshSetAddress,vf),r.booleanMatrixInvOld.copy(vf).invert(),r.booleanWasTransformed=!1}else r instanceof yf&&!0===r.needsTransformForDownstream?(Nl.transformMeshSet(r.booleanMeshSetAddress,vf),r.needsTransformForDownstream=!1):!0===r.booleanWasTransformed&&(Nl.transformMeshSet(r.booleanMeshSetAddress,aIe.multiplyMatrices(vf,r.booleanMatrixInvOld)),r.booleanMatrixInvOld.copy(vf).invert(),r.booleanWasTransformed=!1);!1===Nl.hasOpenEdges(r.booleanMeshSetAddress)||n===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(r.booleanMeshSetAddress),r.geometry.userData.wasFilteredFromBoolean=!1):r.geometry.userData.wasFilteredFromBoolean=!0}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new Fe([],0)),void this.geometry.setDrawRange(0,0);if(!0===e)return Nl.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Ze,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=Nl.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,nI(this),rI(this)}dispose(){super.dispose(),this.geometry.dispose()}get recursiveBBox(){let e=super.recursiveBBox;return-1===this.geometry.boundingSphere?.radius&&(e.getCenter(this.geometry.boundingSphere.center),Ww.copy(this.matrixWorld).invert(),this.geometry.boundingSphere.center.applyMatrix4(Ww),GW.copy(e.max).applyMatrix4(Ww),WW.copy(e.min).applyMatrix4(Ww),this.geometry.boundingSphere.radius=GW.distanceTo(WW)/2),e}};(e=>{e.is=function t(i){return zt.is(i)&&i instanceof Bg}})(pI||(pI={}));var fI=(e,t)=>class extends(Dv(e,t)){updateState_Light(i,n){this.updateState_Entity(i,n),void 0!==i.color&&(this.color=n.shared.color(i.color)),void 0!==i.intensity&&(this.intensity=i.intensity),void 0!==i.depth&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),void 0!==i.shadows&&(this.castShadow=i.shadows)}},Qo=e=>e instanceof gs,ja=e=>null!==e&&e instanceof yf,mI=e=>lI.is(e),qw=class extends(Mv(Vve)){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){Av(this.object,qw.geometryHelper,e,t)}update(){}},_f=class extends(Dv(dp,qw)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&1===Object.keys(e).length&&t.scene.reloadSplats()}},Iv="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Yw=class extends bi{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new _e(null),kernel16:new _e(null),inputBuffer:new _e(null),cocBuffer:new _e(null),texelSize:new _e(new z),scale:new _e(1)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;\n#if PASS == 1\nuniform vec4 kernel64[32];\n#else\nuniform vec4 kernel16[8];\n#endif\nvarying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\n#if PASS == 1\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;\n#else\nvec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;\n#endif\n}}",vertexShader:Iv}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let t=new Float32Array(128),i=new Float32Array(32),n=0,r=0;for(let a=0;a<80;++a){let l=2.39996323*a,c=Math.sqrt(a)/Math.sqrt(80),h=c*Math.cos(l),u=c*Math.sin(l);a%5==0?(i[r++]=h,i[r++]=u):(t[n++]=h,t[n++]=u)}let s=[],o=[];for(let a=0;a<128;)s.push(new St(t[a++],t[a++],t[a++],t[a++]));for(let a=0;a<32;)o.push(new St(i[a++],i[a++],i[a++],i[a++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=o}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function XW(e,t,i){return e*(t-i)-t}function gI(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var dIe=class extends bi{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new _e(null),focusDistance:new _e(0),focusRange:new _e(0),cameraNear:new _e(.3),cameraFar:new _e(1e3)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",vertexShader:Iv}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=_l){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-XW(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=gI(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-XW(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=gI(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof yr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},ZW=class extends bi{constructor(e=new z){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new _e(null),texelSize:new _e(new z),halfTexelSize:new _e(new z),kernel:new _e(0),scale:new _e(1)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},gIe=class extends bi{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new _e(null),opacity:new _e(1)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",vertexShader:Iv}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},bIe=class extends bi{constructor(e=new z,t=2){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:zd.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new _e(null),depthBuffer:new _e(null),predicationBuffer:new _e(null),texelSize:new _e(e)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=_l){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*e).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ko={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},vI=class extends bi{constructor(e,t,i,n,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:zd.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new _e(null),depthBuffer:new _e(null),resolution:new _e(new z),texelSize:new _e(new z),cameraNear:new _e(.3),cameraFar:new _e(1e3),aspect:new _e(1),time:new _e(0)},blending:bn,depthWrite:!1,depthTest:!1,dithering:r}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=_l){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(Ko.FRAGMENT_HEAD,e.get(Ko.FRAGMENT_HEAD)).replace(Ko.FRAGMENT_MAIN_UV,e.get(Ko.FRAGMENT_MAIN_UV)).replace(Ko.FRAGMENT_MAIN_IMAGE,e.get(Ko.FRAGMENT_MAIN_IMAGE)),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(Ko.VERTEX_HEAD,e.get(Ko.VERTEX_HEAD)).replace(Ko.VERTEX_MAIN_SUPPORT,e.get(Ko.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof yr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Ko}},CIe=class extends bi{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:zd.replace(/\D+/g,"")},uniforms:{inputBuffer:new _e(null),threshold:new _e(0),smoothing:new _e(1),range:new _e(null)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:Iv}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},MIe=class extends bi{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new _e(e),inputBuffer:new _e(null),strength:new _e(1)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",vertexShader:Iv}),this.toneMapped=!1,this.setColorChannel(0),this.setMaskFunction(0)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==mr&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return void 0!==this.defines.INVERTED}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},TIe=class extends bi{constructor(e=new z,t=new z){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new _e(null),searchTexture:new _e(null),areaTexture:new _e(null),resolution:new _e(t),texelSize:new _e(e)},blending:bn,depthWrite:!1,depthTest:!1,fragmentShader:"#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",vertexShader:"uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},IIe=new sp,Yc=null,ts=class{constructor(e="Pass",t=new wc,i=IIe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();null!==t&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;null!==t?t.material=e:(t=new jr(function PIe(){if(null===Yc){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(Yc=new Ze).setAttribute?(Yc.setAttribute("position",new st(e,3)),Yc.setAttribute("uv",new st(t,2))):(Yc.addAttribute("position",new st(e,3)),Yc.addAttribute("uv",new st(t,2)))}return Yc}(),e),t.frustumCulled=!1,null===this.scene&&(this.scene=new wc),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=_l){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"function"==typeof t.dispose){if(t instanceof wc||t===this.renderer)continue;this[e].dispose()}}}},yI=class extends ts{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new gIe,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new di(1,1,{minFilter:It,magFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTarget.texture.type=i,i!==mr?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===xt&&(this.renderTarget.texture.encoding=xt))}},RIe=class extends ts{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,r){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},_I=new Je,bI=class extends ts{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,n,r){let s=this.overrideClearColor,o=this.overrideClearAlpha,a=e.getClearAlpha(),l=null!==s,c=o>=0;l?(_I.copy(e.getClearColor(_I)),e.setClearColor(s,c?o:a)):c&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(_I,a):c&&e.setClearAlpha(a)}},Ss=class extends sr{constructor(e,t=-1,i=-1,n=1){super(),this.resizable=e,this.base=new z(1,1),this.preferred=new z(t,i),this.target=this.preferred,this.s=n}get width(){let n,{base:e,preferred:t,scale:i}=this;return n=-1!==t.width?t.width:-1!==t.height?Math.round(t.height*(e.width/Math.max(e.height,1))):Math.round(e.width*i),n}set width(e){this.preferredWidth=e}get height(){let n,{base:e,preferred:t,scale:i}=this;return n=-1!==t.height?t.height:-1!==t.width?Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):Math.round(e.height*i),n}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(-1),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return-1}},wI=!1,KW=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case hs:i=this.materialsFlatShadedDoubleSide;break;case qn:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded}else switch(t.material.side){case hs:i=this.materialsDoubleSide;break;case qn:i=this.materialsBackSide;break;default:i=this.materials}this.originalMaterials.set(t,t.material),t.material=t.isSkinnedMesh?i[2]:t.isInstancedMesh?i[1]:i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=No;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=qn,n}),this.materialsDoubleSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.side=hs,n}),this.materialsFlatShaded=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=qn,n}),this.materialsFlatShadedDoubleSide=t.map(i=>{let n=i.clone();return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=hs,n})}}render(e,t,i){let n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,wI){let r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of r)s[0].material=s[1];this.meshCount!==r.size&&r.clear()}else{let r=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=r}e.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return wI}static set workaroundEnabled(e){wI=e}},OIe=class extends ts{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new bI,this.overrideMaterialManager=null===i?null:new KW(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new KW(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,r){let s=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=s.background,h=e.shadowMap.autoUpdate,u=this.renderToScreen?null:t;null!==a&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(u),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,s,o):e.render(s,o),o.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=h}},$W=class extends ts{constructor(e,t,{resolutionScale:i=1,width:n=Ss.AUTO_SIZE,height:r=Ss.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new OIe(e,t,new Cj({depthPacking:IU}));let o=this.renderPass;o.skipShadowMapUpdate=!0,o.ignoreBackground=!0;let a=o.getClearPass();a.overrideClearColor=new Je(16777215),a.overrideClearAlpha=1,this.renderTarget=s,void 0===this.renderTarget&&(this.renderTarget=new di(1,1,{minFilter:Ei,magFilter:Ei,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Ss(this,n,r,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){this.renderPass.render(e,this.renderToScreen?null:this.renderTarget)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},jt=(new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]),{SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18}),$Ie=new Map([[jt.SKIP,null],[jt.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[jt.ALPHA,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[jt.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[jt.COLOR_BURN,"float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[jt.COLOR_DODGE,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[jt.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[jt.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[jt.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[jt.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[jt.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[jt.DIVIDE,"float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[jt.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[jt.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[jt.OVERLAY,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[jt.REFLECT,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[jt.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[jt.SOFT_LIGHT,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[jt.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]),JIe=class extends sr{constructor(e,t=1){super(),this.f=e,this.opacity=new _e(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return $Ie.get(this.blendFunction)}},Ga=class extends sr{constructor(e,t,{attributes:i=0,blendFunction:n=jt.SCREEN,defines:r=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=a,this.defines=r,this.uniforms=s,this.extensions=o,this.blendMode=new JIe(n),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=_l){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"function"==typeof t.dispose){if(t instanceof wc||t===this.renderer)continue;this[e].dispose()}}}};function JW(e,t,i){for(let n of t){let r="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),s=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(let o of i.entries())null!==o[1]&&i.set(o[0],o[1].replace(s,r))}}function e2e(e,t,i,n,r,s,o){let a=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=void 0!==a.get("fragment")&&/mainImage/.test(a.get("fragment")),c=void 0!==a.get("fragment")&&/mainUv/.test(a.get("fragment")),h=[],u=[],d=!1,p=!1;if(void 0===a.get("fragment"))console.error("Missing fragment shader",t);else if(c&&2&o)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(l||c){let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=vI.Section;if(c){let v=`\t${e}MainUv(UV);\n`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+v),d=!0}if(null!==a.get("vertex")&&/mainSupport/.test(a.get("vertex"))){let v=`\t${e}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(a.get("vertex"))?"vUv);\n":");\n",i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+v),h=h.concat([...a.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),u=u.concat(h).concat([...a.get("vertex").matchAll(f)].map(y=>y[1]))}u=u.concat([...a.get("fragment").matchAll(f)].map(v=>v[1])),u=u.concat([...t.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),u=u.concat([...t.uniforms.keys()]),t.uniforms.forEach((v,y)=>s.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),t.defines.forEach((v,y)=>r.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),JW(e,u,r),JW(e,u,a);let g=t.blendMode;if(n.set(g.blendFunction,g),l){let y=`${e}MainImage(color0, UV, `;1&o&&/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/.test(a.get("fragment"))&&(y+="depth, ",p=!0),y+="color1);\n\t";let _=e+"BlendOpacity";s.set(_,g.opacity),y+=`color0 = blend${g.blendFunction}(color0, color1, ${_});\n\n\t`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${_};\n\n`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+y)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+a.get("fragment")+"\n"),null!==a.get("vertex")&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+a.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);return{varyings:h,transformedUv:d,readDepth:p}}var Zw=class extends ts{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new vI(null,null,null,e),this.effects=t.sort((i,n)=>n.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=vI.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,n=new Map,r=new Map,s=new Set,o=0,a=0,l=0,c=!1,h=!1;for(let d of this.effects)if(d.blendMode.blendFunction===jt.SKIP)l|=1&d.getAttributes();else if(l&d.getAttributes()&2)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let f=e2e("e"+o++,d,t,i,n,r,l);if(a+=f.varyings.length,c=c||f.transformedUv,h=h||f.readDepth,null!==d.extensions)for(let m of d.extensions)s.add(m)}let u=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(u,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+"\n")}1&l?(h&&t.set(e.FRAGMENT_MAIN_IMAGE,"float depth = readDepth(UV);\n\n\t"+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,"vec2 transformedUv = vUv;\n"+t.get(e.FRAGMENT_MAIN_UV)),n.set("UV","transformedUv")):n.set("UV","vUv"),t.forEach((d,p,f)=>f.set(p,d.trim().replace(/^#/,"\n#"))),this.uniformCount=r.size,this.varyingCount=a,this.skipRendering=0===o,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(r).setDefines(n)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=_l){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,n,r){for(let s of this.effects)s.update(e,t,n);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=n,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let n of this.effects)n.initialize(e,t,i),n.addEventListener("change",r=>this.handleEvent(r));this.updateMaterial(),this.verifyResources(),void 0!==i&&i!==mr&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){"change"===e.type&&this.recompile()}},t2e=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],e8=class extends ts{constructor({resolutionScale:e=.5,width:t=Ss.AUTO_SIZE,height:i=Ss.AUTO_SIZE,kernelSize:n=SI.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new di(1,1,{minFilter:It,magFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new Ss(this,t,i,e);r.addEventListener("change",s=>this.setSize(r.baseWidth,r.baseHeight)),this.blurMaterial=new ZW,this.ditheredBlurMaterial=new ZW,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=n}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let d,p,s=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=t2e[this.kernelSize],h=this.blurMaterial,u=t;for(this.fullscreenMaterial=h,d=0,p=c.length-1;d<p;++d){let f=1&d?l:a;h.kernel=c[d],h.inputBuffer=u.texture,e.setRenderTarget(f),e.render(s,o),u=f}this.dithering&&(h=this.ditheredBlurMaterial,this.fullscreenMaterial=h),h.kernel=c[d],h.inputBuffer=u.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,o)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(n,r),this.ditheredBlurMaterial.setSize(n,r)}initialize(e,t,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==mr?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===xt&&(this.renderTargetA.texture.encoding=xt,this.renderTargetB.texture.encoding=xt))}static get AUTO_SIZE(){return Ss.AUTO_SIZE}},i2e=class extends ts{constructor({width:e=Ss.AUTO_SIZE,height:t=Ss.AUTO_SIZE,renderTarget:i,luminanceRange:n,colorOutput:r}={}){super("LuminancePass"),this.fullscreenMaterial=new CIe(r,n),this.needsSwap=!1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new di(1,1,{minFilter:It,magFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Ss(this,e,t);s.addEventListener("change",o=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){void 0!==i&&i!==mr&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},n2e=class extends ts{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new bI(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,r){let s=e.getContext(),o=e.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,h,4294967295),o.stencil.setClear(u),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(a,l)):(e.setRenderTarget(t),e.render(a,l),e.setRenderTarget(i),e.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},Wa=class extends ts{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){let t=this.fullscreenMaterial.uniforms;void 0!==t&&void 0!==t[e]&&(this.inputBufferUniform=t[e])}}render(e,t,i,n,r){null!==this.inputBufferUniform&&null!==t&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){void 0!==i&&i!==mr&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},SI={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},a2e=class extends Ga{constructor({blendFunction:e=jt.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:n=.5,intensity:r=1,width:s=Ss.AUTO_SIZE,height:o=Ss.AUTO_SIZE,kernelSize:a=SI.LARGE}={}){super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",{blendFunction:e,uniforms:new Map([["map",new _e(null)],["intensity",new _e(r)]])}),this.renderTarget=new di(1,1,{minFilter:It,magFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new i2e({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new e8({resolutionScale:n,width:s,height:o,kernelSize:a});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let n=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,n),this.blurPass.render(e,n,n)):this.blurPass.render(e,t,n)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),void 0!==i&&(this.renderTarget.texture.type=i,e.outputEncoding===xt&&(this.renderTarget.texture.encoding=xt))}},c2e=class extends Ga{constructor({blendFunction:e=jt.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect","uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["brightness",new _e(t)],["contrast",new _e(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},h2e=class extends Ga{constructor(e=jt.NORMAL){super("ColorAverageEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",{blendFunction:e})}},f2e=class extends Ga{constructor({blendFunction:e=jt.NORMAL,offset:t=new z(.001,5e-4)}={}){super("ChromaticAberrationEffect","varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",blendFunction:e,attributes:2,uniforms:new Map([["offset",new _e(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},g2e=class extends Ga{constructor(e,{blendFunction:t=jt.NORMAL,worldFocusDistance:i,worldFocusRange:n,focusDistance:r=0,focalLength:s=.1,focusRange:o=s,bokehScale:a=1,width:l=Ss.AUTO_SIZE,height:c=Ss.AUTO_SIZE}={}){super("DepthOfFieldEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",{blendFunction:t,attributes:1,uniforms:new Map([["nearColorBuffer",new _e(null)],["farColorBuffer",new _e(null)],["nearCoCBuffer",new _e(null)],["scale",new _e(1)]])}),this.camera=e,this.renderTarget=new di(1,1,{minFilter:It,magFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Wa(new dIe(e));let h=this.cocMaterial;h.focusDistance=r,h.focusRange=o,void 0!==i&&(h.worldFocusDistance=i),void 0!==n&&(h.worldFocusRange=n),this.blurPass=new e8({kernelSize:SI.MEDIUM,width:l,height:c});let u=this.blurPass.getResolution();u.addEventListener("change",p=>this.setSize(u.getBaseWidth(),u.getBaseHeight())),this.maskPass=new Wa(new MIe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=1,d.colorChannel=1,this.bokehNearBasePass=new Wa(new Yw(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Wa(new Yw(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Wa(new Yw(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Wa(new Yw(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=a}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera;return gI(-t.position.distanceTo(e),t.near,t.far)}setDepthTexture(e,t=_l){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let n=this.renderTarget,r=this.renderTargetCoC,s=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(null!==this.target){let a=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=a}this.cocPass.render(e,null,r),this.blurPass.render(e,r,s),this.maskPass.render(e,t,o),this.bokehFarBasePass.render(e,o,n),this.bokehFarFillPass.render(e,n,this.renderTargetFar),this.bokehNearBasePass.render(e,t,n),this.bokehNearFillPass.render(e,n,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(o=>o.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(o=>o.setSize(n,r)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(o=>o.fullscreenMaterial.setSize(n,r))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(n=>n.initialize(e,t,i)),this.blurPass.initialize(e,t,mr),void 0!==i&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===xt&&(this.renderTarget.texture.encoding=xt,this.renderTargetNear.texture.encoding=xt,this.renderTargetFar.texture.encoding=xt,this.renderTargetMasked.texture.encoding=xt))}},y2e=(new M,new ye,class extends Ga{constructor({blendFunction:e=jt.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect","uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["hue",new _e(new M)],["saturation",new _e(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}}),b2e=(new Je,class extends Ga{constructor({blendFunction:e=jt.SCREEN,premultiply:t=!1}={}){super("NoiseEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}}),x2e=class extends Ga{constructor(e=30){super("PixelationEffect","uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",{uniforms:new Map([["active",new _e(!1)],["d",new _e(new z)]])}),this.resolution=new z,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}},t8=(Math,new M,new M,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC"),i8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",n8=class extends Ga{constructor({preset:e=1,edgeDetectionMode:t=2,predicationMode:i=0}={}){let n,r;super("SMAAEffect","uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",{vertexShader:"varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",blendFunction:jt.NORMAL,attributes:3,uniforms:new Map([["weightMap",new _e(null)]])}),arguments.length>1&&(n=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new di(1,1,{minFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new bI(!0,!1,!1),this.clearPass.overrideClearColor=new Je(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Wa(new bIe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Wa(new TIe);let s=new i4;s.onLoad=()=>{let o=new kn(n);o.name="SMAA.Search",o.magFilter=Ei,o.minFilter=Ei,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!0,this.weightsMaterial.searchTexture=o;let a=new kn(r);a.name="SMAA.Area",a.magFilter=It,a.minFilter=It,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!1,this.weightsMaterial.areaTexture=a,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),void 0!==n&&void 0!==r?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(n=new Image,r=new Image,n.addEventListener("load",()=>s.itemEnd("search")),r.addEventListener("load",()=>s.itemEnd("area")),n.src=t8,r.src=i8),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case 0:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case 1:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case 2:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case 3:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0}}setDepthTexture(e,t=_l){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;null!==e&&null!==t&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return t8}static get areaImageDataURL(){return i8}},M2e=class extends Ga{constructor({blendFunction:e=jt.NORMAL,technique:t=0,eskil:i=!1,offset:n=.5,darkness:r=.5}={}){super("VignetteEffect","uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new _e(n)],["darkness",new _e(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return 1===this.technique}set eskil(e){this.technique=e?1:0}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}};function CI(e,t,i){return e+(t-e)*i}function Sr(e,t,i,n){let r=CI(e,t,.75),s=CI(i,n,.75);return CI(r,s,.875)}new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),Sr(0,0,0,0),new Float32Array([0,0,0,0]),Sr(0,0,0,1),new Float32Array([0,0,0,1]),Sr(0,0,1,0),new Float32Array([0,0,1,0]),Sr(0,0,1,1),new Float32Array([0,0,1,1]),Sr(0,1,0,0),new Float32Array([0,1,0,0]),Sr(0,1,0,1),new Float32Array([0,1,0,1]),Sr(0,1,1,0),new Float32Array([0,1,1,0]),Sr(0,1,1,1),new Float32Array([0,1,1,1]),Sr(1,0,0,0),new Float32Array([1,0,0,0]),Sr(1,0,0,1),new Float32Array([1,0,0,1]),Sr(1,0,1,0),new Float32Array([1,0,1,0]),Sr(1,0,1,1),new Float32Array([1,0,1,1]),Sr(1,1,0,0),new Float32Array([1,1,0,0]),Sr(1,1,0,1),new Float32Array([1,1,0,1]),Sr(1,1,1,0),new Float32Array([1,1,1,0]),Sr(1,1,1,1),new Float32Array([1,1,1,1]);var jl=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=jt.NORMAL}},A2e=class extends jl{constructor(){super(a2e),this.blendFunction=jt.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},D2e=class extends jl{constructor(){super(c2e)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},T2e=class extends jl{constructor(){super(f2e),this.effect.offset=new z(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]}},I2e=class extends jl{constructor(){super(h2e)}},P2e=class extends jl{constructor(){super(y2e),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},R2e=class extends jl{constructor(){super(b2e),this.blendFunction=jt.OVERLAY}},O2e=class extends jl{constructor(){super(M2e)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},L2e=class extends jl{constructor(e){super(g2e,e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=e}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}},N2e=class extends jl{constructor(){super(x2e)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},EI=class extends bi{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new _e(null)},blending:bn,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}",fragmentShader:"#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},z2e=class extends ts{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new EI,this.resolutionVector=new z,this.resolveMaterial=new bi({name:"TAAResolveMaterial",uniforms:{inputBuffer:new _e(null),historyBuffer:new _e(null),velocityBuffer:new _e(null),depthBuffer:new _e(null),resolution:new _e(new z)},blending:bn,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}"}),this.historyRenderTarget=new di(1024,1024,{minFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new di(1024,1024,{minFilter:It,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},U2e=class extends ts{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new $W(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new EI,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new EI,this.depthPass=new $W(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let n=this.camera.layers.mask,r=e;r.setRenderTarget(r.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],r.clear(),r.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),r.shadowMap.needsUpdate=!1,r.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=n}},r8=new wc,j2e=new bi({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "}),MI=class extends ts{constructor(e,t,i){super("OpaquePass",t??r8,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}set splatViewer(e){this._splatViewer=e}get splatViewer(){return this._splatViewer}setCamera(e){this.camera=e}setScene(e){this.scene=e??r8}getScene(){return this.scene}render(e,t){if(this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(n=>{n.layers.isEnabled(3)&&n instanceof gs&&(this.originalMaterials.set(n.id,n.material),n.material=j2e)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8),e.setRenderTarget(this.renderToScreen?null:t),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),!0===this._splatViewer?.splatRenderingInitialized){let n=e.autoClear;e.autoClear=!1,e.render(this.scene,this.camera),this._splatViewer.update(),e.render(this._splatViewer.splatMesh,this.camera),e.autoClear=n}else e.render(this.scene,this.camera);this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((n,r)=>{let s=this.scene.getObjectById(r);s&&(s.material=n)})}},G2e=new bi({name:"CombineMaterial",uniforms:{inputBufferA:new _e(null),inputBufferB:new _e(null)},blending:bn,depthWrite:!1,depthTest:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"}),W2e=class extends ts{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=G2e,this.helperPass=new MI(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new MI(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new n8({preset:0,edgeDetectionMode:2});this.effectPass=new Zw(this.camera,t),this.rt=new di(10,10,{minFilter:It,magFilter:It,wrapS:on,wrapT:on,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let n=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(n),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},Pv=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],$2e=new bi({vertexShader:"#define GLSLIFY 1\n#include <skinning_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}",fragmentShader:"#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}"}),Kw=new bi({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}",uniforms:{texture_ao_lrez:new _e(null),texture_depth_lrez:new _e(null),texture_depth_hrez:new _e(null),near:new _e(null),far:new _e(null)}}),J2e=class extends ts{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,n=1024;this.gBuffer=new di(i,n,{type:zr,depthTexture:new pp(i,n),minFilter:It,magFilter:It}),this.depthBufferHighRes=new di(i,n,{depthTexture:new pp(i,n)}),this.aoBuffer=new di(i,n,{minFilter:It,magFilter:It}),this.splineScene=e,this.splineCamera=t;let r=new Float32Array(2*Pv.length);for(let o=0;o<Pv.length;o++){let a=2*o;r[a+0]=Pv[o][0],r[a+1]=Pv[o][1]}this.blueNoiseInDiskTexture=new xc(r,Pv.length,1,__,zr),this.blueNoiseInDiskTexture.wrapS=vl,this.blueNoiseInDiskTexture.wrapT=vl,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new bi({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}",uniforms:{near:new _e(null),far:new _e(null),fov:new _e(null),proj_info:new _e(new St),is_ortho:new _e(!1),resolution:new _e(new z),radius_of_influence:new _e(8),radius_in_screen_space:new _e(1),exponent:new _e(1),ao_color:new _e(new M),bias:new _e(.5),texture_depth:new _e(null),texture_normals:new _e(null),texture_blue_noise:new _e(null),texture_blue_noise_in_disk:new _e(this.blueNoiseInDiskTexture),frame_index:new _e(0),fog_enabled:new _e(!1),fog_near:new _e(1),fog_far:new _e(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new di(i,n,{minFilter:It,magFilter:It,wrapS:on,wrapT:on,depthBuffer:!1,type:zr});let s=new n8({preset:3,edgeDetectionMode:2});this.effectPass=new Zw(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,n=e*i,r=t*i;this.gBuffer.setSize(n,r),this.aoBuffer.setSize(n,r),this.hbaoMaterial.uniforms.resolution.value.set(n,r),this.aaBuffer.setSize(n,r),this.effectPass.setSize(n,r)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}render(e,t,i){this.splineScene.overrideMaterial=$2e;let n=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=n,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let r=this.splineCamera.perspCamera.projectionMatrix.elements;this.hbaoMaterial.uniforms.proj_info.value.set(2/r[0],2/r[5],-(1-r[8])/r[0],-(1+r[9])/r[5]);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),h=this.hbaoMaterial.uniforms.resolution.value.y/(2*Math.tan(.5*c));this.hbaoMaterial.uniforms.radius_in_screen_space.value=.5*this.hbaoMaterial.uniforms.radius_of_influence.value*h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let r=this.splineCamera.orthoCamera.projectionMatrix.elements,o=2/r[5];this.hbaoMaterial.uniforms.proj_info.value.set(2/r[0],o,-(1+r[12])/r[0],-(1-r[13])/r[5]),this.hbaoMaterial.uniforms.radius_in_screen_space.value=this.hbaoMaterial.uniforms.radius_of_influence.value*(this.hbaoMaterial.uniforms.resolution.value.y/o*.5),this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Kw,Kw.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Kw.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Kw.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},iPe=class extends Wa{constructor(){super(new bi({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",uniforms:{tInput:new _e(null),tMap:new _e(null),uResolution:new _e(new z),uSize:new _e(new z),uCoords:new _e(new z),uScale:new _e(1),uSceneColor:new _e(new Je(16711680)),uDPR:new _e(1),uCurrent:new _e(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},sPe=[],oPe=class extends Wa{constructor(){super(new bi({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",uniforms:{toScene:new _e(null),fromScene:new _e(null),uResolution:new _e(new z),uDPR:new _e(1),mixRatio:new _e(0),threshold:new _e(.1),useTexture:new _e(0),tMixTexture:{value:sPe[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}};function s8(e,t){return t&&t.enabled&&e.push(t.effect),e}var aPe=e=>Object.values(jt).includes(e)?e:jt.NORMAL,lPe=class extends sr{constructor(e){super(),this.postprocessingState=iw.defaultData,this._scene=new wc,this._camera=new xr,this.effects=new Map,this.blueNoiseTexture=new xc,this._renderToScreen=!0,this.clock=new class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=l4(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=l4();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}},this.renderer=e,this.debug=!1,this.effects.set("bloom",new A2e),this.effects.set("chromaticAberration",new T2e),this.effects.set("vignette",new O2e),this.effects.set("noise",new R2e),this.effects.set("colorAverage",new I2e),this.effects.set("hueSaturation",new P2e),this.effects.set("brightnessContrast",new D2e),this.effects.set("depthOfField",new L2e),this.effects.set("pixelation",new N2e),this.effectComposer=new class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new yI,this.depthTexture=null,this.timer=new class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return.001*this.delta}getFixedDelta(){return.001*this.fixedDelta}setFixedDelta(e){return this.fixedDelta=1e3*e,this}getElapsed(){return.001*this.elapsed}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==e?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,r,n,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,r,n,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,r,n,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){let t=e.getSize(new z),i=e.getContext().getContextAttributes()?.alpha??!1,n=this.inputBuffer.texture[0].type;n===mr&&e.outputEncoding===xt&&(this.inputBuffer.texture[0].encoding=xt,this.outputBuffer.texture[0].encoding=xt,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(t.width,t.height,!1);for(let r of this.passes)r.initialize(e,i,n)}}replaceRenderer(e,t=!0){let i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&null!==n&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new pp(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ju,e.type=zu):e.type=yl,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n,r,s){let c,o=this.renderer,a=null===o?new z:o.getDrawingBufferSize(new z),l={minFilter:It,magFilter:It,wrapS:on,wrapT:on,stencilBuffer:t,depthBuffer:e};return n>0?(c=new di(a.width,a.height,l),c.samples=n):(r?(c=new Nhe(a.width,a.height,2,l),c.texture[1].type=Vu):c=new di(a.width,a.height,l),c.depthTexture=new pp(2048,2048),c.depthTexture.type=zr),i===mr&&null!==o&&o.outputEncoding===xt&&(Array.isArray(c.texture)?c.texture.forEach(h=>h.encoding=xt):c.texture.encoding=xt),Array.isArray(c.texture)?c.texture.forEach((h,u)=>{h.name=`EffectComposer.Buffer ${r} ${u}`,h.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${r}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){let o,i=this.passes,n=this.renderer,r=n.getDrawingBufferSize(new z),s=n.getContext().getContextAttributes()?.alpha??!1;if(e.MRTCompatible&&(o=this.inputBuffer.texture[0].type),e.MRTCompatible||(o=this.inputBuffer.texture.type),e.setRenderer(n),e.setSize(r.width,r.height),e.initialize(n,s,o),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){let a=this.createDepthTexture();for(e of i)e.setDepthTexture(a)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);-1!==i&&t.splice(i,1).length>0&&(null!==this.depthTexture&&(t.reduce((r,s)=>r||s.needsDepthTexture,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())),this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0)))}removeAllPasses(){let e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let l,c,h,u,t=this.renderer,i=this.copyPass,n=this.inputBuffer,r=this.outputBuffer,s=this.inputBufferSingle,o=this.outputBufferSingle,a=!1;void 0===e&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,n,r,e,a):d.render(t,s,o,e,a),d.needsSwap&&(a&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,n,r,e,a),c.setFunc(l.EQUAL,1,4294967295)),h=n,u=s,n=r,s=o,r=h,o=u),d instanceof n2e?a=!0:d instanceof RIe&&(a=!1))}setSize(e,t,i){let n=this.renderer;if(this._width=e,this._height=t,void 0===e||void 0===t){let s=n.getSize(new z);e=s.width,t=s.height}n.setSize(e,t,i);let r=n.getDrawingBufferSize(new z);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height),this.inputBufferSingle.setSize(r.width,r.height),this.outputBufferSingle.setSize(r.width,r.height);for(let s of this.passes)s.setSize(r.width,r.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),null!==this.inputBufferSingle&&this.inputBufferSingle.dispose(),null!==this.outputBufferSingle&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}}(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new MI(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new U2e(this.scene,this.camera,this.renderer),this.aoPass=new J2e(this.scene,this.camera),this.taaPass=new z2e,this.taaPass.renderToScreen=!1,this.helperPass=new W2e(this.camera),this.helperPass.renderToScreen=!1,this.overlayPass=new iPe,this.overlayPass.enabled=!1,this.sceneTransitionPass=new oPe,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){void 0!==e?(this.overlayPass.texture=e,this.overlayPass.enabled=!0):this.overlayPass.enabled=!1}get overlayTexture(){return this.overlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),this.aoPass.setCamera(e),this.helperPass.setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];!0!==i.enabled||e||!this._renderToScreen?i.renderToScreen=!1:(i.renderToScreen=!0,e=!0)}}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new xc(e,128,128),this.blueNoiseTexture.wrapS=vl,this.blueNoiseTexture.wrapT=vl,this.blueNoiseTexture.minFilter=Ei,this.blueNoiseTexture.magFilter=Ei,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,n,r,s,o,a){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=n,this.aoPass.fogEnabled=r,this.aoPass.fogNear=s,this.aoPass.fogFar=o,this.aoPass.runHalfRes!==!a&&(this.aoPass.runHalfRes=!a)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let e=[this.effects.get("pixelation")].reduce(s8,[]);e.length>0&&(this.uvEffectPass=new Zw(this.camera,...e),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let t=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(s8,[]);t.length>0&&(this.effectPass=new Zw(this.camera,...t),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.overlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new z;this.renderer.getDrawingBufferSize(e),this._rt=new di(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:vl,wrapT:vl}),this._rt.samples=0,this._savePass=new yI(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new yI(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(!0===e?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(null!==e?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,n=!1;t!==this.postprocessingState.enabled&&(n=!0);for(let r of Object.entries(i)){let s=r[1],o=this.effects.get(r[0]);if(o){o.enabled!==s.enabled&&(n=!0),o.enabled=s.enabled;for(let[a,l]of Object.entries(s))"blendFunction"===a?o.blendFunction=aPe(l):o[a]=l}}this.postprocessingState=e,n&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,n){e instanceof St?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,n),this.effectComposer.outputBuffer.scissor.set(e,t,i,n));let r=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(r),this.effectComposer.outputBuffer.scissor.multiplyScalar(r),this.renderer.setScissor(e,t,i,n)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,n){e instanceof St?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,n),this.effectComposer.outputBuffer.viewport.set(e,t,i,n))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let n=this.renderer.getPixelRatio();this._rt.setSize(e*n,t*n)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},uPe=Mt.lights_fragment_begin,hPe=Mt.shadowmask_pars_fragment,o8=null,AI=new bi({vertexShader:"\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n\nvoid main()\n{\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n}\n",fragmentShader:"\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",uniforms:{depthContrast:{value:1}}}),a8=new kn,gPe=class extends Ej{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new z,this.pipeline=new lPe(this),this.dummyCamera=new xr,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(r=!0,s=!0,o=!0)=>{let a=this.getContext(),l=0;r&&(l|=a.COLOR_BUFFER_BIT),s&&(l|=a.DEPTH_BUFFER_BIT),o&&(l|=a.STENCIL_BUFFER_BIT),a.clear(l),a.clearBufferfv(a.COLOR,1,[0,0,0,1])},this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=sM,this.dummyCamera.matrixAutoUpdate=!1;let n=this.getContext();if(n&&"drawingBufferColorSpace"in n)try{n.drawingBufferColorSpace="display-p3"}catch(r){console.warn(r)}this.setPixelRatio=r=>{this._pixelRatio!==r&&(this._pixelRatio=r,t(r))},this.setSize=(r,s,o=!0)=>{(this.viewportWidth!==r||this.viewportHeight!==s)&&(this.viewportWidth=r,this.viewportHeight=s,i(r,s,o),this.normalRenderTarget?.setSize(r*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(r,s),this.transmissionDepthTarget?.setSize(r*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(r,s,o))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){void 0===this.aoRenderTarget&&(this.aoRenderTarget=new di(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:It,magFilter:It,wrapS:on,wrapT:on,depthBuffer:!1}))}_resizeTransmission(e,t){this.transmissionRenderTarget?.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return 1===it.transmissionLod.value}set hdTransmission(e){it.transmissionLod.value=!0===e?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new di(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:jd,magFilter:It,wrapS:on,wrapT:on,depthBuffer:!1}),this.transmissionDepthTarget=new di(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Ei,magFilter:Ei,depthBuffer:!1}))}createNormalRenderTarget(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new di(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Ei,magFilter:Ei,type:zr,depthTexture:new pp(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(n=>{n.layers.isEnabled(8)&&(n.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),AI.uniforms.depthContrast.value=i instanceof xr?(i.far-i.near)/1e4:1,t.overrideMaterial=AI,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?VI:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(n=>{n.layers.isEnabled(8)&&(n.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let n=t.height,r=t.width,s=this.viewportWidth/this.viewportHeight;r<n?r=n*s:n=r/s,this.dummyCamera.setViewplaneSize(r,n);for(let o=0;o<i;o++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i,sceneHelpersOnTop:n,overrideTransmission:r,overrideNormal:s}={}){let o=e instanceof zI?e.activePage:e,a=o.visible;o.visible=!0;let l=o.scene;this.xr.enabled&&(!1===this.isXRCopyPassSet&&null!==this.getRenderTarget()&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(o.bgColor,o.bgColor.a),o.penumbraSizeArray.forEach((d,p)=>{it.penumbraSize.value[p]=d}),it.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?it.resolution.value.set(this.resolution.x,this.resolution.y):it.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==s?(it.normalRenderTarget.value=s,it.normalRenderTargetDepth.value=a8):l.needsNormal()&&(this.createNormalRenderTarget(),it.normalRenderTarget.value=this.normalRenderTarget.texture,it.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,o,t));let c=o.data.ao,h=c.occlusion;h&&(this.createAORenderTarget(),it.aoRenderTarget.value=this.aoRenderTarget.texture),it.aoEnabled.value=h,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,o.aoColor,null!==o.fog,o.backupFog.near,o.backupFog.far,c.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture);let u=!1;if(void 0!==r)it.transmissionRenderTarget.value=r,it.transmissionRenderTargetDepth.value=a8,this.pipeline.setTransmissionPassEnabled(!1);else{let d=l.needsTransmission();d&&(void 0===this.transmissionRenderTarget&&(u=!0),this.createTransmissionRenderTarget(),it.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,it.aspectRatio.value=function ADe(e,t){return e>=t?new z(t/e,1):new z(1,e/t)}(this.viewportWidth,this.viewportHeight),it.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(d)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=n,this.pipeline.scene=o,this.pipeline.camera=t,u&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==o.postprocessing&&(this.pipeline.updatePostprocessing(o.postprocessing),!i&&!n&&this.pipeline.disableHelpers()),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),o.overrideMaterial=l.wireframeState?VI:null,this.pipeline.render(),it.frameIndex.value=(it.frameIndex.value+1)%16,t instanceof xr&&t.copyHistory(),o.visible=a}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let n=this.pipeline.sceneTransitionPass.uniforms;n.uDPR.value=window.devicePixelRatio,n.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},l8=class extends(Mv(Bve)){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Av(this.object,l8.geometryHelper,e,t)}},c8=class extends(Mv(Fve)){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Av(this.object,c8.geometryHelper,e,t)}},DI=class extends(Mv(kve)){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Av(this.object,DI.geometryHelper,e,t)}update(){if(void 0!==this.object){let e=DI._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let n=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let r=0,s=this.cone.material.length;r<s;r++)this.cone.material[r].color.set(n);else this.cone.material.color.set(n)}}},u8=DI;u8._vector=new M;var h8=class extends(fI(wve,l8)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.top=1250,n.bottom=-1250,n.right=1250,n.left=-1250,n.near=-1e4,n.far=2500;let r=new db(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof db&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;void 0!==e.size&&function vPe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},d8=new M,p8=new M,f8=new ft,m8=class extends(fI(vve,u8)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=2*qe.RAD2DEG*this.angle,n.aspect=1,n.near=100,n.far=2500;let r=new db(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof db&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),p8.setFromMatrixPosition(this.matrixWorld),f8.setFromRotationMatrix(this.matrixWorld),d8.copy(this.up).applyQuaternion(f8).negate().multiplyScalar(this.distance),this.target.position.copy(p8).add(d8),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Zc=class extends(uT(wc)){constructor(e,t){super(),this.data=t,this.bgColor=new _s(1,1,1,1),this.fog=null,this.backupFog=new Mj(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Je,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new xr(Tp,{...ev.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new mve(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}updateVisible(){}setBackgroundColor(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}updateAmbientLight(e,t){void 0!==e.color&&(this.ambientLight.color=$r(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.enabled&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof ff)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){void 0!==e.softShadowQuality&&this.isActive&&((e="medium")=>{if(o8===e)return!1;o8=e;let t=(e=>{switch(e){case"low":return 8;case"medium":default:return 16;case"high":return 32}})(e);Mt.shadowmap_pars_fragment=(e=>`\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ${e};\nconst int gShadowSamples = ${e};\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n`)(t);let i=uPe.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Mt.lights_fragment_begin=i;let n=hPe.slice();return n=n.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Mt.shadowmask_pars_fragment=n,!0})(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){this.fog=e.enabled?this.backupFog:null,this.isActive&&(this.scene.fog=this.fog),this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=$r(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){void 0!==e.aoColor&&(this.aoColor=$r(e.aoColor,t))}updateByOp(e,t,i,n){super.updateByOp(e,t,i,n);let r=t;co(e.path,["fog"])?this.updateFog(r.fog,i.shared):co(e.path,["ao"])?this.updateAo(r.ao,i.shared):co(e.path,["ambient"])?this.updateAmbientLight(r.ambient,i.shared):co(e.path,["shadow"])&&this.updateShadow(r.shadow)}updateState(e,t){this.updateState_Entity(e,t),void 0!==e.backgroundColor&&this.setBackgroundColor($r(e.backgroundColor,t.shared)),void 0!==e.fog&&this.updateFog(e.fog,t.shared),void 0!==e.ambient&&this.updateAmbientLight(e.ambient,t.shared),void 0!==e.ao&&this.updateAo(e.ao,t.shared),void 0!==e.shadow&&this.updateShadow(e.shadow)}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof h8&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize,e+=1),i instanceof m8&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize,t+=1)})}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let s=r.cloner;zt.is(r)&&(r.visible||s?.object.data.visible)&&((Qo(r)||mI(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),RI(r,e,t,!0)),i(r))}};return i(this),t}},yPe=class extends(fI(_ve,c8)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=90,n.aspect=1,n.near=100,n.far=2500;let r=new M(-n.far+this.position.x,-n.far+this.position.y,-n.far+this.position.z),s=new M(n.far+this.position.x,n.far+this.position.y,n.far+this.position.z),o=new ln(r,s),a=new pb(o,new Je(16755200));a.visible=!1,this.gizmos.shadowmap=a,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof pb){let i=this.shadow.camera,n=new M(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),r=new M(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(n,r),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},_Pe=class extends Jr{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?FT(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},TI=class extends Jr{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){let t,e={...this.data.geometry.extrusion.shape};for(let n in e)"string"==typeof e[n]&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));if("Custom"===e.type){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let r=this._context.scene.find(n);r?.data&&(r.attachedPaths.add(this),t=r.geometry.userData?.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=u6;break;case"Ellipse":n=ET;break;case"Polygon":n=c6;break;case"Star":n=h6;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(n=>n.update()))}detachShape(){null!==this._shapeId&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?FT(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},bf=class extends(Dv(dp,qw)){constructor(e,t,i){super(),"Instance"===t.type&&"string"==typeof e&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(e,t){let i=lw.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let n,r;for(let s of Oc.rootOverrideProps)void 0===e[s]?(void 0===n&&(n={...e}),n[s]=i.data[s]):(void 0===r&&(r={}),r[s]=e[s],void 0===n&&(n={...e}),n[s]=Dc.apply(i.data[s],e[s]));return this.overrideData=r,n}return{...Xr.defaultData,...e,...Tl(Xr.defaultData,Oc.rootOverrideProps)}}updateByOp(e,t,i,n){let r;if(this.isInstanceRoot&&!n)if(t=this.transformAssignData(t,i),0===e.type&&0===e.path.length&&this.component)for(let s of Oc.rootOverrideProps)s in e.props&&void 0===e.props[s]&&(void 0===r&&(r={...e,props:{...e.props}}),r.props[s]=this.component.data[s]);else if(0===e.type&&e.path.length>0&&Oc.rootOverrideProps.includes(e.path[0])){let s=e.path[0];void 0===r&&(r={...e,path:[],props:{[s]:t[s]}})}super.updateByOp(r??e,t,i,n)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(void 0===this.component){let i=e.scene.find(t.component)??null,n=!1;if(i!==this.oldComponent){if(this.oldComponent){let r=0;for(let s of this.children){if(!zt.is(s))break;e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),II(s),r+=1}this.children.splice(0,r)}n=!0}if(i){let r={};v8(e,[this.uuid],t.overrides,this,i,i,0,n,r);for(let s of this.children)if(zt.is(s)){let o=s.data;"Empty"===o.type&&o.animations&&s.traverseEntity(a=>{if(a instanceof Jr&&a.isSkinnedMesh){let l=a.dataPatched;if(l.bones&&l.boneInverses){let c=l.bones.map(d=>e.scene.find(r[d])),h=l.boneInverses.map(d=>(new ye).fromArray(d)),u=new tA(c,h);a.bind(u,a.bindMatrix)}}else a.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function II(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)zt.is(i)&&II(i)}}function g8(e,t,i,n){return e.component===t&&NH(e.identity,n)?e.overrideData===i?2:1:0}function v8(e,t,i,n,r,s,o,a,l){if(o>50)return!1;if(n.component!==r){if(n.component){let h=n.component.instances.indexOf(n);h>=0&&n.component.instances.splice(h,1)}r.instances.push(n),n.component=r}r instanceof bf&&r.isInstanceRoot&&r.expandInstanceChildren(e);let c=0;for(let h of r.children)if(zt.is(h)){let u=[...t,..."string"==typeof h.identity?[h.identity]:h.identity],d=nw.resolve(i,u,1);null!=d&&!(d instanceof Vn)&&(Object.setPrototypeOf(d,Vn.prototype),console.error("wrong prototype"));let f,p=null;if(!a){let m=n.children[c];if(p=zt.is(m)?m:null,null!==p){let g=g8(p,h,d,u);f=g>=1?p.stateSelection:void 0,2!==g&&(p=null)}if(null===p&&(p=e.scene.findInstance(u)??null,null!==p)){let g=g8(p,h,d,u);if(f=g>=1?p.stateSelection:void 0,2!==g)p=null;else{let v=p.parent.children.indexOf(p);p.parent.children.splice(v,1),n.children.splice(c,0,p),p.parent===n?v<=c&&console.error("not possible"):(p.parent=n,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(null===p){let m=d?Dc.apply(h.data,d):h.data;ih.is(m.type)&&(m={...m,type:"Empty"}),p=Uc.createEntity(u,m,e),p.overrideData=d,n.add(p),n.children.splice(n.children.length-1,1),n.children.splice(c,0,p),p.updateState(p.data,e),f&&p.changeSelectedState(f,e),e.scene.registerInstanceAndSetUuid(p)}p.isBone&&(l[p.identity[p.identity.length-1]]=p.uuid),c+=1,v8(e,t,i,p,h,s,o+1,a,l)}if(!a){let h=c;for(;;){let u=n.children[c];if(!zt.is(u))break;e.pendingDeletes.add(u),c+=1}n.children.splice(h,c-h)}return!0}var bPe=class extends(Dv(Aj,qw)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}};function PI(e,t,i){return"Mesh"===t.type?function wPe(e,t,i){let n;return"TextGeometry"===t.geometry.type?new FW(e,t,i):(n="SubdivGeometry"===t.geometry.type?new Cv(e,t,i):"PathGeometry"===t.geometry.type?new TI(e,t,i):"VectorGeometry"===t.geometry.type?new _Pe(e,t,i):"BooleanGeometry"===t.geometry.type?new yf(e,t,i):new Jr(e,t,i),n)}(e,t,i):"Empty"===t.type||"Splat"===t.type?new _f(e,t):"Bone"===t.type?new bPe(e,t):"Page"===t.type?new Zc(e,t):"PointLight"===t.type?new yPe(e,t,i):"SpotLight"===t.type?new m8(e,t,i):"DirectionalLight"===t.type?new h8(e,t,i):"Component"===t.type||"Instance"===t.type?new bf(e,t,i):ih.is(t.type)?new xr(e,t):(console.error(t),new _f(e,t))}function y8(e,t){let i=!1,n=t.getLayersOfType("transmission"),r=t.getLayersOfType("outline");return r.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,rI(e),nI(e)),0===n.length&&0===r.length&&e.layers.set(0),e instanceof ff&&e.needsAO&&e.layers.enable(5),i}function _8(e,t){if(!t.layers)return!1;let i=!1,n=t.getLayersOfType("transmission").filter(s=>s.data.visible),r=t.getLayersOfType("outline").filter(s=>s.data.visible);return n.length>0&&(e.layers.set(3),r.length>0&&e.layers.enable(8),i=!0),0===n.length&&0===r.length&&e.layers.set(0),e.needsAO&&e.layers.enable(5),i}Uc.createEntity=PI,Uc.changeEntityProptotype=function xPe(e,t,i){let n=PI(e.identity,t,i),r=e.children,s=e.attachedPaths,o=e.parent,a=e.component,l=e.instances,c=e.overrideData,h=e.uuid,u=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(n));for(let d of Object.keys(n))e[d]=n[d];e.children=[...e.children,...r],e.attachedPaths=s,e.parent=o,e.component=a,e.instances=l,e.uuid=h,e.overrideData=c,e.updateState(e.data,i),u&&e.changeSelectedState(u,i),e.resetBBoxNeedsUpdate()},Uc.Cloner=Xo;var MPe=new c4,APe=new ye,DPe=new Zd;function RI(e,t,i,n=!1){let r=e.cloner;if(r)for(let s of r.children){let o=APe.copy(s.matrixWorld).invert(),a=DPe.copy(t.ray).applyMatrix4(o);a.applyMatrix4(e.matrixWorld);let c=MPe;c.set(a.origin,a.direction),c.near=t.near,c.far=t.far;let h=c.intersectObject(e,!1);h.length>0&&i.push({...h[0],object:n?s:e})}}var qa=Wn(fg()),Hl=Wn(mg()),hn=Wn(fg()),Rt=Wn(mg()),$w=class{constructor(e,t,i){this._dataNormalized=e,this._minD=t,this._maxD=i}static createFromUnnormalized(e){let t=Rt.sup(e),i=Rt.inf(e),n=(0,hn.default)(new Float32Array(e.size),e.shape),r=t-i;return r<1e-4?Rt.assigns(n,0):(Rt.subs(n,e,i),Rt.divs(n,n,r)),new $w(n,i,t)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let e=(0,hn.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return Rt.muls(e,this._dataNormalized,this._maxD-this._minD),Rt.adds(e,e,this._minD),e}},Hi=class{constructor(e,t){this._quantized=e,this._method=t}get quantized(){return this._quantized}static maxIntBits(e){return 2**e-1}static fromNormalized(e,t){let n,i=e.data;if("norm8x"===t){let r=Hi.maxIntBits(8),s=(0,hn.default)(new Float32Array(i.size),i.shape);Rt.muls(s,i,r),Rt.roundeq(s),n=(0,hn.default)(new Uint8Array(s.data),i.shape)}else if("norm565"===t){let r=(0,hn.default)(new Float32Array(i.size),i.shape);Rt.assign(r,i),Rt.mulseq(r.pick(null,0),Hi.maxIntBits(5)),Rt.mulseq(r.pick(null,1),Hi.maxIntBits(6)),Rt.mulseq(r.pick(null,2),Hi.maxIntBits(5)),Rt.roundeq(r);let s=(0,hn.default)(new Uint16Array(r.data),i.shape),o=(0,hn.default)(new Uint16Array(i.shape[0]),[i.shape[0]]),a=(0,hn.default)(new Uint16Array(i.shape[0]),[i.shape[0]]);Rt.lshifts(o,s.pick(null,0),11),Rt.lshifts(a,s.pick(null,1),5),Rt.boreq(o,a),Rt.boreq(o,s.pick(null,2)),n=o}else{let r=(0,hn.default)(new Float32Array(i.size),i.shape);Rt.assign(r,i),Rt.mulseq(r.pick(null,0),Hi.maxIntBits(11)),Rt.mulseq(r.pick(null,1),Hi.maxIntBits(10)),Rt.mulseq(r.pick(null,2),Hi.maxIntBits(11)),Rt.roundeq(r);let s=(0,hn.default)(new Uint32Array(r.data),i.shape),o=(0,hn.default)(new Uint32Array(i.shape[0]),[i.shape[0]]),a=(0,hn.default)(new Uint32Array(i.shape[0]),[i.shape[0]]);Rt.lshifts(o,s.pick(null,0),21),Rt.lshifts(a,s.pick(null,1),11),Rt.boreq(o,a),Rt.boreq(o,s.pick(null,2)),n=o}return new Hi(n,t)}dequantize(e,t){let n,i=this._method,r=this._quantized;if("norm8x"===i){let s=Hi.maxIntBits(8);n=(0,hn.default)(new Float32Array(r.size),r.shape),Rt.muls(n,r,1/s)}else if("norm565"===i){let s=(0,hn.default)(new Uint8Array(r.shape[0]),[r.shape[0]]),o=(0,hn.default)(new Uint8Array(r.shape[0]),[r.shape[0]]),a=(0,hn.default)(new Uint8Array(r.shape[0]),[r.shape[0]]);Rt.rrshifts(s,r,11),Rt.rrshifts(o,r,5),Rt.bandseq(o,Hi.maxIntBits(6)),Rt.bands(a,r,Hi.maxIntBits(5)),n=(0,hn.default)(new Float32Array(3*r.shape[0]),[r.shape[0],3]),Rt.muls(n.pick(null,0),s,1/Hi.maxIntBits(5)),Rt.muls(n.pick(null,1),o,1/Hi.maxIntBits(6)),Rt.muls(n.pick(null,2),a,1/Hi.maxIntBits(5))}else{let s=(0,hn.default)(new Uint16Array(r.shape[0]),[r.shape[0]]),o=(0,hn.default)(new Uint16Array(r.shape[0]),[r.shape[0]]),a=(0,hn.default)(new Uint16Array(r.shape[0]),[r.shape[0]]);Rt.rrshifts(s,r,21),Rt.rrshifts(o,r,11),Rt.bandseq(o,Hi.maxIntBits(10)),Rt.bands(a,r,Hi.maxIntBits(11)),n=(0,hn.default)(new Float32Array(3*r.shape[0]),[r.shape[0],3]),Rt.muls(n.pick(null,0),s,1/Hi.maxIntBits(11)),Rt.muls(n.pick(null,1),o,1/Hi.maxIntBits(10)),Rt.muls(n.pick(null,2),a,1/Hi.maxIntBits(11))}return new $w(n,e,t)}},Ji=class{constructor(e,t,i,n,r,s=!1){this._quantized=e,this._minMaxMatrix=t,this._chunkSize=i,this._quantizationMethod=n,this._variableChunkSize=r,this._isDynamicChunks=s}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(e){let i=this.minmaxMatrix.shape[0]-e.length,n=(0,qa.default)(new Float32Array(2*i),[i,2]),r=0,s=i,o=0,a=this.minmaxMatrix.shape[0];for(let l=0;l<e.length;l++)a=e[l],s=a-o+r,s>r&&Hl.assign(n.hi(s,2).lo(r,0),this.minmaxMatrix.hi(a,2).lo(o,0)),r=s,o=a+1;return r<i&&Hl.assign(n.lo(r,0),this.minmaxMatrix.lo(o,0)),n}_createPrunedQuantized(e){let r,s,i=this.quantized.shape[0]-e.length,n=this._quantizationMethod;"norm8x"===n?(s=this._quantized.shape[1],r=(0,qa.default)(new Uint8Array(s?i*s:i),s?[i,s]:[i,1])):r=(0,qa.default)("norm565"===n?new Uint16Array(i):new Uint32Array(i),[i]);let o=0,a=i,l=0,c=r.shape[0];for(let h=0;h<e.length;h++)c=e[h],a=c-l+o,a>o&&(s?Hl.assign(r.hi(a,s).lo(o,0),this._quantized.hi(c,s).lo(l,0)):Hl.assign(r.hi(a).lo(o),this._quantized.hi(c).lo(l))),o=a,l=c+1;return o<i&&(s?Hl.assign(r.lo(o,0),this._quantized.lo(l,0)):Hl.assign(r.lo(o),this._quantized.lo(l))),r}pruneFeature(e,t,i){let n=this._createPrunedQuantized(e),r=this._createPrunedMinMax(t);return new Ji(n,r,this._chunkSize,this._quantizationMethod,i,!0)}static getRequiredNChunks(e,t){return Math.floor(e/t)}static fromArray(e,t,i){let o,n=e.shape[0],r=Math.floor(n/i),s=(0,qa.default)(new Float32Array(2*r),[r,2],[2,1]);o="norm8x"===t?(0,qa.default)(new Uint8Array(e.size),e.shape):(0,qa.default)("norm565"===t?new Uint16Array(e.shape[0]):new Uint32Array(e.shape[0]),[e.shape[0]]);for(let a=0;a<r;a++){let h,l=a*i,c=a+1<r?(a+1)*i:n;h=$w.createFromUnnormalized(e.shape.length>1?e.hi(c,e.shape[1]).lo(l,0):e.hi(c).lo(l)),s.set(a,0,h.minD),s.set(a,1,h.maxD),Hl.assign(o.shape.length>1?o.hi(c,o.shape[1]).lo(l,0):o.hi(c).lo(l),Hi.fromNormalized(h,t).quantized)}return new Ji(o,s,i,t)}denormDequant(){let s,o,e=this._minMaxMatrix.shape[0],t=this._quantized,i=t.shape[0],n=this._quantizationMethod,r=this._chunkSize;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");s=this._variableChunkSize}o="norm8x"===n?(0,qa.default)(new Float32Array(t.size),t.shape):(0,qa.default)(new Float32Array(3*i),[i,3]);let a=0,l=r;for(let c=0;c<e;c++){let[h,u]=[this._minMaxMatrix.get(c,0),this._minMaxMatrix.get(c,1)];this._isDynamicChunks&&(l=s[c]);let p,d=c+1<e?a+l:i;p=new Hi(t.shape.length>1?t.hi(d,t.shape[1]).lo(a,0):t.hi(d).lo(a),n),Hl.assign(o.hi(d,o.shape[1]).lo(a,0),p.dequantize(h,u).denormalize()),a=d}return o}static fetchArrayBuffer(e){return(0,sn.Z)(function*(){return yield(yield fetch(e,{mode:"cors"})).arrayBuffer()})()}},Qc=Wn(fg()),Ht=Wn(mg()),wf=Wn(fg()),En=Wn(mg()),b8=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function w8(e){return e<1e5?e<100?e<10?0:1:e<1e4?e<1e3?2:3:4:e<1e7?e<1e6?5:6:e<1e9?e<1e8?7:8:9}function x8(e,t){if(e===t)return 0;if(~~e===e&&~~t===t){if(0===e||0===t)return e<t?-1:1;if(e<0||t<0){if(t>=0)return-1;if(e>=0)return 1;e=-e,t=-t}let r=w8(e),s=w8(t),o=0;return r<s?(e*=b8[s-r-1],t/=10,o=-1):r>s&&(t*=b8[r-s-1],e/=10,o=1),e===t?o:e<t?-1:1}let i=String(e),n=String(t);return i===n?0:i<n?-1:1}function S8(e,t,i,n){let r=t+1;if(r===i)return 1;if(n(e[r++],e[t])<0){for(;r<i&&n(e[r],e[r-1])<0;)r++;!function RPe(e,t,i){for(i--;t<i;){let n=e[t];e[t++]=e[i],e[i--]=n}}(e,t,r)}else for(;r<i&&n(e[r],e[r-1])>=0;)r++;return r-t}function C8(e,t,i,n,r){for(n===t&&n++;n<i;n++){let s=e[n],o=t,a=n;for(;o<a;){let c=o+a>>>1;r(s,e[c])<0?a=c:o=c+1}let l=n-o;switch(l){case 3:e[o+3]=e[o+2];case 2:e[o+2]=e[o+1];case 1:e[o+1]=e[o];break;default:for(;l>0;)e[o+l]=e[o+l-1],l--}e[o]=s}}function OI(e,t,i,n,r,s){let o=0,a=0,l=1;if(s(e,t[i+r])>0){for(a=n-r;l<a&&s(e,t[i+r+l])>0;)o=l,l=1+(l<<1),l<=0&&(l=a);l>a&&(l=a),o+=r,l+=r}else{for(a=r+1;l<a&&s(e,t[i+r-l])<=0;)o=l,l=1+(l<<1),l<=0&&(l=a);l>a&&(l=a);let c=o;o=r-l,l=r-c}for(o++;o<l;){let c=o+(l-o>>>1);s(e,t[i+c])>0?o=c+1:l=c}return l}function LI(e,t,i,n,r,s){let o=0,a=0,l=1;if(s(e,t[i+r])<0){for(a=r+1;l<a&&s(e,t[i+r-l])<0;)o=l,l=1+(l<<1),l<=0&&(l=a);l>a&&(l=a);let c=o;o=r-l,l=r-c}else{for(a=n-r;l<a&&s(e,t[i+r+l])>=0;)o=l,l=1+(l<<1),l<=0&&(l=a);l>a&&(l=a),o+=r,l+=r}for(o++;o<l;){let c=o+(l-o>>>1);s(e,t[i+c])<0?l=c:o=c+1}return l}function NI(e){let t=(0,wf.default)(new Int32Array(e.shape[0]),[e.shape[0]]),i=(0,wf.default)(new Int32Array(e.shape[0]),[e.shape[0]]);return En.bands(t,e,1023),En.lshifts(i,t,16),En.bxoreq(t,i),En.bandseq(t,4278190335),En.lshifts(i,t,8),En.bxoreq(t,i),En.bandseq(t,50393103),En.lshifts(i,t,4),En.bxoreq(t,i),En.bandseq(t,51130563),En.lshifts(i,t,2),En.bxoreq(t,i),En.bandseq(t,153391689),t}function xf(e,t){if(e.shape[0]!==t.shape[0])throw new Error("wrong length");let i=(0,wf.default)(new Float32Array(e.size),e.shape,e.stride,e.offset);for(let n=0;n<t.shape[0];n++){let r=t.get(n);if(e.shape.length>1)for(let s=0;s<e.shape[1];s++)i.set(n,s,e.get(r,s));else i.set(n,e.get(r))}return i}function kPe(e){let t=En.sup(e),i=En.inf(e),n=1e3/Math.min(1e3,t-i),r=(0,wf.default)(new Float32Array(e.data),e.shape);En.mulseq(r,n);let o=function NPe(e){let t=NI(e.pick(null,0)),i=NI(e.pick(null,1));En.lshiftseq(i,1);let n=NI(e.pick(null,2));return En.lshiftseq(n,2),En.boreq(t,i),En.boreq(t,n),t}((0,wf.default)(new Int32Array(r.data),e.shape)),a=Array.from(o.data).map((c,h)=>[c,h]);!function LPe(e,t,i,n){if(!Array.isArray(e))throw new TypeError("Can only sort arrays");t?"function"!=typeof t&&(n=i,i=t,t=x8):t=x8,i||(i=0),n||(n=e.length);let r=n-i;if(r<2)return;let s=0;if(r<32)return s=S8(e,i,n,t),void C8(e,i,n,i+s,t);let o=new class{constructor(e,t){Vr(this,"array",null),Vr(this,"compare",null),Vr(this,"minGallop",7),Vr(this,"length",0),Vr(this,"tmpStorageLength",256),Vr(this,"stackLength",0),Vr(this,"runStart",null),Vr(this,"runLength",null),Vr(this,"stackSize",0),this.array=e,this.compare=t,this.length=e.length,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(e,t){this.runStart[this.stackSize]=e,this.runLength[this.stackSize]=t,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;if(e>=1&&this.runLength[e-1]<=this.runLength[e]+this.runLength[e+1]||e>=2&&this.runLength[e-2]<=this.runLength[e]+this.runLength[e-1])this.runLength[e-1]<this.runLength[e+1]&&e--;else if(this.runLength[e]>this.runLength[e+1])break;this.mergeAt(e)}}forceMergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;e>0&&this.runLength[e-1]<this.runLength[e+1]&&e--,this.mergeAt(e)}}mergeAt(e){let t=this.compare,i=this.array,n=this.runStart[e],r=this.runLength[e],s=this.runStart[e+1],o=this.runLength[e+1];this.runLength[e]=r+o,e===this.stackSize-3&&(this.runStart[e+1]=this.runStart[e+2],this.runLength[e+1]=this.runLength[e+2]),this.stackSize--;let a=LI(i[s],i,n,r,0,t);n+=a,r-=a,0!==r&&(o=OI(i[n+r-1],i,s,o,o-1,t),0!==o&&(r<=o?this.mergeLow(n,r,s,o):this.mergeHigh(n,r,s,o)))}mergeLow(e,t,i,n){let r=this.compare,s=this.array,o=this.tmp,a=0;for(a=0;a<t;a++)o[a]=s[e+a];let l=0,c=i,h=e;if(s[h++]=s[c++],0==--n){for(a=0;a<t;a++)s[h+a]=o[l+a];return}if(1===t){for(a=0;a<n;a++)s[h+a]=s[c+a];return void(s[h+n]=o[l])}let u=this.minGallop;for(;;){let d=0,p=0,f=!1;do{if(r(s[c],o[l])<0){if(s[h++]=s[c++],p++,d=0,0==--n){f=!0;break}}else if(s[h++]=o[l++],d++,p=0,1==--t){f=!0;break}}while((d|p)<u);if(f)break;do{if(d=LI(s[c],o,l,t,0,r),0!==d){for(a=0;a<d;a++)s[h+a]=o[l+a];if(h+=d,l+=d,(t-=d)<=1){f=!0;break}}if(s[h++]=s[c++],0==--n){f=!0;break}if(p=OI(o[l],s,c,n,0,r),0!==p){for(a=0;a<p;a++)s[h+a]=s[c+a];if(h+=p,c+=p,0==(n-=p)){f=!0;break}}if(s[h++]=o[l++],1==--t){f=!0;break}u--}while(d>=7||p>=7);if(f)break;u<0&&(u=0),u+=2}if(this.minGallop=u,u<1&&(this.minGallop=1),1===t){for(a=0;a<n;a++)s[h+a]=s[c+a];s[h+n]=o[l]}else{if(0===t)throw new Error("mergeLow preconditions were not respected");for(a=0;a<t;a++)s[h+a]=o[l+a]}}mergeHigh(e,t,i,n){let r=this.compare,s=this.array,o=this.tmp,a=0;for(a=0;a<n;a++)o[a]=s[i+a];let l=e+t-1,c=n-1,h=i+n-1,u=0,d=0;if(s[h--]=s[l--],0==--t){for(u=h-(n-1),a=0;a<n;a++)s[u+a]=o[a];return}if(1===n){for(h-=t,l-=t,d=h+1,u=l+1,a=t-1;a>=0;a--)s[d+a]=s[u+a];return void(s[h]=o[c])}let p=this.minGallop;for(;;){let f=0,m=0,g=!1;do{if(r(o[c],s[l])<0){if(s[h--]=s[l--],f++,m=0,0==--t){g=!0;break}}else if(s[h--]=o[c--],m++,f=0,1==--n){g=!0;break}}while((f|m)<p);if(g)break;do{if(f=t-LI(o[c],s,e,t,t-1,r),0!==f){for(h-=f,l-=f,t-=f,d=h+1,u=l+1,a=f-1;a>=0;a--)s[d+a]=s[u+a];if(0===t){g=!0;break}}if(s[h--]=o[c--],1==--n){g=!0;break}if(m=n-OI(s[l],o,0,n,n-1,r),0!==m){for(h-=m,c-=m,n-=m,d=h+1,u=c+1,a=0;a<m;a++)s[d+a]=o[u+a];if(n<=1){g=!0;break}}if(s[h--]=s[l--],0==--t){g=!0;break}p--}while(f>=7||m>=7);if(g)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),1===n){for(h-=t,l-=t,d=h+1,u=l+1,a=t-1;a>=0;a--)s[d+a]=s[u+a];s[h]=o[c]}else{if(0===n)throw new Error("mergeHigh preconditions were not respected");for(u=h-(n-1),a=0;a<n;a++)s[u+a]=o[a]}}}(e,t),a=function PPe(e){let t=0;for(;e>=32;)t|=1&e,e>>=1;return e+t}(r);do{if(s=S8(e,i,n,t),s<a){let l=r;l>a&&(l=a),C8(e,i,i+l,i+s,t),s=l}o.pushRun(i,s),o.mergeRuns(),r-=s,i+=s}while(0!==r);o.forceMergeRuns()}(a,(c,h)=>c[0]-h[0]);let l=a.map(([c,h])=>h);return(0,wf.default)(Uint32Array.from(l))}var _h=class{constructor(e,t,i,n,r,s,o,a,l,c){this.propertyDescs=e,this.format=t,this.nsplats=i,this.xyz=n,this.colors=r,this.harmonics=s,this.opacity=o,this.scaling=a,this.rotation=l,this.maxSHDegree=c}getPlyBinary(){let e=_h._generateHeaderString(this.propertyDescs,this.format,this.nsplats),t=(new TextEncoder).encode(e),i=Object.keys(this.propertyDescs).length,n=(0,Qc.default)(new Float32Array(this.nsplats*i),[this.nsplats,i]);if(Ht.assign(n.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),Ht.assign(n.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),Ht.assign(n.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),Ht.assign(n.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),Ht.assign(n.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),Ht.assign(n.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),Ht.assign(n.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),Ht.assign(n.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),Ht.assign(n.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),Ht.assign(n.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),Ht.assign(n.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),Ht.assign(n.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),Ht.assign(n.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),Ht.assign(n.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let o=0;o<this.harmonics.length;o++){let a=3*o;Ht.assign(n.pick(null,this.propertyDescs[`f_rest_${a}`].index),this.harmonics[o].pick(null,0)),Ht.assign(n.pick(null,this.propertyDescs[`f_rest_${a+1}`].index),this.harmonics[o].pick(null,1)),Ht.assign(n.pick(null,this.propertyDescs[`f_rest_${a+2}`].index),this.harmonics[o].pick(null,2))}let r=new Uint8Array(n.data.buffer),s=new Uint8Array(r.length+t.length);return s.set(t),s.set(r,t.length),s.buffer}save(e,t){let i=this.getPlyBinary(),n=new Blob([i],{type:"application/octet-stream"}),r=new File([n],e),s=new FormData;s.append("file",r),s.append("filename",e),s.append("basedir",t),fetch("http://127.0.0.1:8000/push_file",{method:"POST",body:s})}static loadFile(e){return(0,sn.Z)(function*(){return yield(yield fetch(e)).arrayBuffer()})()}mortonPositionSplatsSort(){let e=kPe(this.xyz),t=xf(this.xyz,e),i=xf(this.colors,e),n=xf(this.opacity,e),r=xf(this.scaling,e),s=xf(this.rotation,e),o=[];for(let a=0;a<this.harmonics.length;a++)o.push(xf(this.harmonics[a],e));return new _h(this.propertyDescs,this.format,this.nsplats,t,i,o,n,r,s,this.maxSHDegree)}static _generateHeaderString(e,t,i){let n=`ply\nformat ${t.format} ${t.version}\nelement vertex ${i}`,r=Object.keys(e).length,s=Array(r);for(let o in e){let a=e[o];s[a.index]={name:o,dtype:a.dtype}}for(let o=0;o<s.length;o++)n=`${n}\nproperty ${s[o].dtype} ${s[o].name}`;return`${n}\nend_header\n`}static fromArrayBuffer(e,t=3){let{splatCount:i,vertexData:n,propertiesDesc:r,format:s}=_h.decodeHeader(e),o=n.buffer.slice(n.byteOffset),a=Object.keys(r).length,l=(0,Qc.default)(new Float32Array(o),[i,a]),c=0,h={},u={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1};for(let _ in r)if(r.hasOwnProperty(_)){let b=r[_].dtype;h[_]=c,c+=u[b]}let d=(0,Qc.default)(new Float32Array(3*i),[i,3]);Ht.assign(d.pick(null,0),l.pick(null,h.x/4)),Ht.assign(d.pick(null,1),l.pick(null,h.y/4)),Ht.assign(d.pick(null,2),l.pick(null,h.z/4));let p=(0,Qc.default)(new Float32Array(3*i),[i,3]);Ht.assign(p.pick(null,0),l.pick(null,h.scale_0/4)),Ht.assign(p.pick(null,1),l.pick(null,h.scale_1/4)),Ht.assign(p.pick(null,2),l.pick(null,h.scale_2/4));let f=(0,Qc.default)(new Float32Array(3*i),[i,3]);Ht.assign(f.pick(null,0),l.pick(null,h.f_dc_0/4)),Ht.assign(f.pick(null,1),l.pick(null,h.f_dc_1/4)),Ht.assign(f.pick(null,2),l.pick(null,h.f_dc_2/4));let m=(0,Qc.default)(new Float32Array(4*i),[i,4]);Ht.assign(m.pick(null,0),l.pick(null,h.rot_1/4)),Ht.assign(m.pick(null,1),l.pick(null,h.rot_2/4)),Ht.assign(m.pick(null,2),l.pick(null,h.rot_3/4)),Ht.assign(m.pick(null,3),l.pick(null,h.rot_0/4));for(let _=0;_<i;_++){let b=m.pick(_,null),w=Math.sqrt(b.get(0)**2+b.get(1)**2+b.get(2)**2+b.get(3)**2);Ht.divseq(b,w)}let g=(0,Qc.default)(new Float32Array(1*i),[i,1]);Ht.assign(g.pick(null,0),l.pick(null,h.opacity/4));let v=(Math.min(Math.max(t,0),3)+1)**2-1,y=[];for(let _=0;_<v;_++){let b=(0,Qc.default)(new Float32Array(3*i),[i,3]),w=3*_;Ht.assign(b.pick(null,0),l.pick(null,h[`f_rest_${w}`]/4)),Ht.assign(b.pick(null,1),l.pick(null,h[`f_rest_${w+1}`]/4)),Ht.assign(b.pick(null,2),l.pick(null,h[`f_rest_${w+2}`]/4)),y.push(b)}return new _h(r,s,i,d,f,y,g,p,m,t)}static fromPLYFile(e,t=3){return(0,sn.Z)(function*(){let i=yield _h.loadFile(e);return _h.fromArrayBuffer(i,t)})()}static decodeHeader(e){let t=new TextDecoder,i=0,n="",r=100;for(;;){if(i+r>=e.byteLength)throw new Error("End of file reached while searching for end of header");let p=new Uint8Array(e,i,r);n+=t.decode(p),i+=r;let f=i-200,m=new Uint8Array(e,Math.max(0,f),f>0?200:r);if(t.decode(m).includes("end_header"))break}let h,s=n.split("\n"),o=0,a={},l={},c=0;for(let p=0;p<s.length;p++){let f=s[p].trim();if(f.startsWith("element vertex")){let m=f.match(/\d+/);m&&(o=parseInt(m[0]))}else if(f.startsWith("property")){let m=f.match(/(\w+)\s+(\w+)\s+(\w+)/);if(m){let g=m[2],v=m[3];a[v]=c,l[v]={dtype:g,index:c},c++}}else if(f.startsWith("format")){let m=f.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);m&&(h={format:m[2],version:m[3]})}else if("end_header"===f)break}let u=n.indexOf("end_header")+10+1;return{splatCount:o,vertexData:new DataView(e,u),headerOffset:i,propertiesDesc:l,format:h}}},kI=class{constructor(e,t,i,n,r,s,o,a){this.config=e,this.xyz=t,this.scaling=i,this.color=n,this.opacity=r,this.harmonics=o,this.quaternion=s,this.variableChunkSize=a}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(e,t){let i=Ji.fromArray(e.xyz,t.xyz,t.chunkSize),n=Ji.fromArray(e.scaling,t.scaling,t.chunkSize),r=Ji.fromArray(e.colors,t.color,t.chunkSize),s=Ji.fromArray(e.opacity,t.opacity,t.chunkSize),o=Ji.fromArray(e.rotation,t.quaternion,t.chunkSize),a=e.harmonics,l=[];if(t.harmonics)for(let c=0;c<a.length;c++){let h=Ji.fromArray(a[c],t.harmonics,t.chunkSize);l.push(h)}return new kI(t,i,n,r,s,o,l)}_countIndexesInChunks(e){let t=[],i=this.nchunks,n=this.chunkSize;if(i===Ji.getRequiredNChunks(this.nsplats,n))for(let o=0;o<e.length;o++){let a=e[o],l=Math.floor(a/this.chunkSize);l in t?t[l].push(a):t[l]=[a]}else{let o=this.variableChunkSize,a={},l=0;for(let c=0;c<i;c++)a[c]=l,l+=o[c];for(let c=0;c<e.length;c++){let h=e[c],u=Math.min(Math.floor(h/n),i-1);for(;h>=a[u]+o[u];)u++;u in t?t[u].push(h):t[u]=[h]}}return t}pruneSplats(e){let i,t=this._countIndexesInChunks(e),n=[];return t.length>0&&(i=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),t.forEach((r,s)=>{i[s]-=r.length,i[s]<=0&&n.push(s)}),i=i.filter(r=>r>0)),new kI(this.config,this.xyz.pruneFeature(e,n,i),this.scaling.pruneFeature(e,n,i),this.color.pruneFeature(e,n,i),this.opacity.pruneFeature(e,n,i),this.quaternion.pruneFeature(e,n,i),this.harmonics?this.harmonics.map(r=>r.pruneFeature(e,n,this.variableChunkSize)):void 0,i)}static loadConfig(e){return(0,sn.Z)(function*(){return yield(yield fetch(e,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()})()}toGaussians(){let t={},i=0;if(t.x={dtype:"float",index:i},i++,t.y={dtype:"float",index:i},i++,t.z={dtype:"float",index:i},i++,t.f_dc_0={dtype:"float",index:i},i++,t.f_dc_1={dtype:"float",index:i},i++,t.f_dc_2={dtype:"float",index:i},i++,this.harmonics&&this.harmonics.length>0)for(let r=0;r<this.harmonics.length;r++)t[`f_rest_${r}`]={dtype:"float",index:i},i++,t[`f_rest_${r+1}`]={dtype:"float",index:i},i++,t[`f_rest_${r+2}`]={dtype:"float",index:i},i++;t.opacity={dtype:"float",index:i},i++,t.scale_0={dtype:"float",index:i},i++,t.scale_1={dtype:"float",index:i},i++,t.scale_2={dtype:"float",index:i},i++,t.rot_0={dtype:"float",index:i},i++,t.rot_1={dtype:"float",index:i},i++,t.rot_2={dtype:"float",index:i},i++,t.rot_3={dtype:"float",index:i},i++;let n=this.harmonics?.map(r=>r.denormDequant());return new _h(t,{format:"binary_little_endian",version:"1.0"},this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),n||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},Sf=Wn(fg()),vo=Wn(mg()),E8={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},FI=class{constructor(e){this._buffer=e}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let t=this.decoded.color.denormDequant(),i=this.decoded.opacity.denormDequant(),n=(0,Sf.default)(new Float32Array(4*t.shape[0]),[t.shape[0],4]);return vo.mulseq(t,.28209479177387814),vo.addseq(t,.5),vo.mulseq(t,255),vo.maxseq(t,0),vo.minseq(t,255),vo.negeq(i),vo.expeq(i),vo.addseq(i,1),vo.recipeq(i),vo.mulseq(i,255),vo.assign(n.hi(t.shape[0],3).lo(0,0),t),vo.assign(n.hi(t.shape[0],4).lo(0,3),i),(0,Sf.default)(new Uint8Array(n.data),[t.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:e,chunkCount:t,chunkSize:i,typeChunks:n,vertexData:r,propertiesDesc:s}=this.decodeHeader(),o={xyz:s.xyz.compressionMethod,color:s.color.compressionMethod,opacity:s.opacity.compressionMethod,scaling:s.scaling.compressionMethod,quaternion:s.quaternion.compressionMethod,chunkSize:i};s.harmonics_0&&(o.harmonics=s.harmonics_0.compressionMethod);let a=r.byteOffset,l=Array(Object.keys(s).length);for(let g in s)l[s[g].index]={name:g,method:s[g].compressionMethod};let d,c=2*t*4,h=a,u="dynamic"===n?2*t:0,p=!1;if(u>0){let g=new Uint16Array(r.buffer.slice(h,h+u));h+=u,d=Array.from(g),p=!0}let f={};for(let g of l){let _,v=0,y=!0;if("norm8x"===g.method)v=1*e*E8[g.name];else if("norm11"===g.method)v=4*e;else{if("norm565"!==g.method)throw y=!1,new Error(`Not Implemented format: ${g.method}`);v=2*e}if(!y)throw new Error("loading chunk byt hasnot minmax!");{let C=r.buffer.slice(h,h+c);_=(0,Sf.default)(new Float32Array(C),[t,2]),h+=c}let w,b=r.buffer.slice(h,h+v);if(h+=v,"norm8x"===g.method)w=(0,Sf.default)(new Uint8Array(b),[e,E8[g.name]]);else if("norm11"===g.method)w=(0,Sf.default)(new Uint32Array(b));else{if("norm565"!==g.method)throw new Error(`Not Implemented format: ${g.method}`);w=(0,Sf.default)(new Uint16Array(b))}f[g.name]=new Ji(w,_,i,g.method,d,p)}let m=[];for(let g=0;g<15;g++){let v=f[`harmonics_${g}`];v&&(m.push(v),delete f[`harmonics_${g}`])}return m.length>0&&(f.harmonics=m),new kI(o,f.xyz,f.scaling,f.color,f.opacity,f.quaternion,f.harmonics,d)}buildPreComputedBuffers(){let e=this.decoded,t=e.nsplats,i=new ArrayBuffer(24*t),n=new Float32Array(i),r=e.scaling.denormDequant(),s=e.quaternion.denormDequant(),o=new ft,a=new an,l=new an,c=new an,h=new ye;for(let u=0;u<t;u++){h.makeScale(Math.exp(r.get(u,0)),Math.exp(r.get(u,1)),Math.exp(r.get(u,2))),l.setFromMatrix4(h),o.set(s.get(u,0),s.get(u,1),s.get(u,2),s.get(u,3)),h.makeRotationFromQuaternion(o),a.setFromMatrix4(h),c.copy(a).multiply(l);let d=c.elements;n[6*u]=d[0]*d[0]+d[3]*d[3]+d[6]*d[6],n[6*u+1]=d[0]*d[1]+d[3]*d[4]+d[6]*d[7],n[6*u+2]=d[0]*d[2]+d[3]*d[5]+d[6]*d[8],n[6*u+3]=d[1]*d[1]+d[4]*d[4]+d[7]*d[7],n[6*u+4]=d[1]*d[2]+d[4]*d[5]+d[7]*d[8],n[6*u+5]=d[2]*d[2]+d[5]*d[5]+d[8]*d[8]}this._precomputedCovarianceBufferData=i}decodeHeader(){let e=this._buffer,t=new TextDecoder,i=0,n="",r=100;for(;;){if(i+r>=e.byteLength)throw new Error("End of file reached while searching for end of header");let f=new Uint8Array(e,i,r);n+=t.decode(f),i+=r;let m=i-200,g=new Uint8Array(e,Math.max(0,m),m>=0?200:r);if(t.decode(g).includes("end_header"))break}let s=n.split("\n"),o=0,a=0,l=0,c=0,h="",u={};for(let f=0;f<s.length;f++){let m=s[f].trim();if(m.startsWith("element vertex")){let g=m.match(/\d+/);g&&(o=parseInt(g[0]))}else if(m.startsWith("property")){let g=m.match(/(\w+)\s+(\w+)\s+(\w+)/);g&&(u[g[2]]={compressionMethod:g[3],index:c},c++)}else if(m.startsWith("element chunks")){let g=m.match(/\d+/);g&&(a=parseInt(g[0]))}else if(m.startsWith("element chunkSize")){let g=m.match(/\d+/);g&&(l=parseInt(g[0]))}else if(m.startsWith("element typeChunks")){let g=m.match(/(\w+)\s+(\w+)\s+(\w+)/);g&&(h=g[3])}else if("end_header"===m)break}let d=n.indexOf("end_header")+10+1;return{splatCount:o,chunkCount:a,chunkSize:l,typeChunks:h,vertexData:new DataView(e,d),propertiesDesc:u}}pruneSplats(e){let t=this.decodeBuffer().pruneSplats(e);return FI.fromCompressedGaussianSplats(t)}static fromCompressedGaussianSplats(e){let i=e.xyz.nchunks,n=`gspline\nelement vertex ${e.xyz.length}\nelement chunks ${i}\nelement chunkSize ${e.chunkSize}\nelement typeChunks ${e.isDynamicChunks?"dynamic":"static"}\nproperty xyz ${e.xyz.method}\nproperty color ${e.color.method}\nproperty opacity ${e.opacity.method}\nproperty scaling ${e.scaling.method}\nproperty quaternion ${e.quaternion.method}`;if(e.harmonics&&e.harmonics.length>0)for(let x=0;x<e.harmonics.length;x++)n=`${n}\nproperty harmonics_${x} ${e.harmonics[x].method}`;n=`${n}\nend_header\n`;let r=(new TextEncoder).encode(n),s=2*i*4,o=e.xyz.quantized.data.buffer.byteLength,a=e.xyz instanceof Ji?s:0,l=e.color.quantized.data.buffer.byteLength,c=e.color instanceof Ji?s:0,h=e.opacity.quantized.data.buffer.byteLength,u=e.opacity instanceof Ji?s:0,d=e.scaling.quantized.data.buffer.byteLength,p=e.scaling instanceof Ji?s:0,f=e.quaternion.quantized.data.buffer.byteLength,m=e.quaternion instanceof Ji?s:0,g=e.variableChunkSize?Uint16Array.from(e.variableChunkSize):void 0,v=g?g.byteLength:0,y=r.byteLength+v+o+a+l+c+h+u+d+p+f+m,_=0,b=0;if(e.harmonics&&e.harmonics.length>0)for(let x=0;x<e.harmonics.length;x++)_+=e.harmonics[x].quantized.data.buffer.byteLength,b+=e.harmonics[x]instanceof Ji?s:0;_=0,b=0,y+=_+b;let w=new Uint8Array(y),C=0;if(w.set(r,C),C+=r.byteLength,v>0&&(w.set(new Uint8Array(g.buffer),C),C+=v),e.xyz instanceof Ji&&(w.set(new Uint8Array(e.xyz.minmaxMatrix.data.buffer),C),C+=s),w.set(new Uint8Array(e.xyz.quantized.data.buffer),C),C+=o,e.color instanceof Ji&&(w.set(new Uint8Array(e.color.minmaxMatrix.data.buffer),C),C+=s),w.set(new Uint8Array(e.color.quantized.data.buffer),C),C+=l,e.opacity instanceof Ji&&(w.set(new Uint8Array(e.opacity.minmaxMatrix.data.buffer),C),C+=s),w.set(new Uint8Array(e.opacity.quantized.data.buffer),C),C+=h,e.scaling instanceof Ji&&(w.set(new Uint8Array(e.scaling.minmaxMatrix.data.buffer),C),C+=s),w.set(new Uint8Array(e.scaling.quantized.data.buffer),C),C+=d,e.quaternion instanceof Ji&&(w.set(new Uint8Array(e.quaternion.minmaxMatrix.data.buffer),C),C+=s),w.set(new Uint8Array(e.quaternion.quantized.data.buffer),C),C+=f,_>0&&e.harmonics&&e.harmonics.length>0)for(let x=0;x<e.harmonics.length;x++){let S=e.harmonics[x];S instanceof Ji&&(w.set(new Uint8Array(S.minmaxMatrix.data.buffer),C),C+=s),w.set(new Uint8Array(S.quantized.data.buffer),C),C+=S.quantized.data.byteLength}return new FI(w.buffer)}},Kc=class{};function BPe(e){let t,i,n,r,s,o,a,l,c,h,u,d,p,f,m,g;function y(T,I,P){let R=new Float32Array(h,s,3*i);n=0;let L=new Uint32Array(h,r,i);for(let j=0;j<P.length-1;j++){let F=I[j],N=T[j].elements,q=F.filter(U=>U.enabled&&"Include"===U.mode).map(U=>"Box"===U.type?C(U):E(U)),W=F.filter(U=>U.enabled&&"Exclude"===U.mode).map(U=>"Box"===U.type?C(U):E(U));for(let U=P[j];U<P[j+1];U++){let V=p[3*U],Y=p[3*U+1],G=p[3*U+2];if((0===q.length||b(V,Y,G,q))&&(0===W.length||!b(V,Y,G,W))){let X=1/(N[3]*V+N[7]*Y+N[11]*G+N[15]);R[3*n]=(N[0]*V+N[4]*Y+N[8]*G+N[12])*X,R[3*n+1]=(N[1]*V+N[5]*Y+N[9]*G+N[13])*X,R[3*n+2]=(N[2]*V+N[6]*Y+N[10]*G+N[14])*X,L[n]=U,n++}}}}function b(T,I,P,R,L){return R["Intersect"===L?"every":"some"](j=>{let F=function w(T,I,P,R,L){let j=T-L[0],F=I-L[1],N=P-L[2],q=1/(R[3]*j+R[7]*F+R[11]*N+R[15]);return{x:(R[0]*j+R[4]*F+R[8]*N+R[12])*q+L[0],y:(R[1]*j+R[5]*F+R[9]*N+R[13])*q+L[1],z:(R[2]*j+R[6]*F+R[10]*N+R[14])*q+L[2]}}(T,I,P,j.invRotationMatrix,j.cropCenter);return Array.isArray(j)?function S(T,I,P,R){return T>=R[0]&&T<=R[3]&&I>=R[1]&&I<=R[4]&&P>=R[2]&&P<=R[5]}(F.x,F.y,F.z,j):function D(T,I,P,R){let L=(T-R.cropCenter[0])*R.invRadiusX,j=(I-R.cropCenter[1])*R.invRadiusY,F=(P-R.cropCenter[2])*R.invRadiusZ;return L*L+j*j+F*F<=1}(F.x,F.y,F.z,j)})}function C(T){let I=T.cropSize[0]/2,P=T.cropSize[1]/2,R=T.cropSize[2]/2,L=[T.cropCenter[0]-I,T.cropCenter[1]-P,T.cropCenter[2]-R,T.cropCenter[0]+I,T.cropCenter[1]+P,T.cropCenter[2]+R],j=x(T.cropRotation);return Object.assign(L,{invRotationMatrix:j,cropCenter:T.cropCenter})}function x(T){let I=[],P=T[0]*Math.PI/180,R=T[1]*Math.PI/180,L=T[2]*Math.PI/180,j=Math.cos(P),F=Math.sin(P),N=Math.cos(R),q=Math.sin(R),W=Math.cos(L),U=Math.sin(L),V=j*W,Y=j*U,G=F*W,X=F*U;return I[0]=N*W,I[1]=-N*U,I[2]=q,I[4]=Y+G*q,I[5]=V-X*q,I[6]=-F*N,I[8]=X-V*q,I[9]=G+Y*q,I[10]=j*N,I[12]=0,I[13]=0,I[14]=0,I[3]=0,I[7]=0,I[11]=0,I[15]=1,I}function E(T){let I=2/T.cropSize[0],P=2/T.cropSize[1],R=2/T.cropSize[2],L=x(T.cropRotation);return{invRadiusX:I,invRadiusY:P,invRadiusZ:R,cropCenter:T.cropCenter,invRotationMatrix:L}}e.onmessage=T=>{if(T.data.getCroppedIndexes){let I=new Uint32Array(function _(T,I){let P=[],R=I.filter(F=>F.enabled&&"Include"===F.mode).map(F=>"Box"===F.type?C(F):E(F)),L=I.filter(F=>F.enabled&&"Exclude"===F.mode).map(F=>"Box"===F.type?C(F):E(F)),j=T.length;for(let F=0;F<j;F+=3){let N=T[F],q=T[F+1],W=T[F+2];(0===R.length||b(N,q,W,R))&&(0===L.length||!b(N,q,W,L))||P.push(F/3)}return console.log(P),P}(new Float32Array(T.data.positions),T.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:I},[I])}else if(T.data.positions)u=T.data.positions,p=new Float32Array(u),m=T.data.meshMatrixWorlds,g=T.data.cropsArray,f=T.data.meshIndexIntervals,y(m,g,f),e.postMessage({sortSetupComplete:!0});else if(T.data.sort||T.data.newMatrixWorlds||T.data.newCropsArray)(T.data.newMatrixWorlds||T.data.newCropsArray)&&(g=T.data.newCropsArray||g,m=T.data.newMatrixWorlds||m,y(m,g,f)),function v(T){let P,I=new Float64Array(h,o,16);for(let R=0;R<16;R++)I[R]=T[R];if(n>1){t.exports.sortIndexes(r,s,c,o,a,l,d.DepthMapRange,n);let R=new Uint32Array(n);P=R.buffer,R.set(new Uint32Array(h,l,n))}else if(1===n){let R=new Uint32Array(n);R[0]=new Uint32Array(h,r,i)[0],P=R.buffer}else P=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:P},[P])}(T.data.sort.view);else if(T.data.init){d=T.data.init.Constants,i=T.data.init.splatCount;let I=d.BytesPerInt,P=3*d.BytesPerFloat,R=new Uint8Array(T.data.init.sorterWasmBytes),W=Math.floor((i*(I+P)+(i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2)+32*d.MemoryPageSize)/d.MemoryPageSize)+1,U={module:{},env:{memory:new WebAssembly.Memory({initial:2*W,maximum:3*W,shared:!0})}};WebAssembly.compile(R).then(V=>WebAssembly.instantiate(V,U)).then(V=>{t=V,r=0,s=i*I,o=s+i*P,c=o+16*d.BytesPerFloat*2,a=c+i*d.BytesPerInt,l=a+d.DepthMapRange*d.BytesPerInt,h=U.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}Vr(Kc,"DepthMapRange",65536),Vr(Kc,"MemoryPageSize",65536),Vr(Kc,"BytesPerFloat",4),Vr(Kc,"BytesPerInt",4);var BI=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),zPe=function(e,t,i,n){return e+(t<<8)+(i<<16)+(n<<24)},Jw=new z,ex=class extends jr{constructor(e,t,i,n,r=!1,s=1,o,a){super(i,n),this.splatCount=t,this.meshIndexIntervals=o,this.meshMatrixWorlds=a,this.splatBuffers=e,this.geometry=i,this.material=n,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,n=1,r,s){let o=ex.buildGeomtery(t),a=ex.buildMaterial(r);return new ex(e,t,o,a,i,n,r,s)}static buildMaterial(e){let n={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new z},viewport:{type:"v2",value:new z},basisViewport:{type:"v2",value:new z},debugColor:{type:"v3",value:new Je},covariancesTextureSize:{type:"v2",value:new z(1024,1024)},centersColorsTextureSize:{type:"v2",value:new z(1024,1024)},orthoZoom:{type:"f",value:-1}};return new bi({uniforms:n,vertexShader:"\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",fragmentShader:"\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",transparent:!0,alphaTest:1,blending:ku,depthTest:!0,depthWrite:!1,side:hs})}static buildGeomtery(e){let t=new Ze;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),n=new st(i,3);t.setAttribute("position",n),n.setXYZ(0,-1,-1,0),n.setXYZ(1,-1,1,0),n.setXYZ(2,1,1,0),n.setXYZ(3,1,-1,0),n.needsUpdate=!0;let r=(new o4).copy(t),s=new Uint32Array(e),o=new Tj(s,1,!1);return o.setUsage(35048),r.setAttribute("splatIndex",o),r.instanceCount=e,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(n=>n.buildPreComputedBuffers()),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let e=0,t=0,i=0;for(let n of this.splatBuffers){let r=n.nsplats;this.colors.subarray(e,e+4*r).set(n.colorsA),e+=4*r,this.centers.subarray(t,t+3*r).set(n.decoded.xyz.denormDequant().data),t+=3*r,this.covariances.subarray(i,i+6*r).set(new Float32Array(n.precomputedCovarianceBufferData)),i+=6*r}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new z(4096,1024);for(;t.x*t.y*2<6*e;)t.y*=2;let n,r,i=new z(4096,1024);for(;i.x*i.y*4<4*e;)i.y*=2;if(this.halfPrecisionCovariancesOnGPU){r=new Uint16Array(t.x*t.y*2);for(let h=0;h<this.covariances.length;h++)r[h]=Hve.toHalfFloat(this.covariances[h]);n=new xc(r,t.x,t.y,__,Vu)}else r=new Float32Array(t.x*t.y*2),r.set(this.covariances),n=new xc(r,t.x,t.y,__,zr);n.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=n,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let h=0;h<e;h++){let u=4*h,d=3*h,p=4*h;s[p]=zPe(this.colors[u],this.colors[u+1],this.colors[u+2],this.colors[u+3]),s[p+1]=BI(this.centers[d]),s[p+2]=BI(this.centers[d+1]),s[p+3]=BI(this.centers[d+2])}let o=new xc(s,i.x,i.y,rU,yl);o.internalFormat="RGBA32UI",o.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=o,this.material.uniforms.centersColorsTextureSize.value.copy(i);let l=new Float32Array(4096);for(let h=0;h<this.meshMatrixWorlds.length;h++)l.set(this.meshMatrixWorlds[h].elements,16*h);let c=new xc(l,1024,1,Ls,zr);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:r,texture:n,size:t},centerColors:{data:s,texture:o,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,n){this.splatCount>0&&(Jw.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(Jw),this.material.uniforms.basisViewport.value.set(2/Jw.x,2/Jw.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=n,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose())}},VI=new Eg;VI.wireframe=!0;var M8=new M,zI=class extends wc{constructor(e,t){super(),this.data=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new class{constructor(){this._constraints=new Map}setConstraint(e,t){null===t?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,n)=>{let r=[n,i],s=i;for(;this._constraints.has(s);)s=this._constraints.get(s),t.has(s)||r.push(s);for(let o=r.length-2;o>=0;o--)if(!t.has(r[o])){let a=e.find(r[o]);a?a.applyPathSnapping(e):console.warn(`missing entity ${r[o]}`),t.add(r[o])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},this.errorPage=new Zc("fdasfa",{...Bp.defaultData,name:""}),this.invisibleObjects=new _f("jflkdsafjasdifjaslk",{...jD.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function EPe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof ff)if(Array.isArray(i.material))for(let n=0;n<i.material.length;n++)_8(i,i.material[n])&&(t=!0);else _8(i,i.material)&&(t=!0)}),t}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function CPe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof ff)if(Array.isArray(i.material))for(let n=0;n<i.material.length;n++)y8(i,i.material[n])&&(t=!0);else y8(i,i.material)&&(t=!0)}),t}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof Zc&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let i=[],n=t;for(;n!==this;){let r=n;n=n.parent;let s=n.children.indexOf(r);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let n=this.getWithSortKey(i.id);void 0!==n&&t.push(n)}return t.sort((i,n)=>function fCe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}(i.sortKey,n.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(void 0===i)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===e)return this.activePage.personalCamera;if(e===Tp)return this.activePage.personalCamera}if(""===e||void 0===e)return;let t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}debugEnsureEntity(e){let t=this.find(e);t?Array.isArray(t.identity)&&void 0===this.findInstance(t.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{e.cloner?.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){1===e.path.length&&"components"===e.path[0]&&1===e.type&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let i=null===e.parent?this:this.find(e.parent);if(void 0===i)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,i,e.localIndex,t);n.updateVisible(),n.resetBBoxNeedsUpdate(),Qo(n)&&ja(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(0===e.path.length&&8===e.type){let i=this.find(e.id);if(void 0===i)throw new Error("unexpected");this.markToExpandCloner(i),i.resetBBoxNeedsUpdate(),this.unregisterObject(i);let n=i.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(i),this.markPenumbraSizeDirty(),i.parent.remove(i),ja(i.parent)&&(i.parent.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Qo(i)&&(i.freeBooleanPointer(),n instanceof yf&&n.invalidateDownstreamBooleanData().recomputeBoolean()),i instanceof TI&&i.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),this.pathConstraints.removeDependencies(i.uuid),i.updatePathSnapping()}else if(0===e.path.length&&9===e.type){let i=this.find(e.id);if(void 0===i)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(i);let n=i.parent;this.markNeedsRecomputeInstancesForAncessors(n),i.cloner?.resetOnMove(),this.markToExpandCloner(i);let r=null===e.parent?this:this.find(e.parent);if(void 0===r)throw new Error("unexpected");r.add(i),this.markNeedsRecomputeInstancesForAncessors(r),this.markToExpandCloner(i),i.invalidateClonerTransform(i),i.updateVisible(),i.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty(),r.children.splice(e.localIndex,0,r.children.pop()),Qo(i)&&(i.invalidateUpstreamBooleanData(),ja(i.parent)?i.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof yf&&n.invalidateDownstreamBooleanData().recomputeBoolean()),i.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let t of this.children)t instanceof Zc&&(t.visible=t.uuid===e,t.visible&&(this.activePage=t,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(e,t,i,n){if(0===t.type){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}"pathSnapping"===t.path[0]&&void 0!==t.props.pathId&&this.pathConstraints.setConstraint(e,t.props.pathId)}let r=this.find(e);if(r)try{(function SPe(e,t,i,n){e.updateByOp(t,i,n,!1)})(r,t,i,{scene:this,shared:n}),r instanceof Jr&&r.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((n,r)=>({data:n[1].asset.data,children:n[1].asset.children,id:n[0],fi:r}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(n=>{ja(n)&&n.recomputeBoolean(),n instanceof xr&&n.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{("Component"===t.data.type||"Instance"===t.data.type)&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){zt.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{zt.is(t)&&"Component"===t.data.type&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,n,r,s,o){if(e){let a=n.find(e);a&&a!==n&&r.forInstancesRec(l=>{l.data=Kg(l.data,c=>{let h=c.events.data(o.id),u=l.goUp(s);if(u){let d=[...VH(u.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let f=p.uuid;Wr.zoom(h,t)[i]=f}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,n,r,s){e.forEach(o=>{("Transition"===o.data.type||"Animation"===o.data.type)&&this.relativeizeInner(o.data.object,[...t,o.id],"object",i,n,r,s)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof bf&&"string"==typeof e.identity&&"Component"===e.data.type)return e.traverseEntity((t,i)=>{t.data.events.forEach(n=>{if("GameControl"===n.data.type){let r=!1;if(t.forInstancesRec(s=>{s.data=Kg(s.data,o=>{s.isInstanceRoot||(o.events.delete(n.id),r=!0)}).data}),!1===r)for(let s of ow.list)this.rewriteActions(n.data.gameActions[s],["gameActions",s],e,t,i,n)}else"Conditional"===n.data.type?("Distance"===n.data.condition.type?(this.relativeizeInner(n.data.condition.fromObject,["condition"],"fromObject",e,t,i,n),this.relativeizeInner(n.data.condition.toObject,["condition"],"toObject",e,t,i,n)):"State"===n.data.condition.type?this.relativeizeInner(n.data.condition.object,["condition"],"object",e,t,i,n):"Comparison"===n.data.condition.type&&("Property"===n.data.condition.lOperand.type&&this.relativeizeInner(n.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,n),"Property"===n.data.condition.rOperand.type&&this.relativeizeInner(n.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,n)),this.rewriteActions(n.data.inActions,["inActions"],e,t,i,n),this.rewriteActions(n.data.outActions,["outActions"],e,t,i,n)):"actions"in n.data&&this.rewriteActions(n.data.actions,["actions"],e,t,i,n)})}),!0})}expandInstances(e,t,i){let n=new Set;this.traverseEntity(r=>{if(r instanceof bf&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:n}),t||r.resetBBoxNeedsUpdate(),i&&r.traverseEntity(s=>{i.addClip(s)}),!0});for(let r of n)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),II(r)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof bf&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i="string"==typeof t.identity?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)zt.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],n=r=>{for(let s of r.children){let o=s.cloner;if(zt.is(s)&&!s.raycastLock&&(s.visible||o?.object.data.visible))if(!0===t&&s.isInstanceRoot){let a=[];if(e.intersectObject(s,!0,a),a.length){let l=a[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(Qo(s)||mI(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),RI(s,e,i)),n(s)}};return n(this),i}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let s=r.cloner;zt.is(r)&&(r.visible||s?.object.data.visible)&&((Qo(r)||mI(r)&&this.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),RI(r,e,t,!0)),i(r))}};return i(this),t}forEachEntity(e){for(let t of this.children)zt.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)zt.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)zt.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof Jr&&"Mesh"===i.data.type&&"TextGeometry"===i.data.geometry.type&&i.data.geometry.font===e){let n=i.geometry,r=i.data.geometry;n.updateFont(e,t).then(()=>{n.update(r);let s=i.invalidateDownstreamBooleanData();ja(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)fv.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)zt.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,n,r,s){let o={scene:this,shared:s},a=PI(e,t,o);return a&&(this.entityByUuid[e]=a,n.add(a),n.children.splice(r,0,n.children.pop()),i.length>0&&(a.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,a,s)),a.updateState(t,o),a instanceof Jr&&a.updateGeometryGroupsIfNeeded(),a.updateVisible(),a.cloner&&this.toExpandCloner.add(a),t.pathSnapping?.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),"Empty"===t.type&&t.animations&&a.traverseEntity(l=>{if(l instanceof Jr&&l.isSkinnedMesh){let c=l.dataPatched;if(c.bones&&c.boneInverses){let h=c.bones.map(p=>this.find(p)),u=c.boneInverses.map(p=>(new ye).fromArray(p)),d=new tA(h,u);l.bind(d,l.bindMatrix)}}else l.matrixAutoUpdate=!0}),a}getCenter(e){let t=[];for(let n=0,r=e.length;n<r;++n){let{id:s,recursive:o}=e[n],a=this.find(s);t.push(...(o?a.recursiveBBox:a.singleBBox).vertices)}let i=new ln;return i.setFromPoints(t),i.getCenter(M8),M8}copyMatrixWorld(e,t){if(null===e)return void t.identity();let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){if(null===e)return void t.identity();let i=this.find(e)?.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof gs)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Wc&&e(t.material[i]);else t.material instanceof Wc&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(n=>{n instanceof xr&&n.setViewplaneSize(e,t,i)})}initializeSplatViewer(e){this.splatViewer=new class{constructor(e={}){Vr(this,"updateSplatMeshUniforms",function(){let t=new z;return function(){null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(this.renderer.getSize(t),this.cameraFocalLengthX=this.camera.projectionMatrix.elements[0]*this.devicePixelRatio*t.x*.45,this.cameraFocalLengthY=this.camera.projectionMatrix.elements[5]*this.devicePixelRatio*t.y*.45,this.splatMesh.updateUniforms(t,this.cameraFocalLengthX,this.cameraFocalLengthY,this.camera.isPerspectiveCamera?-1:this.camera.zoom*this.devicePixelRatio))}}()),Vr(this,"updateView",function(){let t=new ye,i=[],n=new M(0,0,-1),r=new M(0,0,-1),s=new M,o=new M;return function(a=!1){let l=this.updateMatrixWorldsInWorkerIfNeeded(),c=this.cropsChanged();if(!a){r.set(0,0,-1).applyQuaternion(this.camera.quaternion);let u=!1,d=!1;if(r.dot(n)<=.95&&(u=!0),o.copy(this.camera.position).sub(s).length()>=1&&(d=!0),!(u||d||l||c))return}s.copy(this.camera.position),n.copy(r),t.copy(this.camera.matrixWorld).invert(),t.premultiply(this.camera.perspCamera.projectionMatrix),i[0]=this.camera.position.x,i[1]=this.camera.position.y,i[2]=this.camera.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...l?{newMatrixWorlds:this.meshMatrixWorlds}:{},...c?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.renderer=e.renderer,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.splatRenderingInitialized=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null}get camera(){return this.scene.activeCamera}reloadSplats(){this.splatRenderingInitialized=!1;let e=this.loadSplat();this.renderer.pipeline.opaquePass.splatViewer=e?this:null}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=(new M).fromArray(e.position)),e.orientation&&(e.orientation=(new ft).fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseEntity(s=>{if("Splat"===s.data.type){let o=s.visible;s.traverseAncestors(a=>{o&&(o=a.visible)}),o&&t.push(s)}}),this.splatMesh&&this.splatMesh.dispose(),0===t.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(o=>o.data));let i=t.map(s=>new FI(new Uint8Array(s.data.buffer).buffer)),n=0,r=[0];for(let s of i)n+=s.getSplatCount(),r.push(n);return this.setupSplatMesh(i,n,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(n),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,16*t);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{t.data.crops.forEach((n,r)=>{void 0===this.cropsArray[i][r]?(e=!0,this.cropsArray[i][r]=n.data):Object.entries(n.data).forEach(([s,o])=>{(Array.isArray(o)&&o.some((a,l)=>a!==this.cropsArray[i][r][s][l])||o!==this.cropsArray[i][r]?.[s])&&(e=!0,this.cropsArray[i][r][s]=o)})}),t.data.crops.length!==this.cropsArray[i]?.length&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new M,n=new ft,r=!1,s=1,o,a){this.splatMesh=ex.buildMesh(e,t,r,s,o,a),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(n),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=10,this.updateSplatMeshUniforms(),this.splatRenderCount=t}setupSortWorker(e){this.sortWorker=function VPe(e){let t=new Worker(URL.createObjectURL(new Blob(["(",BPe.toString(),")(self)"],{type:"application/javascript"}))),i=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),n=new Uint8Array(i.length);for(let r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return t.postMessage({init:{sorterWasmBytes:n.buffer,splatCount:e,Constants:{BytesPerFloat:Kc.BytesPerFloat,BytesPerInt:Kc.BytesPerInt,DepthMapRange:Kc.DepthMapRange,MemoryPageSize:Kc.MemoryPageSize}}}),t}(e),this.sortWorker.onmessage=t=>{t.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.updateView(!0,!0),this.splatRenderingInitialized=!0)}}update(){!1!==this.splatRenderingInitialized&&(this.updateSplatMeshUniforms(),this.updateView())}getSplatMesh(){return this.splatMesh}}({scene:this,renderer:e}),this.reloadSplats()}reloadSplats(){this.splatViewer?.reloadSplats()}},tx=(e,t)=>{let i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},UI=e=>e*(Math.PI/180),jI=new Map,A8=e=>{jI.has(e)&&clearTimeout(jI.get(e)),jI.set(e,setTimeout(e,100))},ix=(e,t,i)=>{let r,n=t.split(/[ ,]+/g);for(let s=0;s<n.length;s+=1)r=n[s],e.addEventListener?e.addEventListener(r,i,!1):e.attachEvent&&e.attachEvent(r,i)},D8=(e,t,i)=>{let r,n=t.split(/[ ,]+/g);for(let s=0;s<n.length;s+=1)r=n[s],e.removeEventListener?e.removeEventListener(r,i):e.detachEvent&&e.detachEvent(r,i)},T8=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),I8=()=>{if(!(typeof window>"u"))return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},HI=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},GI=(e,t,i)=>{let n=P8(e);for(let r in n)if(n.hasOwnProperty(r))if("string"==typeof t)n[r]=t+" "+i;else{let s="";for(let o=0,a=t.length;o<a;o+=1)s+=t[o]+" "+i+", ";n[r]=s.slice(0,-2)}return n},P8=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},WI=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},qI=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)};typeof window<"u"&&(R8="ontouchstart"in window,O8=!!window.PointerEvent,L8=!!window.MSPointerEvent);var R8,O8,L8,Cf,Rv_mouse={start:"mousedown",move:"mousemove",end:"mouseup"},Ov={};function bh(){}O8?Cf={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:L8?Cf={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:R8?(Cf={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},Ov=Rv_mouse):Cf=Rv_mouse,bh.prototype.on=function(e,t){var r,i=this,n=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var s=0;s<n.length;s+=1)i._handlers_[r=n[s]]=i._handlers_[r]||[],i._handlers_[r].push(t);return i},bh.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},void 0===e?i._handlers_={}:void 0===t?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i},bh.prototype.trigger=function(e,t){var r,i=this,n=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var s=0;s<n.length;s+=1)i._handlers_[r=n[s]]&&i._handlers_[r].length&&i._handlers_[r].forEach(function(o){o.call(i,{type:r,target:i},t)})},bh.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=((e,t)=>{let i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i})(t.options,e))},bh.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){"function"==typeof i["on"+t]?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},ix(e,Cf[t],i._domHandlers_[t]),Ov[t]&&ix(e,Ov[t],i._domHandlers_[t]),i},bh.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},D8(e,Cf[t],i._domHandlers_[t]),Ov[t]&&D8(e,Ov[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var YI=bh;function Un(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Un.id,Un.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Un.prototype=new YI,Un.constructor=Un,Un.id=0,Un.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Un.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=((e,t)=>{let i=P8("borderRadius");for(let n in i)i.hasOwnProperty(n)&&(i[n]="50%");return i})(),i=GI("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},WI(n.el,i),"circle"===this.options.shape&&WI(n.back,t),WI(n.front,t),this.applyStyles(n),this},Un.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this},Un.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Un.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Un.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Un.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},Un.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){t.ui.el.style.display="dynamic"===t.options.mode?"none":"block","function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:t.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t},Un.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r={};r.front=GI("transition",["top","left"],i.options.fadeTime+"ms");var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(r),i.applyStyles(s),i.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(i),i.restCallback()},i.options.fadeTime)},Un.prototype.restCallback=function(){var e=this,t={};t.front=GI("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},Un.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Un.prototype.computeDirection=function(e){var r,s,o,t=e.angle.radian,i=Math.PI/4,n=Math.PI/2;if(t>i&&t<3*i&&!e.lockX?r="up":t>-i&&t<=i&&!e.lockY?r="left":t>3*-i&&t<=-i&&!e.lockX?r="down":e.lockY||(r="right"),e.lockY||(s=t>-n&&t<n?"left":"right"),e.lockX||(o=t>0?"up":"down"),e.force>this.options.threshold){var l,a={};for(l in this.direction)this.direction.hasOwnProperty(l)&&(a[l]=this.direction[l]);var c={};for(l in this.direction={x:s,y:o,angle:r},e.direction=this.direction,a)a[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+o,e),c.angle||this.trigger("dir dir:"+r,e)}else this.resetDirection();return e};var ZPe=Un;function dn(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=dn.id,dn.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),("static"===i.options.mode||"semi"===i.options.mode)&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let n=getComputedStyle(i.options.zone.parentElement);return n&&"flex"===n.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}dn.prototype=new YI,dn.constructor=dn,dn.id=0,dn.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(void 0===i)return t[0];for(var n=0,r=t.length;n<r;n+=1)if(t[n].identifier===i)return t[n];return!1}},dn.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},dn.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}},dn.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,r={},s=i.options;if(e.x&&e.y)r={x:e.x-(i.parentIsFlex?n.x:n.x+i.box.left),y:e.y-(i.parentIsFlex?n.y:n.y+i.box.top)};else if(e.top||e.right||e.bottom||e.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=e.top,a.style.right=e.right,a.style.bottom=e.bottom,a.style.left=e.left,a.style.position="absolute",s.zone.appendChild(a);var l=a.getBoundingClientRect();s.zone.removeChild(a),r=e,e={x:l.left+n.x,y:l.top+n.y}}var c=new ZPe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(HI(c.ui.el,r),HI(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c},dn.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},dn.prototype.bindNipple=function(e){var t=this,n=function(r,s){t.trigger(r.type+" "+s.id+":"+r.type,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},dn.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval(function(){var s=e.force||e.pressure||e.webkitForce||0;s!==r&&(t.trigger("pressure",s),n.trigger("pressure "+t.identifier+":pressure",s),r=s)}.bind(n),100)},dn.prototype.onstart=function(e){var t=this,i=t.options,n=e;return e=T8(e),t.updateBox(),qI(e,function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(o){if(Object.values(n.touches).findIndex(function(l){return l.identifier===o})<0){var a=[e[0]];a.identifier=o,t.processOnEnd(a)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))}),t.manager.bindDocument(),!1},dn.prototype.processOnStart=function(e){var n,t=this,i=t.options,r=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,o={x:e.pageX,y:e.pageY},a=t.getOrCreate(r,o);a.identifier!==r&&t.manager.removeIdentifier(a.identifier),a.identifier=r;var l=function(h){h.trigger("start",h),t.trigger("start "+h.id+":start",h),h.show(),s>0&&t.pressureFn(e,h,h.identifier),t.processOnMove(e)};if((n=t.idles.indexOf(a))>=0&&t.idles.splice(n,1),t.actives.push(a),t.ids.push(a.identifier),"semi"!==i.mode)l(a);else{if(!(tx(o,a.position)<=i.catchDistance))return a.destroy(),void t.processOnStart(e);l(a)}return a},dn.prototype.getOrCreate=function(e,t){var r,i=this,n=i.options;return/(semi|static)/.test(n.mode)?(r=i.idles[0])?(i.idles.splice(0,1),r):"semi"===n.mode?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):r=i.createNipple(t,e)},dn.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),s=t.manager.scroll;if((e=>isNaN(e.buttons)?0!==e.pressure:0!==e.buttons)(e)){if(!r)return console.error("Found zombie joystick with ID "+n),void t.manager.removeIdentifier(n);if(i.dynamicPage){var o=r.el.getBoundingClientRect();r.position={x:s.x+o.left,y:s.y+o.top}}r.identifier=n;var a=r.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=r.position.y),i.lockY&&(l.x=r.position.x);var f,m,c=tx(l,r.position),h=((e,t)=>(e=>e*(180/Math.PI))(Math.atan2(t.y-e.y,t.x-e.x)))(l,r.position),u=UI(h),d=c/a,p={distance:c,position:l};if("circle"===r.options.shape?(f=Math.min(c,a),m=((e,t,i)=>{let n={x:0,y:0};return i=UI(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n})(r.position,f,h)):(m=((e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)}))(l,r.position,a),f=tx(m,r.position)),i.follow){if(c>a){let b=l.y-m.y;r.position.x+=l.x-m.x,r.position.y+=b,r.el.style.top=r.position.y-(t.box.top+s.y)+"px",r.el.style.left=r.position.x-(t.box.left+s.x)+"px",c=tx(l,r.position)}}else l=m,c=f;var g=l.x-r.position.x,v=l.y-r.position.y;r.frontPosition={x:g,y:v},i.dataOnly||HI(r.ui.front,r.frontPosition);var y={identifier:r.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:u,degree:h},vector:{x:g/a,y:-v/a},raw:p,instance:r,lockX:i.lockX,lockY:i.lockY};(y=r.computeDirection(y)).angle={radian:UI(180-h),degree:180-h},r.trigger("move",y),t.trigger("move "+r.id+":move",y)}else this.processOnEnd(e)},dn.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),s=t.manager.removeIdentifier(r.identifier);!r||(i.dataOnly||r.hide(function(){"dynamic"===i.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))},dn.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()},dn.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()}),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var QPe=dn;function Qn(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=I8(),t.config(e),t.prepareCollections();var i=function(){var r;t.collections.forEach(function(s){s.forEach(function(o){r=o.el.getBoundingClientRect(),o.position={x:t.scroll.x+r.left,y:t.scroll.y+r.top}})})};if(typeof window>"u")return t.collections;ix(window,"resize",function(){A8(i)});var n=function(){t.scroll=I8()};return ix(window,"scroll",function(){A8(n)}),t.collections}Qn.prototype=new YI,Qn.constructor=Qn,Qn.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(n){return!(i=n.get(t))}),i}},Qn.prototype.create=function(e){return this.createCollection(e)},Qn.prototype.createCollection=function(e){var t=this,i=new QPe(t,e);return t.bindCollection(i),t.collections.push(i),i},Qn.prototype.bindCollection=function(e){var t=this,n=function(r,s){t.trigger(r.type+" "+s.id+":"+r.type,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},Qn.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},Qn.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||!0===e)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},Qn.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},Qn.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t},Qn.prototype.onmove=function(e){return this.onAny("move",e),!1},Qn.prototype.onend=function(e){return this.onAny("end",e),!1},Qn.prototype.oncancel=function(e){return this.onAny("end",e),!1},Qn.prototype.onAny=function(e,t){var n,i=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=T8(t);var s=function(a,l,c){c.ids.indexOf(l)>=0&&(c[r](a),a._found_=!0)};return qI(t,function(a){n=i.getIdentifier(a),qI(i.collections,s.bind(null,a,n)),a._found_||i.removeIdentifier(n)}),!1},Qn.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()},Qn.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var N8=new Qn,k8=new Map,Lv=new Map,wh=class{constructor(e,t,i,n){this.data=t;let{audio:r,volume:s,delay:o,loop:a}=t;if(!r)throw new Error("Missing property");let l="string"==typeof r?n.getAudio(r).src:r.data;this.audioPlayer=new xv({src:l,volume:s,delay:o,loop:a}),Lv.has(i.uuid)?Lv.get(i.uuid).push(this):Lv.set(i.uuid,[this]),k8.set(e,this)}playByToggle(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},XI=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=k8.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=Lv.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...Lv.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},F8=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new wh(e,t,i,n);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new XI(t)}}dispatchBasic(){if(!1===Mn(this.shared,this.condition))return!1;this.interaction instanceof wh?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===Mn(this.shared,this.condition))return!1;this.interaction instanceof wh?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(!1===Mn(this.shared,this.condition))return!1;this.interaction instanceof wh&&("start"===e?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},B8=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e);var V8=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{this.timeoutIdQueue.shift();let o=this.page.scene.find(s);if(void 0===o)return;let a=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=!a||o.dataPatched.physics?.fusedBody;if(o.cloner){for(let c of o.cloner.children)l?(c.playModeVisible=!1,c.rigidBody&&"positioned"===o.dataPatched.physics?.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),a.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.bvhGeometry&&(c.bvhGeometry=void 0)):void 0===this.clone||this.clone===c?(c.playModeVisible=!1,c.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),a.removeRigidBody(c.rigidBody),c.rigidBody=void 0)):void 0===c.playModeVisible&&(c.playModeVisible=!0);(l||void 0===this.clone||!1===this.clone)&&(o.visible=!1,o.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(o.rigidBody.collider(0).handle),a.removeRigidBody(o.rigidBody),o.rigidBody=void 0),o.bvhGeometry&&(o.bvhGeometry=void 0))}else o.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(o.rigidBody.collider(0).handle),a.removeRigidBody(o.rigidBody),o.rigidBody=void 0),o.bvhGeometry&&(o.bvhGeometry=void 0),o.visible=!1;this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(void 0===a?c=>void 0!==c.bvhGeometry:c=>void 0!==c.rigidBody),o.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(!1===Mn(this.shared,this.condition))return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()}dispatchFromStart(){if(!1===Mn(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},z8=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.shared=i,this.eventManager=n,this.condition=r,this.shared=i}dispatch(){if(!1===Mn(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{this.shared.reset(this.shared.data,!0),c2(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},1e3*(this.data.delay??0))}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},U8={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},ZI={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},rRe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],nx={CSS:{},springs:{}};function $o(e,t,i){return Math.min(Math.max(e,t),i)}function Nv(e,t){return e.indexOf(t)>-1}function QI(e,t){return e.apply(null,t)}var lt={arr:function(e){return Array.isArray(e)},obj:function(e){return Nv(Object.prototype.toString.call(e),"Object")},pth:function(e){return lt.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||lt.svg(e))},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return lt.hex(e)||lt.rgb(e)||lt.hsl(e)},key:function(e){return!U8.hasOwnProperty(e)&&!ZI.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}};function j8(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function H8(e,t){var i=j8(e),n=$o(lt.und(i[0])?1:i[0],.1,100),r=$o(lt.und(i[1])?100:i[1],.1,100),s=$o(lt.und(i[2])?10:i[2],.1,100),o=$o(lt.und(i[3])?0:i[3],.1,100),a=Math.sqrt(r/n),l=s/(2*Math.sqrt(r*n)),c=l<1?a*Math.sqrt(1-l*l):0,u=l<1?(l*a-o)/c:-o+a;function d(f){var m=t?t*f/1e3:f;return m=l<1?Math.exp(-m*l*a)*(1*Math.cos(c*m)+u*Math.sin(c*m)):(1+u*m)*Math.exp(-m*a),0===f||1===f?f:1-m}return t?d:function p(){var f=nx.springs[e];if(f)return f;for(var m=1/6,g=0,v=0;;)if(1===d(g+=m)){if(++v>=16)break}else v=0;var y=g*m*1e3;return nx.springs[e]=y,y}}function sRe(e){return void 0===e&&(e=10),function(t){return Math.ceil($o(t,1e-6,1)*e)*(1/e)}}var oRe=function(){var t=.1;function i(h,u){return 1-3*u+3*h}function n(h,u){return 3*u-6*h}function r(h){return 3*h}function s(h,u,d){return((i(u,d)*h+n(u,d))*h+r(u))*h}function o(h,u,d){return 3*i(u,d)*h*h+2*n(u,d)*h+r(u)}return function c(h,u,d,p){if(0<=h&&h<=1&&0<=d&&d<=1){var f=new Float32Array(11);if(h!==u||d!==p)for(var m=0;m<11;++m)f[m]=s(m*t,h,d);return function(v){return h===u&&d===p||0===v||1===v?v:s(function g(v){for(var y=0,_=1;10!==_&&f[_]<=v;++_)y+=t;--_;var C=y+(v-f[_])/(f[_+1]-f[_])*t,x=o(C,h,d);return x>=.001?function l(h,u,d,p){for(var f=0;f<4;++f){var m=o(u,d,p);if(0===m)return u;u-=(s(u,d,p)-h)/m}return u}(v,C,h,d):0===x?C:function a(h,u,d,p,f){var m,g,v=0;do{(m=s(g=u+(d-u)/2,p,f)-h)>0?d=g:u=g}while(Math.abs(m)>1e-7&&++v<10);return g}(v,y,y+t,h,d)}(v),u,p)}}}}(),G8=function(){var e={linear:function(){return function(n){return n}}},t={Sine:function(){return function(n){return 1-Math.cos(n*Math.PI/2)}},Circ:function(){return function(n){return 1-Math.sqrt(1-n*n)}},Back:function(){return function(n){return n*n*(3*n-2)}},Bounce:function(){return function(n){for(var r,s=4;n<((r=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((3*r-2)/22-n,2)}},Elastic:function(n,r){void 0===n&&(n=1),void 0===r&&(r=.5);var s=$o(n,1,10),o=$o(r,.1,2);return function(a){return 0===a||1===a?a:-s*Math.pow(2,10*(a-1))*Math.sin((a-1-o/(2*Math.PI)*Math.asin(1/s))*(2*Math.PI)/o)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach(function(n,r){t[n]=function(){return function(s){return Math.pow(s,r+2)}}}),Object.keys(t).forEach(function(n){var r=t[n];e["easeIn"+n]=r,e["easeOut"+n]=function(s,o){return function(a){return 1-r(s,o)(1-a)}},e["easeInOut"+n]=function(s,o){return function(a){return a<.5?r(s,o)(2*a)/2:1-r(s,o)(-2*a+2)/2}}}),e}();function KI(e,t){if(lt.fnc(e))return e;var i=e.split("(")[0],n=G8[i],r=j8(e);switch(i){case"spring":return H8(e,t);case"cubicBezier":return QI(oRe,r);case"steps":return QI(sRe,r);default:return QI(n,r)}}function W8(e){try{return document.querySelectorAll(e)}catch{return}}function rx(e,t){for(var i=e.length,n=arguments.length>=2?arguments[1]:void 0,r=[],s=0;s<i;s++)if(s in e){var o=e[s];t.call(n,o,s,e)&&r.push(o)}return r}function sx(e){return e.reduce(function(t,i){return t.concat(lt.arr(i)?sx(i):i)},[])}function q8(e){return lt.arr(e)?e:(lt.str(e)&&(e=W8(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function $I(e,t){return e.some(function(i){return i===t})}function JI(e){var t={};for(var i in e)t[i]=e[i];return t}function e2(e,t){var i=JI(e);for(var n in e)i[n]=t.hasOwnProperty(n)?t[n]:e[n];return i}function ox(e,t){var i=JI(e);for(var n in t)i[n]=lt.und(e[n])?t[n]:e[n];return i}function Gl(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function t2(e,t){return lt.fnc(e)?e(t.target,t.id,t.total):e}function Ya(e,t){return e.getAttribute(t)}function n2(e,t,i){if($I([i,"deg","rad","turn"],Gl(t)))return t;var r=nx.CSS[t+i];if(!lt.und(r))return r;var o=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(o),o.style.position="absolute",o.style.width=100+i;var l=100/o.offsetWidth;a.removeChild(o);var c=l*parseFloat(t);return nx.CSS[t+i]=c,c}function Y8(e,t,i){if(t in e.style){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(n)||"0";return i?n2(e,r,i):r}}function r2(e,t){return lt.dom(e)&&!lt.inp(e)&&(Ya(e,t)||lt.svg(e)&&e[t])?"attribute":lt.dom(e)&&$I(rRe,t)?"transform":lt.dom(e)&&"transform"!==t&&Y8(e,t)?"css":null!=e[t]?"object":void 0}function X8(e){if(lt.dom(e)){for(var r,t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,n=new Map;r=i.exec(t);)n.set(r[1],r[2]);return n}}function s2(e,t,i,n){switch(r2(e,t)){case"transform":return function dRe(e,t,i,n){var r=Nv(t,"scale")?1:0+function hRe(e){return Nv(e,"translate")||"perspective"===e?"px":Nv(e,"rotate")||Nv(e,"skew")?"deg":void 0}(t),s=X8(e).get(t)||r;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),n?n2(e,s,n):s}(e,t,n,i);case"css":return Y8(e,t,i);case"attribute":return Ya(e,t);default:return e[t]||0}}function o2(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var n=Gl(e)||0,r=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return r+s+n;case"-":return r-s+n;case"*":return r*s+n}}function Z8(e,t){if(lt.col(e))return function uRe(e){return lt.rgb(e)?function aRe(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}(e):lt.hex(e)?function lRe(e){var i=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,l,c,h){return l+l+c+c+h+h}),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return"rgba("+parseInt(n[1],16)+","+parseInt(n[2],16)+","+parseInt(n[3],16)+",1)"}(e):lt.hsl(e)?function cRe(e){var a,l,c,t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100,s=t[4]||1;function o(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+6*(p-d)*f:f<.5?p:f<2/3?d+(p-d)*(2/3-f)*6:d}if(0==n)a=l=c=r;else{var h=r<.5?r*(1+n):r+n-r*n,u=2*r-h;a=o(u,h,i+1/3),l=o(u,h,i),c=o(u,h,i-1/3)}return"rgba("+255*a+","+255*l+","+255*c+","+s+")"}(e):void 0}(e);if(/\s/g.test(e))return e;var i=Gl(e),n=i?e.substr(0,e.length-i.length):e;return t?n+t:n}function a2(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Q8(e){for(var n,t=e.points,i=0,r=0;r<t.numberOfItems;r++){var s=t.getItem(r);r>0&&(i+=a2(n,s)),n=s}return i}function K8(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function pRe(e){return 2*Math.PI*Ya(e,"r")}(e);case"rect":return function fRe(e){return 2*Ya(e,"width")+2*Ya(e,"height")}(e);case"line":return function mRe(e){return a2({x:Ya(e,"x1"),y:Ya(e,"y1")},{x:Ya(e,"x2"),y:Ya(e,"y2")})}(e);case"polyline":return Q8(e);case"polygon":return function gRe(e){var t=e.points;return Q8(e)+a2(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function $8(e,t){var i=t||{},n=i.el||function yRe(e){for(var t=e.parentNode;lt.svg(t)&&lt.svg(t.parentNode);)t=t.parentNode;return t}(e),r=n.getBoundingClientRect(),s=Ya(n,"viewBox"),o=r.width,a=r.height,l=i.viewBox||(s?s.split(" "):[0,0,o,a]);return{el:n,viewBox:l,x:l[0]/1,y:l[1]/1,w:o/l[2],h:a/l[3]}}function bRe(e,t){function i(a){return void 0===a&&(a=0),e.el.getPointAtLength(t+a>=1?t+a:0)}var n=$8(e.el,e.svg),r=i(),s=i(-1),o=i(1);switch(e.property){case"x":return(r.x-n.x)*n.w;case"y":return(r.y-n.y)*n.h;case"angle":return 180*Math.atan2(o.y-s.y,o.x-s.x)/Math.PI}}function J8(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=Z8(lt.pth(e)?e.totalLength:e,t)+"";return{original:n,numbers:n.match(i)?n.match(i).map(Number):[0],strings:lt.str(e)||t?n.split(i):[]}}function e9(e){return rx(e?sx(lt.arr(e)?e.map(q8):q8(e)):[],function(i,n,r){return r.indexOf(i)===n})}function t9(e){var t=e9(e);return t.map(function(i,n){return{target:i,id:n,total:t.length,transforms:{list:X8(i)}}})}function wRe(e,t){var i=JI(t);if(/^spring/.test(i.easing)&&(i.duration=H8(i.easing)),lt.arr(e)){var n=e.length;2!==n||lt.obj(e[0])?lt.fnc(t.duration)||(i.duration=t.duration/n):e={value:e}}var s=lt.arr(e)?e:[e];return s.map(function(o,a){var l=lt.obj(o)&&!lt.pth(o)?o:{value:o};return lt.und(l.delay)&&(l.delay=a?0:t.delay),lt.und(l.endDelay)&&(l.endDelay=a===s.length-1?t.endDelay:0),l}).map(function(o){return ox(o,i)})}var i9={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,n,r){if(n.list.set(t,i),t===n.last||r){var s="";n.list.forEach(function(o,a){s+=a+"("+o+") "}),e.style.transform=s}}};function n9(e,t){t9(e).forEach(function(n){for(var r in t){var s=t2(t[r],n),o=n.target,a=Gl(s),l=s2(o,r,a,n),h=o2(Z8(s,a||Gl(l)),l),u=r2(o,r);i9[u](o,r,h,n.transforms,!0)}})}function ARe(e,t){return rx(sx(e.map(function(i){return t.map(function(n){return function MRe(e,t){var i=r2(e.target,t.name);if(i){var n=function ERe(e,t){var i;return e.tweens.map(function(n){var r=function CRe(e,t){var i={};for(var n in e){var r=t2(e[n],t);lt.arr(r)&&1===(r=r.map(function(s){return t2(s,t)})).length&&(r=r[0]),i[n]=r}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}(n,t),s=r.value,o=lt.arr(s)?s[1]:s,a=Gl(o),l=s2(t.target,e.name,a,t),c=i?i.to.original:l,h=lt.arr(s)?s[0]:c,u=Gl(h)||Gl(l),d=a||u;return lt.und(o)&&(o=c),r.from=J8(h,d),r.to=J8(o2(o,h),d),r.start=i?i.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=KI(r.easing,r.duration),r.isPath=lt.pth(s),r.isColor=lt.col(r.from.original),r.isColor&&(r.round=1),i=r,r})}(t,e),r=n[n.length-1];return{type:i,property:t.name,animatable:e,tweens:n,duration:r.end,delay:n[0].delay,endDelay:r.endDelay}}}(i,n)})})),function(i){return!lt.und(i)})}function r9(e,t){var i=e.length,n=function(s){return s.timelineOffset?s.timelineOffset:0},r={};return r.duration=i?Math.max.apply(Math,e.map(function(s){let o=s.startOnceDelay??0,a=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return n(s)+o+a+l+s.duration*(s.loop??1)})):t.duration,r.delay=i?Math.min.apply(Math,e.map(function(s){let o=s.startOnceDelay??0,a=s.pingPongDelayCorrection??0;return n(s)+o+a+s.delay})):t.delay,r.endDelay=i?r.duration-Math.max.apply(Math,e.map(function(s){let o=s.startOnceDelay??0,a=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return n(s)+o+a+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,r}var ax,s9=0,yo=[],o9=[],TRe=function(){function e(){ax=requestAnimationFrame(t)}function t(i){var n=yo.length;if(n){for(var r=0;r<n;){var s=yo[r];s.paused?(yo.splice(r,1),n-=1):(s.tick(i),r++)}e()}else ax=cancelAnimationFrame(ax)}return e}();function pn(e){void 0===e&&(e={});var r,s,t=0,i=0,n=0,o=0,a=null;function l(x){var S=window.Promise&&new Promise(function(E){return a=E});return x.finished=S,S}var c=function DRe(e){var t=e2(U8,e),i=e2(ZI,e),n=function SRe(e,t){var i=[],n=t.keyframes;for(var r in n&&(t=ox(function xRe(e){for(var t=rx(sx(e.map(function(s){return Object.keys(s)})),function(s){return lt.key(s)}).reduce(function(s,o){return s.indexOf(o)<0&&s.push(o),s},[]),i={},n=function(s){var o=t[s];i[o]=e.map(function(a){var l={};for(var c in a)lt.key(c)?c==o&&(l.value=a[c]):l[c]=a[c];return l})},r=0;r<t.length;r++)n(r);return i}(n),t)),t)lt.key(r)&&i.push({name:r,tweens:wRe(t[r],e)});return i}(i,e),r=t9(e.targets),s=ARe(r,n),o=r9(s,i),a=s9;return s9++,ox(t,{id:a,children:[],animatables:r,animations:s,duration:o.duration,delay:o.delay,endDelay:o.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}(e);function u(){var x=c.direction;"alternate"!==x&&(c.direction="normal"!==x?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(S){(1===S.loop||S.loop%2==0)&&(S.reversed=c.reversed)})}function p(x){return c.reversed?c.duration-x:x}function m(x,S,E=!1){S&&S.seek(c.reversed?S.duration*S.loop-(x-S.timelineOffset-S.pingPongDelayCorrection):x-S.timelineOffset-S.startOnceDelay-S.pingPongDelayCorrection,E)}function v(x){var S=0,E=c.animations,D=E.length;for("alternate"!==c.direction&&"alternate"===c.parent?.direction?!1===c.parent?.rewind&&!0===c.reversePlayback&&!1===c.rewind&&(x=c.parent?.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-x:c.duration+c.delay-c.endDelay-x):w(!1,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)&&(x=c.parent?.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-x:c.duration+c.delay-c.endDelay-x);S<D;){var T=E[S],I=T.animatable,P=T.tweens,R=P.length-1,L=P[R];let se;R&&(L=rx(P,function($){return x<$.end})[0]||L),se=c.parent?.reversed&&"alternate"===c.direction?$o(x-L.start-L.endDelay,0,L.duration)/L.duration:$o(x-L.start-L.delay,0,L.duration)/L.duration;for(var j=isNaN(se)?1:L.easing(se),F=L.to.strings,N=L.round,q=[],W=L.to.numbers.length,U=void 0,V=0;V<W;V++){var Y=void 0;let $,ge;"alternate"!==c.direction?!1===c.parent?.rewind&&!0===c.reversePlayback&&!1===c.rewind?($=L.to.numbers[V],ge=L.from.numbers[V]||0):(ge=L.to.numbers[V],$=L.from.numbers[V]||0):w(!0,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)?($=L.to.numbers[V],ge=L.from.numbers[V]||0):(ge=L.to.numbers[V],$=L.from.numbers[V]||0),Y=L.isPath?bRe(L.value,j*ge):$+j*(ge-$),N&&(L.isColor&&V>2||(Y=Math.round(Y*N)/N)),q.push(Y)}var G=F.length;if(G){U=F[0];for(var X=0;X<G;X++){var re=F[X+1],K=q[X];isNaN(K)||(U+=re?K+re:K+" ")}}else U=q[0];i9[T.type](I.target,T.property,U,I.transforms),T.currentValue=U,S++}}function y(x){c[x]&&!c.passThrough&&c[x](c)}l(c);let b={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function w(x,S,E,D,T){return b[x<<4|S<<3|E<<2|D<<1|T]}function C(x,S=!1){var E=c.duration;let D=c.delay,T=E-c.endDelay;c.parent?.reversed&&"alternate"===c.direction&&(D=c.endDelay,T=E-c.delay);var I=p(x);if(c.progress=$o(I/E*100,0,100),S||(c.reversePlayback=I<c.currentTime),o&&function g(x,S=!1){if(c.reversed)for(var E=o;E--;)m(x,s[E],S);else for(var D=0;D<o;D++)m(x,s[D],S)}(I,S),!c.began&&c.currentTime>=0&&(c.began=!0,y("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,y("loopBegin")),(c.reversed||I>=0)&&I<=D&&0!==c.currentTime&&(v(0),y("change")),(I>=T&&c.currentTime!==E+c.pingPongDelayCorrection||!E)&&(v(E),y("change")),I>D&&I<T?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,y("changeBegin")),v(I),y("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,y("change"),o&&y("timelineChangeComplete")):c.began&&I>T&&y("changeComplete"),c.currentTime=$o(I,0,E+c.pingPongDelayCorrection),c.began&&y("update"),x>=E)if(function _(){c.remaining&&!0!==c.remaining&&c.remaining--}(),c.remaining){t+=o?c.duration/pn.speed:c.duration;for(let P of s)P.setStartTime(0),P.remaining=P.loop;y("loopComplete"),c.loopBegan=!1,"alternate"===c.direction?u():o&&function d(){c.direction="normal",c.reversed=!1,s.forEach(function(x){return x.reversed=!1})}()}else c.paused=!0,c.completed||(c.completed=!0,y("loopComplete"),y("complete"),!c.passThrough&&"Promise"in window&&(a(),l(c)))}return c.reset=function(){var x=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed="reverse"===x,c.remaining=c.loop;for(var S=o=(s=c.children).length;S--;)c.children[S].reset();v(c.reversed?c.duration:0)},c.setStartTime=function(x){t=x},c.set=function(x,S){return n9(x,S),c},c.tick=function(x){n=x,t||(t=n),C((n+(i-t))*pn.speed)},c.seek=function(x,S=!1){C(x-t,S)},c.pause=function(x){c.paused=!0,o&&(r=x??performance.now())},c.play=function(x){!c.paused||(c.completed&&c.reset(),c.paused=!1,yo.push(c),o&&void 0!==r&&(t+=(x??performance.now())-r),ax||TRe())},c.reverse=function(){u(),c.completed=!c.reversed,function f(){t=0,i=p(c.currentTime)*(1/pn.speed)}()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function a9(e,t){for(var i=t.length;i--;)$I(e,t[i].animatable.target)&&t.splice(i,1)}typeof document<"u"&&document.addEventListener("visibilitychange",function IRe(e){document.hidden?(yo.forEach(function(t){return t.pause(e.timeStamp)}),o9=yo.slice(0),pn.running=yo=[]):o9.forEach(function(t){return t.play(e.timeStamp)})}),pn.version="3.2.0",pn.speed=1,pn.running=yo,pn.remove=function PRe(e){for(var t=e9(e),i=yo.length;i--;){var n=yo[i],r=n.animations,s=n.children;a9(t,r);for(var o=s.length;o--;){var a=s[o],l=a.animations;a9(t,l),!l.length&&!a.children.length&&s.splice(o,1)}!r.length&&!s.length&&n.pause()}},pn.get=s2,pn.set=n9,pn.convertPx=n2,pn.path=function _Re(e,t){var i=lt.str(e)?W8(e)[0]:e,n=t||100;return function(r){return{property:r,el:i,svg:$8(i),totalLength:K8(i)*(n/100)}}},pn.setDashoffset=function vRe(e){var t=K8(e);return e.setAttribute("stroke-dasharray",t),t},pn.stagger=function RRe(e,t){void 0===t&&(t={});var i=t.direction||"normal",n=t.easing?KI(t.easing):null,r=t.grid,s=t.axis,o=t.from||0,a="first"===o,l="center"===o,c="last"===o,h=lt.arr(e),u=parseFloat(h?e[0]:e),d=h?parseFloat(e[1]):0,p=Gl(h?e[1]:e)||0,f=t.start||0+(h?u:0),m=[],g=0;return function(v,y,_){if(a&&(o=0),l&&(o=(_-1)/2),c&&(o=_-1),!m.length){for(var b=0;b<_;b++){if(r){var w=l?(r[0]-1)/2:o%r[0],C=l?(r[1]-1)/2:Math.floor(o/r[0]),E=w-b%r[0],D=C-Math.floor(b/r[0]),T=Math.sqrt(E*E+D*D);"x"===s&&(T=-E),"y"===s&&(T=-D),m.push(T)}else m.push(Math.abs(o-b));g=Math.max.apply(Math,m)}n&&(m=m.map(function(P){return n(P/g)*g})),"reverse"===i&&(m=m.map(function(P){return s?P<0?-1*P:-P:Math.abs(g-P)}))}return f+(h?(d-u)/g:u)*(Math.round(100*m[y])/100)+p}},pn.timeline=function ORe(e){void 0===e&&(e={});var t=pn(e);return t.duration=0,t.add=function(i,n){var r=yo.indexOf(t),s=t.children;function o(d){d.passThrough=!0}r>-1&&yo.splice(r,1);for(var a=0;a<s.length;a++)o(s[a]);var l=ox(i,e2(ZI,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=lt.und(n)?c:o2(n,c),o(t);var h=pn(l);o(h),s.push(h),h.parent=t;var u=r9(s,e);return t.delay=u.delay,t.endDelay=u.endDelay,t.duration=u.duration,!0===h.loop&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},pn.easing=KI,pn.penner=G8,pn.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var l9=pn,c9=new M,u9=new M,h9=new ft;function xh(e,t,i,n,r,s){let o=i[e]?i[e]:void 0,a=n[e];if(null==a)return;let l=null!=o?"string"==typeof o?Number(r.getVariable(o)??0):o:t[e],c="string"==typeof a?Number(r.getVariable(a)??0):a;return l!==c?{update:h=>{let u=qe.lerp(l,c,h);t[e]=s?Math.trunc(u):u},start:()=>{t[e]=l},end:()=>{t[e]=c}}:void 0}function d9(e,t,i,n,r,s){let a=n[e];if(!a)return;let c=[...(i[e]?i[e]:void 0)??t[e]].map(u=>"string"==typeof u?Number(r.getVariable(u)??0):u),h=[...a].map(u=>"string"==typeof u?Number(r.getVariable(u)??0):u);return c.length!==h.length||NH(c,h)?void 0:{update:u=>{c.forEach((d,p)=>{let f=qe.lerp(d,h[p],u);t[e][p]=s?Math.trunc(f):f})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],h)}}}function lx(e,t,i){return t.forEach((n,r)=>{e.setComponent(r,"string"==typeof n?Number(i.getVariable(n)??0):n)}),e}function p9(e,t,i,n,r){let s=i[e]?i[e]:void 0,o=n[e];if(!o)return;let a=t[e],l=s?lx(new M,s,r):a.clone(),c=lx(new M,o,r);return l.equals(c)?void 0:{update:h=>{a.lerpVectors(l,c,h)},start:()=>{a.copy(l)},end:()=>{a.copy(c)}}}function $c(e,t,i,n,r){return"number"==typeof t[e]?xh(e,t,i??{},n,r):Array.isArray(t[e])?d9(e,t,i??{},n,r):void 0}function f9(e,t,i,n){let r=[],s=pf(i,n)||!!t.layers&&pf(t,n);r.push(function KRe(e,t){return{update:()=>{e.transparent=t}}}(e,s));for(let o of e.layers){let a=t.layers?.data(o.uuid),l=i.layers.data(o.uuid);if(!l||"light"!==o.type&&(!(o.visible??1)||!(l.visible??1)))continue;let c=o.getNames().filter(h=>!q5.some(u=>h.includes(u)));for(let h of c)try{let d,u=o.getValue(h);if("colors"===h)d=ZRe(o,a,l,h);else if(Array.isArray(u))"steps"===h&&(d=XRe(o,a,l,h));else if("number"==typeof u)d=HRe(o,a,l,h,n);else{if("boolean"==typeof u)continue;u instanceof z?d=GRe(o,a,l,h):u instanceof M?d=WRe(o,a,l,h,n):u instanceof _s?d=YRe(o,a,l,h,n):u instanceof Je?d=qRe(o,a,l,h,n):"isTexture"in u&&(d=QRe(o,a,l,h))}d&&(Array.isArray(d)?r.push(...d):r.push(d))}catch(u){console.error(`lerpMaterial: unexpected material layer for ${h}`,u)}}return r}function HRe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:e.getValue(n),o=i[n],a="string"==typeof s?Number(r.getVariable(s)??0):s,l="string"==typeof o?Number(r.getVariable(o)??0):o;return a!==l?{update:c=>{e.setValue(n,qe.lerp(a,l,c))},start:()=>{e.setValue(n,a)},end:()=>{e.setValue(n,l)}}:void 0}function GRe(e,t,i,n){if(!e.hasValue(n)||!(n in i))return;let r=e.getValue(n),s=t?(new z).fromArray(t[n]):r.clone(),o=(new z).fromArray(i[n]);return s.equals(o)?void 0:{update:a=>{r.lerpVectors(s,o,a)},start:()=>{r.copy(s)},end:()=>{r.copy(o)}}}function WRe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=e.getValue(n),o=t?t[n]:void 0,a=i[n],l=o?lx(new M,o,r):s.clone(),c=lx(new M,a,r);return l.equals(c)?void 0:{update:h=>{s.lerpVectors(l,c,h)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function qRe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:void 0,o=i[n],a=e.getValue(n),l=s?"string"==typeof s?r.getColor(s).clone():(new Je).setRGB(s.r,s.g,s.b):a.clone(),c="string"==typeof o?r.getColor(o).clone():(new Je).setRGB(o.r,o.g,o.b);if(l.equals(c))return;let h=a.clone();return{update:u=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function YRe(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:void 0,o=i[n],a=e.getValue(n),l=s?"string"==typeof s?r.getColor(s).clone():(new Je).setRGB(s.r,s.g,s.b):a.clone(),c="string"==typeof o?r.getColor(o).clone():new _s(o.r,o.g,o.b,o.a);if(l.equals(c))return;let h=a.clone();return{update:u=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function XRe(e,t,i,n="steps"){if(!e.hasValue(n)||!(n in i))return;let r=[],s=e.getValue(n),o=t?t[n]:s,a=i[n];for(let l=0;l<s.length;++l){let c=o[l],h=a[l];c!==h&&r.push({update:u=>{s[l]=qe.lerp(c,h,u)},start:()=>{s[l]=c},end:()=>{s[l]=h}})}return r.length?r:void 0}function ZRe(e,t,i,n="colors"){if(!e.hasValue(n)||!(n in i))return;let r=[],s=e.getValue(n),o=t?t[n]:s.map(l=>l.toArray()),a=i[n];for(let l=0;l<s.length;++l){let c=[...o[l]],h=[...a[l]];Kb.isEqual(c,h)||r.push({update:u=>{s[l].fromArray(Kb.lerp(c,h,u))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(h)}})}return r.length?r:void 0}function QRe(e,t,i,n="texture"){if(!e.hasValue(n)||!(n in i))return;let r=e.getNode("mat");if(!r)return;let s=t?t[n]:r,o=i[n],a=[...s.repeat],l=[...s.offset],c=[...o.repeat],h=[...o.offset];return Ip.isEqual(a,c)&&Ip.isEqual(l,h)?void 0:{update:u=>{r.repeat=Ip.lerp(a,c,u),r.offset=Ip.lerp(l,h,u),r.updateMatrix()},start:()=>{r.repeat=[...a],r.offset=[...l],r.updateMatrix()},end:()=>{r.repeat=[...c],r.offset=[...h],r.updateMatrix()}}}var l2=new M,m9=new Yn;function g9(e,t,i,n,r){let s=[];return e.data.visible&&s.push(...function $Re(e,t,i,n,r){let o,a,l,c,h,u,s=[],d={slide:t.pathSnapping?.slide??e.updatedPathSnapping?.slide??e.dataPatched.pathSnapping?.slide??0,offset:t.pathSnapping?.offset??e.updatedPathSnapping?.offset??e.dataPatched.pathSnapping?.offset??0};if(h=xh("slide",d,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),h&&s.push(h),u=xh("offset",d,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),u&&s.push(u),!h&&!u&&(o=p9("position",e,t,i,r),o&&s.push(o),a=p9("scale",e,t,i,r),a&&s.push(a),l=function JRe(e,t,i,n,r){let s=t?.rotation?t.rotation.map(h=>("string"==typeof h?Number(r.getVariable(h)??0):h)*qe.DEG2RAD):void 0,o=i.rotation?.map(h=>("string"==typeof h?Number(r.getVariable(h)??0):h)*qe.DEG2RAD);if(!o)return;let a=s?(new M).fromArray(s):(new M).setFromEuler(e.rotation),l=(new M).fromArray(o);if(a.equals(l))return;let c=l2.subVectors(l,a);if(n&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=(new ft).setFromEuler(m9.setFromVector3(a)),u=(new ft).setFromEuler(m9.setFromVector3(l));return{update:d=>{!function LRe(e,t,i,n){if(0===n)return i.copy(e);if(1===n)return i.copy(t);let r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(r>=1)return i.copy(e);let s=1-r*r;if(s<=Number.EPSILON){let h=1-n;return i.w=h*e.w+n*t.w,i.x=h*e.x+n*t.x,i.y=h*e.y+n*t.y,i.z=h*e.z+n*t.z,i.normalize(),i}let o=Math.sqrt(s),a=Math.atan2(o,r),l=Math.sin((1-n)*a)/o,c=Math.sin(n*a)/o;i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c}(h,u,e.quaternion,d)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(l)}}}return{update:h=>{l2.lerpVectors(a,l,h),e.rotation.setFromVector3(l2)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(l)}}}(e,t,i,n,r),l&&s.push(l),c=function NRe(e,t,i,n){let r=i[e]?i[e]:void 0,s=n[e];if(!s)return;let o=t[e],a=r?(new ye).fromArray(r):o.clone(),l=new M,c=new ft,h=new M;a.decompose(l,c,h);let u=(new ye).fromArray(s),d=new M,p=new ft,f=new M;return u.decompose(d,p,f),a.equals(u)?void 0:{update:m=>{h9.slerpQuaternions(c,p,m),c9.lerpVectors(l,d,m),u9.lerpVectors(h,f,m),o.compose(c9,h9,u9)},start:()=>{o.compose(l,c,h)},end:()=>{o.compose(d,p,f)}}}("hiddenMatrix",e,t,i),c&&s.push(c)),o||a||l||c||h||u){let p=()=>{e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e.parent?.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Qo(e)&&ja(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,d))};s.push({update:p,start:p,end:p})}return s}(e,t,i,r,n)),e.data.visible&&s.push(...function eOe(e,t,i,n){let r=[];if(!("cloner"in i)||!e.cloner)return r;let s=e.cloner,o="cloner"in t?t.cloner:{},a=i.cloner;F5.forEach(p=>{let f;f="count"===p?xh("count",s.parameters,o,a,n,!0):$c(p,s.parameters,o??{},a,n),f&&r.push(f)});let l=function tOe(e,t,i,n){if("radial"!==e.parameters.type)return;let r=t.radial,s=i.radial;if(!s)return;let o=e.parameters.radial,a=[];return B5.forEach(l=>{let c=$c(l,o,r??{},s,n);c&&a.push(c)}),a}(s,o,a,n);l?.length&&r.push(...l);let c=function iOe(e,t,i,n){if("linear"!==e.parameters.type)return;let r=t.linear,s=i.linear;if(!s)return;let o=[],a=e.parameters.linear;return V5.forEach(l=>{let c=$c(l,a,r??{},s,n);c&&o.push(c)}),o}(s,o,a,n);c?.length&&r.push(...c);let h=function nOe(e,t,i,n){if("grid"!==e.parameters.type)return;let r=t.grid,s=i.grid;if(!s)return;let o=[],a=e.parameters.grid;return z5.forEach(l=>{let c;c="count"===l?d9(l,a,r??{},s,n,!0):$c(l,a,r??{},s,n),c&&o.push(c)}),o}(s,o,a,n);h?.length&&r.push(...h);let u=function rOe(e,t,i,n){if("toObject"!==e.parameters.type)return;let r=t.toObject,s=i.toObject;if(!s)return;let o=[],a=e.parameters.toObject;return U5.forEach(l=>{let c;c="count"===l?xh(l,a,r??{},s,n,!0):$c(l,a,r??{},s,n),c&&o.push(c)}),o}(s,o,a,n);u?.length&&r.push(...u);let d=function sOe(e,t,i,n){if(!e.parameters.randomness)return;let r=t.randomnessObject,s=i.randomnessObject;if(!s)return;let o=[],a=e.parameters.randomnessObject;return j5.forEach(l=>{let c=$c(l,a,r??{},s,n);c&&o.push(c)}),o}(s,o,a,n);return d?.length&&r.push(...d),r.length&&r.push({update:()=>{s.update()}}),r}(e,t,i,n)),Qo(e)?(e instanceof Jr&&e.data.visible&&s.push(...function zRe(e,t,i,n){let r=[];if(!("geometry"in i))return r;let s=e.geometry.userData.parameters,o="geometry"in t?t.geometry:{},a=i.geometry;if(e instanceof Cv){let l=function BRe(e,t,i,n){if(void 0===i.scaleBaked)return;let r=(t.scaleBaked??e.data.geometry.scaleBaked).map(a=>"string"==typeof a?Number(n.getVariable(a)??0):a),s=i.scaleBaked.map(a=>"string"==typeof a?Number(n.getVariable(a)??0):a);if(th.isEqual(r,s))return;let o=[];return o.push({update:a=>{e.updateGeometryInteractions({scaleBaked:[qe.lerp(r[0],s[0],a),qe.lerp(r[1],s[1],a),qe.lerp(r[2],s[2],a)]},n),e.invalidateDownstreamBooleanData()},start:()=>{e.updateGeometryInteractions({scaleBaked:r},n),e.invalidateDownstreamBooleanData()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},n),e.invalidateDownstreamBooleanData()}}),o}(e,o,a,n);l&&r.push(...l)}else{let l={};if(Object.assign(l,Tl(s,Q5)),Q5.forEach(c=>{let h=$c(c,l,o,a,n);h&&r.push(h)}),e instanceof TI){Object.assign(l,{extrusion:{...s.extrusion}});let c=function VRe(e,t,i,n){if(!i.extrusion)return;let r=e.extrusion,s=t.extrusion??{},o=i.extrusion,a=[];return Z5.forEach(l=>{let c=$c(l,r,s,o,n);c&&a.push(c)}),a}(l,o,a,n);c&&r.push(...c)}r.length&&r.push({update:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded()},start:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded()},end:c=>{e.updateGeometryInteractions(l,n),e.updateGeometryGroupsIfNeeded()}})}return r}(e,t,i,n)),e.data.visible&&s.push(...function jRe(e,t,i,n){let r=[];if(Array.isArray(e.material)){if(!("materials"in i)||!i.materials)return r;let s="materials"in t&&t.materials?t.materials:[],o=i.materials;e.material.forEach((a,l)=>{if(!o[l])return;let c=s[l]??{},h=o[l];"string"==typeof c||"string"==typeof h||r.push(...f9(a,c,h,n))})}else{if(!("material"in i)||!i.material)return r;let s="material"in t&&t.material?t.material:{},o=i.material;if("string"==typeof s||"string"==typeof o)return r;r.push(...f9(e.material,s,o,n))}return r}(e,t,i,n))):(e=>pI.is(e))(e)?e.data.visible&&s.push(...function URe(e,t,i,n){let r=[];if(void 0!==i.intensity){let s=xh("intensity",e,t,i,n);s&&r.push(s)}if(void 0!==i.color){let s=function kRe(e,t,i,n,r){let s=i[e]?i[e]:void 0,o=n[e];if(!o)return;let a=t[e],l=s?"string"==typeof s?r.getColor(s).clone():(new Je).setRGB(s.r,s.g,s.b):a.clone(),c="string"==typeof o?r.getColor(o).clone():(new Je).setRGB(o.r,o.g,o.b);if(l.equals(c))return;let h=a.clone();return t[e]=h,{update:u=>{h.lerpColors(l,c,u)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}("color",e,t,i,n);s&&r.push(s)}return r}(e,t,i,n)):(e=>e instanceof xr)(e)&&s.push(...function FRe(e,t,i,n){let r=[],s="OrthographicCamera"===e.cameraType?t.orthographic?.zoom:t.perspective?.zoom,o="OrthographicCamera"===e.cameraType?i.orthographic?.zoom:i.perspective?.zoom;if(void 0!==o){let a=s??e.zoom,l=o;a!==l&&r.push({update:c=>{e.zoom=qe.lerp(a,l,c),e.updateProjectionMatrix()},start:()=>{e.zoom=a,e.updateProjectionMatrix()},end:()=>{e.zoom=l,e.updateProjectionMatrix()}})}if(void 0!==i.targetOffset){let a=xh("targetOffset",e,t,i,n);a&&r.push(a)}return r}(e,t,i,n)),s.length?{update:o=>{s.forEach(a=>a.update(o))},start:o=>{s.forEach(a=>a.start?.(o))},end:o=>{s.forEach(a=>a.end?.(o))}}:void 0}var v9=new M;function c2(e,t,i=!1){let n=[];e.traverseChildren(r=>{if(i&&(r.rigidBody?.setTranslation(r.position0,!0),r.rigidBody?.setRotation(r.rotation0,!0),r.rigidBody?.setLinvel(v9,!0),r.rigidBody?.setAngvel(v9,!0)),!zt.is(r))return;let s=r.uuid,o=r.data;if(delete r.states,r.uuid===Tp)return;let a=!1;n.some(l=>e.scene.find(s)?.isDescendantOf(l))?a=!0:!0===o.physics?.fusedBody&&"dynamic"===o.physics.rigidBody&&n.push(s),r.data=o,r.currentState=null,r.reversibleToState=null,r.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};!0===e.data.globalPhysics.usePhysics&&o.physics&&("dynamic"===o.physics.rigidBody||a)&&(void 0!==l.data.position&&delete c.position,void 0!==l.data.rotation&&delete c.rotation,void 0!==l.data.hiddenMatrix&&delete c.hiddenMatrix),r.states||(r.states={}),r.states[l.id]=nh.patch(o,c)}(function aOe(e,t,i,n,r=!1){if(t instanceof Jr&&t.removeInteractionGeometry(),t.changeSelectedState(i,{scene:e,shared:n},r),t instanceof Jr&&t.updateGeometryGroupsIfNeeded(),t instanceof xr&&t.updateCameraState(t.dataPatched,{scene:e,shared:n}),t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()})(e.scene,r,null,t,void 0!==o.events.find(l=>"Follow"===l.data.type||"LookAt"===l.data.type)),function oOe(e){e.traverseEntity(t=>{for(let i of t.data.events){let n=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":n.push(...i.data.actions);break;case"GameControl":for(let r of Object.values(i.data.gameActions))n.push(...r);break;case"DragDrop":n.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":n.push(...i.data.inActions,...i.data.outActions)}for(let r of n)if("Create"===r.data.type&&"Yes"===r.data.hideBase){let s=e.scene.find(r.data.object);s&&(s.visible=!1)}}})}(e)})}function y9(e){let t;if(5===e.easing){let{control1:i,control2:n}=e;t=`cubicBezier(\n\t\t\t${i[0]}, ${i[1]}, ${n[0]}, ${n[1]}\n\t\t)`}else if(6===e.easing){let{mass:i,stiffness:n,damping:r,velocity:s}=e;t=`spring( ${i}, ${n}, ${r}, ${s} )`}else{let i;switch(e.easing){case 0:default:i=Pc.linear;break;case 1:i=Pc.ease;break;case 2:i=Pc.easeIn;break;case 3:i=Pc.easeOut;break;case 4:i=Pc.easeInOut}let[n,r,s,o]=i;t=`cubicBezier( ${n}, ${r}, ${s}, ${o} )`}return{duration:e.duration,easing:t}}function u2(e){let t={delay:0,loop:-1===e.repeat||e.repeat+1};if(0===e.repeat)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay}return"alternate"===t.direction&&(t.delay/=2,t.endDelay/=2,"start"===e.delayDirection?(t.pingPongDelayCorrection=t.delay,"number"==typeof t.loop&&t.loop%2==0&&(t.pingPongEndDelayCorrection=t.delay)):"end"===e.delayDirection?"number"==typeof t.loop&&t.loop%2!=0&&(t.pingPongEndDelayCorrection=t.endDelay):"start-end"===e.delayDirection&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var lOe={type:"beginState"},cOe={type:"completeState",isfromEntity:!1},_9=class{constructor(e,t,i,n,r,s){if(this.object=e,this.data=n,this.sharedAssets=r,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.dispatchEvent({type:"requestRender"})),0===this.targets.t||1===this.targets.t?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let o=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=o,this.object.dispatchEvent({type:"beginState",state:o}),this.object.traverseEntity(a=>{a!==this.object&&a instanceof xr&&a.dispatchEvent(lOe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let o=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=o,this.object.dispatchEvent({type:"completeState",state:o}),this.object.traverseEntity(a=>{a!==this.object&&a instanceof xr&&a.dispatchEvent(cOe)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=g9(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},void 0===t){let o=cx(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!o)throw new Error("Missing property");this.from=o}else{let o=cx(this.object,t);if(!o)throw new Error("Missing property");this.from=o}if(void 0===i)throw new Error("Missing property");{let o=cx(this.object,i);if(!o)throw new Error("Missing property");this.to=o}this.useCurrentState=void 0===t||void 0===i,this.params={targets:this.targets,t:1,autoplay:!1,...u2(n),...y9(n),change:this.onChange},this.callback=g9(this.object,void 0===t?{}:this.from.data,void 0===i?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},b9=class extends sr{constructor(e,t,i,n){if(super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{"normal"!==this.data.tweens[0].data.direction&&(this.toggleIsForward=!this.toggleIsForward),!1!==this.timelineNeedsRebuild&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let r=this.page.scene.find(e.object);if(!r)throw new Error("Missing property");if(!r.states)throw new Error("Missing property");if(this.object=r,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay="start-once"===e.tweens[0].data.delayDirection?e.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline&&!1===this.timeline.paused}init(){this.initialCurrentState=cx(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){try{let n=u2(this.data.tweens[0].data);i&&"number"==typeof n.loop&&n.loop--,this.timeline?.pause(),this.timeline=l9.timeline({autoplay:!1,...n,...!0===n.loop||n.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let r=this.tweens.findIndex(s=>s?.changeBegan);if(!0===t&&(this.timelineNeedsRebuild=!0),e){let s=-1===r?0:r;for(let o=s;o<this.data.tweens.length-1;o++){let c,a=this.data.tweens[o],l=this.data.tweens[o+1];o!==s||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.playing?c=void 0===a.data.state?this.currentState:a.data.state:(c=void 0,this.object instanceof xr&&(this.object.wasMovedByUser=!1));let h=new _9(this.object,c,void 0===l.data.state?this.currentState:l.data.state,l.data,this.shared,this.data.allowSlerp??!1);-1!==r&&o===s&&Object.assign(h.params,{startOnceDelay:0}),this.tweens[o]=h,this.timeline.add(h.params,this.timeline.duration+(o===s?n.delay:0))}this.timeline.duration+=n.endDelay}else{let s=-1===r?this.data.tweens.length-1:r+1;for(let o=s;o>0;o--){let c,a=this.data.tweens[o],l=this.data.tweens[o-1];o!==s||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.playing?c=void 0===a.data.state?this.currentState:a.data.state:(c=void 0,this.object instanceof xr&&(this.object.wasMovedByUser=!1));let h=new _9(this.object,c,void 0===l.data.state?this.currentState:l.data.state,a.data,this.shared,this.data.allowSlerp??!1);-1!==r&&o===s&&Object.assign(h.params,{startOnceDelay:0}),this.tweens[o-1]=h,this.timeline.add(h.params,this.timeline.duration+(o===s?n.endDelay:0))}this.timeline.duration+=n.delay}}catch(n){n instanceof Error&&console.error(n.message)}!0===this.object.previousAction?.playing&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(!1===Mn(this.shared,this.condition)||this.playing)return!1;clearTimeout(this.timeoutId);let e=u2(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){this.timeline?.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=void 0===this.data.tweens[0].data.state?this.initialCurrentState:this.data.tweens[0].data.state;this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){void 0===this.timeline&&this.buildTimeline(),this.timeline?.seek(e*this.timeline.duration,!0)}toggle(e){if(!1===Mn(this.shared,this.condition))return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function cx(e,t){let i,n;if("string"==typeof t?(i=t,n=e.states?.[i]):null===t&&(i=null,n=e.data),void 0!==i&&void 0!==n)return{id:i,data:n}}var uOe={type:"beginState"},w9={type:"completeState",isfromEntity:!1},x9={type:"requestRender"},S9=class extends sr{constructor(e,t,i,n){super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new M,this.posEnd=new M,this.qStart=new ft,this.qEnd=new ft,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=l9({targets:i,t:1,...y9(this.data),update:()=>{0===i.t&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(uOe));let n=this.page.activeCamera;n.position.lerpVectors(this.posStart,this.posEnd,i.t),n.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),n.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,n.wasMovedBySwitchCameraAction=!0,n.updateMatrix(),n.updateMatrixWorld(),n.updateProjectionMatrix(),n.dispatchEvent(x9),1===i.t&&n.dispatchEvent(w9)}})}switchCamera(e){let t=this.page.scene.find(e);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(t),this.page.activeCamera.dispatchEvent({type:"cameraChange",camera:t})}play(){if(!1===Mn(this.shared,this.condition))return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)},1e3*this.data.delay)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){if(!1===Mn(this.shared,this.condition))return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward;try{this.playing?(this.animation?.pause(),this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(w9),this.page.activeCamera.dispatchEvent(x9))},1e3*this.data.delay)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},C9=class extends sr{constructor(e,t,i,n,r){super(),this.page=t,this.animationControls=i,this.shared=n,this.condition=r,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,o=t.scene.find(e.object);o&&Array.isArray(o.identity)&&(s=o.identity[0]),this.data={...e,object:s};let a=this.animationControls.clipIdToAction[e.clipId+"/"+s];this.duration=a?.getClip()?.duration??1;let l=a?.getClip()?.tracks[0]?.times.length??1/0;this.leftFrameTime=this.data.crop[0]/l*this.duration,this.rightFrameTime=this.data.crop[1]/l*this.duration,this.startOnceDelay=e.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(e=!1){if(!1===Mn(this.shared,this.condition))return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([i,n])=>{let r=i.split("/")[1];this.threeAnimAction!==n&&r===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&this.threeAnimAction?.fadeIn(.2)},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=qe.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(!1===Mn(this.shared,this.condition))return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let i=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,r])=>{let s=n.split("/")[1];this.threeAnimAction!==r&&s===i&&r.isRunning()&&(t?r.fadeOut(.2):r.stop())}),t&&this.threeAnimAction?.fadeIn(.2)}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();e&&(e.duration=this.duration),this.pause()}},E9=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.eventManager=i,this.shared=n,this.condition=r,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(!1===Mn(this.shared,this.condition))return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},1e3*this.data.delay))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target))return;"fade"===this.data.transition&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,1e3*this.data.duration),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),c2(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},M9=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Mn(this.shared,this.condition)}dispatch(){if(!1===this.evaluatedCondition)return!1;let e=this.shared.getVariable(this.data.variableId),t=d6(this.data.expression,this.shared,Us.typeOfVariable(e));void 0!==t&&this.shared.updateVariable(this.data.variableId,"string"==typeof t?{textValue:t}:t)}dispose(){}},A9=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.timeoutId=null}dispatchInner(){if(!1===Mn(this.shared,this.condition))return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if("PlayPause"===this.data.mode)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"===e?"Paused":"Playing");else if("Play"===this.data.mode&&"Playing"!==e)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if("Stop"===this.data.mode&&"Stopped"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if("Pause"===this.data.mode&&"Paused"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if("Restart"===this.data.mode)this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if("Toggle"===this.data.mode){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);"Playing"===e?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,void 0!==t&&!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);"PlayPause"===this.data.mode&&"Playing"===t&&(e=this.data.pauseDelay),0!==e?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};function Mn(e,t){if(void 0===t)return!0;if(0===t.expression.length)return!1;let i=d6(t.expression,e,"boolean");return t.negate?!i:!!i}function is(e,t,i,n,r,s){let o={Audio:[],Video:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[]},a=l=>({id:c,data:h})=>{try{"Audio"===h.type?zs[e.type].includes("Audio")&&o.Audio.push(new F8(c,h,s,n,l)):"Video"===h.type?zs[e.type].includes("Video")&&o.Video.push(new T9(c,h,s,n,l)):"Link"===h.type?zs[e.type].includes("Link")&&o.Link.push(new class{constructor({url:e,context:t},i,n,r){if(this.controlsManager=i,this.shared=n,this.condition=r,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:function iRe(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return((e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:n,data:r,hash:s}=i.groups,o=n.split(";");s=t?"":s;let a=!1;"base64"===o[o.length-1]&&(o.pop(),a=!0);let l=(o.shift()||"").toLowerCase(),c=[...o.map(h=>{let[u,d=""]=h.split("=").map(p=>p.trim());return"charset"===u&&(d=d.toLowerCase(),"us-ascii"===d)?"":`${u}${d?`=${d}`:""}`}).filter(Boolean)];return a&&c.push("base64"),(c.length>0||l&&"text/plain"!==l)&&c.unshift(l),`data:${c.join(";")},${a?r.trim():r}${s?`#${s}`:""}`})(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let n=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&"https:"===n.protocol&&(n.protocol="http:"),t.forceHttps&&"http:"===n.protocol&&(n.protocol="https:"),t.stripAuthentication&&(n.username="",n.password=""),t.stripHash?n.hash="":t.stripTextFragment&&(n.hash=n.hash.replace(/#?:~:text.*?$/i,"")),n.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,o=0,a="";for(;;){let c=s.exec(n.pathname);if(!c)break;let h=c[0],u=c.index;a+=n.pathname.slice(o,u).replace(/\/{2,}/g,"/"),a+=h,o=u+h.length}a+=n.pathname.slice(o,n.pathname.length).replace(/\/{2,}/g,"/"),n.pathname=a}if(n.pathname)try{n.pathname=decodeURI(n.pathname)}catch{}if(!0===t.removeDirectoryIndex&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=n.pathname.split("/");B8(s[s.length-1],t.removeDirectoryIndex)&&(s=s.slice(0,-1),n.pathname=s.slice(1).join("/")+"/")}if(n.hostname&&(n.hostname=n.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(n.hostname)&&(n.hostname=n.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...n.searchParams.keys()])B8(s,t.removeQueryParameters)&&n.searchParams.delete(s);if(!0===t.removeQueryParameters&&(n.search=""),t.sortQueryParameters){n.searchParams.sort();try{n.search=decodeURIComponent(n.search)}catch{}}t.removeTrailingSlash&&(n.pathname=n.pathname.replace(/\/$/,""));let r=e;return e=n.toString(),!t.removeSingleSlash&&"/"===n.pathname&&!r.endsWith("/")&&""===n.hash&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||"/"===n.pathname)&&""===n.hash&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}(e,{removeTrailingSlash:!1,removeSingleSlash:!1}),this.context=t??"tab"}dispatch(){if(!1===Mn(this.shared,this.condition))return!1;kH?window.location.assign(this.url):("tab"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(ot[0]),function mCe(){ot.splice(0,ot.length)}())}}(h,r.controlsManager,n,l)):"Create"===h.type?zs[e.type].includes("Create")&&o.Create.push(new O9(h,i,r.controlsManager,n,l)):"Destroy"===h.type?zs[e.type].includes("Destroy")&&o.Destroy.push(new V8(h,i,r.controlsManager,n,l)):"Reset"===h.type?zs[e.type].includes("Reset")&&o.Reset.push(new z8(h,i,n,r,l)):"Transition"===h.type?zs[e.type].includes("Transition")&&o.Transition.push(new b9(h,i,n,l)):"SwitchCamera"===h.type?zs[e.type].includes("SwitchCamera")&&o.SwitchCamera.push(new S9(h,i,n,l)):"SceneTransition"===h.type?zs[e.type].includes("SceneTransition")&&o.SceneTransition.push(new E9(h,i,r,n,l)):"Animation"===h.type?zs[e.type].includes("Animation")&&o.Animation.push(new C9(h,i,r.animationControls,n,l)):"SetVariable"===h.type?zs[e.type].includes("SetVariable")&&o.SetVariable.push(new M9(h,i,n,l)):"DynamicVariablePlay"===h.type?zs[e.type].includes("DynamicVariablePlay")&&o.DynamicVariablePlay.push(new A9(h,i,n,l)):"Conditional"===h.type&&zs[e.type].includes("Conditional")&&(h.ifActions.forEach(a({expression:h.condition,negate:!1})),h.elseActions.forEach(a({expression:h.condition,negate:!0})))}catch{}};return t.forEach(a()),o}function Kn(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof F8||i instanceof T9||i instanceof C9||i instanceof b9||i instanceof O9||i instanceof V8||i instanceof S9||i instanceof E9||i instanceof z8||i instanceof M9||i instanceof A9)&&i.dispose()})})}var D9=new Map,kv=new Map,Ef=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:n,loop:r,volume:s,delay:o}=t;if(this.object=i,void 0===n)throw new Error("Missing property");let a=function hOe(e,t){let i;if("material"in e&&(i=Array.isArray(e.material)?e.material[0].layers.find(r=>r.uuid===t):e.material.layers.find(r=>r.uuid===t)),i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}(i,n);a&&(this.videoElement=a,this.videoElement.loop=r===1/0,this.videoElement.autoplay=!0,void 0!==s&&(this.videoElement.volume=s)),void 0!==o&&(this.delay=o),kv.has(i.uuid)?kv.get(i.uuid).push(this):kv.set(i.uuid,[this]),D9.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();void 0!==i&&i.then(n=>{}).catch(n=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},h2=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=D9.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=kv.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...kv.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},T9=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new Ef(e,t,i);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new h2(t)}}dispatchBasic(){if(!1===Mn(this.shared,this.condition))return!1;this.interaction instanceof Ef?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===Mn(this.shared,this.condition))return!1;this.interaction instanceof Ef?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},I9=(()=>{let e,t,i,n;function r(a){!e&&!P9()&&t?.sharedGameControlGlobals.createdObjects.length>0&&(e=requestAnimationFrame(s)),a&&(t=a,n=a.requestRender)}function s(a){let l=i?a-i:0,c=t.sharedGameControlGlobals.createdObjects,h=t.sharedGameControlGlobals.nCreatedPerAction,u=c.length,d=0;for(;d<u;){let p=c[d];void 0===p.userData.createdTime&&(p.userData.createdTime=a),void 0===p.userData.lifetime&&void 0===p.userData.quantity||p.userData.lifetime&&a-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&h[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),n()),d++):(h[p.userData.actionId]>p.userData.quantity&&h[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>void 0!==f.bvhGeometry)),u--,n())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?a:void 0}return typeof document<"u"&&document.addEventListener("visibilitychange",function o(){P9()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):r()}),r})();function P9(){return!!document&&document.hidden}var R9=new ft,dOe=new M,pOe=new M,O9=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=qe.generateUUID(),this.dispatch=()=>{if(!1===Mn(this.shared,this.condition))return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()},this.dispatchFromStart=()=>{if(!1===Mn(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))},this.dispatchThrottled=function tCe(e,t,i){var n=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return jo(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),QA(e,t,{leading:n,maxWait:t,trailing:r})}(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{null===this.intervalId&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let o=new wr(this.object);if(o.playModeVisible=!0,o.expand(),"world"!==this.data.coordinateSystem){let c=this.page.scene.find(this.data.coordinateSystem);c&&(c.updateMatrixWorldSVD(),o.hiddenMatrix.copy(c.matrixWorldRigid))}o.position.fromArray(this.data.position),o.rotation.fromArray(this.data.rotation),o.updateMatrix(),this.page.add(o);let a=this.controlsManager.sharedGameControlGlobals;a.createdObjects.push(o),void 0===a.nCreatedPerAction[this.uniqueId]?a.nCreatedPerAction[this.uniqueId]=1:a.nCreatedPerAction[this.uniqueId]++,o.updateWorldMatrix(!0,!0),o.traverseObject(this.traverseObjectCB),I9(),this.controlsManager.requestRender()},this.traverseObjectCB=o=>{let a;if(o.hasNonUniformScale&&o.updateMatrixWorldSVD(),this.controlsManager.sharedGameControlGlobals.rapierWorld){if(o instanceof Xo){if(!o.objectForSample)return!0===o.object.dataPatched.physics.fusedBody&&"dynamic"===o.object.dataPatched.physics.rigidBody||void 0;if(o.objectForSample.dataPatched.physics.fusedBody)return;a=o.object}else if(o instanceof wr)a=o.object;else if(a=o,a.dataPatched.cloner?.hideBase)return!0}else{if(o instanceof Xo)return;a=o instanceof wr?o.object:o}"Time"===this.data.destroy?o.userData.lifetime=1e3*this.data.lifetime:"Quantity"===this.data.destroy&&(o.userData.quantity=this.data.destroyAfterQuantity,o.userData.actionId=this.uniqueId);let l=(new M).fromArray(this.data.velocity),c=a.dataPatched;if(!("visibility"===c.physics.enabled?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(o,a,{fromCreate:!0,dynamic:this.data.dynamic}),"Collision"===this.data.destroy&&(o.rigidBody?.collider(0).setActiveEvents(1),o.userData.hasCollisionDestroy=!0),o.matrixWorld.decompose(dOe,R9,pOe),l.applyQuaternion(R9),this.data.velocity.some(h=>0!==h)&&this.data.dynamic&&o.rigidBody?.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in o.object&&this.controlsManager.addBoundsTree(o),this.data.velocity.some(h=>0!==h)&&this.data.dynamic&&(o.userData.velocity=l)),!0===a.dataPatched.physics?.fusedBody))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,"world"!==this.data.coordinateSystem&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");I9(i)}dispose(){null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},N9=(new M,new M),k9=new M,mOe=new M,ns=new M,Cs=new M,Jc=new M,f2=new ye,F9=new ye,gOe=new ye,Jo=(new ye,new ft),Wl=new ft,Xa=new Yn(0,0,0,"YXZ"),vOe=new M(1,0,0),ea=new M(0,1,0),yOe=new M(0,0,1),B9=new M(1,1,1),$n=(new ds,new oo),_o=new ln,SOe={type:"requestRender"},COe={type:"updateMatrix"},z9=Math.PI/6,m2=class extends sr{constructor(e,t,i,n,r,s,o,a,l){super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=n,this.controlsManager=r,this.cameraFollow=s,this.camera=o,this.page=a,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new ye,this.target0=new M,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=200,this.euler0=new Yn(0,0,0,"YXZ"),this.position0Cam=new M,this.quat0Cam=new ft,this.scale0Cam=new M,this.hiddenMatrix0Cam=new ye,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new oo(new M(0,-40,0),new M(0,40,0)),matrix:new ye,position:new M,rotation:new ft},this.euler=new Yn(0,0,0,"YXZ"),this.eulerDelta=new M,this.lastPosition=new M,this.lastCameraQuaternion=new ft,this.lastCameraPosition=new M,this.PI_2=Math.PI/2,this.prevMouse=new z,this.velocityTarget=new M,this.velocity=new M,this.directionXZ=new M,this.rotVelocityStick=new M,this.rotVelocityTarget=new M,this.rotVelocity=new M,this.rotDirection=new M,this.nonColliderRotOffset=new ye,this.nonColliderPosOffset=new ye,this.firstPointerId=-1,this.rot=new M,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new ye,this.objectToTarget=new M,this.objectToTarget0=new M,this.objectToCamXZ=new M,this.objectToCamXZ0=new M,this.targetToCamera=new M,this.targetToCamera0=new M,this.cameraPolarAxis0=new M,this.targetPos=new M,this.targetQuat=new ft,this.lerpFactorPos=(new M).setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ft,this.objXZQuatInv=new ft,this.objXZRotMat=new ye,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new M,this.pushedVelocity=new M,this.groundYRotation=0,this.objectRealQuat=new ft,this.colliderWorldQuat=new ft,this.groundNormal=new M,this.groundTilt=new ft,this.groundTiltInv=new ft,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new M,this.quaternion=new ft,this.scale=new M,this.initialAction=!0,this.onPointerDown=f=>{f.target!==this.domElement||-1!==this.firstPointerId||(this.firstPointerId=f.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),"keys"!==this.rotBy&&!Bs&&(!FH||BH>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(f.clientX,f.clientY))},this.onPointerUp=f=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),"mouse"===f.pointerType&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=f=>{if(f.pointerId!==this.firstPointerId)return;let m=f.clientX-this.prevMouse.x,g=f.clientY-this.prevMouse.y;this.prevMouse.set(f.clientX,f.clientY),"mouse"===f.pointerType&&"keys"!==this.rotBy&&(FH&&BH<15.5&&!Bs?(this.eulerDelta.y=-m*this.mouseOrbitSensitivity,this.eulerDelta.x=-g*this.mouseOrbitSensitivity):(this.eulerDelta.y=-f.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-f.movementY*this.mouseOrbitSensitivity)),"mouse"!==f.pointerType&&"drag"===this.rotByTouch&&(this.eulerDelta.y=-m*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-g*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=f=>{m2.isLocked=this.domElement.ownerDocument.pointerLockElement===this.domElement},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let f in this.movementState)this.movementState[f]=0},this.onKeyDown=f=>{!(f.target instanceof HTMLInputElement)&&("ArrowLeft"===f.code||"ArrowUp"===f.code||"ArrowRight"===f.code||"ArrowDown"===f.code||"Space"===f.code)&&f.preventDefault();for(let m of this.keyAssignments)if(f.key.toUpperCase()===m[1]||f.key===m[1]){this.movementState[m[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=f=>{for(let m of this.keyAssignments)if(f.key.toUpperCase()===m[1]||f.key===m[1]||f.code.slice(3,f.code.length).toUpperCase()===m[1]){this.movementState[m[0]]=0;break}},this.copyVRGamePadValues=(f,m)=>{for(let g=2;g<4;g++){let v=f.axes[g];0===m?2===g?this.movementState.movePosX=v:this.movementState.movePosZ=v:(this.movementState.jump=f.buttons[3].pressed?1:0,2===g?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(v)>=.3&&(this.vrEulerYOffset+=v<0?1:-1),this.movementState.rotPosY=v):"fly"===this.moveMode&&(this.movementState.moveNegY=v))}},this.sharedGameControlGlobals=r.sharedGameControlGlobals,e===o&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),h=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,h,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||!0===this.cameraFollow)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),!0===this.cameraFollow){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let g,v,f=new M(0,0,-1).applyQuaternion(this.camera.quaternion),m=(new M).subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(m),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ),Math.abs(f.y)<1e-6?(m.y=0,f.y=0,v=m.projectOnVector(f)):v=f.multiplyScalar(m.y/f.y>0?m.y/f.y:m.length()),this.targetToCamera0.copy(v).negate(),g=this.camera.position.clone().add(v),this.objectToTarget0.subVectors(g,this.position);let y=(new Yn).setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-y.x,y.x=0,y.z=0,y.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(y)}if(this.object instanceof xr&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=1*(i.speedTranslate??250),this.speedOrbit=.025*(i.speedRotate??100),this.mouseOrbitSensitivity=16e-6*(i.speedRotate??100),this.keyAssignments=i.keyAssignments.map(f=>{let m=[f[0],f[1]];return"\u25b2"===m[1]?m[1]="ArrowUp":"\u25c0"===m[1]?m[1]="ArrowLeft":"\u25bc"===m[1]?m[1]="ArrowDown":"\u25b6"===m[1]?m[1]="ArrowRight":"\u21e7"===m[1]?m[1]="Shift":"\u21b5"===m[1]?m[1]="Enter":"Space"===m[1]?m[1]=" ":"\u2318"===m[1]?m[1]="Meta":"Ctrl"===m[1]?m[1]="Control":"Esc"===m[1]&&(m[1]="Escape"),m}),"mouse"===i.rotBy){let f;f=this.keyAssignments.findIndex(m=>"rotNegX"===m[0]),-1!==f&&(this.keyAssignments[f][1]=""),f=this.keyAssignments.findIndex(m=>"rotPosX"===m[0]),-1!==f&&(this.keyAssignments[f][1]=""),f=this.keyAssignments.findIndex(m=>"rotPosY"===m[0]),-1!==f&&(this.keyAssignments[f][1]=""),f=this.keyAssignments.findIndex(m=>"rotNegY"===m[0]),-1!==f&&(this.keyAssignments[f][1]="")}this.lerpFactorPosStart=1-.02**(1/(60*(i.delayPos[0]??.3))),this.lerpFactorPosEnd=1-.02**(1/(60*(i.delayPos[1]??.3))),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/(60*(i.delayRot[0]??.3))),this.lerpFactorRotEnd=1-.02**(1/(60*(i.delayRot[1]??.3))),this.lerpFactorPosCamera=1-.02**(1/(60*(i.delayPosCamera??.3))),this.lerpFactorRotCamera=1-.02**(1/(60*(i.delayRotCamera??.3))),this.gravity=12*(this.gloabalPhysics.gravity??Np.defaultData.gravity),this.usePhysics=this.gloabalPhysics.usePhysics??Np.defaultData.usePhysics,this.jumpPower=20*i.jumpPower,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??aw.defaultDataThirdPerson.orientWith,this.slopeThresh=65*Math.PI/180,"capsule"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=.02*i.collider.height/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height):"sphere"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*.02/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*.3/this.pixelsPerMeter,this.colliderHeight=2*i.collider.radius):(this.offset=.02*i.collider.height/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let u=(new M).fromArray(i.collider.position),d=(new ft).setFromEuler((new Yn).fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(u).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(u,d,B9),void 0!==i.cameraXAxis&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.runMultiplier=i.runMultiplier??2;let p=2*i.navmesh.destinationHelperRadius;if(p>0){let f=new rt;f.push({fi:0,data:{...ms.defaultData("light","phong"),alpha:0},id:"layer1"}),f.push({fi:0,data:{...ms.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let m=new $T({layers:f},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new jr(RG.create({parameters:{width:p,height:p/10,hollow:.7}}),m),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=(new Yn).setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof xr?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;void 0!==e.gameActions&&(this.actions={},ow.list.forEach(i=>{this.actions[i]=is({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Kn(this.actions.idle),Kn(this.actions.move),Kn(this.actions.run),Kn(this.actions.jump)}dispatchStartEvent(e){void 0!==this.actions[e]&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(!1===this.initialAction)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){void 0!==this.actions[e]&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),null!==t.object.currentState&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ns.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let n=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let r=60*n,s=!1;if(this.usePhysics&&this.collisionEnabled){let a=Cs.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/120,1)*(this.gravity>0?1:-1):this.velocity.y)*n,0).divideScalar(this.pixelsPerMeter),l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,a,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(l){this.onObject=!0,this.groundNormal.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),0===l.collider.parent()?.bodyType()&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let c=l.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let h of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(h.rigidBody===c&&h.userData.isFollowingObj!==this.object.uuid){(h.hasNonUniformScale?h.matrixWorldRigid:h.matrixWorld).decompose(ns,Wl,Cs),this.groundVelocity.subVectors(ns,h.prevT),this.object.getWorldPosition(Cs).add(this.collider.position).sub(ns),this.groundYRotation=Xa.setFromQuaternion(Wl).y-h.prevR.y,Jc.copy(Cs).applyAxisAngle(ea,this.groundYRotation),this.groundVelocity.add(Jc.sub(Cs)).divideScalar(n);break}}else this.onObject=!1}if("walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*r),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,"+z"===this.forwardDir&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let a=this.navMeshPathDest.material;if("walk"===this.moveMode&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let l=ns.subVectors(this.path[1],this.position),c=Cs.subVectors(this.path[1],this.path[0]);l.dot(c)<0?this.path.shift():(this.directionXZ.x=c.x,this.directionXZ.z=c.z),a.opacity=a.userData.opacity0}else a.opacity-=.05*a.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.moveForce=this.movementState.run?this.runMultiplier:1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()||!1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**r),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**r),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**r)):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let o=mOe.copy(this.velocity);if("none"!==this.orientMode&&!1===this.isFirstPerson){let a=Cs.copy(o);a.y=0,o.set(0,o.y,a.length()*("+z"===this.forwardDir?1:-1))}if(this.directionXZ.manhattanLength()>0&&"none"!==this.orientMode)if("camera"===this.orientWith&&this.path.length<=1){let a=ns;this.camera.getWorldDirection(a);let l=Jc.copy(ea).multiplyScalar(a.dot(ea));a.sub(l);let c=Cs.copy(this.directionXZ);c.x*=-1,this.rot.y=a.angleTo(c)*(a.cross(c).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*("+z"===this.forwardDir?1:-1);if(Xa.setFromVector3(this.rot),"walk"===this.moveMode&&(Xa.x=0),o.applyEuler(Xa),s&&(Wl.setFromUnitVectors(ea,this.groundNormal),o.applyQuaternion(Wl)),i){let a=Xa.set(0,this.vrEulerYOffset*z9,0);i.applyEuler(a),o.x+=i.x,o.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*n}if(!0===this.usePhysics){let a=Cs;this.pushedVelocity.set(0,0,0);for(let l of this.sharedGameControlGlobals.entitiesWithTransformAnim){let c=Jc.setFromMatrixPosition(l.matrixWorld).sub(l.prevT).divideScalar(n).divideScalar(this.pixelsPerMeter),h=l.rigidBody.collider(0).castCollider(c,this.object.rigidBody.collider(0),ns.copy(o).divideScalar(this.pixelsPerMeter),n,!1);c.multiplyScalar(this.pixelsPerMeter);let u=zt.is(l)?l:l.object;if(null!==h&&this.lastHitObj!==u){let d;l instanceof wr&&(d=l);let p=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(p)for(let f of p)"character"===f.data.target&&(f.dispatch(d),u.dispatchEvent(I2));this.lastHitObj=u}if(null!==h){this.pushedVelocity.copy(c),a.copy(h.normal1).applyQuaternion(l.quaternion);break}}if(0!==this.pushedVelocity.manhattanLength()){let l=a.dot(o);l<0&&o.addScaledVector(a,-l),o.add(this.pushedVelocity)}else o.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotVelocityStick.x="normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?-this.rotDirection.x*this.speedOrbit*this.rotForce:0,this.rotVelocityStick.y="normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?-this.rotDirection.y*this.speedOrbit*this.rotForce:0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(n),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**r):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**r),this.euler.x+=this.rotVelocity.x*n,this.euler.y+=this.rotVelocity.y*n+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*n),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){if("radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(ea,this.euler.y-this.euler0.y);let a=Cs.copy(this.objectToCamXZ).normalize(),l=Jc.copy(o).multiplyScalar(n);l.y=0;let c=l.sub(ns.copy(a).multiplyScalar(l.dot(a))).cross(a).y;this.euler.y-=Math.atan2(c,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*n+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?this.euler.x="Limit"===this.cameraXAxis?qe.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):qe.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=qe.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Xa.copy(t),Xa.y=0):(Xa.copy(this.euler),Xa.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Xa)),t&&("walk"===this.moveMode?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*z9),Jo.setFromAxisAngle(vOe,this.rot.x),Wl.setFromAxisAngle(ea,this.rot.y),Wl.multiply(Jo),Jo.setFromAxisAngle(yOe,this.rot.z),Wl.multiply(Jo),this.quaternion.copy(Wl),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.objectRealQuat.multiply(this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let a=Cs.copy(o).multiplyScalar(n/this.pixelsPerMeter),l=null;this.didHit=!1;let c=new M;for(let h=0;h<5;h++){let u=a.length(),d=Jc.copy(a).normalize();if(l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(c),this.colliderWorldQuat,d,this.object.rigidBody?.collider(0).shape,u,!1,24,void 0,void 0,this.object.rigidBody),null===l){0===h&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),c.add(a);break}{this.didHit=!0;let p=this.sharedGameControlGlobals.colliderToEntity.get(l.collider.handle);if(p!==this.lastHitObj&&0===h){this.lastHitObj=p;let v=this.sharedGameControlGlobals.entityToCollisionEvents[p?.uuid];if(v)for(let y of v)if("character"===y.data.target){let b,_=(this.sharedGameControlGlobals.rapierWorld?.getCollider(l.collider.handle))._parent;if(p.cloner)for(let w of p.cloner.children)if(w.rigidBody===_){b=w;break}y.dispatch(b),p.dispatchEvent(I2)}}let f=N9.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat),m=k9.copy(d).multiplyScalar(l.toi).dot(f),g=l.toi;if(0===g&&(this.position.y+=this.offset*this.pixelsPerMeter),m>this.offset&&(g=l.toi*(m-this.offset)/m,c.addScaledVector(d,g)),a.copy(d).multiplyScalar(u-g),Math.acos(-f.y)>this.slopeThresh){let v=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(c),y=Jc.copy(l.witness2).applyQuaternion(this.colliderWorldQuat);y.y=0;let _=v.add(y);_.y+=this.stepThresh;let b=this.sharedGameControlGlobals.rapierWorld.castShape(_,this.colliderWorldQuat,a,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);null!==b&&0===b.toi&&(f.y=0,f.normalize())}a.addScaledVector(f,-a.dot(f))}}this.position.addScaledVector(c,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(ns.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(Jo.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let a=this.onObject?1:5,l=o.multiplyScalar(n/a);for(let c=0;c<a;c++)this.position.add(l),this.collisionAdjustment(n/a)}else this.position.addScaledVector(o,n);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();let a=this.objectToTarget.add(this.position),l=this.targetToCamera.add(a);f2.lookAt(l,a,ea).setPosition(l),f2.decompose(this.targetPos,this.targetQuat,ns),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**r),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**r),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=qe.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=qe.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(COe),!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&("fly"===this.moveMode||!0===this.onObject||!1===this.collisionEnabled)&&(null===this.navMeshPathDest||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0)||(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(SOe),0))}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let t,e=Jo.setFromAxisAngle(ea,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?qe.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(e),t="Limit"===this.cameraXAxis?qe.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):qe.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ns.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&i.applyQuaternion(e);let n=Wl.setFromAxisAngle(i,t);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(e),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(n)}groundTiltAdjustment(e){180*ea.angleTo(e)/Math.PI<15||180*ea.angleTo(e)/Math.PI>85?Jo.identity():Jo.setFromUnitVectors(ea,e),this.groundTilt.slerp(Jo,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){let t=k9.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=f2.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ns,Jo,Cs).compose(ns,Jo,B9);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(r=>{if(r===this.object||r.isDescendantOf(this.object))return;_o.makeEmpty(),r.updateMatrixWorldSVD();let s=r.matrixWorldRigid,o=F9.copy(s).invert(),a=gOe.copy(F9).multiply(i);$n.copy(this.collider.segment),$n.start.applyMatrix4(a),$n.end.applyMatrix4(a);let l=N9.copy(this.position).applyMatrix4(o);_o.expandByPoint($n.start),_o.expandByPoint($n.end),_o.min.addScalar(-this.collider.radius),_o.max.addScalar(this.collider.radius),r.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder:c=>c.distanceToPoint($n.end),intersectsBounds:c=>c.intersectsBox(_o),intersectsTriangle:c=>{let h=ns,u=Cs,d=c.closestPointToSegment($n,h,u);if(d<this.collider.radius){let p=this.collider.radius-d,f=u.sub(h).normalize(),m=Jc.copy(l);m.addScaledVector(f,p);let g=m.applyMatrix4(s).sub(this.position);t.add(g),$n.start.addScaledVector(f,p),$n.end.addScaledVector(f,p)}}})}),_o.makeEmpty(),$n.copy(this.collider.segment),$n.start.applyMatrix4(i),$n.end.applyMatrix4(i),_o.expandByPoint($n.start),_o.expandByPoint($n.end),_o.min.addScalar(-this.collider.radius),_o.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder:r=>r.distanceToPoint($n.end),intersectsBounds:r=>r.intersectsBox(_o),intersectsTriangle:r=>{let s=ns,o=Cs,a=r.closestPointToSegment($n,s,o);if(a<this.collider.radius){let l=this.collider.radius-a,c=o.sub(s).normalize();this.alignToGround&&this.groundTiltAdjustment(c),t.addScaledVector(c,l),$n.start.addScaledVector(c,l),$n.end.addScaledVector(c,l)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let n=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(n),this.position.add(t)}},U9=m2;U9.isLocked=!1;var EOe=Wn(Wz());function ql(e,t){let i=new Ze;if(!e.getAttribute("position"))return i.setAttribute("position",new Fe([],3)),i.setIndex([]),i;let{positions:n,triIndices:r}=Rw(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Fe(n,3)),i.setIndex(r),t&&i.applyMatrix4(t),i}var MOe=new ye,AOe=new ye,Za=[[0,0,0],[0,0,0],[0,0,0]];function j9(e){let t=e.elements;Za[0][0]=t[0],Za[0][1]=t[4],Za[0][2]=t[8],Za[1][0]=t[1],Za[1][1]=t[5],Za[1][2]=t[9],Za[2][0]=t[2],Za[2][1]=t[6],Za[2][2]=t[10];let{u:i,v:n}=(0,EOe.SVD)(Za),r=MOe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=AOe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1);return r.multiply(s.transpose())}var DOe=class extends c4{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(n=>{n.visible&&this.intersectObject(n,t,i)}),i}createRaycastLineHelper(){let e=new Sc({color:65280,linewidth:10}),t=new M(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new M(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),n=this.camera.far-this.camera.near,r=(new M).addVectors(t,i.multiplyScalar(n)),s=new Ze;return s.setFromPoints([t,r]),new Q_(s,e)}},H9=e=>e instanceof _f||e instanceof bf;function TOe(e,t){return e.distance-t.distance}function G9(e,t,i){if(Ll(t)&&t.visible){Qo(t)&&t.raycast(e,i);for(let n of t.children)G9(e,n,i)}}function ux(e,t,i,n=!1){if(!n&&!i.some(s=>void 0!==hx(e,s)))return[];let r=[];return t.children.forEach(s=>G9(e,s,r)),r.sort(TOe),r}function g2(e){let t=[];if(e.length){let i=e[0].object;Ll(i)&&t.push(i);let n=i.parent;for(;n;)H9(n)&&t.push(n),n=n.parent}return t}function hx(e,t){if(Qo(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(H9(t))return W9(e,t)}function W9(e,t){if(Ll(t)&&t.visible){if(Qo(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let n=W9(e,i);if(n)return n}}}var q9=(e=>(e[e.keydown=0]="keydown",e[e.keyup=1]="keyup",e[e.pointerdown=2]="pointerdown",e[e.pointerup=3]="pointerup",e[e.pointermove=4]="pointermove",e[e.wheel=5]="wheel",e[e.scroll=6]="scroll",e))(q9||{}),ta=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},v2=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],Y9=e=>v2.find(([t,i])=>i===e)?.[0],Fv=e=>v2.find(([t])=>t===e)?.[1],ROe=(e,t)=>{let i=Y9(e);if(i){let n=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(n,"target",{writable:!1,value:t}),n}},OOe=class extends ta{constructor(e){super(e),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=i=>{if(!i.eventName||!i.target||"Scroll"===i.eventName)return;let n=this.splineEvents[Y9(i.eventName)]?.[i.target.uuid];if(!n)return;"Scroll"===i.eventName&&void 0!==i.deltaY&&Object.assign(n,{deltaY:i.deltaY});let{domElement:r}=this.eventContext;r.dispatchEvent(n)};let{page:t}=this.eventContext;t.traverseEntity(i=>{if(i.data?.events.length)for(let[n,r]of v2)if(i.data.events.some(s=>s.data.type===r&&!s.data.disabled)){this.objectsPerEvents.has(n)?this.objectsPerEvents.get(n)?.push(i):this.objectsPerEvents.set(n,[i]);let o=ROe(r,{id:i.uuid,name:i.name}),a=this.splineEvents[n];a?a[i.uuid]=o:this.splineEvents[n]={[i.uuid]:o}}})}connect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},LOe=class{constructor(e,t,i,n,r,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,this.useToggle="Toggle"===t.runMode,("KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type)&&!t.key)throw new Error("Missing property");this.actions=is(t,t.actions,n,r,s,i)}disconnect(){Kn(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(t)}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()}),this.actions.SwitchCamera.forEach(t=>{t.toggle()})):"MousePress"===this.data.type||"KeyPress"===this.data.type?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing)||this.actions.Transition.forEach(t=>{!1===this.alreadyPlayedNonTogglingActions.has(t)&&t.play()}),this.actions.SwitchCamera.some(t=>t.playing)||this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),!1===e&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},NOe=class extends ta{constructor(e,t,i){super(e),this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=s=>{if(!0===this.useForRaycastProperty&&null===this.sceneInterects){this.eventContext.updateRaycaster(s);let{raycaster:o,page:a}=this.eventContext,l=ux(o,a,[],!0);this.sceneInterects=l,l.length&&(this.eventContext.sharedAssets.raycastProperty={x:l[0].point.x,y:l[0].point.y,z:l[0].point.z,objX:l[0].object.matrixWorld.elements[12],objY:l[0].object.matrixWorld.elements[13],objZ:l[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=s=>{(s.target===this.eventContext.domElement||"SPLINE-VIEWER"===s.target.tagName)&&this.canvasMouseEvents.forEach(o=>{("MouseDown"===o.data.type||"MousePress"===o.data.type)&&(this.onCanvasRaycast(s),o.dispatch())})},this.onCanvasMouseUp=s=>{(s.target===this.eventContext.domElement||"SPLINE-VIEWER"===s.target.tagName)&&this.canvasMouseEvents.forEach(o=>{"MouseUp"===o.data.type?(this.onCanvasRaycast(s),o.dispatch()):"MousePress"===o.data.type&&o.dispatchRelease()})},this.onMouseDown=s=>{ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseEvent("MouseDown"))},this.onMouseUp=s=>{ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=s=>{ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMousePressEvent())},this.onMousePressRelease=s=>{ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMousePressEvent(!0))},this.onKeyDown=s=>{this.heldKeys[s.key]||(this.handleKeyEvent(s,"KeyDown"),this.handleKeyEventHeld(s,"KeyDown",!0)),this.heldKeys[s.key]=!0},this.onKeyUp=s=>{this.handleKeyEvent(s,"KeyUp"),this.handleKeyEventHeld(s,"KeyUp",!0)},this.onKeyPressDown=s=>{this.heldKeysPress[s.key]?this.handleKeyEventHeld(s,"KeyPress"):(this.handleKeyEvent(s,"KeyPress"),this.handleKeyEventHeld(s,"KeyPress",!0)),this.heldKeysPress[s.key]=!0},this.onKeyPressUp=s=>{this.handleKeyEvent(s,"KeyPress",!0)},this.releaseHeldKey=s=>{delete this.heldKeys[s.key]},this.releaseHeldKeyPress=s=>{delete this.heldKeysPress[s.key]},this._onUserEvent=({eventName:s,target:o,reverse:a})=>{if(!s||!o)return;let l=Fv(s);l&&("MouseDown"===l||"MouseUp"===l||"MousePress"===l?(o.dispatchEvent({type:"beginEvent",eventName:l}),this.eventsPerObjects[l]?.[o.uuid]?.forEach(c=>{c.dispatchUserEvent(a)})):("KeyDown"===l||"KeyUp"===l||"KeyPress"===l)&&(o.dispatchEvent({type:"beginEvent",eventName:l}),this.eventsPerObjects[l]?.[o.uuid]?.forEach(c=>{c.dispatchUserEvent()})))};let{page:n,sharedAssets:r}=this.eventContext;n.traverseEntity(s=>{if(!s.data?.events.length)return;let o=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let a of o){let l=this.eventsPerObjects[a];s.data.events.filter(({data:c})=>c.type===a&&!0!==c.disabled).forEach(({id:c,data:h})=>{try{let u=new LOe(c,h,s,n,r,t);u.actions.Video.length&&(this.hasVideoAction=!0),"MouseDown"!==h.type&&"MouseUp"!==h.type&&"MousePress"!==h.type||"Canvas"!==h.mode&&"Window"!==h.mode?l[s.uuid]?l[s.uuid].push(u):l[s.uuid]=[u]:this.canvasMouseEvents.push(u)}catch{}}),l[s.uuid]?.length&&this.objectsPerTypes[a].push(s)}})}connect(){let{domElement:e}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),e.addEventListener("pointerdown",this.onCanvasMouseDown),e.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(n=>{n.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(n=>{n.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(n=>{n.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,page:n}=this.eventContext,r=this.objectsPerTypes[e];if(r.length||this.useForRaycastProperty){if(t||this.useForRaycastProperty){let s;null===this.sceneInterects?s=ux(i,n,r,this.useForRaycastProperty):(s=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&s.length&&(this.eventContext.sharedAssets.raycastProperty={x:s[0].point.x,y:s[0].point.y,z:s[0].point.z,objX:s[0].object.matrixWorld.elements[12],objY:s[0].object.matrixWorld.elements[13],objZ:s[0].object.matrixWorld.elements[14]}),t&&g2(s).forEach(o=>{this.eventsPerObjects[e][o.uuid]&&this.handleObjectMouseEventDispatch(o,e)})}t||r.forEach(s=>{hx(i,s)&&this.handleObjectMouseEventDispatch(s,e)})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],n=[];if(i.length){if(!e){let{stopRaycast:r,raycaster:s,page:o}=this.eventContext;if(r){let a=ux(s,o,i);n=g2(a)}else i.forEach(a=>{hx(s,a)&&n.push(a)})}this._prevObjects.length&&this._prevObjects.forEach(r=>{n.includes(r)||this.handleObjectMouseEventDispatchRelease(r,t)}),n.length&&n.forEach(r=>{this.handleObjectMouseEventDispatch(r,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(n=>{let r=this.eventsPerObjects[t][n.uuid];r.some(({data:s})=>"key"in s&&s.key===e.key)&&n.dispatchEvent({type:"beginEvent",eventName:t}),r.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(n=>{this.eventsPerObjects[t][n.uuid].forEach(r=>{"key"in r.data&&r.data.key===e.key&&r.dispatchHeld(i)})})}},kOe=new M,FOe=new M,X9=class{constructor(e,t,i,n,r){this.actionsIn=is(e,e.inActions,i,n,r,t),this.actionsOut=is(e,e.outActions,i,n,r,t)}disconnect(){Kn(this.actionsIn),Kn(this.actionsOut)}},BOe=class extends X9{constructor(e,t,i,n,r,s){super(t,i,n,r,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=kOe.setFromMatrixPosition(this.objects[0].matrixWorld),h=FOe.setFromMatrixPosition(this.objects[1].matrixWorld),u=c.distanceTo(h)<=this.distance?"in":"out";if(this.stage!==u){this.stage=u;let d="in"===u?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch())}};let{distance:o,fromObject:a,toObject:l}=t.condition;this.distance=o;for(let c of[a,l]){if(!c)throw new Error("Missing property");let h=n.find(c);if(!h)throw new Error("Missing property");this.objects.push(h)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},VOe=class extends X9{constructor(e,t,i,n,r,s){super(t,i,n,r,s),this.id=e,this.data=t,this.object=i,this.onBegin=({state:c})=>{this.toState!==c&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()))},this.onComplete=({state:c})=>{this.toState===c&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()))};let{condition:o}=t;if(!o.object)throw new Error("Missing property");let a=n.find(o.object);if(!a)throw new Error("Missing property");if(this.toObject=a,o.state&&!this.toObject.states?.[o.state])throw new Error("Missing property");this.toState=o.state}connect(){(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length||this.actionsOut.SetVariable.length)&&this.toObject.addEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length||this.actionsIn.SetVariable.length)&&this.toObject.addEventListener("completeState",this.onComplete)}disconnect(){super.disconnect(),(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length||this.actionsOut.SetVariable.length||this.actionsOut.DynamicVariablePlay.length)&&this.toObject.removeEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length||this.actionsIn.SetVariable.length||this.actionsIn.DynamicVariablePlay.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}},zOe=class extends ta{constructor(e,t){super(e),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{page:i,sharedAssets:n}=this.eventContext;i.traverseEntity(r=>{if(r.data?.events.length)for(let{id:s,data:o}of r.data.events)if(!o.disabled&&"Conditional"===o.type)try{let a;"Comparison"===o.condition.type||("Distance"===o.condition.type?a=new BOe(s,o,r,i,n,t):"State"===o.condition.type&&(a=new VOe(s,o,r,i,n,t))),a&&(this.eventsPerConditions[o.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Bv=new M,eu=new M,Sh=new M,Z9=new Fs,ri=new M,jn=new M,Q9=new M,Ch=new ft,y2=new Yn,jOe=new ye,_2=new an,Mf=new M,Qa=new M;function b2(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var HOe=function(){let e=new ye;return(t,i,n)=>{let r=t.obj;e.copy(r.hiddenMatrix),null!==r.parent&&e.premultiply(r.parent.matrixWorld),e.invert(),r.position.copy(i),"global"===t.reference&&b2(r.position,t.limits),r.position.applyMatrix4(e),"parent"===t.reference?b2(r.position,t.limits):"local"===t.reference&&(Ch.copy(t.quat0).invert(),r.position.sub(t.position0),r.position.applyQuaternion(Ch),b2(r.position,t.limits),Ch.invert(),r.position.applyQuaternion(Ch),r.position.add(t.position0)),e.multiply(n??r.matrixWorld).decompose(ri,r.quaternion,jn),r.updateMatrix(),r.hasNonUniformScale&&(r.updateMatrixWorld(),r.updateMatrixWorldSVD()),r instanceof gs&&ja(r.parent)&&r.invalidateDownstreamBooleanData(!0)}}(),WOe=class extends ta{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=n=>{if(ot.length>1)return;this.eventContext.updateRaycaster(n);let{raycaster:r,page:s}=this.eventContext,o=s.raycastWithClones(r);if(this.lastDropDestination=null,0!==o.length){for(let a of this.events){let l=0;for(let{obj:c,pointEnd:h,pointStart:u}of a.dragItems){if(c===o[0].object||c===o[0].object.object||zt.is(c)&&c.isAncestorOf(o[0].object.uuid)){if(a.activeIdx=l,a.activeDragItem.reset=!1,a.activeDragItem.currentDampingFactor=a.data.dampingFactor,a.activeDragItem.snapped=!1,"hand"===a.data.cursor&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){a.activeDragItem.obj.rigidBody&&a.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=a.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(ri,Ch,jn),y2.setFromQuaternion(Ch),void 0===d.prevR?(d.prevR=y2.clone(),d.prevT=ri.clone()):(d.prevR.copy(y2),d.prevT.copy(ri)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(a.activeDragItem.obj)}return this.calcPlaneIntersectPos(c,u,a.data.plane,a.data.referenceFrame),h.copy(u),(this.eventManager.controlsManager.usePhysics&&"dynamic"===c.data.physics?.rigidBody||!1===a.data.drop||!1===a.data.resetOnSnapFail)&&a.activeDragItem.fromPosition.setFromMatrixPosition(a.activeDragItem.obj.matrixWorld),this.activeEvent=a,void(this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1))}l++}}this.activeEvent=null}else this.activeEvent=null},this.onPointerMove=n=>{if(ot.length>1)return;this.eventContext.updateRaycaster(n);let{raycaster:r,page:s}=this.eventContext,o=s.raycastWithClones(r);if(0!==ot.length){if(this.activeEvent&&this.activeEvent.activeDragItem){let l,a=this.activeEvent.activeDragItem;if(a.snapped=!1,this.activeEvent.data.drop&&(l=o.filter(c=>a.obj!==c.object&&!a.obj.isAncestorOf(c.object.uuid)&&!(c.object instanceof _f)&&("all"===this.activeEvent.data.dropOn||this.activeEvent.dropDestIds.some(h=>h===c.object.uuid||s.scene.find(h).isAncestorOf(c.object.uuid))))[0]),l){let c=Q9.copy(l.face.normal).applyMatrix3(_2.getNormalMatrix(l.object.matrixWorld));if("center"===this.activeEvent.data.snapTo)a.fromPosition.setFromMatrixPosition(l.object.matrixWorld);else if("surface"===this.activeEvent.data.snapTo){if(a.fromPosition.copy(l.point),"bbox"===this.activeEvent.data.snapSurfaceMode){ri.copy(c).applyMatrix3(_2.setFromMatrix4(a.obj.matrixWorld).transpose());let h=a.obj;ri.x>.2?jn.x=-h.recursiveBBox.min.x:ri.x<-.2&&(jn.x=-h.recursiveBBox.max.x),ri.y>.2?jn.y=-h.recursiveBBox.min.y:ri.y<-.2&&(jn.y=-h.recursiveBBox.max.y),ri.z>.2?jn.z=-h.recursiveBBox.min.z:ri.z<-.2&&(jn.z=-h.recursiveBBox.max.z),jn.applyMatrix3(_2.invert())}else jn.copy(c).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);a.fromPosition.add(jn)}this.activeEvent.data.autoOrient&&(ri.set(0,1,0).cross(c),ri.length()<1e-4&&ri.set(-1,0,0).cross(c),jn.crossVectors(Q9,ri),a.orientationMatrix.makeBasis(ri,jn,c)),a.pointStart.copy(a.fromPosition),a.pointEnd.copy(a.pointStart),a.currentDampingFactor=this.activeEvent.snapDampingFactor,a.snapped=!0,this.lastDropDestination!==l.object&&(this.lastDropDestination=l.object,this.activeEvent.actionsDrop.Transition.forEach(h=>{h.play()}),this.activeEvent.actionsDrop.Animation.forEach(h=>{h.play()}),this.activeEvent.actionsDrop.Audio.forEach(h=>{h.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(h=>{h.dispatchThrottled()}))}else a.orientationMatrix.makeRotationFromQuaternion(a.quat0),this.lastDropDestination=null,a.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(a.obj,a.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(c=>{c.stop(),null!==c.object.currentState&&c.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(c=>{c.stop()}),this.activeEvent.actionsDrop.Audio.forEach(c=>{c.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(c=>{c.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(c=>c.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(c=>c.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(c=>c.dispatch()),!1===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(c=>{c.play()}),this.activeEvent.actionsDrag.Animation.forEach(c=>{c.play()}),this.activeEvent.actionsDrag.Audio.forEach(c=>{c.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(c=>{c.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(c=>{c.stop(),null!==c.object.currentState&&c.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(c=>{c.stop()}))},500),this.updateDragItem(a),a.obj.dispatchEvent({type:"requestRender"})}}else{let a=!1;for(let l of this.events){for(let{obj:c}of l.dragItems)if(c===o[0]?.object||c===o[0]?.object?.object||zt.is(c)&&c.isAncestorOf(o[0]?.object.uuid)){switch(a=!0,l.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move")}break}if(a)break}a||this.setCursor("default")}},this.onPointerUp=n=>{if(this.activeEvent&&this.activeEvent.activeDragItem){"hand"===this.activeEvent.data.cursor&&this.setCursor("grab");let r="dynamic"===this.activeEvent.activeDragItem.obj.data.physics?.rigidBody;!1===this.activeEvent.activeDragItem.snapped&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(!1===this.eventManager.controlsManager.usePhysics||!r)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&r&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),!0===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),null!==s.object.currentState&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}};let i={};e.page.traverseEntity(n=>{n.component&&(i[n.component.uuid]?i[n.component.uuid].push(n.uuid):i[n.component.uuid]=[n.uuid])}),e.page.traverseEntity(n=>{n.data?.events.filter(r=>"DragDrop"===r.data.type&&!r.data.disabled).forEach(r=>{this.events.push(new class{constructor(e,t,i,n,r,s){this.object=e,this.data=t,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=0===this.data.resetSpeed?1:8/this.data.resetSpeed+1,this.snapDampingFactor=0===this.data.snapSpeed?1:8/this.data.snapSpeed+1,this.actionsDrag=is(t,t.dragDropActions.drag,i,n,r,this.object),this.actionsDrop=is(t,t.dragDropActions.drop,i,n,r,this.object);let o=[];this.data.objects.forEach(a=>{let l=i.find(a);!l||!1!==l.data.visible&&(o.push(l),s[l.uuid]&&s[l.uuid].forEach(c=>{let h=i.find(c);!h||!1!==h.data.visible&&o.push(h)}))}),this.data.dropDestinations.forEach(a=>{let l=i.find(a);!l||!1!==l.data.visible&&(this.dropDestIds.push(l.uuid),s[l.uuid]&&s[l.uuid].forEach(c=>{let h=i.find(c);!h||!1!==h.data.visible&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(a=>("locked"===this.data.planeMode&&(a.userData.lockedPlane=!0),a.userData.worldPosition0=(new M).setFromMatrixPosition(a.matrixWorld),{obj:a,fromPosition:(new M).setFromMatrixPosition(a.matrixWorld),pointStart:new M,pointEnd:new M,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:(new M).copy(a.position),quat0:(new ft).copy(a.quaternion),snapped:!1,orientationMatrix:new ye,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return null!==this.activeIdx?this.dragItems[this.activeIdx]:null}dispose(){Kn(this.actionsDrag),Kn(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}}(n,r.data,e.page,e.sharedAssets,t,i))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,n){let{getCamera:r,raycaster:s}=this.eventContext;r().getWorldDirection(eu),eu.negate();let o=Ch.identity();switch("parent"===n?jOe.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(ri,o,jn):"local"===n&&e.matrixWorld.decompose(ri,o,jn),i){case"x":ri.set(1,0,0).applyQuaternion(o),Mf.copy(eu).cross(ri),Qa.copy(ri).cross(Mf);break;case"y":ri.set(0,1,0).applyQuaternion(o),Mf.copy(eu).cross(ri),Qa.copy(ri).cross(Mf);break;case"z":ri.set(0,0,1).applyQuaternion(o),Mf.copy(eu).cross(ri),Qa.copy(ri).cross(Mf);break;case"xy":Qa.set(0,0,1).applyQuaternion(o);break;case"yz":Qa.set(1,0,0).applyQuaternion(o);break;case"xz":Qa.set(0,1,0).applyQuaternion(o);break;case"adaptive":eu.angleTo(jn.set(0,1,0))>Math.PI/6?(ri.crossVectors(jn.set(0,1,0),eu),Qa.crossVectors(ri,jn)):Qa.set(0,1,0);break;default:Qa.copy(eu)}Sh.setFromMatrixPosition(e.matrixWorld);let a=e.userData.lockedPlane?e.userData.worldPosition0:Sh;if(Z9.setFromNormalAndCoplanarPoint(Qa,a),s.ray.intersectPlane(Z9,t)&&("x"===i||"y"===i||"z"===i)){let l=jn.subVectors(t,a).dot(ri);t.copy(a).addScaledVector(ri,l)}}updateDragItem(e,t=!1){Sh.setFromMatrixPosition(e.obj.matrixWorld),"current"===e.reset?Bv.subVectors(e.fromPosition,Sh).divideScalar(e.currentDampingFactor):"original"===e.reset?(Bv.subVectors(e.obj.userData.worldPosition0,Sh).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Bv.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Sh).divideScalar(e.currentDampingFactor),e.paused=!(e.currentDampingFactor>1)||Bv.length()<.01,(this.activeEvent&&1===this.activeEvent.data.dampingFactor||t)&&HOe(e,Bv.add(Sh),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Df=new M,w2=new M,Yl=new M,Xl=new M,K9=new Fs,YOe={type:"requestRender"},XOe=function(){let e=new M,t=new M;return(i,n,r)=>r>0?(e.subVectors(i,n),e.length()<=r?i:t.copy(n).add(e.normalize().multiplyScalar(r))):n}(),$9=function(){let e=new ye;return(t,i)=>{t.position.copy(i),null!==t.parent&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof gs&&ja(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),QOe=class extends ta{constructor(e,t){super(e),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=n=>{if(!(ot.length>1)){this.eventContext.updateRaycaster(n);for(let r of this.events)void 0===r.target&&this.updateSingleEvent(r)}},this.onMouseEnter=n=>{for(let r of this.events)void 0===r.target&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=n=>{for(let r of this.events)void 0===r.target&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=n=>()=>{this.updateSingleEvent(n)};let{page:i}=this.eventContext;i.traverseEntity(n=>{let r=n.data?.events.find(s=>"Follow"===s.data.type&&!s.data.disabled);r&&(!i.data.globalPhysics.usePhysics||"dynamic"!==n.dataPatched.physics?.rigidBody)&&this.events.push(new class{constructor(e,t,i,n,r){this.data=e,this.object=t,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new M,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...SD.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=is(e,e.actions,i,n,r,t)}}(r.data,n,i,e.sharedAssets,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Bs&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events)if(void 0!==i.target){let n=i.target,r=this.onTargetChange(i);this.pairOfEventListeners.push([n,r]),n.addEventListener("requestRender",r)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Bs&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let i of this.events)i.paused=!0,i.isReset=!1,Kn(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){this.events.forEach(o=>{o.actions.Create.forEach(a=>{a.dispatchThrottled()})});let{plane:i,limitDistance:n,limitDistanceEnabled:r}=e.data;if(e.object.getWorldPosition(Yl),e.isReset)Xl.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(Xl);else{let{getCamera:o,raycaster:a}=this.eventContext;if("custom"===i?(o().getWorldDirection(w2),w2.negate(),Df.copy(w2)):"xy"===i?Df.set(0,0,1):"xz"===i?Df.set(0,1,0):"yz"===i&&Df.set(1,0,0),K9.setFromNormalAndCoplanarPoint(Df,Yl),!a.ray.intersectPlane(K9,Xl))return}if(!e.isReset)if(Xl.distanceTo(e.worldPosition0)>n&&r&&e.target){if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;Xl.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor}else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;!1===e.data.enabledTranslation[0]&&(Xl.x=Yl.x),!1===e.data.enabledTranslation[1]&&(Xl.y=Yl.y),!1===e.data.enabledTranslation[2]&&(Xl.z=Yl.z);let s=XOe(Yl,Xl,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=Df.subVectors(s,Yl).divideScalar(e.currentDampingFactor);Yl.add(o),t&&$9(e.object,Yl),e.paused=o.length()<.01}else $9(e.object,s),e.paused=!0;e.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(YOe)}},Vv=new M,dx=new M,zv=new ye,Tf=new ft,tu=new ft,Uv=new M,jv=new M,Eh=new M,Zl=new M,x2=new Fs,$Oe={type:"requestRender"},JOe={type:"changeRotation"},J9=function(){let e=new ye;return function(t,i){null!==t.parent?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(j9(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof gs&&ja(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),t3e=class extends ta{constructor(e){super(e),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=i=>{if(!(ot.length>1)){this._lastMouseEvent=i,this.eventContext.updateRaycaster(i);for(let n of this.events)void 0===n.target&&this.updateSingleEvent(n)}},this.onMouseEnter=i=>{for(let n of this.events)void 0===n.target&&(n.isReset=!1,n.currentDampingFactor=n.data.dampingFactor)},this.onMouseLeave=i=>{for(let n of this.events)void 0===n.target&&(n.data.resetOnPointerLeave&&(n.isReset=!0,n.currentDampingFactor=n.resetDampingFactor),this.updateSingleEvent(n))},this.onScroll=i=>{if(this._lastMouseEvent){let n=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(n)}},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)},this.createUserEventListener=i=>({eventName:n,target:r})=>{if(!n||!r)return;let s=Fv(n);s&&"LookAt"===s&&this.updateSingleEvent(i)};let{page:t}=this.eventContext;t.traverseEntity(i=>{let n=i.data?.events.find(r=>"LookAt"===r.data.type&&!r.data.disabled);n&&(!t.data.globalPhysics.usePhysics||"dynamic"!==i.dataPatched.physics?.rigidBody)&&this.events.push(new class{constructor(e,t,i){this.object=t,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ft,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...CD.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}}(n.data,i,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Bs&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?t.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events){if(void 0!==i.target){let s=this.onTargetChange(i),o=i.target;this.pairOfEventListeners.push([o,s]),o.addEventListener("requestRender",s)}let n=this.createUserEventListener(i),r=i.object;this.pairOfUserEventListeners.push([r,n]),r.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Bs&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let[i,n]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",n);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){let{tilt:t,axis:i,distance:n,plane:r,limitDistance:s,enabledRotation:o,limitDistanceEnabled:a}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:h,target:u}=e;if(h.getWorldPosition(Uv),!e.isReset)if(e.target)e.target.getWorldPosition(jv);else{if("custom"===r?(l().getWorldDirection(dx),dx.negate(),x2.setFromNormalAndCoplanarPoint(dx,Uv)):("xy"===r?Vv.set(0,0,1):"xz"===r?Vv.set(0,1,0):"yz"===r&&Vv.set(1,0,0),x2.setFromNormalAndCoplanarPoint(Vv,Uv)),!c.ray.intersectPlane(x2,jv))return;n>0&&("custom"===r||void 0===r)&&jv.addScaledVector(dx,n)}if(e.isReset||(u?"target"===t?Eh.copy(u.up).applyMatrix4(zv.extractRotation(u.matrixWorld)).normalize():o.some(d=>!1===d)?("x"===i?(Zl.set(0,0,1),!1===o[2]&&Zl.set(0,1,0)):"y"===i?(Zl.set(1,0,0),!1===o[0]&&Zl.set(0,0,1)):(Zl.set(0,1,0),!1===o[1]&&Zl.set(1,0,0)),Eh.copy(Zl).applyQuaternion(e.worldQuaternion0).normalize()):Eh.set(0,1,0):"custom"===r?Eh.set(0,1,0):Eh.copy(Vv)),e.isReset)tu.copy(e.worldQuaternion0);else if(Uv.distanceTo(jv)>s&&a&&u){if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;tu.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor}else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;(function i3e(e,t,i,n,r,s){let o=e.elements;fn.subVectors(t,i),0===fn.lengthSq()&&(fn.z=1),fn.normalize(),Hn.crossVectors(n,fn),0===Hn.lengthSq()&&(1===Math.abs(n.z)?fn.x+=1e-4:fn.z+=1e-4,fn.normalize(),Hn.crossVectors(n,fn)),Hn.normalize(),bo.crossVectors(fn,Hn),"x"===r?1===s.z?[Hn,bo,fn]=[fn,Hn,bo]:(Hn.negate(),[Hn,fn]=[fn,Hn]):"y"===r?1===s.x?[Hn,bo,fn]=[bo,fn,Hn]:(Hn.negate(),[bo,fn]=[fn,bo]):1===s.x&&(Hn.negate(),[Hn,bo]=[bo,Hn]),o[0]=Hn.x,o[4]=bo.x,o[8]=fn.x,o[1]=Hn.y,o[5]=bo.y,o[9]=fn.y,o[2]=Hn.z,o[6]=bo.z,o[10]=fn.z})(zv,jv,Uv,Eh,i,Zl),tu.setFromRotationMatrix(zv),Tf.setFromUnitVectors(Zl.applyQuaternion(tu),Eh),o.some(d=>!1===d)&&"target"!==t&&tu.premultiply(Tf).normalize()}e.currentDampingFactor>1?(h.updateWorldMatrix(!0,!1),Tf.setFromRotationMatrix(j9(h.matrixWorld)),Tf.slerp(tu,1/e.currentDampingFactor),J9(h,zv.makeRotationFromQuaternion(Tf)),e.paused=8*(1-Tf.dot(tu))<1e-6):(J9(h,zv.makeRotationFromQuaternion(tu)),e.paused=!0),e.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),h.dispatchEvent($Oe),h.dispatchEvent(JOe)}},bo=new M,Hn=new M,fn=new M,n3e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=is(t,t.actions,n,r,s,i)}disconnect(){Kn(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},r3e=class extends ta{constructor(e,t){super(e),this.eventsPerObjects={},this.objects=[],this._prevObjects=[],this.onMouseDown=r=>{ot.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseHoverEvent())},this.onMouseUp=r=>{ot.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=r=>{ot.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:r,target:s,reverse:o})=>{if(!r||!s)return;let a=Fv(r);a&&"MouseHover"===a&&(s.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[s.uuid]?.forEach(l=>l.dispatchUserEvent(o)))};let{page:i,sharedAssets:n}=this.eventContext;i.traverseEntity(r=>{if(r.visible&&r.data?.events.length){for(let{id:s,data:o}of r.data.events)if(!o.disabled&&"MouseHover"===o.type)try{let a=new n3e(s,o,r,i,n,t);this.eventsPerObjects[r.uuid]?this.eventsPerObjects[r.uuid].push(a):this.eventsPerObjects[r.uuid]=[a]}catch{}this.eventsPerObjects[r.uuid]?.length&&this.objects.push(r)}})}connect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Bs&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(t=>{t.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Bs&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:n,page:r}=this.eventContext;if(i){let s=ux(n,r,this.objects);t=g2(s)}else this.objects.forEach(s=>{hx(n,s)&&t.push(s)})}this._prevObjects.length&&this._prevObjects.forEach(i=>{t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},s3e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=is(t,t.actions,n,r,s,i)}connect(){this.scrollCounter=0}disconnect(){Kn(this.actions)}dispatch(e){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(n=>n.seek(i)),this.actions.Animation.forEach(n=>n.seek(t)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},o3e=class{constructor(e,t,i,n,r,s,o){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=o,this.scrollStart=0,this.scrollEnd=0,this.actions=is(t,t.actions,n,r,o,i)}computeScrollBounds(){let e=this.domElement.getBoundingClientRect(),t=document.body,i=document.documentElement,n=window.pageYOffset||i.scrollTop||t.scrollTop,s=Math.round(e.top+n-(i.clientTop||t.clientTop||0));if("enter"===this.data.startFrom){let o=window.innerHeight,a=e.height,l=this.data.enterAnchor;this.scrollStart=s-("top"===l?o:"bottom"===l?o-a:o-.5*a)}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=e,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Kn(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return void 0===this.box||0===this.box.width&&0===this.box.height&&0===this.box.top&&0===this.box.bottom}computeScroll({y:t}){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let n=Math.min(1,Math.max(0,(t-this.scrollStart)/(this.scrollEnd-this.scrollStart)));this.actions.Transition.forEach(r=>r.seek(n)),this.actions.Animation.forEach(r=>r.seek(n)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},a3e=class extends ta{constructor(e,t){super(e),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([o,a])=>{a.forEach(l=>l.handleResize())})},this.onScroll=o=>{if(!this.isInview)return;let a={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([l,c])=>{l.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:a}),c.forEach(h=>h.dispatch(a))})},this.onWheel=o=>{!this.isInview||o.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([a,l])=>{a.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:o.deltaY}),l.forEach(c=>c.dispatch(o.deltaY))})},this.onUserEvent=({eventName:o,target:a,reverse:l})=>{if(!o||!a)return;let c=Fv(o);c&&"Scroll"===c&&(a.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(a)?.forEach(h=>{h.dispatchUserEvent(l)}))};let{page:i,sharedAssets:n,domElement:r,isExport:s}=this.eventContext;i.traverseEntity(o=>{if(o.data?.events.length)for(let{id:a,data:l}of o.data.events)if(!l.disabled&&"Scroll"===l.type)if("load"!==l.trigger&&s){let c=new o3e(a,l,o,i,n,r,t);this.scrollEventsPerObject.has(o)?this.scrollEventsPerObject.get(o)?.push(c):this.scrollEventsPerObject.set(o,[c])}else{let c=new s3e(a,l,o,i,n,t);this.wheelEventsPerObject.has(o)?this.wheelEventsPerObject.get(o)?.push(c):this.wheelEventsPerObject.set(o,[c])}}),this.intersectionObserver=new IntersectionObserver(o=>{let a=o[0];a&&(this.isInview=a.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},l3e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=is(t,t.actions,n,r,s,i)}disconnect(){Kn(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof wh?t.interaction.audioPlayer.play():t.interaction instanceof XI&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof Ef?t.interaction.play("autoplay"===i):t.interaction instanceof h2&&t.interaction.dispatch())})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof wh?t.interaction.audioPlayer.play():t.interaction instanceof XI&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof Ef?t.interaction.play():t.interaction instanceof h2&&t.interaction.dispatch()})}},c3e=class extends ta{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:n}=this.eventContext;(n?document:i).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.actions.Audio.forEach(s=>{s.interaction instanceof wh&&s.interaction.audioPlayer.play()}),r.actions.Video.forEach(s=>{s.interaction instanceof Ef&&s.interaction.play("autoplay"===(s.interaction.data.triggerAfter??"autoplay"))})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>{r.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:n,reverse:r})=>{if(!i||!n)return;let s=Fv(i);s&&"Start"===s&&(n.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(n)?.forEach(o=>{o.dispatchUserEvent(r)}),this.eventsAfterPerObject.get(n)?.forEach(o=>{o.dispatchUserEvent(r)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext;if(t.traverseEntity(i=>{if(i.data?.events.length)for(let{id:n,data:r}of i.data.events){if(r.disabled||"Start"!==r.type)continue;let s=new l3e(n,r,i,t,e,this.eventManager);(s.actions.Transition.length||s.actions.Animation.length||s.actions.SwitchCamera.length||s.actions.Create.length||s.actions.Destroy.length||s.actions.SceneTransition.length||s.actions.SetVariable.length||s.actions.DynamicVariablePlay.length)&&(this.eventsPerObject.has(i)?this.eventsPerObject.get(i)?.push(s):this.eventsPerObject.set(i,[s])),s.actions.Audio.length&&(this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s])),s.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s]))}}),[...this.eventsAfterPerObject.values()].some(i=>i.length)){if(0===this.eventManager.activateCount){let{domElement:i,isExport:n}=this.eventContext,r=n?document:i;r.addEventListener("pointerdown",this.onMouseDown,{once:!0}),r.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),r.addEventListener("pointerdown",this.onAny),r.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,o])=>{s.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([i,n])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(r=>r.dispatch()),i.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([n,r])=>{n.removeEventListener("userEvent",this.onUserEvent),r.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},u3e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=is(t,t.actions,n,r,s,i),this.target=t.target,this.useToggle="Toggle"===t.runMode}disconnect(){Kn(this.actions)}dispatch(e){this.disabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(t)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()})):(this.actions.Transition.forEach(t=>{!1===this.alreadyPlayedNonTogglingActions.has(t)&&t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}))}},h3e=class extends ta{constructor(e,t,i,n,r){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=n,this.needsRaycast=r,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.events=[],this.onFrame=s=>{this.rafId=window.requestAnimationFrame(this.onFrame);let o=new Date,a=[],l=[];for(let u=0;u<this.propertiesToWatch.length;u++){let{objectId:d,property:p,prevValue:f}=this.propertiesToWatch[u],m=this.eventContext.scene.find(d),g=MD.propertyPaths[p];if("width"===g[0]||"height"===g[0]||"depth"===g[0])m=m.geometry.userData.parameters[g[0]];else for(let v=0;v<g.length;v++)m=m[g[v]];null===f?this.propertiesToWatch[u].prevValue=m instanceof M?m.clone():m:(m instanceof M?!m.equals(f):f!==m)&&(l.push({objId:d,property:p}),m instanceof M?this.propertiesToWatch[u].prevValue.copy(m):this.propertiesToWatch[u].prevValue=m)}for(let u=0;u<this.variablesToWatch.length;u++){let{id:d,prevValue:p}=this.variablesToWatch[u],f=this.shared.getVariable(d);f!==p&&(a.push(d),this.variablesToWatch[u].prevValue=f)}for(let u=0;u<this.dynamicVars.length;u++){let{id:d,expectedTime:p,last:f,data:m,timerSeconds:g,startValue:v}=this.dynamicVars[u],y=1e3;if("timer"!==m.dynamicVariableType&&"stopwatch"!==m.dynamicVariableType||"number3decimal"!==m.format?"counter"===m.dynamicVariableType?y=m.updateInterval:"random"===m.dynamicVariableType&&(y=m.isStatic?1/0:m.updateInterval):y=1,-1!==p){if("Stopped"!==this.shared.getDynamicVariablePlayState(d)&&"Restarted"!==this.shared.getDynamicVariablePlayState(d)||(this.dynamicVars[u].last=s,this.dynamicVars[u].expectedTime=s+y,"counter"===m.dynamicVariableType&&this.shared.getVariable(d)!==v&&(this.shared.updateVariable(d,v),this.eventManager.requestRender()),("timer"===m.dynamicVariableType||"stopwatch"===m.dynamicVariableType)&&this.dynamicVars[u].timerSeconds!==v&&(this.dynamicVars[u].timerSeconds=v,this.shared.updateVariable(d,Go.getFormattedTimerTime(v,m)),this.eventManager.requestRender()),"Restarted"===this.shared.getDynamicVariablePlayState(d)&&this.shared.setDynamicVariablePlayState(d,"Playing"),"Stopped"!==this.shared.getDynamicVariablePlayState(d))){if("Paused"===this.shared.getDynamicVariablePlayState(d)){void 0===this.dynamicVars[u].deltaToExpectedTime&&(this.dynamicVars[u].deltaToExpectedTime=Math.max(this.dynamicVars[u].expectedTime-s,0)),this.dynamicVars[u].last=s-(y-this.dynamicVars[u].deltaToExpectedTime),this.dynamicVars[u].expectedTime=s+this.dynamicVars[u].deltaToExpectedTime;continue}if(this.dynamicVars[u].deltaToExpectedTime=void 0,s>=p)if(this.dynamicVars[u].last=s,this.dynamicVars[u].expectedTime+=y,"random"===m.dynamicVariableType){let _=m.min+Math.random()*(m.max-m.min),b=m.decimals;_=Math.round(_*Math.pow(10,b))/Math.pow(10,b),this.shared.updateVariable(d,_),a.push(d),this.eventManager.requestRender()}else if("counter"===m.dynamicVariableType){if(0===m.increment)continue;let _=this.shared.getVariable(d),b=this.shared.getDynamicVariableToggleIsForward(d)??!0,w=this.shared.getVariable(d)+m.increment*(b?1:-1);m.hasEnd&&(w=m.increment>0?qe.clamp(w,v,m.endValue):qe.clamp(w,m.endValue,v),w===v&&this.shared.setDynamicVariableToggleIsForward(d,void 0),m.repeat?w===m.endValue&&(w=v):(w===v||w===m.endValue)&&this.shared.setDynamicVariablePlayState(d,"Paused")),w!==_&&(a.push(d),this.shared.updateVariable(d,w),this.eventManager.requestRender())}else if("time"===m.dynamicVariableType)this.shared.updateVariable(d,gW(o,m)),a.push(d),this.eventManager.requestRender();else{let _=Us.isTextValue(m.endValue)?eq(m.endValue.textValue):m.endValue,b=this.shared.getDynamicVariableToggleIsForward(d)??!0,w=g+(s-f)/1e3*("timer"===m.dynamicVariableType?-1:1)*(b?1:-1);w=Math.max(w,0),m.hasEnd&&(w="stopwatch"===m.dynamicVariableType?qe.clamp(w,v,_):qe.clamp(w,_,v),w===v&&this.shared.setDynamicVariableToggleIsForward(d,void 0),m.repeat?Math.abs(w-_)<("number3decimal"===m.format?1e-4:.1)&&(w=v):(Math.abs(w-v)<("number3decimal"===m.format?1e-4:.1)||Math.abs(w-_)<("number3decimal"===m.format?1e-4:.1))&&this.shared.setDynamicVariablePlayState(d,"Paused")),w!==g&&(a.push(d),this.dynamicVars[u].timerSeconds=w,this.shared.updateVariable(d,Go.getFormattedTimerTime(w,m)),this.eventManager.requestRender())}}}else this.dynamicVars[u].last=s,this.dynamicVars[u].expectedTime=s+y}this.needsMouse&&this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,this.events.forEach(u=>{"mouseProperty"===u.data.variableId&&(u.dispatch(),this.eventManager.requestRender())}));let c=!1;this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,c=!0);let h=!1;this.shared.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=this.shared.raycastProperty,h=!0),this.events.forEach(u=>{(a.includes(u.data.variableId)||l.find(d=>d.objId===u.data.objectId&&d.property===u.data.property)||"mouseProperty"===u.data.variableId&&c||"raycastProperty"===u.data.variableId&&h)&&(u.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()},e.page.traverseEntity(s=>{s.data?.events.filter(o=>"VariableChange"===o.data.type&&!o.data.disabled).forEach(o=>{this.events.push(new d3e(s.uuid,o.data,s,e.page,e.sharedAssets,i))})}),this.propertiesToWatch=this.events.filter(s=>"objectProperty"===s.data.variableId&&null!==s.data.objectId).map(s=>({objectId:s.data.objectId,property:s.data.property,prevValue:null})),this.shared=e.sharedAssets,this.sharedVariables.forEach(({id:s,data:o})=>{if(!("dynamicVariableType"in o))return void(this.events.find(l=>l.data.variableId===s)&&this.variablesToWatch.push({id:s,prevValue:this.shared.getVariable(s)}));let a;if("timer"===o.dynamicVariableType||"stopwatch"===o.dynamicVariableType){let l;if(Us.isTextValue(o.value)&&Array.isArray(o.value.textValue)){let c=o.value.textValue;l=3===c.length?c[2]+60*c[1]+3600*c[0]:c[1]+60*c[0]}else l=o.value;a=l,this.dynamicVars.push({id:s,last:-1,expectedTime:-1,data:o,timerSeconds:l,startValue:a})}else"time"===o.dynamicVariableType&&this.shared.updateVariable(s,gW(new Date,o)),"counter"===o.dynamicVariableType&&(a=Us.isTextValue(o.value)?eq(o.value.textValue):o.value),this.dynamicVars.push({id:s,last:-1,expectedTime:-1,data:o,startValue:a})})}pause(){this.pauseTime=Date.now()}resume(){let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},d3e=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=is(t,t.actions,n,r,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch())}dispose(){Kn(this.actions)}};function eq(e){return 3===e.length?e[2]+60*e[1]+3600*e[0]:e[1]+60*e[0]}var iq,Lt,ar,y3e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};yCe.then(e=>{iq=e,Lt=new e.Vec3,ar=new e.Vec3});var _3e=new M;function x3e(e){let t=!1;return e.scene.objects.forEach(i=>{"Page"===i.data.type&&!t&&i.data.publish.gameControlObject&&tv.traverseModuleInstances(e,i.id,(n,r,s)=>{for(let o of s)"GameControl"===o.data.type&&o.data.navmesh.enabled&&(t=!0)})}),t}var S3e={type:"change"},nq={type:"changeZoom"},C3e={type:"changePan"},If={type:"start"},Pf={type:"end",changed:!0},E3e={type:"end",changed:!1},S2=new ft,rq=new z,M3e=2*Math.PI,C2=new M,px=new z,E2=new M,fx=new ft,sq=new ye,T3e={type:"requestRender"},oq=class extends sr{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,3,1],this.offset=new M,this.eye=new M,this.lastPosition=new M,this.lastQuaternion=new ft,this.current=new z,this.overShoot=new z,this.overRatio=new z,this.spherical=new h4,this.sphericalDelta=new h4,this.panOffset=new M,this.panLeftV=new M,this.panUpV=new M,this.panV=new M,this.rotateStart=new z,this.rotateEnd=new z,this.rotateDelta=new z,this.panStart=new z,this.panEnd=new z,this.panDelta=new z,this.dollyStart=new z,this.dollyEnd=new z,this.dollyDelta=new z,this.rotationRangeFactor=new z,this.panRangeFactor=new z,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=n=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=n.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(E2,fx,C2),this.offset.copy(E2).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&-1===this.state&&this.rotateLeft((!0===this.autoRotateClockwise?1:-1)*this.getAutoRotationAngle()),0!==this.rotationLimitsMode&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),2!==this.rotationLimitsMode&&(this.spherical.phi+=this.sphericalDelta.phi),(1!==this.rotationLimitsMode||!0===this.autoRotate)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),0!==this.panLimitsMode&&(this.target.applyQuaternion(S2.copy(fx).invert()),this.panOffset.applyQuaternion(S2),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(fx),this.panOffset.applyQuaternion(fx)),2===this.panLimitsMode&&(this.panOffset.y=0),1===this.panLimitsMode&&(this.panOffset.x=0),-1!==this.state||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),E2.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(sq.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(sq));let n=this.spherical.phi%M3e;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(pi.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),n>0&&n>Math.PI||n<0&&n>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),-1===this.state||!0===this.enableDamping){let r=1===this.hoverRotatePanMode?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-r,this.sphericalDelta.phi*=1-r}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>.01||8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-8?(this.dispatchEvent(S3e),this.object.dispatchEvent(T3e),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=n=>{!1!==this.enabled&&("touch"===n.pointerType||"pen"===n.pointerType&&Bs?this.onPointerDownTouch(n):this.onPointerDownMouse(n),-1!==this.state&&(this.isPointerDown=!0,this.dispatchEvent(If),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),n.stopPropagation(),"touch"===n.pointerType||"pen"===n.pointerType&&Bs||this.domElement.setPointerCapture(n.pointerId)))},this.onPointerLeave=n=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(1===this.hoverRotatePanMode?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,C2.subVectors(this.position0,this.target0),this.spherical.setFromVector3(C2),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):2===this.hoverRotatePanMode&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=n},this.onPointerEnter=n=>{this.resetHoverEffectOnPointerLeave||void 0===this.pointerLeaveEvent?px.set(n.clientX-this.domElement.clientWidth/2,n.clientY-this.domElement.clientHeight/2):px.set(n.clientX-this.pointerLeaveEvent.clientX,n.clientY-this.pointerLeaveEvent.clientY),1===this.hoverRotatePanMode?(this.rotateDelta.copy(px).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(rq,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(n.clientX,n.clientY)):2===this.hoverRotatePanMode&&(this.panDelta.copy(px).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(n.clientX,n.clientY)),this.update()},this.onPointerMove=n=>{!1!==this.enabled&&(this.checkRaycastLock()||("touch"===n.pointerType||"pen"===n.pointerType&&Bs?this.onPointerMoveTouch(n):this.onPointerMoveMouse(n),n.stopPropagation()))},this.onPointerUp=n=>{this.isPointerDown=!1,0===ot.length&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),ot.length>1&&n.preventDefault(),this.dispatchEvent(this.hasChange?Pf:E3e),this.state=-1,n&&(n.stopPropagation(),"touch"===n.pointerType||"pen"===n.pointerType&&Bs||this.domElement.releasePointerCapture(n.pointerId))},this.onPointerDownMouse=n=>{let r;switch(r=this.useKeyEvents?this.mouseButtons[n.button]:this.mouseButtonsPlay[n.button],r){case 0:if(!0!==n.altKey||n.shiftKey||Rb(n)){if(" "===this.key){if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2}}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(n),this.state=0}break;case 4:if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2;break;case 3:if(Rb(n)||n.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(n),this.state=0}break;case 5:if(Rb(n)||n.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(n),this.state=0}else{if(!1===this.enablePan)return;this.handleMouseDownPan(n),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=n=>{switch(this.state){case 0:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(n);break;case 1:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(n);break;case 2:if(!1===this.enablePan)return;this.handleMouseMovePan(n)}this.object.wasMovedByUser=!0},this.onPointerDownTouch=n=>{switch(ot.length>1&&n.preventDefault(),this.touches[ot.length-1]){case 0:if(!1===this.enableRotate)return void(this.state=-1);this.handleTouchStartRotate(),this.state=3;break;case 1:if(!1===this.enablePan)return void(this.state=-1);this.handleTouchStartPan(),this.state=4;break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(),this.state=5;break;case 3:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=n=>{switch(ot.length>1&&n.preventDefault(),this.state){case 3:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(n),this.update();break;case 4:if(!1===this.enablePan)return;this.handleTouchMovePan(n),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(n),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(n),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=QA(()=>this.dispatchEvent(Pf),33),this.onMouseWheel=n=>{!1===this.enabled||!1===this.enableZoom&&!1===this.enablePan||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&n.preventDefault(),this.dispatchEvent(If),this.handleMouseWheel(n),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=n=>{if(n.preventDefault(),!1!==this.enabled&&!this.checkRaycastLock()&&!kH)if("gesturechange"===n.type){if(!1===this.enableZoom||!1===this.isTouchZoom)return;this.dispatchEvent(If),n.scale>this.prevScale?this.dollyIn(this.getZoomScale()):n.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=n.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Pf)},this.onContextMenu=n=>{n.preventDefault()},this.onTouchEnd=n=>{n.preventDefault()},this.onKeyDown=n=>{!1!==this.enabled&&(this.key=n.key," "===n.key&&this.dispatchEvent(If))},this.onKeyUp=n=>{!1!==this.enabled&&(this.key=void 0,-1!==this.state&&"Alt"===n.key&&this.onPointerUp(ot[0])," "===n.key&&this.dispatchEvent(Pf))},this.onPointerHover=n=>{"mouse"!==n.pointerType||!1===this.enabled||-1!==this.state||2===this.hoverRotatePanMode&&this.isPanOverShoot||1===this.hoverRotatePanMode&&this.isRotateOverShoot||(this.isPointerDown=!0,2===this.hoverRotatePanMode?this.handleMouseMovePan(n,this.hoverRotatePanStrength):1===this.hoverRotatePanMode&&this.handleMouseMoveRotate(n,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=n=>{n.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(e){this.hasChange="start"!==e.type,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents="window"===t,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.hoverRotatePanStrength=(e.hoverRotatePanStrength/100)**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let n=this.object.getTarget().applyQuaternion(S2.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+n.y,this.maxV=e.panVerticalOffset.max+n.y,this.minH=-e.panHorizontalOffset.min+n.x,this.maxH=e.panHorizontalOffset.max+n.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Ka(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Ka(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Ka(Ka(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=Ka(Ka(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===e.orbitTouches&&(this.touches[0]=0),1===e.panTouches&&(this.touches[0]=1),2===e.orbitTouches&&(this.touches[1]=3),2===e.panTouches&&(this.touches[1]=2),3===e.orbitTouches&&(this.touches[2]=0),3===e.panTouches&&(this.touches[2]=1),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,n,r,s,o,a){let l,c,h;this.overShoot.set(0,0),e instanceof M?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,c=e.phi,this.current.set(Ka(this.spherical.theta),Ka(this.spherical.phi)),h=!1),0===i&&(this.current.x+=l,this.current.y+=c),(3===t||2===t)&&(!h&&this.isThetaFlipped?this.current.x>n&&this.current.x<0?this.overShoot.x=n-this.current.x:this.current.x<r&&this.current.x>0&&(this.overShoot.x=r-this.current.x):this.current.x>n?this.overShoot.x=n-this.current.x:this.current.x<r&&(this.overShoot.x=r-this.current.x)),(3===t||1===t)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<o&&(this.overShoot.y=o-this.current.y)),h||(this.overShoot.x=Ka(this.overShoot.x),this.overShoot.y=Ka(this.overShoot.y)),0!==i?(this.overRatio.copy(this.overShoot).divide(a),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===i&&(this.overRatio.x=aq(Math.abs(this.overRatio.x)),this.overRatio.y=aq(Math.abs(this.overRatio.y))),this.isPointerDown||1===i?2===i&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):2===i&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=.05*this.overShoot.x),this.phiIsFree||(c=.05*this.overShoot.y),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof M?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=!0===e?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){this.panV.copy(this.object.position).sub(this.target);let r=this.panV.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*r/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(C3e)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(nq)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(nq)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(If),this.dollyOut(e),this.dispatchEvent(Pf)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(If),this.dollyIn(e),this.dispatchEvent(Pf)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){void 0!==e.movementX?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(rq,-this.object.angleOffsetFromUp);let n=this.useWindowEvents?window.innerHeight:this.domElement.clientHeight,r=2*Math.PI*this.rotateDelta.x/n,s=2*Math.PI*this.rotateDelta.y/n;this.rotateLeft(r),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){void 0!==e.movementX?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(!1===pCe&&!1===Rb(e)&&!0===function I3e(e){return 0===e.wheelDeltaY||0===e.deltaY?!(Pb&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120)&&(e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:0===e.deltaMode):e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:0===e.deltaMode}(e)){if(!1===this.enablePan)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):this.pan(this.panDelta.x,e.shiftKey?0:this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(!1===this.enableZoom)return;0===e.deltaY?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){2===ot.length?this.rotateStart.set(.5*(ot[0].pageX+ot[1].pageX),.5*(ot[0].pageY+ot[1].pageY)):this.rotateStart.set(ot[0].pageX,ot[0].pageY)}handleTouchStartPan(){2===ot.length?this.panStart.set(.5*(ot[0].pageX+ot[1].pageX),.5*(ot[0].pageY+ot[1].pageY)):this.panStart.set(ot[0].pageX,ot[0].pageY)}handleTouchStartDolly(){let e=ot[0].pageX-ot[1].pageX,t=ot[0].pageY-ot[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(2===ot.length){let i=$A(e);this.rotateEnd.set(.5*(e.pageX+i.x),.5*(e.pageY+i.y))}else{if(e.pointerId!==ot[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(2===ot.length){let t=$A(e);this.panEnd.set(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}else{if(e.pointerId!==ot[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=$A(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=this.options?.showCameraLock;return e&&e(),!0}}return!1}};function Ka(e){let t=2*Math.PI;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function aq(e){return 1-Math.pow(1-e,4)}var Gt,lq=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.page=n,this.currentIntersectedObjects=[],this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=is(t,t.actions,n,r,s,i),this.target=t.target,this.useToggle="Toggle"===t.runMode,this.triggeringObjects=t.triggeringObjects.map(o=>n.scene.find(o))}isValidTriggeringObject(e){return"all"===this.target||this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){Kn(this.actions)}dispatch(){this.disabled||this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):"Once"===this.data.runMode&&this.alreadyPlayedNonTogglingActions.add(e)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.useToggle?(this.actions.Transition.forEach(e=>{e.toggle()}),this.actions.SwitchCamera.forEach(e=>{e.toggle()})):(this.actions.Transition.forEach(e=>{!1===this.alreadyPlayedNonTogglingActions.has(e)&&e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}};bCe.then(e=>Gt=e);var An=new M,ia=new ft,iu=new M,M2=new Yn(0,0,0,"YXZ"),cq=new Yn(0,0,0,"XYZ"),na=new M,A2=new M,D2=new M(1,1,1),Rf=new ft,mx=new ye,uq=new ye,P3e={type:"updateMatrix"},hq=new ft,T2=new ds,I2={type:"beginEvent",eventName:"Collision"},R3e={type:"beginEvent",eventName:"Trigger"},gx=e=>e.states.some(t=>void 0!==t.data.position||void 0!==t.data.rotation||void 0!==t.data.hiddenMatrix||void 0!==t.data.cloner||void 0!==t.data.pathSnapping);function N3e(e){let t=this._clip.duration,i=this._clip.start??0,n=this.loop,r=this.time+e,s=this._loopCount,o=2202===n;if(0===e)return-1===s?r:o&&1==(1&s)?t-(r-i):r;if(2200===n){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<i){let a=Math.floor((r-i)/(t-i));r-=(t-i)*a,s+=Math.abs(a);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o||(r=e>0?t:i,1===this.repetitions&&(r=t)),this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===l){let c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&1==(1&s))return t-(r-i)}return r}var nu,dq=!1,P2=new WeakMap,F3e=class extends fA{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){let r=new mA(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,s=>{this.decodeDracoFile(s,t).catch(n)},i,n)}decodeDracoFile(e,t,i,n){return this.decodeGeometry(e,{attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i}).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(P2.has(e)){let a=P2.get(e);if(a.key===i)return a.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n,r=this.workerNextTaskID++,o=this._getWorker(r,e.byteLength).then(a=>(n=a,new Promise((l,c)=>{n._callbacks[r]={resolve:l,reject:c},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return o.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),P2.set(e,{key:i,promise:o}),o}_createGeometry(e){let t=new Ze;e.index&&t.setIndex(new st(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let n=e.attributes[i];t.setAttribute(n.name,new st(n.array,n.itemSize))}return t}_loadLibrary(e,t){let i=new mA(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,r)=>{i.load(e,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let r=B3e.toString(),s=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){let s=r.data;switch(s.type){case"decode":n._callbacks[s.id].resolve(s);break;case"error":n._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function B3e(){let e,t;function r(o,a,l,c,h,u){let d=u.num_components(),p=l.num_points()*d,f=p*h.BYTES_PER_ELEMENT,m=function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}(o,h),g=o._malloc(f);a.GetAttributeDataArrayForAllPoints(l,u,m,f,g);let v=new h(o.HEAPF32.buffer,g,p).slice();return o._free(g),{name:c,array:v,itemSize:d}}onmessage=function(o){let a=o.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise(function(h){e.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(e)});break;case"decode":let l=a.buffer,c=a.taskConfig;t.then(h=>{let u=h.draco,d=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=function i(o,a,l,c){let d,p,h=c.attributeIDs,u=c.attributeTypes,f=a.GetEncodedGeometryType(l);if(f===o.TRIANGULAR_MESH)d=new o.Mesh,p=a.DecodeBufferToMesh(l,d);else{if(f!==o.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");d=new o.PointCloud,p=a.DecodeBufferToPointCloud(l,d)}if(!p.ok()||0===d.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let m={index:null,attributes:[]};for(let g in h){let y,_,v=self[u[g]];if(c.useUniqueIDs)_=h[g],y=a.GetAttributeByUniqueId(d,_);else{if(_=a.GetAttributeId(d,o[h[g]]),-1===_)continue;y=a.GetAttribute(d,_)}m.attributes.push(r(o,a,d,g,v,y))}return f===o.TRIANGULAR_MESH&&(m.index=function n(o,a,l){let c=3*l.num_faces(),h=4*c,u=o._malloc(h);a.GetTrianglesUInt32Array(l,h,u);let d=new Uint32Array(o.HEAPF32.buffer,u,c).slice();return o._free(u),{array:d,itemSize:1}}(o,a,d)),o.destroy(d),m}(u,d,p,c),m=f.attributes.map(g=>g.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{u.destroy(p),u.destroy(d)}})}}}function z3e(e){return R2.apply(this,arguments)}function R2(){return R2=(0,sn.Z)(function*(e){if(nu){let i,t={attributeIDs:nu.defaultAttributeIDs,attributeTypes:nu.defaultAttributeTypes,useUniqueIDs:!1};try{i=yield nu.decodeGeometry(new Int8Array(e).buffer,t)}catch(n){console.error(n)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([n,r])=>({name:n,itemSize:r.itemSize,array:r.array}))}}return null}),R2.apply(this,arguments)}function O2(){return O2=(0,sn.Z)(function*(e,t){let[i,n]=$H(wD.deserialize(new Uint8Array(e)));fG(i);let r=[];i.scene.objects.traverse((s,o)=>{"Mesh"===o.type&&"NonParametricGeometry"===o.geometry.type&&void 0!==o.geometry.data.draco&&r.push(o)}),r.length&&(yield function V3e(){return nu||(nu=new F3e).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),nu.decoderPending}());for(let s of r){let o=yield z3e(Sn(s.geometry.data.draco));if(o){o.index&&(s.geometry.data.index={array:o.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let a={};o.attributes.forEach(({name:l,array:c,itemSize:h})=>{a[l]={array:c,itemSize:h,type:"Float32Array",normalized:!1}}),s.geometry.data.attributes=a,s.geometry.data.draco=void 0}}return t&&t(i),n.result().data}),O2.apply(this,arguments)}var j3e=class{constructor(e,t,i,n,r,s,o){this.id=e,this.data=t,this.dataEvent=i,this.object=n,this.stage=!1,this.actions=is(i,t.actions,r,s,o,n)}disconnect(){Kn(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},H3e=class extends ta{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,n)=>{this.breakpoints.forEach(r=>{let a,s=ED.deviceToSize(r.data.size),o="horizontal"===r.dataEvent.orientation?i:n;switch(r.data.operator){case"<":a=o<s[0];break;case">":a=o>s[0];break;case"<>":a=o>s[0]&&o<s[1]}r.stage!==a&&(r.stage=a,r.stage?r.dispatchIn():r.dispatchOut())}),this.eventContext.updateDomRect()},this.onResizeObserver=new ResizeObserver(i=>{for(let n of i){let{width:r,height:s}=n.contentRect;this.resize(r,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i),e.traverseEntity(n=>{if(n.visible&&n.data?.events.length)for(let{data:r}of n.data.events)r.disabled||"Resize"===r.type&&r.breakpoints.forEach(({data:s,id:o})=>{try{let a=new j3e(o,s,r,n,e,t,this.eventManager);this.breakpoints.push(a)}catch{}})})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},pq=Object.keys(q9).filter(e=>isNaN(Number(e)));function Z3e(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function Hv(e){return e instanceof Cv?"SubdivObject":"NonParametricGeometry"===e.geometry.type?"NonParametric":"Mesh"}var J3e=Wn(Cue(),1),eLe=new z;let nLe=(()=>{class e{constructor(i){this.modalService=i,this.modalRef=null}openModal(){this.modalRef=this.modalService.open(Gz),this.modalRef.onClose.subscribe(i=>{console.log(i)})}static#e=this.\u0275fac=function(n){return new(n||e)(pe(kV))};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-header"]],decls:20,vars:0,consts:[["id","mainNav",1,"navbar","navbar-expand-lg","navbar-light","fixed-top","shadow-sm","custom-navbar"],[1,"container","px-5"],["href","#page-top",1,"navbar-brand","fw-bold"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarResponsive","aria-controls","navbarResponsive","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"bi-list"],["id","navbarResponsive",1,"collapse","navbar-collapse"],[1,"navbar-nav","ms-auto","me-4","my-3","my-lg-0"],[1,"nav-item"],["href","#features",1,"nav-link","me-lg-3"],["href","#download",1,"nav-link","me-lg-3"],["data-bs-toggle","modal","data-bs-target","#feedbackModal",1,"btn","btn-primary","rounded-pill","px-3","mb-2","mb-lg-0",3,"click"],[1,"d-flex","align-items-center"],[1,"bi-chat-text-fill","me-2"],[1,"small"]],template:function(n,r){1&n&&(Me(0,"nav",0)(1,"div",1)(2,"a",2),ht(3,"PrimaPrime"),Pe(),Me(4,"button",3),ht(5," Menu "),wt(6,"i",4),Pe(),Me(7,"div",5)(8,"ul",6)(9,"li",7)(10,"a",8),ht(11,"About"),Pe()(),Me(12,"li",7)(13,"a",9),ht(14,"Contact"),Pe()()(),Me(15,"button",10),vn("click",function(){return r.openModal()}),Me(16,"span",11),wt(17,"i",12),Me(18,"span",13),ht(19,"Send Feedback"),Pe()()()()()())},styles:[".custom-navbar[_ngcontent-%COMP%]{background-color:transparent!important}.custom-navbar[_ngcontent-%COMP%]   .navbar-brand[_ngcontent-%COMP%], .custom-navbar[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#fff!important}.custom-navbar[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%], .custom-navbar[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{align-items:flex-start}"]})}return e})(),rLe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-footer"]],decls:76,vars:0,consts:[[1,"text-center","text-lg-start","bg-light","text-muted"],[1,"d-flex","justify-content-center","justify-content-lg-between","p-4","border-bottom"],[1,"me-5","d-none","d-lg-block"],["href","",1,"me-4","text-reset"],[1,"fab","fa-facebook-f"],[1,"fab","fa-twitter"],[1,"fab","fa-google"],[1,"fab","fa-instagram"],[1,"fab","fa-linkedin"],[1,"fab","fa-github"],[1,""],[1,"container","text-center","text-md-start","mt-3"],[1,"row","mt-3"],[1,"col-md-3","col-lg-4","col-xl-3","mx-auto","mb-3"],[1,"text-uppercase","fw-bold","mb-3"],[1,"fas","fa-gem","me-3"],[1,"col-md-2","col-lg-2","col-xl-2","mx-auto","mb-3"],["href","#!",1,"text-reset"],[1,"col-md-3","col-lg-2","col-xl-2","mx-auto","mb-3"],[1,"col-md-4","col-lg-3","col-xl-3","mx-auto","mb-md-0","mb-3"],[1,"fas","fa-home","me-3"],[1,"fas","fa-envelope","me-3"],[1,"fas","fa-phone","me-3"],[1,"fas","fa-print","me-3"],[1,"text-center","p-3",2,"background-color","rgba(0, 0, 0, 0.05)"],["href","https://mdbootstrap.com/",1,"text-reset","fw-bold"]],template:function(n,r){1&n&&(Me(0,"footer",0)(1,"section",1)(2,"div",2)(3,"span"),ht(4,"Get connected with us on social networks:"),Pe()(),Me(5,"div")(6,"a",3),wt(7,"i",4),Pe(),Me(8,"a",3),wt(9,"i",5),Pe(),Me(10,"a",3),wt(11,"i",6),Pe(),Me(12,"a",3),wt(13,"i",7),Pe(),Me(14,"a",3),wt(15,"i",8),Pe(),Me(16,"a",3),wt(17,"i",9),Pe()()(),Me(18,"section",10)(19,"div",11)(20,"div",12)(21,"div",13)(22,"h6",14),wt(23,"i",15),ht(24,"PrimaPrime "),Pe(),Me(25,"p"),ht(26," You find the prima we give you the restaurant. "),Pe()(),Me(27,"div",16)(28,"h6",14),ht(29," Main Districts "),Pe(),Me(30,"p")(31,"a",17),ht(32,"Porto"),Pe()(),Me(33,"p")(34,"a",17),ht(35,"Braga"),Pe()(),Me(36,"p")(37,"a",17),ht(38,"Lisboa"),Pe()(),Me(39,"p")(40,"a",17),ht(41,"Faro"),Pe()()(),Me(42,"div",18)(43,"h6",14),ht(44," Top 5 restaurant "),Pe(),Me(45,"p")(46,"a",17),ht(47,"Restaurant 1"),Pe()(),Me(48,"p")(49,"a",17),ht(50,"Restaurant 2"),Pe()(),Me(51,"p")(52,"a",17),ht(53,"Restaurant 3"),Pe()(),Me(54,"p")(55,"a",17),ht(56,"Restaurant 4"),Pe()()(),Me(57,"div",19)(58,"h6",14),ht(59," Contact "),Pe(),Me(60,"p"),wt(61,"i",20),ht(62," Portugal, Porto"),Pe(),Me(63,"p"),wt(64,"i",21),ht(65," primaprime@gmail.com "),Pe(),Me(66,"p"),wt(67,"i",22),ht(68," + 351 234 567 88"),Pe(),Me(69,"p"),wt(70,"i",23),ht(71," + 351 234 567 89"),Pe()()()()(),Me(72,"div",24),ht(73," \xa9 2023 Copyright: "),Me(74,"a",25),ht(75,"primaprime.com"),Pe()()())}})}return e})(),sLe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-present"]],decls:32,vars:0,consts:[[1,"masthead"],[1,"container"],[1,"row","gx-5","align-items-center"],[1,"col-lg-6"],[1,"mb-5","mb-lg-0","text-center","text-lg-start"],[1,"display-1","lh-1","mb-3","text-white"],[1,"lead","fw-normal","text-white","mb-5"],[1,"d-flex","flex-column","flex-lg-row","align-items-center"],["href","#!",1,"me-lg-3","mb-4","mb-lg-0"],["src","assets/img/google-play-badge.svg","alt","...",1,"app-badge"],["href","#!"],["src","assets/img/app-store-badge.svg","alt","...",1,"app-badge"],[1,"masthead-device-mockup"],["viewBox","0 0 100 100","xmlns","http://www.w3.org/2000/svg",1,"circle"],["id","circleGradient","gradientTransform","rotate(45)"],["offset","0%",1,"gradient-start-color"],["offset","100%",1,"gradient-end-color"],["cx","50","cy","50","r","50"],["viewBox","0 0 240.83 240.83","xmlns","http://www.w3.org/2000/svg",1,"shape-1","d-none","d-sm-block"],["x","-32.54","y","78.39","width","305.92","height","84.05","rx","42.03","transform","translate(120.42 -49.88) rotate(45)"],["x","-32.54","y","78.39","width","305.92","height","84.05","rx","42.03","transform","translate(-49.88 120.42) rotate(-45)"],["viewBox","0 0 100 100","xmlns","http://www.w3.org/2000/svg",1,"shape-2","d-none","d-sm-block"],[1,"device-wrapper"],["data-device","iPhoneX","data-orientation","portrait","data-color","black",1,"device"],[1,"screen","bg-black"],["muted","muted","autoplay","","loop","",2,"max-width","100%","height","100%"],["src","assets/img/demo-screen.mp4","type","video/mp4"]],template:function(n,r){1&n&&(Me(0,"header",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1",5),ht(6,"The new way to Pick a Restaurant!"),Pe(),Me(7,"h5",6),ht(8,"Head over to our new app - your ultimate wingman in finding the best restaurants around."),Pe(),Me(9,"div",7)(10,"a",8),wt(11,"img",9),Pe(),Me(12,"a",10),wt(13,"img",11),Pe()()()(),Me(14,"div",3)(15,"div",12),c1(),Me(16,"svg",13)(17,"defs")(18,"linearGradient",14),wt(19,"stop",15)(20,"stop",16),Pe()(),wt(21,"circle",17),Pe(),Me(22,"svg",18),wt(23,"rect",19)(24,"rect",20),Pe(),Me(25,"svg",21),wt(26,"circle",17),Pe(),u1(),Me(27,"div",22)(28,"div",23)(29,"div",24)(30,"video",25),wt(31,"source",26),Pe()()()()()()()()())},styles:[".masthead[_ngcontent-%COMP%]{background-color:transparent!important}.gradient-start-color[_ngcontent-%COMP%], .gradient-end-color[_ngcontent-%COMP%]{color:#fff!important;background-color:#fff!important}"]})}return e})(),oLe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-features"]],decls:53,vars:0,consts:[["id","features"],[1,"container","px-5"],[1,"row","gx-5","align-items-center"],[1,"col-lg-8","order-lg-1","mb-5","mb-lg-0"],[1,"container-fluid","px-5"],[1,"row","gx-5"],[1,"col-md-6","mb-5"],[1,"text-center","text-white"],[1,"bi-phone","icon-feature","text-gradient","d-block","mb-3"],[1,"font-alt"],[1,"mb-0"],[1,"bi-search","icon-feature","text-gradient","d-block","mb-3"],[1,"row"],[1,"col-md-6","mb-5","mb-md-0"],[1,"bi-gift","icon-feature","text-gradient","d-block","mb-3"],[1,"col-md-6"],[1,"bi-patch-check","icon-feature","text-gradient","d-block","mb-3"],[1,"col-lg-4","order-lg-0"],[1,"features-device-mockup"],["viewBox","0 0 100 100","xmlns","http://www.w3.org/2000/svg",1,"circle"],["id","circleGradient","gradientTransform","rotate(45)"],["offset","0%",1,"gradient-start-color"],["offset","100%",1,"gradient-end-color"],["cx","50","cy","50","r","50"],["viewBox","0 0 240.83 240.83","xmlns","http://www.w3.org/2000/svg",1,"shape-1","d-none","d-sm-block"],["x","-32.54","y","78.39","width","305.92","height","84.05","rx","42.03","transform","translate(120.42 -49.88) rotate(45)"],["x","-32.54","y","78.39","width","305.92","height","84.05","rx","42.03","transform","translate(-49.88 120.42) rotate(-45)"],["viewBox","0 0 100 100","xmlns","http://www.w3.org/2000/svg",1,"shape-2","d-none","d-sm-block"],[1,"device-wrapper"],["data-device","iPhoneX","data-orientation","portrait","data-color","black",1,"device"],[1,"screen","bg-black"],["muted","muted","autoplay","","loop","",2,"max-width","100%","height","100%"],["src","assets/img/demo-screen.mp4","type","video/mp4"]],template:function(n,r){1&n&&(Me(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),wt(8,"i",8),Me(9,"h3",9),ht(10,"Optimized to Android and IOS"),Pe(),Me(11,"p",10),ht(12,"Ready to help both worlds, with the same features!"),Pe()()(),Me(13,"div",6)(14,"div",7),wt(15,"i",11),Me(16,"h3",9),ht(17,"Best Restaurant Search Engine"),Pe(),Me(18,"p",10),ht(19,"We don't show you all, we only show you what you need!"),Pe()()()(),Me(20,"div",12)(21,"div",13)(22,"div",7),wt(23,"i",14),Me(24,"h3",9),ht(25,"Free to Use"),Pe(),Me(26,"p",10),ht(27,"This app is free we want to you to succeed! Our success is your success"),Pe()()(),Me(28,"div",15)(29,"div",7),wt(30,"i",16),Me(31,"h3",9),ht(32,"Facts Checked"),Pe(),Me(33,"p",10),ht(34,"We personally validate the restaurants rankings before show to our users!"),Pe()()()()()(),Me(35,"div",17)(36,"div",18),c1(),Me(37,"svg",19)(38,"defs")(39,"linearGradient",20),wt(40,"stop",21)(41,"stop",22),Pe()(),wt(42,"circle",23),Pe(),Me(43,"svg",24),wt(44,"rect",25)(45,"rect",26),Pe(),Me(46,"svg",27),wt(47,"circle",23),Pe(),u1(),Me(48,"div",28)(49,"div",29)(50,"div",30)(51,"video",31),wt(52,"source",32),Pe()()()()()()()()())}})}return e})(),aLe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-overview"]],decls:11,vars:0,consts:[[1,"bg-light"],[1,"container","px-5"],[1,"row","gx-5","align-items-center","justify-content-center","justify-content-lg-between"],[1,"col-12","col-lg-5"],[1,"display-4","lh-1","mb-4"],[1,"lead","fw-normal","text-muted","mb-5","mb-lg-0"],[1,"col-sm-8","col-md-6"],[1,"px-5","px-sm-0"],["src","https://source.unsplash.com/Pb9bUzH1nD8/900x900","alt","...",1,"img-fluid","rounded-circle"]],template:function(n,r){1&n&&(Me(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),ht(5,"Enter the new age of restaurant findings"),Pe(),Me(6,"p",5),ht(7,"This app is perfect for help you find the perfect restaurant for your date, prepared for all types of dates, a first date, a one year anniversary. We got it all! We only ask in return help to mantain this app updated."),Pe()(),Me(8,"div",6)(9,"div",7),wt(10,"img",8),Pe()()()()())}})}return e})(),lLe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-getapp"]],decls:9,vars:0,consts:[["id","download",1,"bg-gradient-primary-to-secondary"],[1,"container","px-5"],[1,"text-center","text-white","font-alt","mb-4"],[1,"d-flex","flex-column","flex-lg-row","align-items-center","justify-content-center"],["href","#!",1,"me-lg-3","mb-4","mb-lg-0"],["src","assets/img/google-play-badge.svg","alt","...",1,"app-badge"],["href","#!"],["src","assets/img/app-store-badge.svg","alt","...",1,"app-badge"]],template:function(n,r){1&n&&(Me(0,"section",0)(1,"div",1)(2,"h2",2),ht(3,"Get the app now!"),Pe(),Me(4,"div",3)(5,"a",4),wt(6,"img",5),Pe(),Me(7,"a",6),wt(8,"img",7),Pe()()()())}})}return e})();const cLe=["canvas3d1"],uLe=["canvas3d2"];let hLe=(()=>{class e{constructor(){this.title="primaprime"}ngOnInit(){this.initCanvas(this.canvas3d1,"https://prod.spline.design/oaIEWq6IabiJg6oQ/scene.splinecode"),this.initCanvas(this.canvas3d2,"https://prod.spline.design/LrXe6UjC3nwcULKu/scene.splinecode")}initCanvas(i,n){i&&i.nativeElement&&new class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=n=>{this.time=n,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),!this._renderer||!this._isPaused&&("manual"===this.renderMode&&!this._renderRequested||"auto"===this.renderMode&&this._skipRender)||(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&((this._eventManager.handlers?.Follow).onAnimationFrameDamping(),(this._eventManager.handlers?.LookAt).onAnimationFrameDamping(),(this._eventManager.handlers?.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera&&(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0?(this._renderer.sceneTransitionTimeRemaining-=this.dt,this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration,this._skipRender=!1):this._renderer.pipeline.sceneTransitionFromTexture=null,this._renderer.renderSplineScene(this._scene,this._camera)),this.canvas.dispatchEvent(this._renderedEvent)),this._perfs?.end()},this._resize=()=>{if(this._renderer){if(1===this._viewportMode&&this._frameView&&(this._frameView.frameSize=eLe.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let n=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera("fullscreen"!==n),"PerspectiveCamera"===this._camera.cameraType&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this._requestRenderAutoMode()}},this._debouncedResize=QA(this._resize,10),this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}}({x:10,y:10})),function gCe(e){e.addEventListener("pointerdown",zH,!0),e.addEventListener("pointerdown",Nb,!0),e.addEventListener("pointermove",Nb,!0),e.addEventListener("pointerup",Ep,!0),e.addEventListener("pointercancel",Ep,!0),e.addEventListener("pointerleave",Ep,!0),window.addEventListener("keydown",UH,!0),window.addEventListener("keyup",jH,!0)}(e)}load(e,t,i){var n=this;return(0,sn.Z)(function*(){(function tLe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)})(e),n.disposed=!1;let r=yield(yield fetch(e,i)).arrayBuffer();yield n.start(r,{variables:t})})()}start(e,{interactive:t=!0,variables:i}={}){var n=this;return(0,sn.Z)(function*(){if(n.disposed)return;let r=yield function U3e(e,t){return O2.apply(this,arguments)}(e);n._data=r,r.version&&(0,J3e.default)(r.version,"0.9.507")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),yield Promise.all([qW(r)&&KAe(),UTe(r)&&XAe(),tv.physicsEnabled(r.scene.objects)&&wCe(),kW(r)&&ATe(),x3e(r)&&_Ce()].filter(Boolean)),n._eventManager?.deactivate(),n._controls?.deactivate(),n._scene?.dispose();let s=new class{get sharedAssets(){return this.shared}constructor(e,t={}){this.shared=new iI(e.shared,t),this.scene=new zI(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof Zc&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Jr&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}}(r);if(s.resetPersonalCameraFromDocumentData(),n._scene=s.scene,n._sharedAssetsManager=s.sharedAssets,n._camera=n._scene.activeCamera,window.location.search.includes("merge-geometries")){let l=performance.now();!function $3e(e,t){let i=function Q3e(e,t){let i={};return e.traverseEntity(n=>{if(!n.visible||!(n instanceof gs)||"Mesh"!==n.type||Array.isArray(n.material)||n.states&&Object.keys(n.states).length)return;let r=n.parent;for(;r;){if(r instanceof gs&&n.states&&Object.keys(n.states).length)return;r=r.parent}let s=n.material.uuid,o=t.shared.materials[s];if(o){if(!br.isMergable(o))return}else{let l=t.scene.objects.get(n.uuid)?.data;if(l&&"material"in l&&"string"!=typeof l.material){if(!br.isMergable(l.material))return;s=br.getHash(l.material)}}i[s]||(i[s]={});let a=i[s][Hv(n)];if(a){if(a.push(n),n.cloner)for(let l of n.cloner.children)a.push(l)}else if(i[s][Hv(n)]=[n],n.cloner)for(let l of n.cloner.children)i[s][Hv(n)].push(l)}),i}(t,e),n=function K3e(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(n=>{let r=n.length;r>t&&(t=r)})}),t}(i),r=new Array(n),s=0,o=new Array(n),a=0,l=new Array(n),c=0,h=new Array(n),u=0;for(let[d,p]of Object.entries(i))for(let f of Object.values(p)){if(a=0,c=0,f.forEach(g=>{g instanceof gs&&(o[a++]=g.geometry.clone(),l[c++]=g)}),c<2)continue;for(let g=0;g<c;g++)l[g].updateWorldMatrix(!0,!1),o[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&Z3e(o[g]);let m=sh(o.slice(0,a),!1);if(m){let g;"SubdivObject"===d?(console.warn("Turning subdiv object into mesh"),g=new jr(m,l[0].material)):g=new jr(m,l[0].material),g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let v=y=>{u=0;for(let _ of y)_.children&&v(_.children),_ instanceof gs&&(Array.isArray(_.material)||i[_.material.uuid]&&i[_.material.uuid][Hv(_)]&&i[_.material.uuid][Hv(_)].length>1||(h[u++]=_));for(let _=0;_<u;_++)t.attach(h[_])};for(let y=0;y<c;y++){let _=l[y];v(_.children),r[s++]=_}}}for(let d=0;d<s;d++)r[d].removeFromParent()}(r,s.scene);let c=performance.now();console.log("Merged geometries in ",c-l," ms")}qW(r)&&n._scene.traverse(l=>{ja(l)&&l.recomputeBoolean()}),n._sharedAssetsManager.setRequestRender(()=>{n._requestRenderAutoMode(),n._scene?.traverse(l=>{l instanceof Xo&&l.pendingMediaLoad&&l.update()})});let o=Object.keys(r.shared.fonts).map(l=>n._sharedAssetsManager.getFont(l).loadingPromise);Promise.all(o).then(()=>{s.scene.markNeedsUpdateRendererDirty(),n._requestRenderAutoMode()}),kW(r)&&function O3e(e){if(tv.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,n)=>{if(n.events)if(Array.isArray(n.events)){for(let r of n.events)if(!0!==r.data.disabled&&"GameControl"===r.data.type&&r.data.collisionEnabled){t=!0;break}}else for(let r of Object.values(n.events))if(!0!==r.disabled&&"GameControl"===r.type&&r.collisionEnabled){t=!0;break}}),t}(r)&&(yield Promise.all(o)),n._scene.rewriteEventsBeforeGoToPlayMode(),c2(n._scene.activePage,n._sharedAssetsManager),n._renderer||(n._renderer=new gPe({canvas:n.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),n._renderer.hdTransmission=!0===r.scene.publish.hdTransmission,n._renderer.setPixelRatio(window.devicePixelRatio),n._renderer.pipeline.addEventListener("smaaloaded",n._requestRenderAutoMode)),n._scene.initializeSplatViewer(n._renderer),void 0!==r.scene.blueNoiseTextureData&&n._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let a=Object.values(r.frames)[0];if(n._frameView?n._frameView.setCamera(n._camera):("fullscreen"===a.preset?(n._viewportMode=1,n.canvas.style.display="block",n.canvas.parentElement&&(n._viewportWidth=n.canvas.parentElement.clientWidth||300,n.canvas.style.width="100%"),n.canvas.parentElement&&(n._viewportHeight=n.canvas.parentElement.clientHeight||150,n.canvas.style.height="100%")):(n._viewportMode=2,n._viewportWidth=a.size[0],n._viewportHeight=a.size[1],n.canvas.style.width=`${n._viewportWidth}px`,n.canvas.style.height=`${n._viewportHeight}px`),n._renderer.setSize(n._viewportWidth,n._viewportHeight,!1),n._frameView=new class{constructor(e,t,i,n,r){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=(new z).copy(i),this._editorSize=(new z).copy(n),this._aspect=t.aspect,this._fov=r??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||"PerspectiveCamera"!==this._camera.cameraType)return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){let t=this._frameSize.y,i=this._editorSize.y,n=this._fov;if(e&&t>i){let r=function q3e(e,t,i,n,r){return(e-t)/(i-t)*(r-n)+n}(t,1080,2160,1,15)/100;n*=t/i,n*=1-r}this._camera.aspect=this._aspect,this._camera.fov=n,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}}(n._renderer,n._camera,new z(n._viewportWidth,n._viewportHeight),new z(window.innerWidth,window.innerHeight)),n._frameView.enableResponsive=(a.allowResponsive??!1)&&"fullscreen"===a.preset),t){let l=new class{constructor(e,t,i,n,r,s,o,a){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=n,this.sharedAssets=r,this.requestRender=s,this.isExport=o,this.frame=a,this.raycaster=new DOe,this.raycasterNeedsUpdate=!0,this._useWindowEvents=!1,this._useWindowEvents="window"===t.mouseEventTarget,this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this.domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}updateDomRect(){this.domRect=this.domElement.getBoundingClientRect()}updateRaycaster(e){if(!this.raycasterNeedsUpdate)return;this.raycasterNeedsUpdate=!1;let{pageX:t,pageY:i}=e.touches?.length>0?e.touches[0]:e;this.updateDomRect(),this.raycaster.setFromCamera(function IOe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-(t-(i.top+window.scrollY))/i.height*2+1}}(t,i,this.domRect),this.getCamera())}}(n._renderer,n.data.scene.publish,n._scene,()=>n._scene.activeCamera,n._sharedAssetsManager,n._requestRenderAutoMode,!0,a);n._scene.updateMatrixWorld(!0),n._controls=new class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Gt.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,n,r]=this.rigidBodyToMesh.get(t.handle);if(An.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),ia.copy(t.rotation()),i.matrixWorld.compose(An,ia,n),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(P3e),r){let s=i.cloner;if(s&&void 0===s.objectForSample){s.matrixWorld.copy(i.matrixWorld);for(let o of s.children)o.updateMatrixWorld(!0)}for(let o of i.children)o.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,n)=>{if(!1===n)return;let r,s;if(this.sensorToTriggerEvent[t]?(r=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(r=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),r&&s&&r.isValidTriggeringObject(s))r.dispatch();else{for(let o=this.sharedGameControlGlobals.createdObjects.length-1;o>=0;o--){let a=this.sharedGameControlGlobals.createdObjects[o];if(a.userData.hasCollisionDestroy&&(a.rigidBody?.collider(0).handle===t||a.rigidBody?.collider(0).handle===i)){this.sharedGameControlGlobals.createdObjects.splice(o,1),a.removeFromParent(),requestAnimationFrame(()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(a.rigidBody));break}}if(this.gameControl?.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let o=this.sharedGameControlGlobals.colliderToEntity.get(i),a=this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid];if(void 0===a)return;for(let l of a)"character"===l.data.target&&this.dispatchCollisionEvent(l,o,i)}else if(this.gameControl?.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let o=this.sharedGameControlGlobals.colliderToEntity.get(t),a=this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid];if(void 0===a)return;for(let l of a)"character"===l.data.target&&this.dispatchCollisionEvent(l,o,t)}else{let o=this.sharedGameControlGlobals.colliderToEntity.get(t),a=this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid];if(void 0!==a)for(let h of a)"scene"===h.data.target&&this.dispatchCollisionEvent(h,o,t);let l=this.sharedGameControlGlobals.colliderToEntity.get(i),c=this.sharedGameControlGlobals.entityToCollisionEvents[l?.uuid];if(void 0!==c)for(let h of c)"scene"===h.data.target&&this.dispatchCollisionEvent(h,l,i)}}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=200,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events){if(!0===i.data.disabled)continue;let n=i.data.actions?.find(r=>"Destroy"===r.data.type)?.data;if(n)for(let r of n.objects){let s=this.page.scene.find(r);s&&(s.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!0!==i.data.disabled&&"DragDrop"===i.data.type)for(let n of i.data.objects){let r=this.page.scene.find(n);r&&(r.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{let i;if(t instanceof Xo)return;i=t instanceof wr?t.object:t;let n=i.dataPatched;if("visibility"===n.physics?.enabled?!n.visible:!n.physics?.enabled)return!0;let r=t.geometry,s=!0===i.userData.hasDestroy,o=!0===i.userData.hasDrag;if(gx(n)||s||o||i.dataPatched.events.some(a=>!0!==a.data.disabled&&"GameControl"===a.data.type))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;r&&e.push(ql(r,t.matrixWorld))}),e.length>0){let t=sh(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new uv(t)}}addRigidBody(e,t,i){let n=[],r="geometry"in e?e.geometry:void 0,s=t.dataPatched;if(void 0!==r?.getAttribute("position")&&n.push(ql(r,e.shearScale)),s.physics.fusedBody){let o=this.gatherChildrenGeom(e,n);e.traverseObject(o),e.children.forEach(l=>l.updateMatrixWorld(!0));let a=e.cloner;a&&void 0===a.objectForSample&&"dynamic"===s.physics.rigidBody&&(a.traverseObject(o),a.children.forEach(l=>l.updateMatrixWorld(!0)))}if(n.length>0){let o,a=!i.fromCreate&&"dynamic"===s.physics.rigidBody||i.fromCreate&&i.dynamic;a?(o=Gt.RigidBodyDesc.dynamic(),o.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(o=Gt.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):o=Gt.RigidBodyDesc.fixed();let l=sh(n);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(An,ia,iu),e.position0=An.clone().divideScalar(this.pixelsPerMeter),e.rotation0=ia.clone(),An.divideScalar(this.pixelsPerMeter),o.setTranslation(An.x,An.y,An.z).setRotation(ia),r?l?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l?.scale(iu.x/this.pixelsPerMeter,iu.y/this.pixelsPerMeter,iu.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(o);a&&this.rigidBodyToMesh.set(c.handle,[e,iu.clone(),s.physics.fusedBody]);let h=!(void 0===s.geometry||"SubdivGeometry"===s.geometry.type||"NonParametricGeometry"===s.geometry.type||"BooleanGeometry"===s.geometry.type||"VectorGeometry"===s.geometry.type||"StarGeometry"===s.geometry.type||"RectangleGeometry"===s.geometry.type||"EllipseGeometry"===s.geometry.type||"TriangleGeometry"===s.geometry.type||"TorusGeometry"===s.geometry.type||"HelixGeometry"===s.geometry.type);try{this.addCollider(c,s.physics,l,t,h)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(u){console.error(u)}}e.rigidBody=c}}addBoundsTree(e){let t=[];if(void 0!==e.geometry?.getAttribute("position")&&e.geometry?.getAttribute("position").count>0&&t.push(ql(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(i=>i.updateMatrixWorld(!0)),t.length>0){let i=sh(t,!1);e.bvhGeometry=i,e.bvhGeometry.boundsTree=new uv(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)}}addCollider(e,t,i,n,r=!0){if(0===i?.getAttribute("position").count||0===i?.getIndex()?.count)return;let s;i&&(s="trimesh"===t.colliderType?Gt.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):Gt.ColliderDesc.convexMesh(i.getAttribute("position").array,r?i.getIndex().array:void 0)),s.setFrictionCombineRule(Gt.CoefficientCombineRule.Average).setRestitutionCombineRule(Gt.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let o=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(o.handle,n),this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]?.some(a=>"scene"===a.target)&&o.setActiveEvents(Gt.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,n)=>{if(0===n)return;let r;if(i instanceof Xo){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;r=i.object}else if(i instanceof wr)r=i.object;else if(r=i,r.dataPatched.cloner?.hideBase)return!0;let s=r.dataPatched;if("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled)return!0;1===n?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let o=i.geometry;void 0!==o?.getAttribute("position")&&t.push(ql(o,i.matrixWorld))}}activate(e){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,n=5,r=8,s=9,o="drag",a=this.page.data.publish.gameControlObject,l=null!==a?this.page.find(a):null,c=null;if(l)for(let d of l.data.events){if(d.data.disabled||"GameControl"!==d.data.type)break;let p=l;for(;this.usePhysics&&null!==(p=p.parent)?.parent&&!p.data.physics?.fusedBody;);d.data.collisionEnabled&&(this.needsCollisionDetection=!0),null===c&&(c=d.data)}if(this.page.traverseEntity(d=>{for(let p of d.dataPatched.events)if(!1===p.data.disabled&&"Trigger"===p.data.type)return this.needsCollisionDetection=!0,!0}),l&&c){i=i||c.camera===t.uuid||l.uuid===t.uuid;let d=new U9(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=d,n=c.joystickPosLoc,r=c.joystickRotLoc,s=c.jumpTouchButtonLoc,o=c.rotByTouch,Bs&&c.touchControl&&(this.joystickToGameControls[n]="pos","walk"===c.moveMode&&(this.joystickToGameControls[s]="jmp"),"joystick"===o&&(this.joystickToGameControls[r]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let d=this.gameControl.data;if(!this.navigationMeshWrapper){let p;this.navigationMeshWrapper=new class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(1!==ot.length)return;let{raycaster:n,page:r}=this.eventContext;this.eventContext.updateRaycaster(i);let s=r.raycastWithClones(n);if(0!==s.length){if(this.gameControl){let o=_3e.copy(this.gameControl.colliderWorldPosition);o.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(o,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,n)=>r=>{let s;if(r instanceof Xo){if(!r.objectForSample)return!0===r.object.dataPatched.physics.fusedBody&&"dynamic"===r.object.dataPatched.physics.rigidBody||void 0;if(r.objectForSample.dataPatched.physics.fusedBody)return;s=r.object}else if(r instanceof wr)s=r.object;else if(s=r,!1===s.dataPatched.cloner?.disabled&&s.dataPatched.cloner?.hideBase&&!0!==s.dataPatched.physics?.fusedBody)return!0;if(n&&!s.userData.navmesh)return;let o=s.dataPatched;if(!o.visible&&!0!==o.physics?.enabled)return!0;r.updateMatrixWorldSVD();let a=gx(o),l=s.userData.hasDestroy,c=s.userData.hasDrag,h=!1,u=!1;for(let d of o.events)!0!==d.data.disabled&&("GameControl"===d.data.type?h=!0:"Follow"===d.data.type&&(u=!0));if(h||a||u||l||c)return!0;if(this.usePhysics&&"dynamic"===o.physics?.rigidBody){if(this.usePhysics&&o.physics?.fusedBody)return!0}else if("geometry"in r&&r.geometry&&i.push(ql(r.geometry,r.matrixWorld)),this.usePhysics&&o.physics?.fusedBody)return r.traverseObject((d,p)=>{if(0===p)return;let f;if(d instanceof Xo){if(!d.objectForSample)return!0===d.object.dataPatched.physics.fusedBody&&"dynamic"===d.object.dataPatched.physics.rigidBody||void 0;if(d.objectForSample.dataPatched.physics.fusedBody)return;f=d.object}else if(d instanceof wr)f=d.object;else if(f=d,d.dataPatched.cloner?.hideBase)return!0;let m=f.dataPatched;if(!m.visible&&!0!==m.physics?.enabled)return!0;"geometry"in d&&d.geometry&&i.push(ql(d.geometry,d.matrixWorld))}),!0},this.traverseNoPhysics=(i,n)=>r=>{let s;if(r instanceof Xo)return;s=r instanceof wr?r.object:r;let o=s.dataPatched;if("visibility"===o.physics.enabled?!o.visible:!o.physics.enabled)return!0;if(n&&!s.userData.navmesh)return;let a=r.geometry,l=!0===s.userData.hasDestroy,c=!0===s.userData.hasDrag;if(gx(o)||l||c||s.dataPatched.events.some(h=>!0!==h.data.disabled&&"GameControl"===h.data.type))return!0;a&&i.push(ql(a,r.matrixWorld))},this.navmeshWasm=iq,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('https://unpkg.com/@splinetool/runtime@0.9.507/build/' + 'navmesh.js'),\n\t\tfetch('https://unpkg.com/@splinetool/navmesh-wasm@0.9.507/build/' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n":"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n")+"\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n"])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.resolution=e.ch,this.setDefaultQueryExtent((new M).setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,n=>{this.buildFromNavmeshData(n.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),c.cloner?.traverseObject(h=>{h.userData.navmesh=!0})});let n=[],r=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(n,"custom"===t.zones);if(e.traverseChildren(r),t.objects.forEach(l=>{let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),c.cloner?.traverseObject(h=>{h.userData.navmesh=void 0})}),0===n.length)return!1;let s=sh(n),{positions:o,triIndices:a}=Rw(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([o,o.length/3,a,a.length,{...y3e,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),n=i.getTriangleCount(),r=new Uint32Array(3*n),s=new Float32Array(3*n*3);for(e=0;e<3*n;e++)r[e]=e;for(e=0;e<n;e++)for(t=0;t<3;t++){let a=i.getTriangle(e).getPoint(t);s[9*e+3*t+0]=a.x,s[9*e+3*t+1]=a.y,s[9*e+3*t+2]=a.z}let o=new Ze;return o.setIndex(new st(r,1)),o.setAttribute("position",new st(s,3)),o}getClosestPoint(e){return Lt.x=e.x,Lt.y=e.y,Lt.z=e.z,this.navMesh.getClosestPoint(Lt)}getClosestPointToRef(e,t){Lt.x=e.x,Lt.y=e.y,Lt.z=e.z;let i=this.navMesh.getClosestPoint(Lt);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Lt.x=e.x,Lt.y=e.y,Lt.z=e.z,this.navMesh.getRandomPointAround(Lt,t)}getRandomPointAroundToRef(e,t,i){Lt.x=e.x,Lt.y=e.y,Lt.z=e.z;let n=this.navMesh.getRandomPointAround(Lt,t);i.set(n.x,n.y,n.z)}moveAlong(e,t){return Lt.x=e.x,Lt.y=e.y,Lt.z=e.z,ar.x=t.x,ar.y=t.y,ar.z=t.z,this.navMesh.moveAlong(Lt,ar)}moveAlongToRef(e,t,i){return Lt.x=e.x,Lt.y=e.y,Lt.z=e.z,ar.x=t.x,ar.y=t.y,ar.z=t.z,this.navMesh.moveAlong(Lt,ar)}computePath(e,t){let i=this.getClosestPoint(t);ar.x=i.x,ar.y=i.y,ar.z=i.z,this.getClosestPoint(e);let n=this.navMesh.computePath(Lt,ar),r=n.getPointCount(),s=[];for(let o=0;o<r;o++){let a=n.getPoint(o);s.push(new M(a.x,a.y,a.z))}return s}createCrowd(e,t){return new class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let n=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;n.radius=t.radius,n.height=t.height,n.maxAcceleration=t.maxAcceleration,n.maxSpeed=t.maxSpeed,n.collisionQueryRange=t.collisionQueryRange,n.pathOptimizationRange=t.pathOptimizationRange,n.separationWeight=t.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;let r=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),n);return this.transforms.push(i),this.agents.push(r),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new M(0,0,0)),r}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);void 0!==t.radius&&(i.radius=t.radius),void 0!==t.height&&(i.height=t.height),void 0!==t.maxAcceleration&&(i.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(i.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(i.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(i.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),!(e<=.001)){{let n=Math.floor(e/.016666666666666666);n>10&&(n=10),n<1&&(n=1);let r=e/n;for(let s=0;s<n;s++)this.crowd.update(r)}for(let n=0;n<this.agents.length;n++){let r=this.agents[n],s=this.getAgentPosition(r);if(this.transforms[n].copy(s),this._agentDestinationArmed[n]){let o=s.x-this._agentDestination[n].x,a=s.z-this._agentDestination[n].z,l=this.reachRadii[n];s.y>this._agentDestination[n].y-this.reachRadii[n]&&s.y<this._agentDestination[n].y+this.reachRadii[n]&&o*o+a*a<l*l&&(this.onReachTarget(r,this._agentDestination[n]),this._agentDestinationArmed[n]=!1)}}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),n=i.getPointCount(),r=[];for(t=0;t<n;t++){let s=i.getPoint(t);r.push(new M(s.x,s.y,s.z))}return r}dispose(){this.crowd.destroy()}}(this,e,t)}setDefaultQueryExtent(e){Lt.x=e.x,Lt.y=e.y,Lt.z=e.z,this.navMesh.setDefaultQueryExtent(Lt)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),n=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);n.set(e);let r=new this.navmeshWasm.NavmeshData;r.dataPointer=n.byteOffset,r.size=e.length,this.navMesh.buildFromNavmeshData(r),this.navmeshWasm._free(n.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Lt.x=e.x,Lt.y=e.y,Lt.z=e.z,this.navMesh.addCylinderObstacle(Lt,t,i)}addBoxObstacle(e,t,i){return Lt.x=e.x,Lt.y=e.y,Lt.z=e.z,ar.x=t.x,ar.y=t.y,ar.z=t.z,this.navMesh.addBoxObstacle(Lt,ar,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return void 0!==this.navmeshWasm}}(this.usePhysics,this.isExport),p="sphere"===d.collider.type?2*d.collider.radius:d.collider.height,p=Math.floor(p/d.navmesh.ch-1),this.navigationMeshWrapper.init({...d.navmesh,walkableHeight:p},this.gameControl,this.eventContext)}}if(!1===i){let{enableRotate:d,enablePan:p,enableZoom:f,autoRotate:m,hoverRotatePanMode:g}=this.eventManager.publish.orbitControls;(d||p||f||m||0!==g)&&(this.orbitControls=new oq(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let h=this.renderer.domElement.width/this.renderer.getPixelRatio(),u=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((d,p)=>{let f=document.body.appendChild(document.createElement("div")),[m,g,v]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[p],y=(h-5*m)/4+m,_={},b="jmp"===d,w=b?0:m;p<10?(p<5?_.top=w/2:_.bottom=w/2,_.left=w/2+p%5*y):10===p?(_.left=w/2,_.top=u/2):(_.right=w/2,_.top=u/2),_.top?_.top-=g[1]:_.bottom+=g[1],_.left?_.left+=g[0]:_.right-=g[0];for(let S in _)_[S]+="px";if(b){let S=f.appendChild(document.createElement("div"));return Object.assign(S.style,_,{position:"absolute",width:m+"px",height:m+"px",backgroundColor:`rgba(255,255,255,${"show"===v?.4:0})`,zIndex:"9999",borderRadius:m+"px",border:"show"===v?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"}),"show"===v&&(S.innerHTML=`\n\t\t\t\t\t\t<svg width="${m/16*16*.4}" height="${.4*m}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t`),S.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),S.addEventListener("touchend",D=>D.preventDefault()),void(this.joysticks[p]=[void 0,f])}let C={zone:f,mode:"static",position:_,size:m};"hide"===v&&(C.restOpacity=0);let x=function(e){return N8.create(e)}(C);x.on("move",(S,E)=>{let D=this.gameControl;"pos"===d?E.force<.2?D.moveForce=0:(D.movementState.movePosZ=Math.sin(-E.angle.radian),D.movementState.movePosX=Math.cos(-E.angle.radian),D.movementState.run=E.force>1.2?1:0,D.moveForce=E.force<.3?(E.force-.2)/.1:1):"rot"===d&&(E.force<.2?D.rotForce=0:(D.movementState.rotPosX=E.vector.y,D.movementState.rotPosY=-E.vector.x,D.rotForce=E.force<.3?(E.force-.2)/.1:1)),this.requestRender()}),x.on("end",(S,E)=>{let D=this.gameControl;"pos"===d?(D.movementState.movePosZ=0,D.movementState.movePosX=0,D.moveForce=1):"rot"===d&&(D.movementState.rotPosX=0,D.movementState.rotPosY=0,D.rotForce=1)}),this.joysticks[p]=[x,f]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(d=>d.disabled=!1)},80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new Gt.World(new Gt.Vector3(0,this.gravity,0)),this.events=new Gt.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{let a;if(o instanceof Xo){if(!o.objectForSample)return!0===o.object.dataPatched.physics.fusedBody&&"dynamic"===o.object.dataPatched.physics.rigidBody||void 0;if(o.objectForSample.dataPatched.physics.fusedBody)return;a=o.object}else if(o instanceof wr)a=o.object;else if(a=o,!1===a.dataPatched.cloner?.disabled&&a.dataPatched.cloner?.hideBase&&!0!==a.dataPatched.physics?.fusedBody)return!0;let c,l=a.dataPatched;for(let g of l.events)!0!==g.data.disabled&&"GameControl"===g.data.type&&(c=g.data);if(!l.physics||("visibility"===l.physics.enabled?!l.visible:!l.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=gx(l),u=!1,d=a.userData.hasDestroy,p=a.userData.hasDrag,f=!1;for(let g of l.events)if(!0!==g.data.disabled)if("Collision"===g.data.type){u=!0;let v=new u3e(g.id,g.data,a,this.page,this.sharedAssets,this.eventManager);v.disabled=!0,this.collisionEvents.push(v),this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid].every(y=>y.id!==g.id)?this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid].push(v):this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid]=[v]}else if("Follow"===g.data.type){f=!0;let v=g.data.target;o.traverseVisible(y=>{y.userData.isFollowingObj=v})}"dynamic"===l.physics.rigidBody&&!1===l.physics.fusedBody&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let m=o.geometry;if(void 0!==c){let g=Gt.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(An,ia,iu),o.position0=An.clone().divideScalar(this.pixelsPerMeter),o.rotation0=ia.clone(),An.divideScalar(this.pixelsPerMeter),g.setTranslation(An.x,An.y,An.z).setRotation(ia);let y,v=this.sharedGameControlGlobals.rapierWorld.createRigidBody(g);o.rigidBody=v,y="sphere"===c.collider.type?Gt.ColliderDesc.ball(c.collider.radius/this.pixelsPerMeter):"capsule"===c.collider.type?Gt.ColliderDesc.capsule((c.collider.height/2-c.collider.radius)/this.pixelsPerMeter,c.collider.radius/this.pixelsPerMeter):Gt.ColliderDesc.cuboid(c.collider.width/this.pixelsPerMeter/2,c.collider.height/this.pixelsPerMeter/2,c.collider.depth/this.pixelsPerMeter/2),y.setFrictionCombineRule(Gt.CoefficientCombineRule.Average).setRestitutionCombineRule(Gt.CoefficientCombineRule.Average).setDensity(l.physics.density).setFriction(l.physics.friction).setRestitution(l.physics.restitution);let _=this.sharedGameControlGlobals.rapierWorld.createCollider(y,v);this.sharedGameControlGlobals.colliderToEntity.set(_.handle,a),An.fromArray(c.collider.position).multiply(iu.setFromMatrixScale(a.matrixWorld)).divideScalar(this.pixelsPerMeter),_.setTranslationWrtParent(An);let b=(new ft).setFromEuler((new Yn).setFromVector3((new M).fromArray(c.collider.rotation)));_.setRotationWrtParent(b),_.setActiveEvents(Gt.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(a,!0)}else"dynamic"===l.physics.rigidBody||h||f||d||p||u?(this.addRigidBody(o,a,{hasFollow:f,hasTransformAnim:h,hasDrag:p}),this.generateSensorColliderDescs(a,l.physics.fusedBody)):(m&&e.push(ql(m,o.matrixWorld)),l.physics.fusedBody&&o.traverseObject((g,v)=>{if(0===v)return;let y;if(g instanceof Xo){if(!g.objectForSample)return!0===g.object.dataPatched.physics.fusedBody&&"dynamic"===g.object.dataPatched.physics.rigidBody||void 0;if(g.objectForSample.dataPatched.physics.fusedBody)return;y=g.object}else if(g instanceof wr)y=g.object;else if(y=g,y.dataPatched.cloner?.hideBase)return!0;let _=y.dataPatched;if("visibility"===_.physics.enabled?!_.visible:!_.physics.enabled)return!0;let b=g.geometry;void 0!==b?.getAttribute("position")&&e.push(ql(b,g.matrixWorld))}),this.generateSensorColliderDescs(a,l.physics.fusedBody,t));return!(!0!==l.physics?.fusedBody&&!c)||void 0}),0===e.length)return;let i=sh(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let n=Gt.RigidBodyDesc.fixed(),r=this.sharedGameControlGlobals.rapierWorld.createRigidBody(n),s=Gt.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Gt.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Gt.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,r);for(let[o,a]of t){let l=this.sharedGameControlGlobals.rapierWorld.createCollider(o,r);this.sensorToTriggerEvent[l.handle]=a}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let i=new lq(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),n=(new ye).compose(na.fromArray(t.data.position),Rf.setFromEuler(cq.fromArray(t.data.rotation)),D2);if("box"===t.data.triggerZone){let r=new ln;r.min.fromArray(t.data.size).multiplyScalar(-.5),r.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([r,n,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,n,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){this.isEnabled=!1,this.page.traverse(e=>{let t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)}),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([e,t])=>{e?.destroy(),t.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let e of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))e.forEach(t=>t.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let n=!0;if(void 0!==this.orbitControls&&this.orbitControls.needsUpdate&&(n=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,n=!1):2===this.initializationCounter&&this.gameControl&&(n=!this.gameControl.update(e,t,i)&&n),!1===this.usePhysics&&this.checkTrigger(),this.usePhysics){let r=.016666666666666666;if(0===e)n=this.stepPhysics()&&n;else{let s=e/1e3;s<r&&s>.55*r&&(s=r),this.accumulator+=s;let o=performance.now(),a=0,l=6;for(;this.accumulator>=r&&a<l&&(n=this.stepPhysics()&&n,this.accumulator-=r,a++,!(performance.now()-o>1e3*r)););this.accumulator=this.accumulator%r}}return n}stepPhysics(){for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(An,ia,iu),M2.setFromQuaternion(ia);let t=e;void 0===t.prevR?(t.prevR=M2.clone(),t.prevT=An.clone()):(t.prevR.copy(M2),t.prevT.copy(An)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(An.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(ia))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){let r,n=(this.sharedGameControlGlobals.rapierWorld?.getCollider(i))._parent;if(t.cloner)for(let s of t.cloner.children)if(s.rigidBody===n){r=s;break}e.dispatch(r),t.dispatchEvent(I2)}updateUseWindowEvents(e){this.orbitControls?.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let n=uq.copy(e.matrixWorld).invert();e.traverseEntity((r,s)=>{if(!1===t&&1===s)return!0;for(let o of r.dataPatched.events)if("Trigger"===o.data.type&&!0!==o.data.disabled){let l,a=new lq(o.id,o.data,r,this.page,this.sharedAssets,this.eventManager);if(l="box"===o.data.triggerZone?Gt.ColliderDesc.cuboid(...o.data.size.map(c=>c/(2*this.pixelsPerMeter))):Gt.ColliderDesc.ball(o.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Gt.ActiveEvents.COLLISION_EVENTS),na.fromArray(o.data.position),Rf.setFromEuler(cq.fromArray(o.data.rotation)),mx.compose(na,Rf,D2).premultiply(r.matrixWorld),i?(mx.decompose(na,Rf,A2),l.setActiveCollisionTypes(Gt.ActiveCollisionTypes.KINEMATIC_FIXED|Gt.ActiveCollisionTypes.DYNAMIC_FIXED)):(mx.premultiply(n).decompose(na,Rf,A2),e.rigidBody.bodyType()===Gt.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Gt.RigidBodyType.Fixed?l.setActiveCollisionTypes(Gt.ActiveCollisionTypes.KINEMATIC_FIXED|Gt.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Gt.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Gt.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),na.divideScalar(this.pixelsPerMeter),l.setTranslation(na.x,na.y,na.z),l.setRotation(Rf),i)i.push([l,a]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=a}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,n,r,s]=this.sharedGameControlGlobals.triggers[t];for(let o=0;o<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;o++){let a=this.sharedGameControlGlobals.entitiesWithTransformAnim[o];if(r===a||!1===s.isValidTriggeringObject(zt.is(a)?a:a.object))continue;let l=uq.copy(r.matrixWorld).decompose(na,hq,A2).compose(na,hq,D2).multiply(n),c=mx.copy(a.matrixWorld).invert().multiply(l);i instanceof ln?e=a.bvhGeometry.boundsTree.intersectsBox(i,c):(T2.radius=i,T2.center.setFromMatrixPosition(c),e=a.bvhGeometry.boundsTree.intersectsSphere(T2)),e?-1===s.currentIntersectedObjects.indexOf(a)&&(s.currentIntersectedObjects.push(a),s.dispatch(),r.dispatchEvent(R3e)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(h=>h!==a)}}}}(l),n._animationControls=new class{constructor(e,t,i,n){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=n,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=r=>{"Empty"===r.data.type&&r.data.animations&&r.data.animations.forEach((s,o)=>{let a=s[0]+"/";if(Array.isArray(r.identity)?a+=r.identity[0]:a+=r.uuid,this.clipIdToAction[a])return;let l=pA.parse(JSON.parse(s[2]));r.animations[o]=l;let c=this.mixer.clipAction(l,r);!1===dq&&(Object.getPrototypeOf(c)._updateTime=N3e,dq=!0),c.clampWhenFinished=!0,this.clipIdToAction[a]=c})},this.mixer=new Nve(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let n=i.animations.find(s=>s.uuid===e);if(!n)return;let r=this.clipIdToAction[e];!r||(r.stop(),this.mixer.uncacheClip(n),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=2201}),this.mixer.stopAllAction(),this.requestRender()}play(e){let i=this.clipIdToAction[e.clipId+"/"+e.object];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),"pingpong"===e.direction&&0!==e.repeat&&(i.loop=2202)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){if(this.needsUpdate)this.needsUpdate=!1;else if(!1===this.isPlaying||this.animationInspectorState?.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){return this.activeClip?.tracks[0]?.times.length??0}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?e/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}}(n._scene,n._requestRenderAutoMode),n._eventManager=new class{constructor(e,t,i,n,r){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=n,this.sharedVariables=r,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onResetRaycaster=()=>{this.eventContext.raycasterNeedsUpdate=!0},this.onTouchMovePreventScroll=s=>{(s.touches.length>1||this.preventTouchScroll)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{let{domRect:o}=this.eventContext,{pageX:a,pageY:l}=s.touches?.length>0?s.touches[0]:s;return{x:a-(o.left+window.scrollX),y:l-(o.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=n.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new OOe(this.eventContext),DynamicVariable:new h3e(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),Conditional:new zOe(this.eventContext,this),Start:new c3e(this.eventContext,this),Basic:new NOe(this.eventContext,this,this.needsRaycast),MouseHover:new r3e(this.eventContext,this),Scroll:new a3e(this.eventContext,this),Follow:new QOe(this.eventContext,this),DragDrop:new WOe(this.eventContext,this),LookAt:new t3e(this.eventContext),Resize:new H3e(this.eventContext,this)};let{page:e,domElement:t,eventElement:i}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),e.traverseEntity(n=>{n.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(n=>n.connect()),pq.forEach(n=>{(Object.values(this.handlers).some(r=>r.domEventsNeeded.has(n))||"pointerdown"===n&&this.controlsManager.navigationMeshWrapper)&&(t.addEventListener(n,this.onResetRaycaster),i.addEventListener(n,this.onResetRaycaster))}),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:t}=this.eventContext;t.style.cursor="",Object.values(this.handlers).forEach(i=>i.disconnect()),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(i=>{i.removeEventListener("requestRender",this.requestRender),i.destroyedInAction=!1}),pq.forEach(i=>{t.removeEventListener(i,this.onResetRaycaster)}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if("Conditional"===i.data.type&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),"Conditional"===i.data.type||"SetVariable"===i.data.type)for(let n of"Conditional"===i.data.type?i.data.condition:i.data.expression)"id"in n&&Array.isArray(n.id)&&("mouse"===n.id[0]&&(this.needsMouse=!0),"raycast"===n.id[0]&&(this.needsRaycast=!0));"DynamicVariablePlay"===i.data.type&&""!==i.data.variableId&&("Play"===i.data.mode||"PlayPause"===i.data.mode||"Toggle"===i.data.mode)&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{if(i.data?.events.length)for(let n of i.data.events)if(!n.data.disabled)if("VariableChange"===n.data.type&&("mouseProperty"===n.data.variableId&&(this.needsMouse=!0),"raycastProperty"===n.data.variableId&&(this.needsRaycast=!0)),"Conditional"===n.data.type)for(let r of["inActions","outActions"])n.data[r].forEach(t);else if("DragDrop"===n.data.type)for(let r of["drag","drop"])n.data.dragDropActions[r].forEach(t);else if("GameControl"===n.data.type)for(let r of["idle","move","jump","run"])n.data.gameActions[r].forEach(t);else if("Resize"===n.data.type)for(let r of n.data.breakpoints)r.data.actions.forEach(t);else"LookAt"===n.data.type||n.data.actions.forEach(t)})}}(r.scene.publish,n._controls,n._animationControls,l,r.shared.variables),n._eventManager.activate(),n._controls.activate(n._eventManager)}n._resize(),void 0!==i&&n.setVariables(i),0===n.dt&&(n.render(performance.now()),setTimeout(()=>{n._renderer?.setAnimationLoop(n.render)},0)),n._resizeObserverTimeout=setTimeout(()=>{!n._resizeObserver&&n.canvas.parentElement&&(n._resizeObserver=new ResizeObserver(()=>{n._viewportWidth=n.canvas.clientWidth,n._viewportHeight=n.canvas.clientHeight,n._debouncedResize()}),n._resizeObserver.observe(n.canvas.parentElement))},300)})()}setVariables(e){if(void 0!==this._data){let t=Object.entries(e);for(let[i,n]of t)this.setVariable(i,n)}}setVariable(e,t){let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;"number"==typeof i.data.value?n="number"==typeof t?t:"boolean"==typeof t?!0===t?1:0:parseFloat(t):"boolean"==typeof i.data.value?n="number"==typeof t?!!t:"boolean"==typeof t?t:"false"!==t.toLocaleLowerCase()&&!!t:"string"!=typeof i.data.value&&void 0!==i.data.value.textValue&&(n=t.toString());let r="string"==typeof n?{textValue:n}:n;this._sharedAssetsManager?.updateVariable(i.id,r),this.requestRender(),this._requestRenderAutoMode()}else void 0===i?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{void 0===e[t.data.name]&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return"string"!=typeof e&&Us.isTextValue(e)?Us.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){let t=this._scene?.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){let t=this._scene?.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){let e=[];return this._scene?.traverseEntity(t=>{if(!(t.uuid===Tp||this._scene.isInvisibleObjects(t)||t instanceof Zc)){let i=this._createProxyObject(t);i&&e.push(i)}}),e}getSplineEvents(){return(this._eventManager?.handlers?.Spline).splineEvents}emitEvent(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEvent(e)}emitEventReverse(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){this._controls?.orbitControls instanceof oq&&this._controls?.orbitControls.zoomOut(e)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){let{r:t,g:i,b:n,a:r}={r:0,g:0,b:0,a:1},s=new _s(t,i,n,r);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}this._scene?.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach(e=>{T4.unsubscribe(e)}),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),void 0!==this._resizeObserverTimeout&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),function vCe(e){e.removeEventListener("pointerdown",zH,!0),e.removeEventListener("pointerdown",Nb,!0),e.removeEventListener("pointermove",Nb,!0),e.removeEventListener("pointerup",Ep,!0),e.removeEventListener("pointercancel",Ep,!0),e.removeEventListener("pointerleave",Ep,!0),window.removeEventListener("keydown",UH,!0),window.removeEventListener("keyup",jH,!0)}(this.canvas)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(e){this._eventManager?.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){if(null==e)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(r=>{r instanceof Zc&&(t=r.name)});let n=T4({name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof Zc||e instanceof zI?void 0:e.parent?.uuid,emitEvent(r){e.dispatchEvent({type:"userEvent",eventName:r})},emitEventReverse(r){e.dispatchEvent({type:"userEvent",eventName:r,reverse:!0})}},(r,s)=>{"object"!=typeof e[r]&&Object.getOwnPropertyDescriptor(e,r)?.writable&&(e[r]=s),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,n),n}}(i.nativeElement).load(n)}static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275cmp=Ar({type:e,selectors:[["app-root"]],viewQuery:function(n,r){if(1&n&&(Po(cLe,7),Po(uLe,7)),2&n){let s;Lr(s=Nr())&&(r.canvas3d1=s.first),Lr(s=Nr())&&(r.canvas3d2=s.first)}},decls:13,vars:0,consts:[[1,"canvas-container"],["id","canvas3d1"],["canvas3d1",""],[1,"overlay-component1"],["id","canvas3d2"],["canvas3d2",""],[1,"overlay-component2"]],template:function(n,r){1&n&&(wt(0,"app-header"),Me(1,"div",0),wt(2,"canvas",1,2)(4,"app-present",3),Pe(),wt(5,"app-about"),Me(6,"div",0),wt(7,"canvas",4,5)(9,"app-features",6),Pe(),wt(10,"app-overview")(11,"app-getapp")(12,"app-footer"))},dependencies:[nV,nLe,rLe,sLe,oLe,aLe,lLe],styles:[".canvas-container[_ngcontent-%COMP%]{position:relative}#canvas3d1[_ngcontent-%COMP%]{width:100%;height:100%}.overlay-component1[_ngcontent-%COMP%]{position:absolute;top:5%;left:25%}#canvas3d2[_ngcontent-%COMP%]{width:100%;height:100%}.overlay-component2[_ngcontent-%COMP%]{position:absolute;top:10%;left:25%}"]})}return e})(),fq=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({})}return e})();new Le("MdbAccordionItemBodyDirective"),new Le("MdbAccordionItemHeaderDirective");let fLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,fq]})}return e})(),vLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs]})}return e})();const yLe={provide:Os,useExisting:ui(()=>bLe),multi:!0};class _Le{element;checked}let bLe=(()=>{class e{get checked(){return this._checked}set checked(i){this._checked=Ru(i)}_checked=!1;get value(){return this._value}set value(i){this._value=i}_value=null;get disabled(){return this._disabled}set disabled(i){this._disabled=Ru(i)}_disabled=!1;checkboxChange=new Ii;get isDisabled(){return this._disabled}get isChecked(){return this._checked}onCheckboxClick(){this.toggle()}onBlur(){this.onTouched()}constructor(){}get changeEvent(){const i=new _Le;return i.element=this,i.checked=this.checked,i}toggle(){this.disabled||(this._checked=!this._checked,this.onChange(this.checked),this.onCheckboxChange())}onCheckboxChange(){this.checkboxChange.emit(this.changeEvent)}onChange=i=>{};onTouched=()=>{};writeValue(i){this.value=i,this.checked=!!i}registerOnChange(i){this.onChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this.disabled=i}static ngAcceptInputType_checked;static ngAcceptInputType_disabled;static \u0275fac=function(n){return new(n||e)};static \u0275dir=et({type:e,selectors:[["","mdbCheckbox",""]],hostVars:2,hostBindings:function(n,r){1&n&&vn("click",function(){return r.onCheckboxClick()})("blur",function(){return r.onBlur()}),2&n&&Mm("disabled",r.isDisabled)("checked",r.isChecked)},inputs:{checked:"checked",value:"value",disabled:"disabled"},outputs:{checkboxChange:"checkboxChange"},features:[_i([yLe])]})}return e})(),wLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,v_]})}return e})(),xLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,o_]})}return e})(),SLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,o_]})}return e})(),CLe=(()=>{class e{get name(){return this._name}set name(i){this._name=i}_name;get checked(){return this._checked}set checked(i){this._checked=Ru(i)}_checked=!1;get value(){return this._value}set value(i){this._value=i}_value=null;get disabled(){return this._disabled}set disabled(i){this._disabled=Ru(i)}_disabled=!1;get isDisabled(){return this._disabled}get isChecked(){return this._checked}get nameAttr(){return this.name}constructor(){}_updateName(i){this._name=i}_updateChecked(i){this._checked=i}_updateDisabledState(i){this._disabled=i}static ngAcceptInputType_checked;static ngAcceptInputType_disabled;static \u0275fac=function(n){return new(n||e)};static \u0275dir=et({type:e,selectors:[["","mdbRadio",""]],hostVars:3,hostBindings:function(n,r){2&n&&(Mm("disabled",r.isDisabled)("checked",r.isChecked),Do("name",r.nameAttr))},inputs:{name:"name",checked:"checked",value:"value",disabled:"disabled"}})}return e})();const ELe={provide:Os,useExisting:ui(()=>MLe),multi:!0};let MLe=(()=>{class e{radios;get value(){return this._value}set value(i){this._value=i,this.radios&&this._updateChecked()}_value;get name(){return this._name}set name(i){this._name=i,this.radios&&this._updateNames()}_name;get disabled(){return this._disabled}set disabled(i){this._disabled=i,this.radios&&this._updateDisabled()}_disabled=!1;_destroy$=new yi;onChange=i=>{};onTouched=()=>{};ngAfterContentInit(){this._updateNames(),this._updateDisabled(),this.radios.changes.pipe($F(this.radios),So(i=>Pn(Promise.resolve(i))),Au(this._destroy$)).subscribe(()=>this._updateRadiosState())}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}_updateRadiosState(){this._updateNames(),this._updateChecked(),this._updateDisabled()}_updateNames(){this.radios.forEach(i=>i._updateName(this.name))}_updateChecked(){this.radios.forEach(i=>{i._updateChecked(i.value===this._value)})}_updateDisabled(){this.radios.forEach(i=>i._updateDisabledState(this._disabled))}registerOnChange(i){this.onChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this._disabled=i,this._updateDisabled()}writeValue(i){this.value=i}static \u0275fac=function(n){return new(n||e)};static \u0275dir=et({type:e,selectors:[["","mdbRadioGroup",""]],contentQueries:function(n,r,s){if(1&n&&Lm(s,CLe,5),2&n){let o;Lr(o=Nr())&&(r.radios=o)}},inputs:{value:"value",name:"name",disabled:"disabled"},features:[_i([ELe])]})}return e})(),ALe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,v_]})}return e})();const DLe=["input"],TLe=["thumb"],ILe=["thumbValue"],PLe=function(e){return{"thumb-active":e}},RLe={provide:Os,useExisting:ui(()=>OLe),multi:!0};let OLe=(()=>{class e{_cdRef;input;thumb;thumbValue;id;required;name;value;get disabled(){return this._disabled}set disabled(i){this._disabled=Ru(i)}_disabled;label;min=0;max=100;step;get default(){return this._default}set default(i){this._default=i}_default;defaultRangeCounterClass;rangeValueChange=new Ii;visibility=!1;thumbStyle;onchange(i){this.onChange(i.target.value)}onInput(){this.rangeValueChange.emit({value:this.value}),this.focusRangeInput()}constructor(i){this._cdRef=i}ngAfterViewInit(){this.thumbPositionUpdate()}focusRangeInput(){this.input.nativeElement.focus(),this.visibility=!0}blurRangeInput(){this.input.nativeElement.blur(),this.visibility=!1}thumbPositionUpdate(){const i=this.input.nativeElement,n=i.value,r=i.min?i.min:0,o=Number(100*(n-r)/((i.max?i.max:100)-r));this.value=n,this.thumbStyle={left:`calc(${o}% + (${8-.15*o}px))`}}onChange=i=>{};onTouched=()=>{};writeValue(i){this.value=i,this._cdRef.markForCheck(),setTimeout(()=>{this.thumbPositionUpdate()},0)}registerOnChange(i){this.onChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this.disabled=i}static ngAcceptInputType_default;static ngAcceptInputType_disabled;static \u0275fac=function(n){return new(n||e)(pe(Fm))};static \u0275cmp=Ar({type:e,selectors:[["mdb-range"]],viewQuery:function(n,r){if(1&n&&(Po(DLe,5),Po(TLe,5),Po(ILe,5)),2&n){let s;Lr(s=Nr())&&(r.input=s.first),Lr(s=Nr())&&(r.thumb=s.first),Lr(s=Nr())&&(r.thumbValue=s.first)}},hostBindings:function(n,r){1&n&&vn("change",function(o){return r.onchange(o)})("input",function(){return r.onInput()})},inputs:{id:"id",required:"required",name:"name",value:"value",disabled:"disabled",label:"label",min:"min",max:"max",step:"step",default:"default",defaultRangeCounterClass:"defaultRangeCounterClass"},outputs:{rangeValueChange:"rangeValueChange"},features:[_i([RLe])],decls:10,vars:14,consts:[["for","id",1,"form-label"],[1,"range"],["type","range","min","0","max","5",1,"form-range",3,"name","disabled","id","min","max","step","value","input","blur","mousedown","mouseup","touchstart","touchend"],["input",""],[1,"thumb",3,"ngStyle","ngClass"],["thumb",""],[1,"thumb-value"],["thumbValue",""]],template:function(n,r){1&n&&(Me(0,"label",0),ht(1),Pe(),Me(2,"div",1)(3,"input",2,3),vn("input",function(){return r.thumbPositionUpdate()})("blur",function(){return r.blurRangeInput()})("mousedown",function(){return r.focusRangeInput()})("mouseup",function(){return r.blurRangeInput()})("touchstart",function(){return r.focusRangeInput()})("touchend",function(){return r.blurRangeInput()}),Pe(),Me(5,"span",4,5)(7,"span",6,7),ht(9),Pe()()()),2&n&&(cd(1),l0(r.label),cd(2),Sm("name",r.name)("disabled",r.disabled)("id",r.id)("min",r.min)("max",r.max)("step",r.step)("value",r.value)("id",r.id),cd(2),Sm("ngStyle",r.thumbStyle)("ngClass",QS(12,PLe,r.visibility)),cd(4),l0(r.value))},dependencies:[FC,xF],encapsulation:2,changeDetection:0})}return e})(),LLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,v_]})}return e})(),NLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({})}return e})(),kLe=(()=>{class e{scrollSpys=[];activeSubject=new yi;active$=this.activeSubject;addScrollspy(i){this.scrollSpys.push(i)}removeScrollspy(i){const n=this.scrollSpys.findIndex(r=>r.id===i);this.scrollSpys.splice(n,1)}updateActiveState(i,n){const r=this.scrollSpys.find(o=>o.id===i);if(!r)return;const s=r.links.find(o=>o.id===n);this.setActiveLink(s)}removeActiveState(i,n){const r=this.scrollSpys.find(o=>o.id===i);if(!r)return;const s=r.links.find(o=>o.id===n);s&&(s.active=!1,s.detectChanges())}setActiveLink(i){i&&(i.active=!0,i.detectChanges(),this.activeSubject.next(i))}removeActiveLinks(i){const n=this.scrollSpys.find(r=>r.id===i);n&&n.links.forEach(r=>{r.active=!1,r.detectChanges()})}static \u0275fac=function(n){return new(n||e)};static \u0275prov=je({token:e,factory:e.\u0275fac})}return e})(),FLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({providers:[kLe]})}return e})();new Le("MdbTabContentDirective"),new Le("MdbTabTitleDirective");let HLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,AE]})}return e})(),GLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs,o_]})}return e})(),WLe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=oi({type:e});static \u0275inj=ti({imports:[Rs]})}return e})(),qLe=(()=>{class e{static#e=this.\u0275fac=function(n){return new(n||e)};static#t=this.\u0275mod=oi({type:e,bootstrap:[hLe]});static#i=this.\u0275inj=ti({imports:[Nre,nue,fLe,vLe,wLe,fq,xLe,tue,Yle,SLe,ALe,LLe,NLe,FLe,HLe,GLe,WLe]})}return e})();Ore().bootstrapModule(qLe).catch(e=>console.error(e))},861:(Wv,qv,In)=>{function kt(ru,$l,en,su,ou,au,Es){try{var ra=ru[au](Es),$a=ra.value}catch(Lf){return void en(Lf)}ra.done?$l($a):Promise.resolve($a).then(su,ou)}function Of(ru){return function(){var $l=this,en=arguments;return new Promise(function(su,ou){var au=ru.apply($l,en);function Es($a){kt(au,su,ou,Es,ra,"next",$a)}function ra($a){kt(au,su,ou,Es,ra,"throw",$a)}Es(void 0)})}}In.d(qv,{Z:()=>Of})}},Wv=>{Wv(Wv.s=913)}]);